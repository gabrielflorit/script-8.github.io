{"version":3,"sources":["images/logo.png","images/loshermanosbros-lite.gif","images/breakout-lite.gif","images/brospipe-lite.gif","images/livecoding480.gif","images/slider480.gif","images/pauserewind.gif","images/toggle.gif","images/spritedemo.gif","images/mapdemo.gif","images/musicdemo.gif","iframe/src/colors.js","iframe/src/utils/screenTypes.js","actions/actionTypes.js","iframe/src/blankTemplate.js","iframe/src/store/initialState.js","iframe/src/toLetter.js","iframe/src/gistParsers/phrases.js","utils/throwError.js","iframe/src/utils/runningSum.js","iframe/src/gistParsers/game.js","reducers/game.js","actions/actions.js","containers/Boot.js","containers/Home.js","iframe/src/utils/bios.js","iframe/src/skeleton.js","iframe/src/gistParsers/map.js","iframe/src/gistParsers/sprites.js","iframe/src/gistParsers/chains.js","iframe/src/gistParsers/songs.js","iframe/src/gistParsers/iframeVersion.js","utils/isDirty.js","utils/canRecord.js","utils/setupLinter.js","utils/getGameTitle.js","iframe/src/utils/gameLineToTabLine.js","containers/Output.js","utils/string.js","iframe/src/frameBufferCanvasAPI/line.js","iframe/src/frameBufferCanvasAPI/polyStroke.js","iframe/src/frameBufferCanvasAPI/circle.js","iframe/src/frameBufferCanvasAPI/sprite.js","iframe/src/frameBufferCanvasAPI/alphabet.js","iframe/src/frameBufferCanvasAPI/print.js","iframe/src/frameBufferCanvasAPI/index.js","iframe/src/frameBufferCanvasAPI/rect.js","iframe/src/contextCanvasAPI/circle.js","iframe/src/contextCanvasAPI/line.js","iframe/src/contextCanvasAPI/polyStroke.js","iframe/src/contextCanvasAPI/alphabet.js","iframe/src/contextCanvasAPI/print.js","iframe/src/contextCanvasAPI/sprite.js","iframe/src/contextCanvasAPI/index.js","iframe/src/contextCanvasAPI/pixel.js","containers/Sprite.js","iframe/src/frameBufferCanvasAPI/pixelData.js","containers/Map.js","iframe/src/settings.js","iframe/src/normalize.js","iframe/src/soundAPI/index.js","components/TextInput.js","containers/Phrase.js","containers/Chain.js","containers/Song.js","utils/patcher.js","containers/Tutorial.js","utils/commands.js","components/CodeEditor.js","containers/Code.js","containers/Help.js","utils/frecency.js","utils/timeAgo.js","components/ShelfCassettes.js","containers/Shelf.js","containers/Notice.js","components/Comments.js","containers/Updater.js","utils/isBlank.js","containers/Menu.js","components/TopBar.js","components/ErrorBoundary.js","containers/App.js","reducers/screen.js","reducers/gist.js","reducers/booted.js","reducers/token.js","reducers/nextAction.js","reducers/sprites.js","reducers/map.js","reducers/phrases.js","reducers/chains.js","reducers/songs.js","reducers/tutorial.js","reducers/sound.js","reducers/shelving.js","reducers/docHistories.js","reducers/dismissedNotices.js","reducers/selectedUi.js","reducers/errorLine.js","reducers/iframeVersion.js","reducers/hideMenu.js","reducers/reducer.js","store/store.js","store/localStorage.js","index.js"],"names":["module","exports","__webpack_require__","p","screenTypes","BOOT","HOME","RUN","HELP","CODE","SPRITE","MAP","SONG","CHAIN","PHRASE","SHELF","cycleOrder","getNextScreen","screen","index","indexOf","length","getPreviousScreen","actionTypes","TOGGLE_MENU","UPDATE_IFRAME_VERSION","SET_ERROR_LINE","CLEAR_TOKEN","SELECT_UI","TOGGLE_SOUND","DISMISS_NOTICES","SET_SCREEN","FETCH_GIST_REQUEST","FETCH_GIST_SUCCESS","FINISH_BOOT","UPDATE_GAME","NEW_GAME","TOKEN_REQUEST","TOKEN_SUCCESS","SET_NEXT_ACTION","CLEAR_NEXT_ACTION","SAVE_GIST_REQUEST","SAVE_GIST_SUCCESS","UPDATE_SFX","UPDATE_SPRITE","UPDATE_MAP","UPDATE_PHRASE","UPDATE_CHAIN","UPDATE_SONG","SET_TUTORIAL_SLIDE","CLOSE_TUTORIAL","SHELVE_CASSETTE_REQUEST","SHELVE_CASSETTE_SUCCESS","UNSHELVE_CASSETTE_REQUEST","UNSHELVE_CASSETTE_SUCCESS","SET_VISIBILITY_REQUEST","SET_VISIBILITY_SUCCESS","COUNTER_CASSETTE_REQUEST","COUNTER_CASSETTE_SUCCESS","SET_SCROLL_DATA","SET_CODE_TAB","UPDATE_HISTORY","SET_CALL_UNDER_MOUSE","CLEAR_CALL_UNDER_MOUSE","blankTemplate","initialState","hideMenu","iframeVersion","version","errorLine","booted","gist","game","0","text","active","key","token","nextAction","sprites","map","phrases","chains","songs","docHistories","dismissedNotices","selectedUi","phrase","chain","song","tutorial","sound","shelving","notes","toLetter","number","includeOctave","normalize","letter","numberToNote","octave","Math","floor","numberToOctave","concat","compressPhrases","_","mapValues","note","noteIndex","volume","join","tempo","isNil","synth","extractGistPhrases","data","JSON","parse","get","stringify","omitEmpty","phraseIsArray","Array","isArray","match","slice","keyBy","d","omit","value","isEmpty","throwError","_ref","error","message","Error","runningSum","array","push","reduce","acc","cur","idx","previous","Object","toConsumableArray","assembleOrderedGame","decorate","arguments","undefined","orderBy","tab","callUnderMouse","node","before","start","nodeCode","end","after","decorateTabCode","filter","parseGistGame","misc","content","lines","ranges","contentLines","split","objectSpread","defineProperty","apply","assembleMiscLines","range","getActive","keys","handleActions","_handleActions","state","action","payload","toString","_ref2","_ref3","scrollData","_ref4","_ref5","actions","createActions","_createActions","IS_NEW_USER","saveGist","_ref7","toFork","dispatch","saveGistRequest","gh","GitHub","preparePayload","id","link","createLink","README","miscJson","public","description","files","sprites.json","map.json","phrases.json","chains.json","songs.json","README.md","gistGame","assembledGistGame","assembledGame","createGist","getGist","create","then","response","saveGistSuccess","user","login","fork","read","catch","update","Boot","_this$props","this","props","fetchGist","setScreen","search","window","location","params","URLSearchParams","shelfUser","_this$props2","counterCassette","isFetching","react_default","a","createElement","className","Component","connect","counterCassetteRequest","fetch","process","json","counterCassetteSuccess","fetchGistRequest","fetchGistSuccess","Home","_this","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","handleStartTutorial","bind","assertThisInitialized","handleSeeLessons","handleClickGifs","startTutorial","src","logo","alt","timestamp","href","onClick","loshermanosbrosgif","breakoutgif","brospipegif","classNames","invisible","livecoding480","slider480","pauserewind","toggle","title","width","height","frameBorder","allow","allowFullScreen","spritedemo","mapdemo","musicdemo","setTutorialSlide","lessonIndex","slideIndex","boot","extractGistMap","extractGistSprites","extractGistChains","extractGistSongs","parseGistIframeVersion","isDirty","thisGame","gameIsDirty","equal","mapIsDirty","spritesIsDirty","phrasesIsDirty","chainsIsDirty","songsIsDirty","iframeVersionIsDirty","canRecord","dirty","gistLogin","currentLogin","parseOptions","ecmaVersion","sourceType","locations","InvalidTokenError","loc","raisedAt","name","findInvalidNode","nodes","Promise","resolve","channel","MessageChannel","type","tokens","document","querySelector","contentWindow","postMessage","port2","port1","onmessage","getLintErrors","asyncToGenerator","regenerator_default","mark","_callee","errors","parsed","wrap","_context","prev","next","acorn","walk","Identifier","sent","t0","from","line","ch","column","to","replace","severity","abrupt","stop","_x","setupLinter","CodeMirror","registerHelper","getGameTitle","trim","toUpperCase","gameLineToTabLine","gameLine","miscLines","sum","findIndex","pair","tabLine","throttledTokenCount","throttle","x","parts","numberWithCommas","tokenizer","Output","handleToggleMenuClick","evaluate","handleClickSize","handleClickError","resize","debounce","handleBlur","addEventListener","showSize","logs","isLoaded","toggleMenu","setState","e","run","currentTarget","focus","setCodeTab","setErrorLine","tabAndTabLine","Date","now","_iframe","prevProps","finishBoot","removeEventListener","_this2","sendPayload","callbacks","isDoneFetching","callback","_e$data","shortcut","endCallback","console","warn","_this3","_this$state","_this$props3","gameTitle","tokenCount","iframeUrl","in-tutorial","sandbox","ref","onLoad","log","_ref4$data","position","bios","includes","drawLine","x1","y1","x2","y2","setPixel","color","steep","abs","dx","dy","derror","y","drawPolyStroke","points","args","c","newPoints","xRot","yRot","midX","midY","cos","PI","sin","xs","ys","min","max","i","round","drawCircle","cx","cy","radius","onlyStroke","err","drawReflectedPair","drawSprite","spriteIndex","darken","flipH","flipV","forEach","cells","rowIndex","colIndex","clamped","clamp","alphabet","<",">","/",":","|","(",")","1","2","3","4","5","6","7","8","9"," ",".",",","+","-","!","?","b","f","g","h","j","k","l","m","n","o","q","r","s","t","u","v","w","z","drawText","letters","currentX","currentY","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","done","pixels","toLowerCase","letterWidth","return","shouldHighlight","canvasAPI","canvasWidth","canvasHeight","_ref$map","initialMap","_runningMap","_cameraX","_cameraY","_colorSwaps","int","colors","newColor","sprite","camera","clear","fill","colorSwap","getPixel","lookupInt","polyStroke","_len","_key","rectStroke","left","right","top","bottom","drawRectStroke","rectFill","rectX","drawRectFill","circStroke","circFill","print","getTile","mx","my","tile","result","setTile","spriteNumber","row","rowNumber","colNumber","resetMap","triplets","rgbStrings","slicedToArray","intLookup","values","possiblyNegativeInteger","reverseIntLookup","rgb","triplet","circle","ctx","fillStyle","strokeStyle","drawPixel","fillRect","x0","beginPath","moveTo","lineTo","stroke","current","xOffset","yOffset","grid","imageData","getImageData","pixel","pixelIndex","offset","putImageData","_ref$darken","_ref$flipH","_ref$flipV","setTransform","_memoryCanvas","_mCtx","getContext","entries","skey","pixelSprite","strokeRect","translate","sx","sy","drawImage","save","clearRect","restore","_ctx$getImageData$dat","alpha","lookup","Sprite","draw","handleTypeClick","handleColorClick","handleCanvasClick","handleOnMouseDown","handleOnMouseEnter","handleOnMouseUp","handleOnTouchMove","getCurrentSprite","setMode","colorIndex","mouseDown","mode","_canvas","col","typeIndex","updateSprite","_e$target$dataset","target","dataset","_e$target$dataset2","touchLocation","changedTouches","elementFromPoint","clientX","clientY","str","replacement","newSprite","substr","_this$state2","onMouseUp","onTouchEnd","data-row","data-col","onMouseDown","onMouseEnter","onTouchStart","onTouchMove","hide","thisSpriteIndex","pixelData","_pixelData","ImageData","_pixelBuffer","ArrayBuffer","_pixelBytes","Uint8ClampedArray","Uint32Array","writePixelDataToCanvas","set","Map","handleSpriteClick","handleRoomClick","spritePixelData","roomPixelData","drawRoom","mapPixelData","drawMap","getCurrentRoom","roomIndex","drawSprites","spriteCanvasAPI","_spriteCanvas","roomCanvasAPI","rowN","colN","_roomCanvas","_this4","mapCanvasAPI","_mapCanvas","updateMap","newMap","createBlankMap","_this5","thisRoomIndex","settings","octaves","volumes","matrixLength","chainChannels","startOffset","startOffsetDouble","bpm","subdivision","vol","slowToFastTempo","fastToSlowTempo","reverse","tempoToPlaybackRate","tempoToSubdivision","16n","createSynth","volumeNode","Tone","oscillator","envelope","release","script8Name","triggerAttack","_ref2$time","time","currentTime","velocity","triggerAttackRelease","_ref3$time","duration","triggerRelease","_ref4$time","_ref4$delay","delay","TextInput","label","handleChange","options","assign","onChange","synths","getCurrentPhrase","Phrase","keydown","handleOctaveChange","handleVolumeChange","handleCloneChange","handleClear","handleClone","createSequence","handleTempoChange","handleSynthChange","handlePhraseIndexChange","handleNoteClick","handleVolumeClick","handlePlay","drawCallback","isPlaying","playingIndex","selectedCloneIndex","selectedOctave","selectedVolume","blur","phraseIndex","_ref6","updatePhrase","validClonePhraseKeys","getValidClonePhraseKeys","confirm","event","code","resume","sequence","playbackRate","schedule","_e$target","validity","valid","_this$props4","newPhrase","_e$target2","_this$props5","_e$target3","_this$props6","selectUi","newPosition","_this$props7","newNote","_ref8","_this$props8","oldPhrase","components_TextInput","highlighter","highlight","disabled","chainIsEmpty","intersection","getCurrentChain","Chain","handleSelectedPhraseChange","handleChainIndexChange","handlePhraseClick","selectedPhraseIndex","chainIndex","updateChain","validCloneChainKeys","getValidCloneChainKeys","_$padStart$split$map","padStart","parseInt","_$padStart$split$map2","phrasePosition","notePosition","phrasesIndices","noteElement","pow","newChain","cloneDeep","allPhrases","sortBy","uniq","newPhraseIndex","setWith","oldChain","getCurrentSong","songIsEmpty","Song","handleSongIndexChange","handleChainClick","updateSong","songIndex","chainPosition","sortedChains","last","newChainIndex","oldSong","newSong","patcher","slides","accumulator","deleteOne","deleteRange","replaceOne","replaceRange","add","same","lineNumberToDelete","lineNumberToDeleteStart","lineNumberToDeleteEnd","lineNumberToReplaceStart","lineNumberToReplaceEnd","substring","lineNumberToReplace","lineNumberToAdd","areRequirementsMet","requirements","every","Tutorial","handleClose","handlePrevious","handleNextSlide","handleNextLesson","handleSlide","fireActions","buttonsElement","setButtonsRef","updateGame","lessons","slide","slideScreen","slideMap","patchedGame","_d$split","_d$split2","prevState","scrollIntoView","closeTutorial","_this$props$tutorial","newGameOnNext","newGame","_this$props$tutorial2","tutorialRef","_lessons$lessonIndex","close","enableNextSlide","nextSlide","nextLesson","buttons","progress","in-run","startsWith","dangerouslySetInnerHTML","__html","commands","cm","spaces","getOption","replaceSelection","comment","toggleComment","format","setContents","oldCode","getValue","indexFromPos","getCursor","_prettier$formatWithC","prettier","formatWithCursor","cursorOffset","parser","plugins","babel","prettierParser","semi","singleQuote","prettierOpts","formatted","newCursor","posFromIndex","setCursor","platform","navigator","CodeEditor","sliderMark","hoverMark","handleSlider","activateSlider","hideSlider","highlightText","mouseMove","activeGame","codeMirror","_editor","theme","lint","lineNumbers","tabSize","cursorBlinkRate","scrollbarStyle","extraKeys","Tab","Cmd-/","Ctrl-/","Alt-F","Esc","docHistory","getDoc","setHistory","clearHistory","on","classList","updateContent","scrollTo","cursorPosition","_slider","firstLine","lastLine","cmLines","getLine","whiteSpaces","defaultCharWidth","defaultTextHeight","remove","addWidget","_highlighterBox","style","cursor","getTokenAt","markText","middleCoords","charCoords","wrapperRect","_wrapper","getBoundingClientRect","string","valueNumber","_this$sliderMark$find","find","newToken","setValue","refresh","nextProps","linesToHighlight","updateHistory","history","getHistory","oldScrollInfo","getScrollInfo","oldCursorPosition","setScrollData","counter","isReady","setInterval","clearInterval","clearCallUnderMouse","ctrlKey","mousePos","coordsChar","pageX","pageY","outside","smallestNode","smallestSize","Infinity","CallExpression","nodeSize","_unused","setCallUnderMouse","scrollInfo","_this6","onMouseMove","step","onInput","Code","handleTabUpdates","components_CodeEditor","Help","handleLesson","setLessonIndex","lesson","shortTitle","howTo","dt","dd","react","shortcuts","apiDocs","section","dl","parseDate","mdy","frecency","visits","date","first","second","daysAgo","getScore","times","timeAgo","diff","ShelfCassettes","renderCassette","handleNext","cassette","handleOnClick","tokenLogin","handleSetVisibility","handleRemove","isPrivate","tooLong","finalTitle","updated","rel","cover","gistId","cassettes","showAllButton","handleOnShowAllClick","defaultProps","Shelf","fetchCassettes","makeShelfCassettes","fetching","popularCassettes","recentCassettes","_isMounted","gameId","pushState","method","body","yourPrivateCassettes","score","yourPublicCassettes","isFork","preventDefault","setVisibility","unshelveCassette","components_ShelfCassettes","userPublicCassettes","shelveCassetteRequest","shelveCassetteSuccess","setVisibilityRequest","setVisibilitySuccess","Notice","handleDismissNotices","dismissNotices","notices","newNoticeIds","difference","notice","DEFAULT_COMMENT","isCommentValid","Comments","deleteComment","createIssueAndComment","fetchIssueAndComments","updateUserScopes","createComment","handleCommentCreate","handleCommentDelete","handleCommentChange","handleLoginClick","commentTextarea","comments","issue","scopes","url","headers","Authorization","Content-Type","has","issueSearchUrl","issueResponse","issueJson","commentsUrl","commentsResponse","commentsJson","createIssue","status","statusText","commentId","open","oldToken","_this$state3","disableAddCommentButton","userHasCorrectScopes","userCanComment","updated_at","is-fetching","Updater","updateUrl","oldId","newId","isBlank","Menu","onExport","onRecordClick","onLoginClick","onInsertBlankClick","onPutOnShelfClick","record","onClose","onUpdateIframeVersion","script8","handleCode","fetchToken","clearNextAction","altKey","metaKey","codeTab","updateIframeVersion","html","element","setAttribute","encodeURIComponent","display","appendChild","click","removeChild","downloadHtml","returnValue","clearToken","putOnShelf","gistUser","iframe","setNextAction","_this$props9","_this$props10","toggleSound","blank","contentIsEmpty","enableInsertBlank","enableRecord","enableRecordToFork","isMine","canShelve","isMusicScreen","isArtScreen","codeTabSuffix","loggedIn","canUpdateIframeVersion","tokenRequest","getUser","getProfile","tokenSuccess","TopBar","show","containers_Updater","containers_Menu","ErrorBoundary","hasError","errorInfo","whiteSpace","componentStack","children","shouldShowNotice","_options","containers_Boot","containers_Home","containers_Sprite","containers_Map","containers_Phrase","containers_Chain","containers_Song","containers_Code","containers_Help","containers_Shelf","App","tutorialElement","React","createRef","appElement","setAppElementRef","clientHeight","paddingBottom","showNotice","components_ErrorBoundary","full-height","components_TopBar","containers_Output","containers_Tutorial","in-RUN","containers_Notice","components_Comments","gist_handleActions","token_handleActions","nextAction_handleActions","sprites_handleActions","map_handleActions","phrases_handleActions","chains_handleActions","songs_handleActions","tutorial_handleActions","shelving_handleActions","docHistories_handleActions","iframeVersion_handleActions","hideMenu_handleActions","reducer","combineReducers","persistedState","serializedState","localStorage","getItem","loadState","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","applyMiddleware","thunkMiddleware","subscribe","setItem","saveState","getState","render","es","containers_App","getElementById"],"mappings":"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EAAG,EAAG,EACN,EAAG,EAAG,GAERC,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERC,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAER/C,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERgD,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERC,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERC,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERC,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERC,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERC,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERlgB,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERmgB,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERC,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EA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,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERC,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERC,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERC,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERC,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERlgB,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERmgB,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERC,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERC,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERC,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERC,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERC,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERC,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERjJ,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAERoE,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAER8E,EAAG,CACD,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,IC3UKmD,GAlED,SAAA3b,GAA+B,IAA5BsP,EAA4BtP,EAA5BsP,EAAGoE,EAAyB1T,EAAzB0T,EAAGgF,EAAsB1Y,EAAtB0Y,QAAS5E,EAAa9T,EAAb8T,EAAGmJ,EAAUjd,EAAVid,IAC3B7J,EAAQgH,GAAO2C,QAAQjJ,GAEf4E,EACX1V,WAEAb,MAAM,IAENxF,IAAI,SAAAkB,GACH,IAAMwb,EAAStD,GAASlY,EAAOyb,eAC/B,MAAO,CAKL/P,MAAO8P,EAASA,EAAOrgB,OAAS,EAAI,EACpC6E,SACAwb,YAIH9Y,OAAO,SAACC,EAAKmd,EAAS7kB,GACrB,IAAM6H,EAAWH,EAAI1H,EAAQ,GACvB8kB,EAAUjd,EAAWA,EAAS4I,MAAQ,EAAI5I,EAASid,QAAU,EAC7DC,EAAUld,EAAWA,EAASkd,QAAU,EAE9C,SAAA1f,OAAAyC,OAAAC,EAAA,EAAAD,CACKJ,GADL,CAAAI,OAAAwB,EAAA,EAAAxB,CAAA,GAGO+c,EAHP,CAIIC,UACAC,eAGH,IAEFjc,OAAO,SAAAjC,GAAC,OAAIA,EAAE0Z,SAGX5D,QAAQ,SAAAqI,GAAQ,IAEZzE,EAAoCyE,EAApCzE,OAAQuE,EAA4BE,EAA5BF,QAASC,EAAmBC,EAAnBD,QAAStU,EAAUuU,EAAVvU,MAG5BwU,EAAYd,EAAIe,aAAa1O,EAAIsO,EAASlK,EAAImK,EAAStU,EAAO,GAC5DxK,EAASgf,EAAThf,KAGRsa,EACG1c,IAAI,SAACshB,EAAOC,GAAR,MAAwB,CAAED,QAAOC,gBAErCtc,OAAO,SAAAjC,GAAC,OAAIA,EAAEse,QAEdxI,QAAQ,SAAA9V,GACP,IAAMwe,EAAwB,EAAfxe,EAAEue,WACjBnf,EAAKof,EAAS,GAAK/K,EAAM,GACzBrU,EAAKof,EAAS,GAAK/K,EAAM,GACzBrU,EAAKof,EAAS,GAAK/K,EAAM,GACzBrU,EAAKof,EAAS,GAAK,MAIvBlB,EAAImB,aAAaL,EAAWzO,EAAIsO,EAASlK,EAAImK,MCrBlCvD,GAzCA,SAAAta,GAST,IARJsP,EAQItP,EARJsP,EACAoE,EAOI1T,EAPJ0T,EACA2B,EAMIrV,EANJqV,YAMIgJ,EAAAre,EALJsV,cAKI,IAAA+I,EALK,EAKLA,EAAAC,EAAAte,EAJJuV,aAII,IAAA+I,KAAAC,EAAAve,EAHJwV,aAGI,IAAA+I,KAFJ7hB,EAEIsD,EAFJtD,QACAugB,EACIjd,EADJid,IAEIvgB,EAAQ2Y,IACV3Y,EAAQ2Y,GAAa5V,MAAM,EAAG,GAAGgW,QAAQ,SAACC,EAAOC,GAC/CD,EAAMvT,MAAM,IAAIsT,QAAQ,SAACrC,EAAOwC,GAC9B,GAAc,MAAVxC,EAAe,CACjB,IAAMyC,EAAUC,MAAO1C,EAAQkC,EAAQ,EAAG,GAC1C2H,EAAIC,UAAY9C,GAAO0C,IAAIjH,GAC3BoH,EAAII,SACFrf,KAAKC,MAAMqR,IAAMiG,EAAQ,EAAIK,EAAWA,GACxC5X,KAAKC,MAAMyV,IAAM8B,EAAQ,EAAIG,EAAWA,GACxC,EACA,SC0MG+D,GAnNG,SAAA1Z,GAMZ,IALJid,EAKIjd,EALJid,IACOtD,EAIH3Z,EAJJuJ,MACQqQ,EAGJ5Z,EAHJwJ,OACA9M,EAEIsD,EAFJtD,QAEImd,EAAA7Z,EADJrD,WACI,IAAAkd,EADE,GACFA,EACAE,EAAc/a,KAAKC,MAAMD,KAAKG,UAAUxC,IAC5CsgB,EAAIuB,aAAa,EAAG,EAAG,EAAG,EAAG,EAAG,GAEhC,IAAIxE,EAAW,EAEXC,EAAW,EAETwE,EAAgBnS,SAAStF,cAAc,UAC7CyX,EAAclV,MAAQoQ,EACtB8E,EAAcjV,OAASoQ,EACvB,IAAM8E,EAAQD,EAAcE,WAAW,MASvC,OAPA/d,OAAOge,QAAQliB,GAAS+Y,QAAQ,SAAAxS,GAAmB,IAAAC,EAAAtC,OAAA6b,GAAA,EAAA7b,CAAAqC,EAAA,GAAjB4b,EAAiB3b,EAAA,GAAXrD,EAAWqD,EAAA,GAC3C3G,GAAOsiB,GDHG,SAAA5b,GAAyB,IAAtBqM,EAAsBrM,EAAtBqM,EAAGoE,EAAmBzQ,EAAnByQ,EAAGoK,EAAgB7a,EAAhB6a,KAAMb,EAAUha,EAAVga,IACjCa,EAAKre,MAAM,EAAG,GAAGgW,QAAQ,SAACC,EAAOC,GAC/BD,EAAMvT,MAAM,IAAIsT,QAAQ,SAACrC,EAAOwC,GAChB,MAAVxC,IACF6J,EAAIC,UAAY9C,GAAO0C,KAAK1J,GAC5B6J,EAAII,SAASrf,KAAKC,MAAMqR,GAAKsG,EAAU5X,KAAKC,MAAMyV,GAAKiC,EAAU,EAAG,QCCxEmJ,CAAY,CAAExP,EADF/S,EAAM,GACK,EAAGmX,EAAS,EAFvB1V,KAAKC,MAAM1B,EAAM,IAESuhB,KAAMje,EAAOod,IAAKyB,MAGnD,CACL7D,WADK,SACMjH,GAAiB,QAAAkH,EAAA9Z,UAAAhI,OAAN6a,EAAM,IAAAvU,MAAAwb,EAAA,EAAAA,EAAA,KAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAANlH,EAAMkH,EAAA,GAAA/Z,UAAA+Z,GAC1BF,GAAW,CAAEjH,SAAQC,OAAMoJ,SAG7BrB,QALK,SAKGC,EAAIC,GACV,IAAMC,EAAO7c,cAAI6a,EAAa,CAAC+B,EAAID,GAAK,MACpCG,EAAkB,OAATD,EAAgBrf,EAAQqf,GAAQ,KAK7C,OAJIC,IACFA,EAAO5P,KAAO4P,EAAO,IAAM,EAC3BA,EAAOte,OAASqe,GAEXC,GAGTC,QAfK,SAeGJ,EAAIC,EAAII,GACdnC,EAAY+B,GAAID,GAAMK,GAGxBpO,KAnBK,SAmBAiF,EAAIC,EAAIC,EAAIC,GAAW,IAAPY,EAAO9S,UAAAhI,OAAA,QAAAiI,IAAAD,UAAA,GAAAA,UAAA,GAAH,EACvB8M,GAAK,CACHiF,GAAI/U,KAAKC,MAAM8U,GACfC,GAAIhV,KAAKC,MAAM+U,GACfC,GAAIjV,KAAKC,MAAMgV,GACfC,GAAIlV,KAAKC,MAAMiV,GACf+J,MACA7J,MAAOgH,GAAO0C,IAAIhJ,MAItB6H,MA9BK,SA8BCrM,EAAGoE,EAAGgF,GAAgB,IAAP5E,EAAO9S,UAAAhI,OAAA,QAAAiI,IAAAD,UAAA,GAAAA,UAAA,GAAH,EACvB2a,GAAM,CACJrM,EAAGA,EAAI0K,EACPtG,EAAGA,EAAIuG,EACPvB,UACA5E,IACAmJ,SAIJjC,WAxCK,SAwCM1L,EAAGoE,EAAG6E,EAAGb,GAAU,IAAP5D,EAAO9S,UAAAhI,OAAA,QAAAiI,IAAAD,UAAA,GAAAA,UAAA,GAAH,EACzBic,EAAIE,YAAc/C,GAAO0C,IAAIhJ,GAC7BmJ,EAAI8B,WACF/gB,KAAKC,MAAMqR,GAAK,GAChBtR,KAAKC,MAAMyV,GAAK,GAChB1V,KAAKC,MAAMsa,GAAK,EAChBva,KAAKC,MAAMyZ,GAAK,IAIpB6C,OAlDK,WAkDgB,IAAdjL,EAActO,UAAAhI,OAAA,QAAAiI,IAAAD,UAAA,GAAAA,UAAA,GAAV,EAAG0S,EAAO1S,UAAAhI,OAAA,QAAAiI,IAAAD,UAAA,GAAAA,UAAA,GAAH,EAChBgZ,EAAWhc,KAAKC,MAAMqR,GACtB2K,EAAWjc,KAAKC,MAAMyV,GACtBuJ,EAAIuB,aAAa,EAAG,EAAG,EAAG,EAAG,EAAG,GAChCvB,EAAI+B,WAAWhF,GAAWC,IAG5BqB,SAzDK,SAyDIhM,EAAGoE,EAAG6E,EAAGb,GAAU,IAAP5D,EAAO9S,UAAAhI,OAAA,QAAAiI,IAAAD,UAAA,GAAAA,UAAA,GAAH,EACvBic,EAAIC,UAAY9C,GAAO0C,IAAIhJ,GAC3BmJ,EAAII,SAASrf,KAAKC,MAAMqR,GAAItR,KAAKC,MAAMyV,GAAI1V,KAAKC,MAAMsa,GAAIva,KAAKC,MAAMyZ,KAGvE4E,SA9DK,WA+DHvC,EAAc/a,KAAKC,MAAMD,KAAKG,UAAUxC,KAG1CA,IAlEK,WAkEa,IAAd2S,EAActO,UAAAhI,OAAA,QAAAiI,IAAAD,UAAA,GAAAA,UAAA,GAAV,EAAG0S,EAAO1S,UAAAhI,OAAA,QAAAiI,IAAAD,UAAA,GAAAA,UAAA,GAAH,EAEb+Y,EAAYtE,QAAQ,SAAC0G,EAAKC,GACxBD,EAAI1G,QAAQ,SAACJ,EAAagH,GACxB,GAAoB,OAAhBhH,EAAsB,CACxB,IAAM4J,EAAM5J,EAAc,GAAM,EAC1B6J,EAAoC,EAA/BlhB,KAAKC,MAAMoX,EAAc,IAG9B9B,EAAuB,GAAjB8I,EAAY/M,GAClBkE,EAAuB,GAAjB4I,EAAY1I,GAKtBH,EAAK,GAAKyG,GACVzG,EAAKyG,EAAW,KAChBxG,EAAK,GAAKyG,GACVzG,EAAKyG,EAAW,KAGhBgD,EAAIkC,UACFV,EACAQ,EACAC,EAjBW,EACC,EAmBZ3L,EACAC,EAjBW,EACC,SA0CxB8G,OAxHK,SAwHEhL,EAAGoE,EAAG2B,GAAuD,IAA1CC,EAA0CtU,UAAAhI,OAAA,QAAAiI,IAAAD,UAAA,GAAAA,UAAA,GAAjC,EAAGuU,EAA8BvU,UAAAhI,OAAA,QAAAiI,IAAAD,UAAA,IAAAA,UAAA,GAAfwU,EAAexU,UAAAhI,OAAA,QAAAiI,IAAAD,UAAA,IAAAA,UAAA,GAClEsZ,GAAO,CACLhL,IACAoE,IACA2B,cACAC,SACAC,QACAC,QACA9Y,UACAugB,SAIJxB,WArIK,SAqIMnM,EAAGoE,EAAGwE,GAAU,IAAPpE,EAAO9S,UAAAhI,OAAA,QAAAiI,IAAAD,UAAA,GAAAA,UAAA,GAAH,EACtBgc,GAAO,CACLlI,GAAI9W,KAAKC,MAAMqR,GACfyF,GAAI/W,KAAKC,MAAMyV,GACfsB,OAAQhX,KAAKC,MAAMia,GACnB+E,MACA7J,MAAOgH,GAAO0C,IAAIhJ,GAClBmB,YAAY,KAIhByG,SAhJK,SAgJIpM,EAAGoE,EAAGwE,GAAU,IAAPpE,EAAO9S,UAAAhI,OAAA,QAAAiI,IAAAD,UAAA,GAAAA,UAAA,GAAH,EACpBgc,GAAO,CACLlI,GAAI9W,KAAKC,MAAMqR,GACfyF,GAAI/W,KAAKC,MAAMyV,GACfsB,OAAQhX,KAAKC,MAAMia,GACnB+E,MACA7J,MAAOgH,GAAO0C,IAAIhJ,MAItB0G,MA1JK,SA0JC1G,GACJmJ,EAAImC,OACJnC,EAAIuB,aAAa,EAAG,EAAG,EAAG,EAAG,EAAG,GAC3B5f,gBAAMkV,GAITmJ,EAAIoC,UAAU,EAAG,EAAG1F,EAAaC,IAHjCqD,EAAIC,UAAY9C,GAAO0C,IAAIhJ,GAC3BmJ,EAAII,SAAS,EAAG,EAAG,IAAK,MAI1BJ,EAAIqC,WAGN3E,SAtKK,SAsKIrL,EAAGoE,GACV,OC3MW,SAAA1T,GAAmB,IAAhBsP,EAAgBtP,EAAhBsP,EAAGoE,EAAa1T,EAAb0T,EAAGuJ,EAAUjd,EAAVid,IAAUsC,EAAA3e,OAAA6b,GAAA,EAAA7b,CAETqc,EAAIe,aAAa1O,EAAGoE,EAAG,EAAG,GAAG3U,KAFpB,GAE3BmZ,EAF2BqH,EAAA,GAExB9H,EAFwB8H,EAAA,GAErBhI,EAFqBgI,EAAA,GAElBC,EAFkBD,EAAA,GAKlC,GAAc,MAAVC,EACF,OARoB,EAYtB,IAAMpM,EAAQgH,GAAOqF,OAAO,CAACvH,EAAGT,EAAGF,EAAGiI,IACtC,OAAc,OAAVpM,EAbkB,EAiBfA,ED4LIuH,CAAS,CACdrL,EAAGtR,KAAKC,MAAMqR,EAAI0K,GAClBtG,EAAG1V,KAAKC,MAAMyV,EAAIuG,GAClBgD,SAIJ9J,SA9KK,SA8KI7D,EAAGoE,GAAU,IAAPI,EAAO9S,UAAAhI,OAAA,QAAAiI,IAAAD,UAAA,GAAAA,UAAA,GAAH,GChMN,SAAAiC,GAA0B,IAAvBqM,EAAuBrM,EAAvBqM,EAAGoE,EAAoBzQ,EAApByQ,EAAGuJ,EAAiBha,EAAjBga,IAAK7J,EAAYnQ,EAAZmQ,MAC7B6J,EAAIC,UAAY9J,EAChB6J,EAAII,SAAS/N,EAAGoE,EAAG,EAAG,GD+LlBP,CAAS,CACP7D,EAAGtR,KAAKC,MAAMqR,GACdoE,EAAG1V,KAAKC,MAAMyV,GACduJ,MACA7J,MAAOgH,GAAO0C,IAAIhJ,QEvMpB4L,eACJ,SAAAA,EAAYxZ,GAAO,IAAA0B,EAAA,OAAAhH,OAAAiH,EAAA,EAAAjH,CAAAqF,KAAAyZ,IACjB9X,EAAAhH,OAAAkH,EAAA,EAAAlH,CAAAqF,KAAArF,OAAAmH,EAAA,EAAAnH,CAAA8e,GAAA1X,KAAA/B,KAAMC,KAEDyZ,KAAO/X,EAAK+X,KAAKzX,KAAVtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACZA,EAAKgY,gBAAkBhY,EAAKgY,gBAAgB1X,KAArBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACvBA,EAAKiY,iBAAmBjY,EAAKiY,iBAAiB3X,KAAtBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACxBA,EAAKkY,kBAAoBlY,EAAKkY,kBAAkB5X,KAAvBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACzBA,EAAKmY,kBAAoBnY,EAAKmY,kBAAkB7X,KAAvBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACzBA,EAAKoY,mBAAqBpY,EAAKoY,mBAAmB9X,KAAxBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAC1BA,EAAKqY,gBAAkBrY,EAAKqY,gBAAgB/X,KAArBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACvBA,EAAKsY,kBAAoBtY,EAAKsY,kBAAkBhY,KAAvBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACzBA,EAAKuY,iBAAmBvY,EAAKuY,iBAAiBjY,KAAtBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACxBA,EAAKwV,UAAYxV,EAAKwV,UAAUlV,KAAftH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACjBA,EAAKwY,QAAUxY,EAAKwY,QAAQlY,KAAbtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAEfA,EAAK/E,MAAQ,CACXwS,YAAa,EACbgL,WAAY,EACZC,WAAW,EACXC,KAAM,KAnBS3Y,sEAuBZ,IAAAyJ,EAAApL,KAEGvJ,EAAYuJ,KAAKC,MAAjBxJ,QACRuJ,KAAKyT,UAAYA,GAAU,CACzBuD,IAAKhX,KAAKua,QAAQ7B,WAAW,MAC7BpV,MAAO,IACPC,OAAQ,GACR9M,YAGFuJ,KAAKyT,UAAUc,QACf5Z,OAAO8B,KAAKhG,GAAS+Y,QAAQ,SAAAoJ,GAC3B,IAAMtiB,GAAOsiB,EACP1C,EAAMne,KAAKC,MAAM1B,EAAM,IACvBkkB,EAAMlkB,EAAM,GAClB8U,EAAKqI,UAAUY,OAAa,EAANmG,EAAe,EAANtE,EAAS5f,iDAK1C0J,KAAK0Z,kDAGY,IACTjjB,EAAYuJ,KAAKC,MAAjBxJ,QACA2Y,EAAgBpP,KAAKpD,MAArBwS,YACR,OAAOhX,IAAEa,IAAIxC,EAAS2Y,EAAahX,IAAEmE,MAAM,GAAG7F,IAAI,SAAAgD,GAAC,MAAI,wDAGvC0V,GAChBpP,KAAKsK,SAAS,CAAE8E,yDAGDgL,GACfpa,KAAKsK,SAAS,CAAE8P,aAAYE,KAAM,8CAGpBG,GAAW,IACjBrL,EAAgBpP,KAAKpD,MAArBwS,YACAsL,EAAiB1a,KAAKC,MAAtBya,aACFrG,EAASrU,KAAKka,mBAIpBQ,EAAa,CAAErG,OAFA,GAAAnc,OAAAyC,OAAAC,EAAA,EAAAD,CAAO0Z,EAAO7a,MAAM,EAAG,IAAvB,CAA2BihB,IAER5nB,MAAOuc,8CAGzB7E,GAChBvK,KAAKsK,SAAS,CACZ+P,WAAW,IAFM,IAAAM,EAIEpQ,EAAEqQ,OAAOC,QAAtB3E,EAJWyE,EAIXzE,IAAKsE,EAJMG,EAINH,IACbxa,KAAKmX,UAAU,CAAEjB,KAAMA,EAAKsE,KAAMA,+CAGjBjQ,GACjB,GAAIvK,KAAKpD,MAAMyd,UAAW,KAAAS,EACHvQ,EAAEqQ,OAAOC,QAAtB3E,EADgB4E,EAChB5E,IAAKsE,EADWM,EACXN,IACbxa,KAAKmX,UAAU,CAAEjB,KAAMA,EAAKsE,KAAMA,+CAKpCxa,KAAKsK,SAAS,CACZ+P,WAAW,8CAIG9P,GAChB,GAAIvK,KAAKpD,MAAMyd,UAAW,CACxB,IAAMU,EAAgBxQ,EAAEyQ,eAAe,GACjCH,EAAUxU,SAAS4U,iBACvBF,EAAcG,QACdH,EAAcI,SACdN,QACM3E,EAAa2E,EAAb3E,IAAKsE,EAAQK,EAARL,IACTtE,GAAOsE,GACTxa,KAAKmX,UAAU,CAAEjB,KAAMA,EAAKsE,KAAMA,qCAKhCF,GACNta,KAAKsK,SAAS,CACZgQ,8CAIoB,IjBpIPc,EAAKvoB,EAAOwoB,EiBoIjBnF,EAAYjZ,EAAZiZ,IAAKsE,EAAOvd,EAAPud,IAAOzO,EACoB/L,KAAKpD,MAAvCwS,EADcrD,EACdqD,YAAagL,EADCrO,EACDqO,WAAYE,EADXvO,EACWuO,KACzBI,EAAiB1a,KAAKC,MAAtBya,aAEFrG,EAASrU,KAAKka,mBAEdoB,EAAYviB,KAAKC,MAAMD,KAAKG,UAAUmb,IAG5CiH,EAAUpF,IjB7IKkF,EiB8IbE,EAAUpF,GjB9IQrjB,EiB+IlB2nB,EjB/IyBa,EiBgJhB,MAATf,EAAeF,EAAa,IjB/IhCgB,EAAIG,OAAO,EAAG1oB,GACdwoB,EACAD,EAAIG,OAAO1oB,EAAQwoB,EAAYte,WAAWhK,SiBgJxC2nB,EAAa,CAAErG,OAAQiH,EAAWzoB,MAAOuc,iDAIzCpP,KAAK0Z,wCAGE,IAAA5N,EAAA9L,KAAAwb,EACmCxb,KAAKpD,MAAvCwS,EADDoM,EACCpM,YAAagL,EADdoB,EACcpB,WAAYE,EAD1BkB,EAC0BlB,KAC3BjG,EAASrU,KAAKka,mBACdrgB,GAAWwa,EAAO7a,MAAM,EAAG,GAAGmC,OAAO,SAAAjC,GAAC,MAAU,aAANA,IAAkB3G,OAC5D0nB,EAA8B,IAAlBpG,EAAOthB,OAAe,GAAKshB,EAAO,GACpD,OACExT,EAAAC,EAAAC,cAAA,OACE0a,UAAWzb,KAAKga,gBAChB0B,WAAY1b,KAAKga,gBACjBhZ,UAAU,4BAEVH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,QACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,gBACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,qBACbH,EAAAC,EAAAC,cAAA,SAAOC,UAAU,UACfH,EAAAC,EAAAC,cAAA,aACG3I,IAAEmE,MAAM,GAAG7F,IAAI,SAAAwf,GAAG,OACjBrV,EAAAC,EAAAC,cAAA,MAAIzK,IAAK4f,GACN9d,IAAEmE,MAAM,GAAG7F,IAAI,SAAA8jB,GACd,IAAM5gB,EAAQxB,IAAEa,IAAIob,EAAQ,CAAC6B,EAAKsE,GAAM,KACxC,OACE3Z,EAAAC,EAAAC,cAAA,MAAIzK,IAAKkkB,GACP3Z,EAAAC,EAAAC,cAAA,UACE4a,WAAUzF,EACV0F,WAAUpB,EACVqB,YAAa/P,EAAKgO,kBAClBgC,aAAchQ,EAAKiO,mBACnBgC,aAAcjQ,EAAKgO,kBACnBkC,YAAalQ,EAAKmO,kBAClBjZ,UAAS,cAAA9I,OAAgB0B,IAEd,MAAVA,EAAgB,IAAM,YASvCiH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,oBACbH,EAAAC,EAAAC,cAAA,SAAOC,UAAU,UACfH,EAAAC,EAAAC,cAAA,aACG3I,IAAEmE,MAAM,GAAG7F,IAAI,SAAAwf,GAAG,OACjBrV,EAAAC,EAAAC,cAAA,MAAIzK,IAAK4f,GACN9d,IAAEmE,MAAM,EAAI,EAAI2Z,EAAK,EAAI,EAAIA,GAAKxf,IAAI,SAAA8jB,GACrC,OACE3Z,EAAAC,EAAAC,cAAA,MACEzK,IAAKkkB,EACLxZ,UAAW+B,IAAW,CACpB1M,OAAQmkB,IAAQJ,GAAuB,MAATE,KAGhCzZ,EAAAC,EAAAC,cAAA,UACE4B,QAAS,kBAAMmJ,EAAK8N,iBAAiBY,IACrCxZ,UAAW+B,IAAU,cAAA7K,OACLsiB,GADK,UAAAtiB,OAETsiB,GACV,CACEnkB,OAAQmkB,IAAQJ,GAAuB,MAATE,cAWlDzZ,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,cACbH,EAAAC,EAAAC,cAAA,UACEC,UAAW+B,IAAW,SAAU,CAC9B1M,OAAiB,MAATikB,IAEV3X,QAAS,WACPmJ,EAAKqO,QAAQ,OALjB,KAWAtZ,EAAAC,EAAAC,cAAA,UACEC,UAAW+B,IAAW,SAAU,CAC9B1M,OAAiB,MAATikB,IAEV3X,QAAS,WACPmJ,EAAKqO,QAAQ,OALjB,MAWFtZ,EAAAC,EAAAC,cAAA,SAAOC,UAAW+B,IAAW,QAAS,CAAEkZ,KAAMpiB,KAC5CgH,EAAAC,EAAAC,cAAA,aACEF,EAAAC,EAAAC,cAAA,UACG3I,IAAEmE,MAAM,GAAG7F,IAAI,SAAAgY,GACd,OACE7N,EAAAC,EAAAC,cAAA,MACEzK,IAAKoY,EACL1N,UAAW+B,IAAW,CACpB1M,OAAQqY,IAAM+L,KAGhB5Z,EAAAC,EAAAC,cAAA,UACE4B,QAAS,kBAAMmJ,EAAK6N,gBAAgBjL,IACpC1N,UAAW+B,IAAW,CACpB1M,OAAQqY,IAAM+L,KAGf/L,YAWrB7N,EAAAC,EAAAC,cAAA,OAAKC,UAAU,WACbH,EAAAC,EAAAC,cAAA,aACEF,EAAAC,EAAAC,cAAA,aACG3I,IAAEmE,MAAM,GAAG7F,IAAI,SAAAwf,GAAG,OACjBrV,EAAAC,EAAAC,cAAA,MAAIzK,IAAK4f,GACN9d,IAAEmE,MAAM,IAAI7F,IAAI,SAAA8jB,GACf,IAAM0B,EAAwB,GAANhG,EAAWsE,EACnC,OACE3Z,EAAAC,EAAAC,cAAA,MACEC,UAAW+B,IAAW,CACpB1M,OAAQ+Y,IAAgB8M,IAE1B5lB,IAAKkkB,GAEL3Z,EAAAC,EAAAC,cAAA,UACE4B,QAAS,kBACPmJ,EAAK+N,kBAAkBqC,cAUzCrb,EAAAC,EAAAC,cAAA,UACEuC,MAAO,IACPC,OAAQ,GACR+I,IAAK,SAAAiO,GACHzO,EAAKyO,QAAUA,MAIrB1Z,EAAAC,EAAAC,cAAA,OAAKC,UAAU,iBAAiBoO,aAlSvBnO,aA0SNC,eAtTS,SAAAnH,GAAA,MAAkB,CAAEtD,QAApBsD,EAAGtD,UAEA,SAAAmH,GAAQ,MAAK,CACtC8c,aAAc,SAAA1d,GAAA,IAAGqX,EAAHrX,EAAGqX,OAAQxhB,EAAXmK,EAAWnK,MAAX,OACZ+K,EACEP,EAAQqd,aAAa,CACnBrG,SACAxhB,cA+SOqO,CAGbuY,ICjSa0C,GAhCG,SAAApiB,GAAuB,IAApBuJ,EAAoBvJ,EAApBuJ,MAAOC,EAAaxJ,EAAbwJ,OAEpB6Y,EAAa,IAAIC,UAAU/Y,EAAOC,GAOlC+Y,EAAe,IAAIC,YAAY,EAAIjZ,EAAQC,GAK3CiZ,EAAc,IAAIC,kBAAkBH,GAY1C,MAAO,CACLlJ,OARqB,IAAIsJ,YAAYJ,GASrCK,uBAP6B,SAAA3F,GAC7BoF,EAAWtjB,KAAK8jB,IAAIJ,GACpBxF,EAAImB,aAAaiE,EAAY,EAAG,MCT9BS,eACJ,SAAAA,EAAY5c,GAAO,IAAA0B,EAAA,OAAAhH,OAAAiH,EAAA,EAAAjH,CAAAqF,KAAA6c,IACjBlb,EAAAhH,OAAAkH,EAAA,EAAAlH,CAAAqF,KAAArF,OAAAmH,EAAA,EAAAnH,CAAAkiB,GAAA9a,KAAA/B,KAAMC,KACD6Z,kBAAoBnY,EAAKmY,kBAAkB7X,KAAvBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACzBA,EAAKoY,mBAAqBpY,EAAKoY,mBAAmB9X,KAAxBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAC1BA,EAAKqY,gBAAkBrY,EAAKqY,gBAAgB/X,KAArBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACvBA,EAAKsY,kBAAoBtY,EAAKsY,kBAAkBhY,KAAvBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACzBA,EAAKmb,kBAAoBnb,EAAKmb,kBAAkB7a,KAAvBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACzBA,EAAKob,gBAAkBpb,EAAKob,gBAAgB9a,KAArBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAEvBA,EAAKqb,gBAAkBb,GAAU,CAAE7Y,MAAO,IAAKC,OAAQ,KACvD5B,EAAKwN,WAAaxN,EAAKwN,WAAWlN,KAAhBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAClBA,EAAKsb,cAAgBd,GAAU,CAAE7Y,MAAO,IAAKC,OAAQ,MACrD5B,EAAKub,SAAWvb,EAAKub,SAASjb,KAAdtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAChBA,EAAKwb,aAAehB,GAAU,CAAE7Y,MAAO,KAASC,OAAQ,MACxD5B,EAAKyb,QAAUzb,EAAKyb,QAAQnb,KAAbtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACfA,EAAK0b,eAAiB1b,EAAK0b,eAAepb,KAApBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACtBA,EAAKwY,QAAUxY,EAAKwY,QAAQlY,KAAbtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAEfA,EAAK/E,MAAQ,CACXwS,YAAa,EACbkO,UAAW,EACXjD,WAAW,EACXC,KAAM,KAtBS3Y,mFA2BjB3B,KAAKud,cACLvd,KAAKkd,WACLld,KAAKod,gDAGO,IAAAhS,EAAApL,KACJvJ,EAAYuJ,KAAKC,MAAjBxJ,QAERuJ,KAAKwd,gBAAkB/J,GAAU,CAC/BL,OAAQpT,KAAKgd,gBAAgB5J,OAC7B9P,MAAO,IACPC,OAAQ,GACR9M,YAEFuJ,KAAKwd,gBAAgBjJ,QACrB5Z,OAAO8B,KAAKhG,GAAS+Y,QAAQ,SAAAoJ,GAC3B,IAAMtiB,GAAOsiB,EACP1C,EAAMne,KAAKC,MAAM1B,EAAM,IACvBkkB,EAAMlkB,EAAM,GAClB8U,EAAKoS,gBAAgBnJ,OAAa,EAANmG,EAAe,EAANtE,EAAS5f,KAEhD0J,KAAKgd,gBAAgBL,uBACnB3c,KAAKyd,cAAc/E,WAAW,0CAIvB,IAAA5M,EAAA9L,KACH3E,EAASyP,KAAKC,MADXhL,EAGgBC,KAAKC,MAAtBxJ,EAHCsJ,EAGDtJ,QAASC,EAHRqJ,EAGQrJ,IACT4mB,EAActd,KAAKpD,MAAnB0gB,UAERtd,KAAK0d,cAAgBjK,GAAU,CAC7BL,OAAQpT,KAAKid,cAAc7J,OAC3B9P,MAAO,IACPC,OAAQ,IACR9M,YAGFuJ,KAAK0d,cAAcnJ,QACnBnc,IAAEmE,MAAM,IAAIiT,QAAQ,SAAAmO,GAClBvlB,IAAEmE,MAAM,IAAIiT,QAAQ,SAAAoO,GAClB,IAAMvJ,EAASjc,IAAEa,IAAIvC,EAAK,CACI,GAA5BqB,KAAKC,MAAMslB,EAAY,GAAUK,EAChCL,EAAY,EAAK,GAAKM,IAEzB9R,EAAK4R,cAAcrJ,OAAc,EAAPuJ,EAAiB,EAAPD,EAAUtJ,OAGlDrU,KAAKid,cAAcN,uBAAuB3c,KAAK6d,YAAYnF,WAAW,OAEtE,IAAMjd,EAAQqP,KAAKC,MACnBa,QAAQY,IAAR,yBAAAtU,OAAqCuD,EAAQJ,EAA7C,yCAGQ,IAAAyiB,EAAA9d,KACF3E,EAASyP,KAAKC,MADZrK,EAGiBV,KAAKC,MAAtBvJ,EAHAgK,EAGAhK,IAAKD,EAHLiK,EAGKjK,QACbuJ,KAAK+d,aAAetK,GAAU,CAC5BL,OAAQpT,KAAKmd,aAAa/J,OAC1B9P,MAAO,KACPC,OAAQ,IACR9M,UACAC,QAGFsJ,KAAK+d,aAAaxJ,QAClB7d,EAAI8Y,QAAQ,SAAC0G,EAAKC,GAChBD,EAAI1G,QAAQ,SAACgL,EAAKpE,GAChB0H,EAAKC,aAAa1J,OAAmB,EAAZ+B,EAA2B,EAAZD,EAAeqE,OAG3Dxa,KAAKmd,aAAaR,uBAAuB3c,KAAKge,WAAWtF,WAAW,OAEpE,IAAMjd,EAAQqP,KAAKC,MACnBa,QAAQY,IAAR,wBAAAtU,OAAoCuD,EAAQJ,EAA5C,oDAIA2E,KAAKkd,WACLld,KAAKod,oDAGW7S,GAChBvK,KAAKsK,SAAS,CACZ+P,WAAW,IAFM,IAAAM,EAIEpQ,EAAEqQ,OAAOC,QAAtB3E,EAJWyE,EAIXzE,IAAKsE,EAJMG,EAINH,IACbxa,KAAKmP,WAAW,CAAE+G,KAAMA,EAAKsE,KAAMA,+CAGlBjQ,GACjB,GAAIvK,KAAKpD,MAAMyd,UAAW,KAAAS,EACHvQ,EAAEqQ,OAAOC,QAAtB3E,EADgB4E,EAChB5E,IAAKsE,EADWM,EACXN,IACbxa,KAAKmP,WAAW,CAAE+G,KAAMA,EAAKsE,KAAMA,+CAKrCxa,KAAKsK,SAAS,CACZ+P,WAAW,8CAIG9P,GAChB,GAAIvK,KAAKpD,MAAMyd,UAAW,CACxB,IAAMU,EAAgBxQ,EAAEyQ,eAAe,GACjCH,EAAUxU,SAAS4U,iBACvBF,EAAcG,QACdH,EAAcI,SACdN,QACM3E,EAAa2E,EAAb3E,IAAKsE,EAAQK,EAARL,IACTtE,GAAOsE,GACTxa,KAAKmP,WAAW,CAAE+G,KAAMA,EAAKsE,KAAMA,+CAKvBpL,GAChBpP,KAAKsK,SAAS,CAAE8E,cAAakL,KAAM,8CAGrBgD,GACdtd,KAAKsK,SAAS,CAAEgT,oDAGO,IAAZpH,EAAYlZ,EAAZkZ,IAAKsE,EAAOxd,EAAPwd,IAAOzO,EACkB/L,KAAKpD,MAAtC0gB,EADevR,EACfuR,UAAWlO,EADIrD,EACJqD,YAAakL,EADTvO,EACSuO,KACxB2D,EAAcje,KAAKC,MAAnBge,UACFvnB,EAAMsJ,KAAKqd,iBACXa,EAASnlB,KAAKC,MAAMD,KAAKG,UAAUxC,IACzCwnB,EAAmC,GAA5BnmB,KAAKC,MAAMslB,EAAY,GAAUpH,GAAMoH,EAAY,EAAK,GAAK9C,GACzD,MAATF,EAAelL,EAAc,KAC/B6O,EAAUC,4CAGK,IACPxnB,EAAQsJ,KAAKC,MAAbvJ,IACR,OAAOA,EAAI3D,OAAS2D,EAAMmmB,EAAIsB,iDAGxB7D,GACNta,KAAKsK,SAAS,CACZgQ,0CAIK,IAAA8D,EAAApe,KAAAwb,EACkCxb,KAAKpD,MAAtC0gB,EADD9B,EACC8B,UAAWlO,EADZoM,EACYpM,YAAakL,EADzBkB,EACyBlB,KACxB5jB,EAAQsJ,KAAKC,MAAbvJ,IACR,OACEmK,EAAAC,EAAAC,cAAA,OACE0a,UAAWzb,KAAKga,gBAChB0B,WAAY1b,KAAKga,gBACjBhZ,UAAU,yBAEVH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,QACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,aACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,kBACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,QACbH,EAAAC,EAAAC,cAAA,aACEF,EAAAC,EAAAC,cAAA,aACG3I,IAAEmE,MAAM,IAAI7F,IAAI,SAAAwf,GAAG,OAClBrV,EAAAC,EAAAC,cAAA,MAAIzK,IAAK4f,GACN9d,IAAEmE,MAAM,IAAI7F,IAAI,SAAA8jB,GACf,IAAMnG,EAASjc,IAAEa,IAAIvC,EAAK,CACI,GAA5BqB,KAAKC,MAAMslB,EAAY,GAAUpH,EAChCoH,EAAY,EAAK,GAAK9C,IAEzB,OACE3Z,EAAAC,EAAAC,cAAA,MAAIzK,IAAKkkB,GACP3Z,EAAAC,EAAAC,cAAA,UACE4a,WAAUzF,EACV0F,WAAUpB,EACVqB,YAAauC,EAAKtE,kBAClBgC,aAAcsC,EAAKrE,mBACnBgC,aAAcqC,EAAKtE,kBACnBkC,YAAaoC,EAAKnE,kBAClBjZ,UAAU,eAET5I,IAAEO,MAAM0b,GAAU,IAAM,YASzCxT,EAAAC,EAAAC,cAAA,UACEuC,MAAO,IACPC,OAAQ,IACR+I,IAAK,SAAAuR,GACHO,EAAKP,YAAcA,MAIzBhd,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SACbH,EAAAC,EAAAC,cAAA,UACEC,UAAW+B,IAAW,SAAU,CAC9B1M,OAAiB,MAATikB,IAEV3X,QAAS,WACPyb,EAAKjE,QAAQ,OALjB,KAWAtZ,EAAAC,EAAAC,cAAA,UACEC,UAAW+B,IAAW,SAAU,CAC9B1M,OAAiB,MAATikB,IAEV3X,QAAS,WACPyb,EAAKjE,QAAQ,OALjB,OAYJtZ,EAAAC,EAAAC,cAAA,OAAKC,UAAU,mBACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,WACbH,EAAAC,EAAAC,cAAA,aACEF,EAAAC,EAAAC,cAAA,aACG3I,IAAEmE,MAAM,GAAG7F,IAAI,SAAAwf,GAAG,OACjBrV,EAAAC,EAAAC,cAAA,MAAIzK,IAAK4f,GACN9d,IAAEmE,MAAM,IAAI7F,IAAI,SAAA8jB,GACf,IAAM0B,EAAwB,GAANhG,EAAWsE,EACnC,OACE3Z,EAAAC,EAAAC,cAAA,MACEC,UAAW+B,IAAW,CACpB1M,OACE+Y,IAAgB8M,GACP,MAAT5B,IAEJhkB,IAAKkkB,GAEL3Z,EAAAC,EAAAC,cAAA,UACE4B,QAAS,kBACPyb,EAAKtB,kBAAkBZ,cAUzCrb,EAAAC,EAAAC,cAAA,UACEuC,MAAO,IACPC,OAAQ,GACR+I,IAAK,SAAAmR,GACHW,EAAKX,cAAgBA,MAI3B5c,EAAAC,EAAAC,cAAA,OAAKC,UAAU,OACbH,EAAAC,EAAAC,cAAA,aACEF,EAAAC,EAAAC,cAAA,aACG3I,IAAEmE,MAAM,GAAG7F,IAAI,SAAAwf,GAAG,OACjBrV,EAAAC,EAAAC,cAAA,MAAIzK,IAAK4f,GACN9d,IAAEmE,MAAM,GAAG7F,IAAI,SAAA8jB,GACd,IAAM6D,EAAsB,EAANnI,EAAUsE,EAChC,OACE3Z,EAAAC,EAAAC,cAAA,MACEC,UAAW+B,IAAW,CACpB1M,OAAQinB,IAAce,IAExB/nB,IAAKkkB,GAEL3Z,EAAAC,EAAAC,cAAA,UACE4B,QAAS,kBACPyb,EAAKrB,gBAAgBsB,cAUvCxd,EAAAC,EAAAC,cAAA,UACEuC,MAAO,KACPC,OAAQ,IACR+I,IAAK,SAAA0R,GACHI,EAAKJ,WAAaA,iBA7TpB/c,aAyUlB4b,GAAIsB,eAAiB,kBAAM/lB,IAAEmE,MAAM,IAAI7F,IAAI,kBAAM0B,IAAEmE,MAAM,KAAK7F,IAAI,kBAAM,UAEzDwK,mBAjVS,SAAAnH,GAAA,MAAuB,CAAEtD,QAAzBsD,EAAGtD,QAA+BC,IAAlCqD,EAAYrD,MAET,SAAAkH,GAAQ,MAAK,CACtCqgB,UAAW,SAAAC,GAAM,OAAItgB,EAASP,EAAQ4gB,UAAUC,OA8UnChd,CAGb2b,YC9UayB,GAdE,CACfC,QAAS,EACTC,QAAS,EACT7nB,QAAS,GACTC,OAAQ,GACRC,MAAO,EACP4nB,aAAc,GACdC,cAAe,EACfC,YAAa,OACbC,kBAAmB,OACnBC,IAAK,KACLC,YAAa,MCLAnnB,GALG,CAChBa,OAAQ,SAAAumB,GAAG,OAAKA,EAAM,GAAKT,GAASE,SACpClmB,KAAM,SAAAA,GAAI,OAAIA,ICKV0mB,GAAkB,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,IAC1CC,GAAkB,GAAA/mB,OAAI8mB,IAAiBE,UAEvCC,GAAsB,SAAAzmB,GAAK,OAAIsmB,GAAgBtmB,IAC/C0mB,GAAqB,SAAA1mB,GAAK,OAC9BumB,GAAgBvoB,IAAI,SAAAgY,GAAC,MAAK,CAAE2Q,MAAO3Q,KAAMhW,IAErC4mB,GAAc,SAAAvlB,GAA2B,IACzCnB,EADiB2mB,EAAwBxlB,EAAxBwlB,WAAY1sB,EAAYkH,EAAZlH,MAwDjC,OArDc,IAAVA,KACF+F,EAAQ,IAAI4mB,SAAW,CACrBC,WAAY,CACVtZ,KAAM,QACN7C,MAAO,IAEToc,SAAU,CACRC,QAAS,QAGPC,YAAc,SAGR,IAAV/sB,KACF+F,EAAQ,IAAI4mB,SAAW,CACrBC,WAAY,CACVtZ,KAAM,QACN7C,MAAO,KAEToc,SAAU,CACRC,QAAS,QAGPC,YAAc,SAGR,IAAV/sB,KACF+F,EAAQ,IAAI4mB,SAAW,CACrBC,WAAY,CACVtZ,KAAM,YAERuZ,SAAU,CACRC,QAAS,QAGPC,YAAc,SAGR,IAAV/sB,KACF+F,EAAQ,IAAI4mB,cAAgB,CAC1BE,SAAU,CACRC,QAAS,QAGPC,YAAc,SAGlBL,EACF3mB,EAAM1B,MAAMqoB,EAAYC,WAExB5mB,EAAM1B,MAAMsoB,WAGP5mB,GAGHinB,GAAgB,SAAA7iB,GAMhB,IALEpF,EAKFoF,EALJ1E,KACAR,EAIIkF,EAJJlF,OACAU,EAGIwE,EAHJxE,OAGIsnB,EAAA9iB,EAFJ+iB,YAEI,IAAAD,EAFGN,WAAaQ,YAEhBF,EADJlnB,EACIoE,EADJpE,MAEA,GAAImnB,GAAQP,WAAaQ,YAAa,CACpC,IAAM1nB,EAAOd,EAASI,EAAkB,GAATE,GAAa,GAAM,GAC5CmoB,EAAWtoB,GAAUa,OAAOA,GACR,UAAtBI,EAAMgnB,aACRhnB,EAAMinB,cAAcvnB,EAAMynB,EAAME,GAER,UAAtBrnB,EAAMgnB,aACRhnB,EAAMinB,cAAcE,EAAME,KAK1BC,GAAuB,SAAAjjB,GAOvB,IANErF,EAMFqF,EANJ3E,KACAR,EAKImF,EALJnF,OACAU,EAIIyE,EAJJzE,OAII2nB,EAAAljB,EAHJ8iB,YAGI,IAAAI,EAHGX,WAAaQ,YAGhBG,EAFJvnB,EAEIqE,EAFJrE,MACAF,EACIuE,EADJvE,MAEA,GAAIqnB,GAAQP,WAAaQ,YAAa,CACpC,IAAM1nB,EAAOd,EAASI,EAAkB,GAATE,GAAa,GAAM,GAC5CsoB,EAAWhB,GAAmB1mB,GAC9BunB,EAAWtoB,GAAUa,OAAOA,GACR,UAAtBI,EAAMgnB,aACRhnB,EAAMsnB,qBAAqB5nB,EAAM8nB,EAAUL,EAAME,GAEzB,UAAtBrnB,EAAMgnB,aACRhnB,EAAMsnB,qBAAqBE,EAAUL,EAAME,KAK3CI,GAAiB,SAAAljB,GAIjB,IAAAmjB,EAAAnjB,EAHJ4iB,YAGI,IAAAO,EAHGd,WAAaQ,YAGhBM,EAAAC,EAAApjB,EAFJqjB,aAEI,IAAAD,EAFI,EAEJA,EADJ3nB,EACIuE,EADJvE,MAEImnB,GAAQP,WAAaQ,aACvBpnB,EAAMynB,eAAeN,EAAOS,ICpGjBC,GAjBG,SAAA1mB,GAAA,IAAG2mB,EAAH3mB,EAAG2mB,MAAO9mB,EAAVG,EAAUH,MAAOuM,EAAjBpM,EAAiBoM,KAAMwa,EAAvB5mB,EAAuB4mB,aAAcC,EAArC7mB,EAAqC6mB,QAArC,OAChB/f,EAAAC,EAAAC,cAAA,OAAKC,UAAU,aACbH,EAAAC,EAAAC,cAAA,aACG2f,EACD7f,EAAAC,EAAAC,cAAA,QAAApG,OAAAkmB,OAAA,CAAO1a,KAAMA,EAAMvM,MAAOA,GAAWgnB,EAArC,CAA8CE,SAAUH,QCUxDI,GAAS3oB,IAAEmE,MAAM+hB,GAASI,eAAehoB,IAAI,SAAA7D,GAAK,OACtDysB,GAAY,CAAEzsB,YAEhB2sB,aAAeX,IAAIjlB,MAAQ0kB,GAASO,IACpCW,aAAelkB,MAAMgjB,GAASK,aAE9B,IAAMqC,GAAmB,SAAAjnB,GAAA,IAAGpD,EAAHoD,EAAGpD,QAASK,EAAZ+C,EAAY/C,WAAZ,OAAA2D,OAAAwB,EAAA,EAAAxB,CAAA,CACvBjC,MAAO,EACPE,MAAO,EACPrB,MAAO,IACJa,IAAEa,IAAItC,EAAS,CAACK,EAAWC,QAAS,MAgBnCgqB,eACJ,SAAAA,EAAYhhB,GAAO,IAAA0B,EAAA,OAAAhH,OAAAiH,EAAA,EAAAjH,CAAAqF,KAAAihB,IACjBtf,EAAAhH,OAAAkH,EAAA,EAAAlH,CAAAqF,KAAArF,OAAAmH,EAAA,EAAAnH,CAAAsmB,GAAAlf,KAAA/B,KAAMC,KAEDihB,QAAUvf,EAAKuf,QAAQjf,KAAbtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACfA,EAAKwf,mBAAqBxf,EAAKwf,mBAAmBlf,KAAxBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAC1BA,EAAKyf,mBAAqBzf,EAAKyf,mBAAmBnf,KAAxBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAC1BA,EAAK0f,kBAAoB1f,EAAK0f,kBAAkBpf,KAAvBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACzBA,EAAK2f,YAAc3f,EAAK2f,YAAYrf,KAAjBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACnBA,EAAK4f,YAAc5f,EAAK4f,YAAYtf,KAAjBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACnBA,EAAK6f,eAAiB7f,EAAK6f,eAAevf,KAApBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACtBA,EAAK8f,kBAAoB9f,EAAK8f,kBAAkBxf,KAAvBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACzBA,EAAK+f,kBAAoB/f,EAAK+f,kBAAkBzf,KAAvBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACzBA,EAAKggB,wBAA0BhgB,EAAKggB,wBAAwB1f,KAA7BtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAC/BA,EAAKigB,gBAAkBjgB,EAAKigB,gBAAgB3f,KAArBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACvBA,EAAKkgB,kBAAoBlgB,EAAKkgB,kBAAkB5f,KAAvBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACzBA,EAAKmgB,WAAangB,EAAKmgB,WAAW7f,KAAhBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAClBA,EAAKogB,aAAepgB,EAAKogB,aAAa9f,KAAlBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAEpBA,EAAK/E,MAAQ,CACXolB,WAAW,EACXC,aAAc,EACdC,mBAAoB,GACpBC,eAAgB,EAChBC,eAAgB,EAChB9H,KAAM,KAxBS3Y,kFA4BA4I,GACjBvK,KAAKsK,SAAS,CACZ6X,gBAAiB5X,EAAEqQ,OAAOhhB,QAE5B2Q,EAAEE,cAAc4X,kDAGC9X,GACjBvK,KAAKsK,SAAS,CACZ8X,gBAAiB7X,EAAEqQ,OAAOhhB,QAE5B2Q,EAAEE,cAAc4X,iDAGA9X,GAChBvK,KAAKsK,SAAS,CACZ4X,mBAAoB3X,EAAEqQ,OAAOhhB,QAE/B2Q,EAAEE,cAAc4X,yDAGQ,IAAAtiB,EACQC,KAAKC,MAA7BjJ,EADgB+I,EAChB/I,WAAYL,EADIoJ,EACJpJ,QACd2rB,EAActrB,EAAWC,OAC/B,OAAO0D,OAAOge,QAAQhiB,GACnBgF,OAAO,SAAAwB,GAAA,IAAAC,EAAAzC,OAAA6b,GAAA,EAAA7b,CAAAwC,EAAA,GAAE7G,EAAF8G,EAAA,GAAAA,EAAA,UAAoB9G,KAASgsB,IACpC5rB,IAAI,SAAA6rB,GAAA,IAAA7kB,EAAA/C,OAAA6b,GAAA,EAAA7b,CAAA4nB,EAAA,GAAEjsB,EAAFoH,EAAA,GAAAA,EAAA,UAAmBpH,wCAGhBiU,GAAG,IAAA7J,EACiCV,KAAKC,MAA3CjJ,EADK0J,EACL1J,WAAYL,EADP+J,EACO/J,QAAS6rB,EADhB9hB,EACgB8hB,aACvBC,EAAuBziB,KAAK0iB,0BAC5BJ,EAActrB,EAAWC,OACzBirB,EAAuBliB,KAAKpD,MAA5BslB,mBACAjrB,EAAS+pB,GAAiBhhB,KAAKC,OACjC7H,IAAEyB,QAAQqoB,KACZA,EAAqBO,EAAqB,KAI1CrqB,IAAEyB,QAAQ5C,EAAOM,QACjB8I,OAAOsiB,QAAP,sCAAAzqB,OACwCgqB,EADxC,QAIAM,EAAa,CACXvrB,OAAQN,EAAQurB,GAChBrvB,MAAOyvB,IAGX/X,EAAEE,cAAc4X,2CAGN9X,GAAG,IAAAyB,EACwBhM,KAAKC,MAAlCuiB,EADKxW,EACLwW,aACFF,EAFOtW,EACShV,WACSC,OAE3BoJ,OAAOsiB,QAAQ,6CACjBH,EAAa,CACXvrB,OAAQ,CACNyB,MAAO,EACPE,MAAO,EACPrB,MAAO,IAET1E,MAAOyvB,IAGX/X,EAAEE,cAAc4X,uCAGVO,GAEa,UAAfA,EAAMC,MAER7iB,KAAK8hB,kDAIIG,GACXjiB,KAAKsK,SAAS,CACZ2X,6DAKFzC,WAAasD,SAEb,IAAM7rB,EAAS+pB,GAAiBhhB,KAAKC,OACrCD,KAAK+iB,SAAW/iB,KAAKwhB,iBACrBxhB,KAAK+iB,SAASC,aAAe7D,GAAoBloB,EAAOyB,OAExD2H,OAAO4J,iBAAiB,UAAWjK,KAAKkhB,kDAGzB,IAAA9V,EAAApL,KACf,OAAO,IAAIwf,YACT,SAACO,EAAMltB,GACL,IAAMoE,EAAS+pB,GAAiB5V,EAAKnL,OAC/BrG,EAAQ3C,EAAOM,MAAM1E,GAEvB+G,GAEEA,EAAM9B,QAAU,GAClB+nB,GAAcllB,OAAAwB,EAAA,EAAAxB,CAAA,GACTf,EADQ,CAEXmmB,OACAnnB,MAAOmoB,GAAO9pB,EAAO2B,UAGrBgB,EAAM9B,QAKVuoB,GAAe,CAAEN,OAAMnnB,MAAOmoB,GAAO9pB,EAAO2B,SAE9C4mB,QAAUyD,SAAS,WACjB7X,EAAK2W,aAAalvB,IACjBktB,IAEL3nB,IAAEmE,MAAM+hB,GAASG,cACjBH,GAASQ,uDAIKvU,GAAG,IAAA2Y,EACS3Y,EAAEqQ,OAAtBuI,EADWD,EACXC,SAAUvpB,EADCspB,EACDtpB,MAClB,GAAIupB,EAASC,MAAO,KAAAC,EAEmBrjB,KAAKC,MAAlCuiB,EAFUa,EAEVb,aACFF,EAHYe,EAEIrsB,WACSC,OACzBA,EAAS+pB,GAAiBhhB,KAAKC,OAC/BqjB,EAAS3oB,OAAAwB,EAAA,EAAAxB,CAAA,GACV1D,EADU,CAEb2B,MAAOgB,IAITymB,GAAe,CAAEznB,MAAOmoB,GAAO9pB,EAAO2B,SAEtC4pB,EAAa,CAAEvrB,OAAQqsB,EAAWzwB,MAAOyvB,+CAI3B/X,GAAG,IAAAgZ,EACShZ,EAAEqQ,OAAtBuI,EADWI,EACXJ,SAAUvpB,EADC2pB,EACD3pB,MAClB,GAAIupB,EAASC,MAAO,CAElBpjB,KAAK+iB,SAASC,aAAe7D,GAAoBvlB,GAF/B,IAAA4pB,EAKmBxjB,KAAKC,MAAlCuiB,EALUgB,EAKVhB,aACFF,EANYkB,EAKIxsB,WACSC,OACzBA,EAAS+pB,GAAiBhhB,KAAKC,OAKrCuiB,EAAa,CAAEvrB,OAJA0D,OAAAwB,EAAA,EAAAxB,CAAA,GACV1D,EADU,CAEbyB,MAAOkB,IAEyB/G,MAAOyvB,0CAIhC,IACHN,EAAchiB,KAAKpD,MAAnBolB,UACF/qB,EAAS+pB,GAAiBhhB,KAAKC,OACjC+hB,GACFhiB,KAAK+iB,SAAS3a,OACdiY,GAAe,CAAEznB,MAAOmoB,GAAO9pB,EAAO2B,UAEtCoH,KAAK+iB,SAASznB,MAAMgjB,GAASK,aAE/B3e,KAAKsK,SAAS,CACZ0X,WAAYA,EACZC,aAAc,oDAIM1X,GAAG,IAAAkZ,EACGlZ,EAAEqQ,OAAtBuI,EADiBM,EACjBN,SAAUvpB,EADO6pB,EACP7pB,MACZ3C,EAAS+pB,GAAiBhhB,KAAKC,OACrC,GAAIkjB,EAASC,MAAO,KAAAM,EACe1jB,KAAKC,MAA9B0jB,EADUD,EACVC,SAAU3sB,EADA0sB,EACA1sB,WAClB2sB,EAAShpB,OAAAwB,EAAA,EAAAxB,CAAA,GACJ3D,EADG,CAENC,OAAQ2C,KAEVymB,GAAe,CAAEznB,MAAOmoB,GAAO9pB,EAAO2B,oDAIxB4hB,GAAK,IAOjBoJ,EAPiBC,EACgB7jB,KAAKC,MAAlCuiB,EADaqB,EACbrB,aACFF,EAFeuB,EACC7sB,WACSC,OACvB+qB,EAAchiB,KAAKpD,MAAnBolB,UACF/qB,EAAS+pB,GAAiBhhB,KAAKC,OAC7BvH,EAAUzB,EAAVyB,MACFgU,EAAWzV,EAAOM,MAAMijB,GAI9B,GAAK9N,EAOE,KACGlU,EAAWkU,EAAXlU,OAKNorB,EAFEprB,EAAS,EAEAmC,OAAAwB,EAAA,EAAAxB,CAAA,GACN+R,EADM,CAETlU,OAAQA,EAAS,IAKL,UAlBhBorB,EAAc,CACZtrB,KAAM,GACNR,OAAQwmB,GAASC,QAAU,EAC3B/lB,OAAQ8lB,GAASE,QAAU,GAmB3BoF,IAAgB5B,GAEd4B,EAAY9rB,QAAU,GACxBooB,GAAqBvlB,OAAAwB,EAAA,EAAAxB,CAAA,GAChBipB,EADe,CAElBhrB,MAAOmoB,GAAO9pB,EAAO2B,OACrBF,WAaN8pB,EAAa,CAAEvrB,OARA0D,OAAAwB,EAAA,EAAAxB,CAAA,GACV1D,EADU,CAEbM,MAAMoD,OAAAwB,EAAA,EAAAxB,CAAA,GACD1D,EAAOM,MADPoD,OAAAyB,EAAA,EAAAzB,CAAA,GAEF6f,EAAMoJ,MAIuB/wB,MAAOyvB,+CAGb,IAOxBwB,EAPY5N,EAAY6N,EAAZ7N,IAAKsE,EAAOuJ,EAAPvJ,IAAOwJ,EACShkB,KAAKC,MAAlCuiB,EADoBwB,EACpBxB,aACFF,EAFsB0B,EACNhtB,WACSC,OAFH8U,EAGgC/L,KAAKpD,MAAzDolB,EAHoBjW,EAGpBiW,UAAW1H,EAHSvO,EAGTuO,KAAM6H,EAHGpW,EAGHoW,eAAgBC,EAHbrW,EAGaqW,eACnCnrB,EAAS+pB,GAAiBhhB,KAAKC,OAC7BvH,EAAUzB,EAAVyB,MACFgU,EAAWzV,EAAOM,MAAMijB,GAG9B,GAAa,MAATF,EACFwJ,EAAU,SACL,CAEL,GAAKpX,EAOE,KACGpU,EAAiBoU,EAAjBpU,KAAMR,EAAW4U,EAAX5U,OAKZgsB,EAFExrB,IAAS4d,EAEJvb,OAAAwB,EAAA,EAAAxB,CAAA,GACF+R,EADE,CAELpU,KAAM4d,IAKJpe,GAAU,EAEL6C,OAAAwB,EAAA,EAAAxB,CAAA,GACF+R,EADE,CAEL5U,OAAQA,EAAS,IAGT,UAzBdgsB,EAAU,CACRxrB,KAAM4d,EACNpe,OAAQqqB,EACR3pB,OAAQ4pB,GA2BR0B,IAAY9B,GAEV8B,EAAQhsB,QAAU,GACpBooB,GAAqBvlB,OAAAwB,EAAA,EAAAxB,CAAA,GAChBmpB,EADe,CAElBlrB,MAAOmoB,GAAO9pB,EAAO2B,OACrBF,WAcR8pB,EAAa,CAAEvrB,OARA0D,OAAAwB,EAAA,EAAAxB,CAAA,GACV1D,EADU,CAEbM,MAAMoD,OAAAwB,EAAA,EAAAxB,CAAA,GACD1D,EAAOM,MADPoD,OAAAyB,EAAA,EAAAzB,CAAA,GAEF6f,EAAMsJ,MAIuBjxB,MAAOyvB,mDAIzCtiB,KAAK+hB,aAAe,aACpB/hB,KAAK+iB,SAAS3a,OACd,IAAMnR,EAAS+pB,GAAiBhhB,KAAKC,OACrCogB,GAAe,CAAEznB,MAAOmoB,GAAO9pB,EAAO2B,SACtCyH,OAAO8K,oBAAoB,UAAWnL,KAAKkhB,oDAG1BjW,GACjB,IAAMgZ,EAAYjD,GAAiB/V,GAC7BqY,EAAYtC,GAAiBhhB,KAAKC,OAEtCgL,EAAUjU,WAAWC,SAAW+I,KAAKC,MAAMjJ,WAAWC,QACtDgtB,EAAUvrB,QAAU4qB,EAAU5qB,QAE9BsH,KAAK+iB,SAASC,aAAe7D,GAAoBmE,EAAU5qB,SAGxDN,IAAEyB,QAAQoqB,EAAU1sB,QAAUa,IAAEyB,QAAQypB,EAAU/rB,QACrDyI,KAAKsK,SAAS,CAAEgQ,KAAM,uCAIjB,IAAAxO,EAAA9L,KAEDsiB,EADiBtiB,KAAKC,MAApBjJ,WACuBC,OAFxBukB,EAWHxb,KAAKpD,MANPolB,EALKxG,EAKLwG,UACAC,EANKzG,EAMLyG,aACAC,EAPK1G,EAOL0G,mBACA5H,EARKkB,EAQLlB,KACA6H,EATK3G,EASL2G,eACAC,EAVK5G,EAUL4G,eAGInrB,EAAS+pB,GAAiBhhB,KAAKC,OAC/BwiB,EAAuBziB,KAAK0iB,0BAElC,OACE7hB,EAAAC,EAAAC,cAAA,OAAKC,UAAU,4BACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,QACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,YACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SAAf,UACAH,EAAAC,EAAAC,cAACmjB,GAAD,CACExD,MAAM,IACN9mB,MAAO0oB,EAAYvlB,WACnB4jB,aAAc3gB,KAAK2hB,wBACnBxb,KAAK,SACLya,QAAS,CAAEpS,IAAK,EAAGC,IAAK6P,GAAS3nB,QAAU,KAE7CkK,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SAAf,SACAH,EAAAC,EAAAC,cAACmjB,GAAD,CACExD,MAAM,IACN9mB,MAAO3C,EAAOyB,MAAMqE,WACpB4jB,aAAc3gB,KAAKyhB,kBACnBtb,KAAK,SACLya,QAAS,CAAEpS,IAAK,EAAGC,IAAK,KAE1B5N,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SAAf,SACAH,EAAAC,EAAAC,cAACmjB,GAAD,CACExD,MAAM,IACN9mB,MAAO3C,EAAO2B,MAAMmE,WACpB4jB,aAAc3gB,KAAK0hB,kBACnBvb,KAAK,SACLya,QAAS,CAAEpS,IAAK,EAAGC,IAAK,MAG5B5N,EAAAC,EAAAC,cAAA,OAAKC,UAAU,UACbH,EAAAC,EAAAC,cAAA,UACEC,UAAW+B,IAAW,cAAe,CAAE1M,OAAQ2rB,IAC/Crf,QAAS3C,KAAK8hB,YAEbE,EAAY,OAAS,QAExBnhB,EAAAC,EAAAC,cAAA,SAAOC,UAAU,SACfH,EAAAC,EAAAC,cAAA,aACG3I,IAAEmE,MAAM,IAAK,GAAG7F,IAAI,SAAAwf,GAAG,OACtBrV,EAAAC,EAAAC,cAAA,MAAIzK,IAAK4f,GACPrV,EAAAC,EAAAC,cAAA,UAAKvJ,EAAS0e,IACb9d,IAAEmE,MAAM+hB,GAASG,cAAc/nB,IAAI,SAAA8jB,GAClC,IAAM5gB,EAAQ3C,EAAOM,MAAMijB,GACrBjhB,EAAQK,GAASA,EAAMtB,OAAS4d,EAChCiO,EACI,KAARjO,GAAcsE,IAAQyH,GAAgBD,EACpCnhB,EAAAC,EAAAC,cAAA,QAAMC,UAAU,cACd,KACN,OACEH,EAAAC,EAAAC,cAAA,MACEzK,IAAKkkB,EACL7X,QAAS,kBAAMmJ,EAAK8V,gBAAgB,CAAE1L,MAAKsE,SAC3CxZ,UAAW+B,IAAWpI,OAAAyB,EAAA,EAAAzB,CAAA,CACpBpB,QACA6qB,UAAW5J,IAAQyH,GAAgBD,GAFhB,UAAA9pB,OAGR0B,GAASA,EAAM9B,QAAWyB,KAGtC4qB,EACDtjB,EAAAC,EAAAC,cAAA,cACGxH,EACGK,EAAM9B,QAAU,EACd8B,EAAM9B,OACN,IACF,aASpB+I,EAAAC,EAAAC,cAAA,SAAOC,UAAU,WACfH,EAAAC,EAAAC,cAAA,aACEF,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,eACC3I,IAAEmE,MAAM+hB,GAASG,cAAc/nB,IAAI,SAAA8jB,GAClC,IAAM5gB,EAAQ3C,EAAOM,MAAMijB,GACrB2J,EACJ3J,IAAQyH,GAAgBD,EACtBnhB,EAAAC,EAAAC,cAAA,QAAMC,UAAU,cACd,KACN,OACEH,EAAAC,EAAAC,cAAA,MACEzK,IAAKkkB,EACLxZ,UAAW+B,IAAWpI,OAAAyB,EAAA,EAAAzB,CAAA,CACpBypB,UAAW5J,IAAQyH,GAAgBD,GADhB,UAAA9pB,OAER0B,GAASA,EAAMpB,QAAWoB,IAEvC+I,QAAS,kBAAMmJ,EAAK+V,kBAAkBrH,KAErC2J,EACDtjB,EAAAC,EAAAC,cAAA,cAASnH,GAASA,EAAMpB,eAQtCqI,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SACbH,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAAA,UACEC,UAAU,SACVqjB,SAAUjsB,IAAEyB,QAAQ5C,EAAOM,OAC3BoL,QAAS3C,KAAKshB,aAHhB,UAQFzgB,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SACbH,EAAAC,EAAAC,cAAA,UACEsjB,SAAUjsB,IAAEyB,QAAQ4oB,GACpBzhB,UAAU,SACV2B,QAAS3C,KAAKuhB,aAHhB,SAOA1gB,EAAAC,EAAAC,cAAA,UACEnH,MAAOsoB,EACPpB,SAAU9gB,KAAKqhB,mBAEdoB,EAAqB/rB,IAAI,SAAAJ,GAAG,OAC3BuK,EAAAC,EAAAC,cAAA,UAAQzK,IAAKA,EAAKsD,MAAOtD,GACtBA,OAKTuK,EAAAC,EAAAC,cAAA,OAAKC,UAAU,YACbH,EAAAC,EAAAC,cAAA,QAAMC,UAAU,SAAhB,UACAH,EAAAC,EAAAC,cAAA,UAAQnH,MAAOuoB,EAAgBrB,SAAU9gB,KAAKmhB,oBAC3C/oB,IAAEmE,MAAM,GAAI,GAAI,GAAG7F,IAAI,SAAAJ,GAAG,OACzBuK,EAAAC,EAAAC,cAAA,UAAQzK,IAAKA,EAAKsD,MAAOtD,IACb,IAATA,EAAa,IAAMA,OAK5BuK,EAAAC,EAAAC,cAAA,OAAKC,UAAU,YACbH,EAAAC,EAAAC,cAAA,QAAMC,UAAU,SAAhB,UACAH,EAAAC,EAAAC,cAAA,UAAQnH,MAAOwoB,EAAgBtB,SAAU9gB,KAAKohB,oBAC3ChpB,IAAEmE,MAAM,GAAI,GAAG7F,IAAI,SAAAJ,GAAG,OACrBuK,EAAAC,EAAAC,cAAA,UAAQzK,IAAKA,EAAKsD,MAAOtD,GACtBA,OAKTuK,EAAAC,EAAAC,cAAA,OAAKC,UAAU,cACbH,EAAAC,EAAAC,cAAA,UACEC,UAAW+B,IAAW,SAAU,CAC9B1M,OAAiB,MAATikB,IAEV3X,QAAS,WACPmJ,EAAKxB,SAAS,CACZgQ,KAAM,QANZ,KAYAzZ,EAAAC,EAAAC,cAAA,UACEsjB,SAAUjsB,IAAEyB,QAAQ5C,EAAOM,OAC3ByJ,UAAW+B,IAAW,SAAU,CAC9B1M,OAAiB,MAATikB,IAEV3X,QAAS,WACPmJ,EAAKxB,SAAS,CACZgQ,KAAM,QAPZ,gBAjiBOrZ,aAsjBNC,eAnkBS,SAAAlE,GAAA,MAA8B,CAAErG,QAAhCqG,EAAGrG,QAAsCK,WAAzCgG,EAAYhG,aAET,SAAA4G,GAAQ,MAAK,CACtC+lB,SAAU,SAAA7mB,GAAO,OAAIc,EAASP,EAAQsmB,SAAS7mB,KAC/C0lB,aAAc,SAAAvlB,GAAA,IAAGhG,EAAHgG,EAAGhG,OAAQpE,EAAXoK,EAAWpK,MAAX,OACZ+K,EACEP,EAAQmlB,aAAa,CACnBvrB,SACApE,cA2jBOqO,CAA6C+f,ICllBtDF,GAAS3oB,IAAEmE,MAAM+hB,GAASI,eAAehoB,IAAI,SAAA7D,GAAK,OACtDysB,GAAY,CAAEzsB,YAEhB2sB,aAAeX,IAAIjlB,MAAQ0kB,GAASO,IACpCW,aAAelkB,MAAMgjB,GAASK,aAE9B,IAMM2F,GAAe,SAAAptB,GAAK,OACvBkB,IAAEmsB,aACD5pB,OAAO8B,KAAKvF,GACZkB,IAAEmE,MAAM+hB,GAASG,cAAc/nB,IAAI,SAAAgY,GAAC,OAAIA,EAAE3R,cAC1ChK,QAEEyxB,GAAkB,SAAAxnB,GAAA,IAAGpG,EAAHoG,EAAGpG,OAAQI,EAAXgG,EAAWhG,WAAX,OAAA2D,OAAAwB,EAAA,EAAAxB,CAAA,CACtBjC,MAAO,GACJN,IAAEa,IAAIrC,EAAQ,CAACI,EAAWE,OAAQ,MAcjCutB,eACJ,SAAAA,EAAYxkB,GAAO,IAAA0B,EAAA,OAAAhH,OAAAiH,EAAA,EAAAjH,CAAAqF,KAAAykB,IACjB9iB,EAAAhH,OAAAkH,EAAA,EAAAlH,CAAAqF,KAAArF,OAAAmH,EAAA,EAAAnH,CAAA8pB,GAAA1iB,KAAA/B,KAAMC,KAEDihB,QAAUvf,EAAKuf,QAAQjf,KAAbtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACfA,EAAK2f,YAAc3f,EAAK2f,YAAYrf,KAAjBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACnBA,EAAK+iB,2BAA6B/iB,EAAK+iB,2BAA2BziB,KAAhCtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAClCA,EAAK0f,kBAAoB1f,EAAK0f,kBAAkBpf,KAAvBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACzBA,EAAK4f,YAAc5f,EAAK4f,YAAYtf,KAAjBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACnBA,EAAK8f,kBAAoB9f,EAAK8f,kBAAkBxf,KAAvBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACzBA,EAAKgjB,uBAAyBhjB,EAAKgjB,uBAAuB1iB,KAA5BtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAC9BA,EAAKijB,kBAAoBjjB,EAAKijB,kBAAkB3iB,KAAvBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACzBA,EAAKmgB,WAAangB,EAAKmgB,WAAW7f,KAAhBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAClBA,EAAKogB,aAAepgB,EAAKogB,aAAa9f,KAAlBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAEpBA,EAAK/E,MAAQ,CACXolB,WAAW,EACXC,aAAc,EACdC,mBAAoB,GACpB2C,oBAAqB,GACrBvK,KAAM,KAnBS3Y,0FAuBQ4I,GACzBvK,KAAKsK,SAAS,CACZua,oBAAqBta,EAAEqQ,OAAOhhB,QAEhC2Q,EAAEE,cAAc4X,iDAGA9X,GAChBvK,KAAKsK,SAAS,CACZ4X,mBAAoB3X,EAAEqQ,OAAOhhB,QAE/B2Q,EAAEE,cAAc4X,wDAGO,IAAAtiB,EACQC,KAAKC,MAA5BjJ,EADe+I,EACf/I,WAAYJ,EADGmJ,EACHnJ,OACdkuB,EAAa9tB,EAAWE,MAC9B,OAAOyD,OAAO8B,KAAK7F,GAAQ+E,OAAO,SAAArF,GAAG,OAAKA,KAASwuB,wCAGzCva,GAAG,IAAA7J,EAC+BV,KAAKC,MAAzCjJ,EADK0J,EACL1J,WAAYJ,EADP8J,EACO9J,OAAQmuB,EADfrkB,EACeqkB,YACtBC,EAAsBhlB,KAAKilB,yBAC3BH,EAAa9tB,EAAWE,MACxBgrB,EAAuBliB,KAAKpD,MAA5BslB,mBACAhrB,EAAQstB,GAAgBxkB,KAAKC,OAC/B7H,IAAEyB,QAAQqoB,KACZA,EAAqB8C,EAAoB,KAIzCV,GAAaptB,IACbmJ,OAAOsiB,QAAP,sCAAAzqB,OACwCgqB,EADxC,QAIA6C,EAAY,CACV7tB,MAAON,EAAOsrB,GACdrvB,MAAOiyB,IAGXva,EAAEE,cAAc4X,2CAGN9X,GAAG,IAAAyB,EACuBhM,KAAKC,MAAjC8kB,EADK/Y,EACL+Y,YACFD,EAFO9Y,EACQhV,WACSE,MAE1BmJ,OAAOsiB,QAAQ,4CACjBoC,EAAY,CACV7tB,MAAO,KACPrE,MAAOiyB,IAGXva,EAAEE,cAAc4X,4CAGLJ,GACXjiB,KAAKsK,SAAS,CACZ2X,6DAIgB,IAAA7W,EAAApL,KAClBwf,WAAasD,SADK,IAGVnsB,EAAYqJ,KAAKC,MAAjBtJ,QACFO,EAAQstB,GAAgBxkB,KAAKC,OAEnCD,KAAK+iB,SAAW,IAAIvD,YAClB,SAACO,EAAMltB,GACL,IAAMqE,EAAQstB,GAAgBpZ,EAAKnL,OADpBilB,EAIwB9sB,IAAE+sB,SACvCtyB,EAAMkK,SAASuhB,GAASG,cACxB,EACA,GAECviB,MAAM,IACNxF,IAAI,SAAAgD,GAAC,OAAI0rB,SAAS1rB,EAAG4kB,GAASG,gBAVlB4G,EAAA1qB,OAAA6b,GAAA,EAAA7b,CAAAuqB,EAAA,GAIRI,EAJQD,EAAA,GAIQE,EAJRF,EAAA,GAaTG,EAAiBptB,IAAEa,IAAI/B,EAAOouB,GAGpCltB,IAAEmE,MAAM+hB,GAASI,eAAelP,QAAQ,SAAAvJ,GAEtC,IAAMqc,EAAclqB,IAAEa,IAAIusB,EAAgBvf,GAG1C,GAAK7N,IAAEO,MAAM2pB,GA0BXjC,GAAe,CAAEN,OAAMnnB,MAAOmoB,GAAO9a,SA1BZ,CAEzB,IAAMhP,EAASmB,IAAEa,IAAItC,EAAS2rB,EAAa,IAGrCmD,EAAcrtB,IAAEa,IAAIhC,EAAOM,MAAOguB,GAGnCntB,IAAEO,MAAM8sB,GAcXpF,GAAe,CAAEN,OAAMnnB,MAAOmoB,GAAO9a,MAZjCwf,EAAY3tB,QAAU,GACxB+nB,GAAcllB,OAAAwB,EAAA,EAAAxB,CAAA,GACT8qB,EADQ,CAEX1F,OACAnnB,MAAOmoB,GAAO9a,MAIdwf,EAAY3tB,WAWtB0nB,QAAUyD,SAAS,WACjB7X,EAAK2W,aAAauD,IACjBvF,IAEL3nB,IAAEmE,MAAMxE,KAAK2tB,IAAIpH,GAASG,aAAc,IACxCH,GAASQ,aAGX9e,KAAK+iB,SAASC,aAAe7D,GAAoBjoB,EAAMwB,OACvD2H,OAAO4J,iBAAiB,UAAWjK,KAAKkhB,yCAGlC0B,GAEa,UAAfA,EAAMC,MAER7iB,KAAK8hB,WAAWc,6CAIFrY,GAAG,IAAA2Y,EACS3Y,EAAEqQ,OAAtBuI,EADWD,EACXC,SAAUvpB,EADCspB,EACDtpB,MAClB,GAAIupB,EAASC,MAAO,CAElBpjB,KAAK+iB,SAASC,aAAe7D,GAAoBvlB,GAF/B,IAAAypB,EAKkBrjB,KAAKC,MAAjC8kB,EALU1B,EAKV0B,YAAa/tB,EALHqsB,EAKGrsB,WACfE,EAAQstB,GAAgBxkB,KAAKC,OAC7B0lB,EAAWvtB,IAAEwtB,UAAU1uB,GAC7ByuB,EAASjtB,MAAQkB,EAEjBmrB,EAAY,CAAE7tB,MAAOyuB,EAAU9yB,MADZmE,EAAWE,4CAKvBqT,GAAG,IACJyX,EAAchiB,KAAKpD,MAAnBolB,UACJA,GACFhiB,KAAK+iB,SAAS3a,OACd2Y,GAAOvR,QAAQ,SAAA5W,GAAK,OAAIynB,GAAe,CAAEznB,aAEzCoH,KAAK+iB,SAASznB,MAAMgjB,GAASK,aAE/B3e,KAAKsK,SAAS,CACZ0X,WAAYA,EACZC,aAAc,IAEhB1X,EAAEE,cAAc4X,sDAGK9X,GAAG,IAAAgZ,EACIhZ,EAAEqQ,OAAtBuI,EADgBI,EAChBJ,SAAUvpB,EADM2pB,EACN3pB,MAClB,GAAIupB,EAASC,MAAO,KAAAI,EACexjB,KAAKC,MAA9B0jB,EADUH,EACVG,SAAU3sB,EADAwsB,EACAxsB,WAClB2sB,EAAShpB,OAAAwB,EAAA,EAAAxB,CAAA,GACJ3D,EADG,CAENE,MAAO0C,mDAK0B,IAAnBqM,EAAmB9I,EAAnB8I,QAASuU,EAAUrd,EAAVqd,IAAKjQ,EAAKpN,EAALoN,EAAKmZ,EACQ1jB,KAAKC,MAA1CtJ,EAD6B+sB,EAC7B/sB,QAASouB,EADoBrB,EACpBqB,YAAa/tB,EADO0sB,EACP1sB,WADO+U,EAEC/L,KAAKpD,MAAnCioB,EAF6B9Y,EAE7B8Y,oBAAqBvK,EAFQvO,EAERuO,KACvBwK,EAAa9tB,EAAWE,MACxBA,EAAQstB,GAAgBxkB,KAAKC,OAC7B0lB,EAAWvtB,IAAEwtB,UAAU1uB,GACzBosB,EAAYlrB,IAAEa,IAAI0sB,EAAU,CAACnL,EAAKvU,IAGhC4f,EAAaztB,IAAEuC,OAAO8B,KAAK9F,IAC9BmvB,OAAO,SAAApsB,GAAC,OAAKA,IACbqsB,OACArvB,IAAI,SAAAgD,GAAC,OAAKA,IACVE,QAEH,GAAa,MAAT0gB,EACFgJ,EAAY,UAGZ,GAAIlrB,IAAEO,MAAM2qB,GAEVA,EAAYlrB,IAAEyB,QAAQgrB,GAClBgB,EAAW,GACXhB,MACC,CAGL,IAAMmB,EAAiB5tB,IAAEtF,QAAQ+yB,GAAavC,GAK5CA,EAFqB,IAAnB0C,EAEU,KAGAH,EAAWG,EAAiB,GAK9C5tB,IAAE6tB,QAAQN,EAAU,CAACnL,EAAKvU,GAAUqd,EAAW3oB,QAC/CoqB,EAAY,CAAE7tB,MAAOyuB,EAAU9yB,MAAOiyB,IACtCva,EAAEE,cAAc4X,sDAIhBriB,KAAK+hB,aAAe,aACpB/hB,KAAK+iB,SAAS3a,OACd2Y,GAAOvR,QAAQ,SAAA5W,GAAK,OAAIynB,GAAe,CAAEznB,YACzCyH,OAAO8K,oBAAoB,UAAWnL,KAAKkhB,oDAG1BjW,GACjB,IAAMib,EAAW1B,GAAgBvZ,GAC3B0a,EAAWnB,GAAgBxkB,KAAKC,OAEpCgL,EAAUjU,WAAWE,QAAU8I,KAAKC,MAAMjJ,WAAWE,OACrDgvB,EAASxtB,QAAUitB,EAASjtB,QAE5BsH,KAAK+iB,SAASC,aAAe7D,GAAoBwG,EAASjtB,SAGvD4rB,GAAa4B,IAAa5B,GAAaqB,IAC1C3lB,KAAKsK,SAAS,CAAEgQ,KAAM,uCAIjB,IAAAxO,EAAA9L,KAAA6jB,EACyB7jB,KAAKC,MAA7BjJ,EADD6sB,EACC7sB,WAAYL,EADbktB,EACaltB,QACdmuB,EAAa9tB,EAAWE,MAFvBskB,EAUHxb,KAAKpD,MALPolB,EALKxG,EAKLwG,UACAC,EANKzG,EAMLyG,aACAC,EAPK1G,EAOL0G,mBACA2C,EARKrJ,EAQLqJ,oBACAvK,EATKkB,EASLlB,KAEIpjB,EAAQstB,GAAgBxkB,KAAKC,OAC7B+kB,EAAsBhlB,KAAKilB,yBAEjC,OACEpkB,EAAAC,EAAAC,cAAA,OAAKC,UAAU,2BACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,QACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAW+B,IAAW,UAAW,CAAEkZ,MAAO7jB,IAAEyB,QAAQlD,MAAzD,2BAGAkK,EAAAC,EAAAC,cAAA,OAAKC,UAAW+B,IAAW,WAAY,CAAEkZ,KAAM7jB,IAAEyB,QAAQlD,MACvDkK,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SAAf,SACAH,EAAAC,EAAAC,cAACmjB,GAAD,CACExD,MAAM,IACN9mB,MAAOkrB,EAAW/nB,WAClB4jB,aAAc3gB,KAAK2kB,uBACnBxe,KAAK,SACLya,QAAS,CAAEpS,IAAK,EAAGC,IAAK6P,GAAS1nB,OAAS,KAE5CiK,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SAAf,SACAH,EAAAC,EAAAC,cAACmjB,GAAD,CACExD,MAAM,IACN9mB,MAAO1C,EAAMwB,MAAMqE,WACnB4jB,aAAc3gB,KAAKyhB,kBACnBtb,KAAK,SACLya,QAAS,CAAEpS,IAAK,EAAGC,IAAK,MAG5B5N,EAAAC,EAAAC,cAAA,OAAKC,UAAW+B,IAAW,SAAU,CAAEkZ,KAAM7jB,IAAEyB,QAAQlD,MACrDkK,EAAAC,EAAAC,cAAA,UACEC,UAAW+B,IAAW,cAAe,CAAE1M,OAAQ2rB,IAC/Crf,QAAS3C,KAAK8hB,YAEbE,EAAY,OAAS,QAExBnhB,EAAAC,EAAAC,cAAA,SAAOC,UAAU,WACfH,EAAAC,EAAAC,cAAA,aACG3I,IAAEmE,MAAM+hB,GAASI,eAAehoB,IAAI,SAAAuP,GAAO,OAC1CpF,EAAAC,EAAAC,cAAA,MAAIzK,IAAK2P,GACPpF,EAAAC,EAAAC,cAAA,UAAKkF,GACJ7N,IAAEmE,MAAM+hB,GAASG,cAAc/nB,IAAI,SAAA8jB,GAClC,IAAMvjB,EAASmB,IAAEa,IAAI/B,EAAO,CAACsjB,EAAKvU,IAC5Bke,EACQ,IAAZle,GAAiBuU,IAAQyH,GAAgBD,EACvCnhB,EAAAC,EAAAC,cAAA,QAAMC,UAAU,cACd,KACN,OACEH,EAAAC,EAAAC,cAAA,MACEzK,IAAKkkB,EACLxZ,UAAW+B,IAAW,CACpBqhB,UACE5J,IAAQyH,GACRD,IACC5pB,IAAEO,MAAM1B,KAEb0L,QAAS,SAAA4H,GAAC,OACRuB,EAAK8Y,kBAAkB,CAAE3e,UAASuU,MAAKjQ,QAGxC4Z,EACDtjB,EAAAC,EAAAC,cAAA,cACEF,EAAAC,EAAAC,cAAA,YACG3I,IAAEO,MAAM1B,GAAU,GAAKmB,IAAE+sB,SAASluB,EAAQ,EAAG,cAWlE4J,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SACbH,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAAA,UACEC,UAAU,SACVqjB,SAAUC,GAAaptB,GACvByL,QAAS3C,KAAKshB,aAHhB,UAQFzgB,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SACbH,EAAAC,EAAAC,cAAA,UACEsjB,SAAUjsB,IAAEyB,QAAQmrB,GACpBhkB,UAAU,SACV2B,QAAS3C,KAAKuhB,aAHhB,SAOA1gB,EAAAC,EAAAC,cAAA,UACEnH,MAAOsoB,EACPpB,SAAU9gB,KAAKqhB,mBAEd2D,EAAoBtuB,IAAI,SAAAJ,GAAG,OAC1BuK,EAAAC,EAAAC,cAAA,UAAQzK,IAAKA,EAAKsD,MAAOtD,GACtBA,OAKTuK,EAAAC,EAAAC,cAAA,OAAKC,UAAU,YACbH,EAAAC,EAAAC,cAAA,QAAMC,UAAU,SAAhB,UACAH,EAAAC,EAAAC,cAAA,UACEnH,MAAOirB,EACP/D,SAAU9gB,KAAK0kB,4BAEd/pB,OAAO8B,KAAK9F,GAASD,IAAI,SAAAJ,GAAG,OAC3BuK,EAAAC,EAAAC,cAAA,UAAQzK,IAAKA,EAAKsD,MAAOtD,GACtBA,OAKTuK,EAAAC,EAAAC,cAAA,OAAKC,UAAU,cACbH,EAAAC,EAAAC,cAAA,UACEC,UAAW+B,IAAW,SAAU,CAC9B1M,OAAiB,MAATikB,IAEV3X,QAAS,WACPmJ,EAAKxB,SAAS,CACZgQ,KAAM,QANZ,KAYAzZ,EAAAC,EAAAC,cAAA,UAEEC,UAAW+B,IAAW,SAAU,CAC9B1M,OAAiB,MAATikB,IAEV3X,QAAS,WACPmJ,EAAKxB,SAAS,CACZgQ,KAAM,QAPZ,gBA3ZMrZ,aAgbLC,eA5cS,SAAAnH,GAAA,MAAsC,CAC5DnD,OADsBmD,EAAGnD,OAEzBD,QAFsBoD,EAAWpD,QAGjCK,WAHsB+C,EAAoB/C,aAiBjB,SAAA4G,GAAQ,MAAK,CACtC+lB,SAAU,SAAA7mB,GAAO,OAAIc,EAASP,EAAQsmB,SAAS7mB,KAC/CioB,YAAa,SAAA9nB,GAAA,IAAG/F,EAAH+F,EAAG/F,MAAOrE,EAAVoK,EAAUpK,MAAV,OACX+K,EACEP,EAAQ0nB,YAAY,CAClB7tB,QACArE,cAqbOqO,CAA6CujB,ICldtD1D,GAAS3oB,IAAEmE,MAAM+hB,GAASI,eAAehoB,IAAI,SAAA7D,GAAK,OACtDysB,GAAY,CAAEzsB,YAEhB2sB,aAAeX,IAAIjlB,MAAQ0kB,GAASO,IACpCW,aAAelkB,MAAMgjB,GAASK,aAE9B,IAOMwH,GAAiB,SAAAnpB,GAAA,IAAGnG,EAAHmG,EAAGnG,MAAOG,EAAVgG,EAAUhG,WAAV,OAAA2D,OAAAwB,EAAA,EAAAxB,CAAA,CACrBjC,MAAO,GACJN,IAAEa,IAAIpC,EAAO,CAACG,EAAWG,MAAO,MAG/BivB,GAAc,SAAAjvB,GAAI,OACrBiB,IAAEmsB,aACD5pB,OAAO8B,KAAKtF,GACZiB,IAAEmE,MAAM+hB,GAASG,cAAc/nB,IAAI,SAAAgY,GAAC,OAAIA,EAAE3R,cAC1ChK,QAaEszB,eACJ,SAAAA,EAAYpmB,GAAO,IAAA0B,EAAA,OAAAhH,OAAAiH,EAAA,EAAAjH,CAAAqF,KAAAqmB,IACjB1kB,EAAAhH,OAAAkH,EAAA,EAAAlH,CAAAqF,KAAArF,OAAAmH,EAAA,EAAAnH,CAAA0rB,GAAAtkB,KAAA/B,KAAMC,KAEDqhB,YAAc3f,EAAK2f,YAAYrf,KAAjBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACnBA,EAAKuf,QAAUvf,EAAKuf,QAAQjf,KAAbtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACfA,EAAK8f,kBAAoB9f,EAAK8f,kBAAkBxf,KAAvBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACzBA,EAAK2kB,sBAAwB3kB,EAAK2kB,sBAAsBrkB,KAA3BtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAC7BA,EAAK4kB,iBAAmB5kB,EAAK4kB,iBAAiBtkB,KAAtBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACxBA,EAAKmgB,WAAangB,EAAKmgB,WAAW7f,KAAhBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAClBA,EAAKogB,aAAepgB,EAAKogB,aAAa9f,KAAlBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAEpBA,EAAK/E,MAAQ,CACXolB,WAAW,EACXC,aAAc,GAbCtgB,2EAiBP4I,GACVA,EAAEE,cAAc4X,OADH,IAAAtiB,EAEsBC,KAAKC,MAAhCumB,EAFKzmB,EAELymB,WACFC,EAHO1mB,EAEO/I,WACSG,KAEzBkJ,OAAOsiB,QAAQ,2CACjB6D,EAAW,CACTrvB,KAAM,CACJuB,MAAO,GAET7F,MAAO4zB,yCAKAxE,GACXjiB,KAAKsK,SAAS,CACZ2X,6DAIgB,IAAA7W,EAAApL,KAClBwf,WAAasD,SADK,IAAApiB,EAGUV,KAAKC,MAAzBrJ,EAHU8J,EAGV9J,OAAQD,EAHE+J,EAGF/J,QACVQ,EAAOgvB,GAAenmB,KAAKC,OAEjCD,KAAK+iB,SAAW,IAAIvD,YAClB,SAACO,EAAMltB,GACL,IAAMsE,EAAOgvB,GAAe/a,EAAKnL,OADlBilB,EAIuC9sB,IAAE+sB,SACtDtyB,EAAMkK,SAASuhB,GAASG,cACxB,EACA,GAECviB,MAAM,IACNxF,IAAI,SAAAgD,GAAC,OAAI0rB,SAAS1rB,EAAG4kB,GAASG,gBAVlB4G,EAAA1qB,OAAA6b,GAAA,EAAA7b,CAAAuqB,EAAA,GAIRwB,EAJQrB,EAAA,GAIOC,EAJPD,EAAA,GAIuBE,EAJvBF,EAAA,GAaTP,EAAa1sB,IAAEa,IAAI9B,EAAMuvB,GAGzBxvB,EAAQkB,IAAEa,IAAIrC,EAAQkuB,GAGtBU,EAAiBptB,IAAEa,IAAI/B,EAAOouB,GAGpCltB,IAAEmE,MAAM+hB,GAASI,eAAelP,QAAQ,SAAAvJ,GAEtC,IAAMqc,EAAclqB,IAAEa,IAAIusB,EAAgBvf,GAG1C,GAAK7N,IAAEO,MAAM2pB,GA0BXjC,GAAe,CAAEN,OAAMnnB,MAAOmoB,GAAO9a,SA1BZ,CAEzB,IAAMhP,EAASmB,IAAEa,IAAItC,EAAS2rB,EAAa,IAGrCmD,EAAcrtB,IAAEa,IAAIhC,EAAOM,MAAOguB,GAGnCntB,IAAEO,MAAM8sB,GAcXpF,GAAe,CAAEN,OAAMnnB,MAAOmoB,GAAO9a,MAZjCwf,EAAY3tB,QAAU,GACxB+nB,GAAcllB,OAAAwB,EAAA,EAAAxB,CAAA,GACT8qB,EADQ,CAEX1F,OACAnnB,MAAOmoB,GAAO9a,MAIdwf,EAAY3tB,WAYtB0nB,QAAUyD,SAAS,WACjB7X,EAAK2W,aAAa2E,IACjB3G,IAEL3nB,IAAEmE,MAAMxE,KAAK2tB,IAAIpH,GAASG,aAAc,IACxCH,GAASQ,aAGX9e,KAAK+iB,SAASC,aAAe7D,GAAoBhoB,EAAKuB,OACtD2H,OAAO4J,iBAAiB,UAAWjK,KAAKkhB,mDAGxB3W,GAAG,IAAA2Y,EACS3Y,EAAEqQ,OAAtBuI,EADWD,EACXC,SAAUvpB,EADCspB,EACDtpB,MAClB,GAAIupB,EAASC,MAAO,CAElBpjB,KAAK+iB,SAASC,aAAe7D,GAAoBvlB,GAF/B,IAAAoS,EAKiBhM,KAAKC,MAAhCumB,EALUxa,EAKVwa,WAAYxvB,EALFgV,EAKEhV,WACdG,EAAOgvB,GAAenmB,KAAKC,OAGjCumB,EAAW,CAAErvB,KAFAwD,OAAAwB,EAAA,EAAAxB,CAAA,GAAQxD,EAAR,CAAcuB,MAAOkB,IAEN/G,MADVmE,EAAWG,6CAKpB,IACH6qB,EAAchiB,KAAKpD,MAAnBolB,UACJA,GACFhiB,KAAK+iB,SAAS3a,OACd2Y,GAAOvR,QAAQ,SAAA5W,GAAK,OAAIynB,GAAe,CAAEznB,aAEzCoH,KAAK+iB,SAASznB,MAAMgjB,GAASK,aAE/B3e,KAAKsK,SAAS,CACZ0X,WAAYA,EACZC,aAAc,kDAII1X,GAAG,IAAAgZ,EACKhZ,EAAEqQ,OAAtBuI,EADeI,EACfJ,SAAUvpB,EADK2pB,EACL3pB,MAClB,GAAIupB,EAASC,MAAO,KAAAC,EACerjB,KAAKC,MAA9B0jB,EADUN,EACVM,SAAU3sB,EADAqsB,EACArsB,WAClB2sB,EAAShpB,OAAAwB,EAAA,EAAAxB,CAAA,GACJ3D,EADG,CAENG,KAAMyC,kDAKc,IAAP4gB,EAAOrd,EAAPqd,IAAOgJ,EACmBxjB,KAAKC,MAAxCrJ,EADgB4sB,EAChB5sB,OAAQ4vB,EADQhD,EACRgD,WACVC,EAFkBjD,EACIxsB,WACCG,KACvBA,EAAOgvB,GAAenmB,KAAKC,OAC7B0lB,EAAWvtB,IAAEa,IAAI9B,EAAMqjB,GAGrBmM,EAAevuB,IAAEuC,OAAO8B,KAAK7F,IAChCkvB,OAAO,SAAApsB,GAAC,OAAKA,IACbqsB,OACArvB,IAAI,SAAAgD,GAAC,OAAKA,IACVE,QAGH,GAAIxB,IAAEO,MAAMgtB,GAEVA,EAAWvtB,IAAEwuB,KAAKD,OACb,CAGL,IAAME,EAAgBzuB,IAAEtF,QAAQ6zB,EAAchB,GAI5CA,EAFoB,IAAlBkB,EAES,KAGAF,EAAaE,EAAgB,GAS5CL,EAAW,CAAErvB,KALAwD,OAAAwB,EAAA,EAAAxB,CAAA,GACRxD,EADQwD,OAAAyB,EAAA,EAAAzB,CAAA,GAEV6f,EAAMmL,IAGmB9yB,MAAO4zB,oCAG7B7D,GAEa,UAAfA,EAAMC,MAER7iB,KAAK8hB,4DAKP9hB,KAAK+hB,aAAe,aACpB/hB,KAAK+iB,SAAS3a,OACd2Y,GAAOvR,QAAQ,SAAA5W,GAAK,OAAIynB,GAAe,CAAEznB,YACzCyH,OAAO8K,oBAAoB,UAAWnL,KAAKkhB,oDAG1BjW,GACjB,IAAM6b,EAAUX,GAAelb,GACzB8b,EAAUZ,GAAenmB,KAAKC,OAElCgL,EAAUjU,WAAWG,OAAS6I,KAAKC,MAAMjJ,WAAWG,MACpD2vB,EAAQpuB,QAAUquB,EAAQruB,QAE1BsH,KAAK+iB,SAASC,aAAe7D,GAAoB4H,EAAQruB,yCAIpD,IAAAoT,EAAA9L,KAEDymB,EADiBzmB,KAAKC,MAApBjJ,WACqBG,KAFtB4U,EAG6B/L,KAAKpD,MAAjColB,EAHDjW,EAGCiW,UAAWC,EAHZlW,EAGYkW,aACb9qB,EAAOgvB,GAAenmB,KAAKC,OACzBrJ,EAAWoJ,KAAKC,MAAhBrJ,OAER,OACEiK,EAAAC,EAAAC,cAAA,OAAKC,UAAU,0BACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,QACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAW+B,IAAW,UAAW,CAAEkZ,MAAO7jB,IAAEyB,QAAQjD,MAAzD,0BAGAiK,EAAAC,EAAAC,cAAA,OAAKC,UAAW+B,IAAW,WAAY,CAAEkZ,KAAM7jB,IAAEyB,QAAQjD,MACvDiK,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SAAf,QACAH,EAAAC,EAAAC,cAACmjB,GAAD,CACExD,MAAM,IACN9mB,MAAO6sB,EAAU1pB,WACjB4jB,aAAc3gB,KAAKsmB,sBACnBngB,KAAK,SACLya,QAAS,CAAEpS,IAAK,EAAGC,IAAK6P,GAASznB,MAAQ,KAE3CgK,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SAAf,SACAH,EAAAC,EAAAC,cAACmjB,GAAD,CACExD,MAAM,IACN9mB,MAAOzC,EAAKuB,MAAMqE,WAClB4jB,aAAc3gB,KAAKyhB,kBACnBtb,KAAK,SACLya,QAAS,CAAEpS,IAAK,EAAGC,IAAK,MAG5B5N,EAAAC,EAAAC,cAAA,OAAKC,UAAW+B,IAAW,SAAU,CAAEkZ,KAAM7jB,IAAEyB,QAAQjD,MACrDiK,EAAAC,EAAAC,cAAA,UACEC,UAAW+B,IAAW,cAAe,CAAE1M,OAAQ2rB,IAC/Crf,QAAS3C,KAAK8hB,YAEbE,EAAY,OAAS,QAExBnhB,EAAAC,EAAAC,cAAA,SAAOC,UAAU,SACfH,EAAAC,EAAAC,cAAA,aACEF,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,eACC3I,IAAEmE,MAAM+hB,GAASG,cAAc/nB,IAAI,SAAA8jB,GAClC,IAAMtjB,EAAQkB,IAAEa,IAAI9B,EAAMqjB,GACpB2J,EACJ3J,IAAQyH,GAAgBD,EACtBnhB,EAAAC,EAAAC,cAAA,QAAMC,UAAU,cACd,KACN,OACEH,EAAAC,EAAAC,cAAA,MACEzK,IAAKkkB,EACLxZ,UAAW+B,IAAW,CACpBqhB,UACE5J,IAAQyH,GAAgBD,IAAc5pB,IAAEO,MAAMzB,KAElDyL,QAAS,kBAAMmJ,EAAKya,iBAAiB,CAAE/L,UAEtC2J,EACDtjB,EAAAC,EAAAC,cAAA,cACEF,EAAAC,EAAAC,cAAA,YACG3I,IAAEO,MAAMzB,GAAS,GAAKkB,IAAE+sB,SAASjuB,EAAO,EAAG,YAU9D2J,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SACbH,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAAA,UACEC,UAAU,SACVqjB,SAAU+B,GAAYjvB,GACtBwL,QAAS3C,KAAKshB,aAHhB,oBApSKrgB,aAmTJC,eAhVS,SAAAnH,GAAA,MAA6C,CACnElD,MADsBkD,EAAGlD,MAEzBD,OAFsBmD,EAAUnD,OAGhCD,QAHsBoD,EAAkBpD,QAIxCK,WAJsB+C,EAA2B/C,aAkBxB,SAAA4G,GAAQ,MAAK,CACtC+lB,SAAU,SAAA7mB,GAAO,OAAIc,EAASP,EAAQsmB,SAAS7mB,KAC/C0pB,WAAY,SAAAvpB,GAAA,IAAG9F,EAAH8F,EAAG9F,KAAMtE,EAAToK,EAASpK,MAAT,OACV+K,EACEP,EAAQmpB,WAAW,CACjBrvB,OACAtE,cAwTOqO,CAA6CmlB,8CCtR7CW,GA/EC,SAAAjtB,GAAuB,IAApBktB,EAAoBltB,EAApBktB,OAAQp0B,EAAYkH,EAAZlH,MACzB,OAAOo0B,EACJztB,MAAM,EAAG3G,EAAQ,GACjB6D,IAAI,SAAAgD,GAAC,OAAIA,EAAExD,OACXoE,OAAO,SAAC4sB,EAAaxP,GACpB,GAAIA,GAAWA,EAAQ3kB,OAAQ,CAC7B,IAAMgJ,EAAQmrB,EAAYhrB,MAAM,MAM1BirB,EAAYzP,EAAQne,MAAM,cAC1B6tB,EAAc1P,EAAQne,MAAM,oBAC5B8tB,EAAa3P,EAAQne,MAAM,aAC3B+tB,EAAe5P,EAAQne,MAAM,mBAC7BguB,EAAM7P,EAAQne,MAAM,aACpBiuB,EAAO9P,EAAQne,MAAM,UAC3B,GAAI4tB,EAAW,CAEb,IAAMM,GAAsBN,EAAU,GAOtC,MALc,GAAAjvB,OAAAyC,OAAAC,EAAA,EAAAD,CACToB,EAAMvC,MAAM,EAAGiuB,IADN9sB,OAAAC,EAAA,EAAAD,CAEToB,EAAMvC,MAAMiuB,EAAqB,KAGtBhvB,KAAK,MAChB,GAAI2uB,EAAa,CAEtB,IAAMM,GAA2BN,EAAY,GACvCO,GAAyBP,EAAY,GAM3C,MALc,GAAAlvB,OAAAyC,OAAAC,EAAA,EAAAD,CACToB,EAAMvC,MAAM,EAAGkuB,IADN/sB,OAAAC,EAAA,EAAAD,CAEToB,EAAMvC,MAAMmuB,EAAwB,KAGzBlvB,KAAK,MAChB,GAAI6uB,EAAc,CAEvB,IAAMM,GAA4BN,EAAa,GACzCO,GAA0BP,EAAa,GAO7C,MANc,GAAApvB,OAAAyC,OAAAC,EAAA,EAAAD,CACToB,EAAMvC,MAAM,EAAGouB,IADNjtB,OAAAC,EAAA,EAAAD,CAET+c,EAAQoQ,UAAUR,EAAa,GAAGv0B,OAAS,GAAGmJ,MAAM,OAF3CvB,OAAAC,EAAA,EAAAD,CAGToB,EAAMvC,MAAMquB,EAAyB,KAG1BpvB,KAAK,MAChB,GAAI4uB,EAAY,CACrB,IAAMU,GAAuBV,EAAW,GAOxC,MANc,GAAAnvB,OAAAyC,OAAAC,EAAA,EAAAD,CACToB,EAAMvC,MAAM,EAAGuuB,IADNptB,OAAAC,EAAA,EAAAD,CAET+c,EAAQoQ,UAAUT,EAAW,GAAGt0B,OAAS,GAAGmJ,MAAM,OAFzCvB,OAAAC,EAAA,EAAAD,CAGToB,EAAMvC,MAAMuuB,EAAsB,KAGvBtvB,KAAK,MAChB,GAAI8uB,EAAK,CAEd,IAAMS,GAAmBT,EAAI,GAO7B,MANc,GAAArvB,OAAAyC,OAAAC,EAAA,EAAAD,CACToB,EAAMvC,MAAM,EAAGwuB,IADNrtB,OAAAC,EAAA,EAAAD,CAET+c,EAAQoQ,UAAUP,EAAI,GAAGx0B,OAAS,GAAGmJ,MAAM,OAFlCvB,OAAAC,EAAA,EAAAD,CAGToB,EAAMvC,MAAMwuB,KAGDvvB,KAAK,MAChB,OAAI+uB,EACFN,EAEAxP,EAGT,OAAOwP,GAER,cChEDe,GAAqB,SAAAluB,GAAA,IAAGmuB,EAAHnuB,EAAGmuB,aAAcjoB,EAAjBlG,EAAiBkG,MAAjB,OACzBkoB,KAAMD,EAAc,SAACtuB,EAAOtD,GAAR,OAAgB2J,EAAM3J,KAASsD,KAgC/CwuB,eACJ,SAAAA,EAAYnoB,GAAO,IAAA0B,EAAA,OAAAhH,OAAAiH,EAAA,EAAAjH,CAAAqF,KAAAooB,IACjBzmB,EAAAhH,OAAAkH,EAAA,EAAAlH,CAAAqF,KAAArF,OAAAmH,EAAA,EAAAnH,CAAAytB,GAAArmB,KAAA/B,KAAMC,KACDooB,YAAc1mB,EAAK0mB,YAAYpmB,KAAjBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACnBA,EAAK2mB,eAAiB3mB,EAAK2mB,eAAermB,KAApBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACtBA,EAAK4mB,gBAAkB5mB,EAAK4mB,gBAAgBtmB,KAArBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACvBA,EAAK6mB,iBAAmB7mB,EAAK6mB,iBAAiBvmB,KAAtBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACxBA,EAAK8mB,YAAc9mB,EAAK8mB,YAAYxmB,KAAjBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACnBA,EAAK+mB,YAAc/mB,EAAK+mB,YAAYzmB,KAAjBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACnBA,EAAKgnB,eAAiB,KACtBhnB,EAAKinB,cAAgB,SAAAre,GACnB5I,EAAKgnB,eAAiBpe,GAVP5I,8EAcsB,IAA3BoC,EAA2Bwe,EAA3Bxe,YAAaC,EAAcue,EAAdve,WAAcjE,EAQnCC,KAAKC,MANPE,EAFqCJ,EAErCI,UACA0oB,EAHqC9oB,EAGrC8oB,WACAnO,EAJqC3a,EAIrC2a,aACAuD,EALqCle,EAKrCke,UACArrB,EANqCmN,EAMrCnN,OACA+X,EAPqC5K,EAOrC4K,WAIMsc,EADO6B,GAAQ/kB,GACfkjB,OACF8B,EAAQ9B,EAAOjjB,GACLglB,EAA8CD,EAAtDn2B,OAAqBsD,EAAiC6yB,EAAjC7yB,KAAMO,EAA2BsyB,EAA3BtyB,QAAcwyB,EAAaF,EAAlBryB,IAE5C,IAAKiC,gBAAMzC,GAAO,CAChB,IAAMgzB,EAAclC,GAAQ,CAAEC,SAAQp0B,MAAOmR,IAEzCpR,IAAWd,EAAYK,KACzB02B,EAAW,CAAE3tB,IAAK,EAAGY,QAASotB,IAG9BL,EAAW,CAAE3tB,IAAK,EAAGY,QAAO,kBAAA5D,OAAoBgxB,KAYpD,GAPIzyB,GAEFA,EAAQ+Y,QAAQ,SAAA9R,GAAA,IAAGtD,EAAHsD,EAAGtD,MAAOvH,EAAV6K,EAAU7K,MAAV,OACd6nB,EAAa,CAAErG,OAAQja,EAAOvH,YAI9Bo2B,EAAU,CACZ,IAAI/K,EAASrB,GAAIsB,iBACjB8K,EAASzZ,QAAQ,SAAA9V,GAAK,IAAAyvB,EACMzvB,EAAEwC,MAAM,KADdktB,EAAAzuB,OAAA6b,GAAA,EAAA7b,CAAAwuB,EAAA,GACbjT,EADakT,EAAA,GACR5O,EADQ4O,EAAA,GACHxvB,EADGwvB,EAAA,GAEpBlL,GAAQhI,IAAMsE,GAAO5gB,GAASA,EAAQ,OAExCqkB,EAAUC,GAIR8K,IACF7oB,EAAU6oB,GAENA,IAAgBl3B,EAAYK,MAC9BwY,EAAW,+CAKEM,EAAWoe,GAAW,IAAA3oB,EACVV,KAAKC,MAA1B7I,EAD+BsJ,EAC/BtJ,SAAUxE,EADqB8N,EACrB9N,OACVmR,EAA4B3M,EAA5B2M,YAAaC,EAAe5M,EAAf4M,WAGbkkB,EAFWY,GAAQ/kB,GAAnBkjB,OACajjB,GACbkkB,aAKJA,IACGD,GAAmB,CAAEC,eAAcjoB,MAAOgL,KACzCgd,GAAmB,CAAEC,eAAcjoB,MAAOD,KAAKC,SACjDD,KAAKuoB,mBAKP31B,IAAWd,EAAYG,KACzB+N,KAAK2oB,eAAeW,uDAKtBtpB,KAAKC,MAAMspB,uDAG4B,IAA3BxlB,EAA2BggB,EAA3BhgB,YAAaC,EAAc+f,EAAd/f,WACzBhE,KAAKC,MAAM6D,iBAAiB,CAAEC,cAAaC,eAC3ChE,KAAK0oB,YAAY,CAAE3kB,cAAaC,0DAGf,IACTD,EAAgB/D,KAAKC,MAAM7I,SAA3B2M,YACR/D,KAAKyoB,YAAY,CAAE1kB,YAAaA,EAAc,EAAGC,WAAY,8CAG7C,IAAAwlB,EACoBxpB,KAAKC,MAAM7I,SAAvC2M,EADQylB,EACRzlB,YAAaC,EADLwlB,EACKxlB,WACK8kB,GAAQ/kB,GAAakjB,OAAOjjB,GAA9CylB,eAENzpB,KAAKC,MAAMypB,QAAQ1pB,KAAKC,MAAMrN,QAEhCoN,KAAKyoB,YAAY,CAAE1kB,cAAaC,WAAYA,EAAa,6CAG1C,IAAA2lB,EACqB3pB,KAAKC,MAAM7I,SAAvC2M,EADO4lB,EACP5lB,YAAaC,EADN2lB,EACM3lB,WACrBhE,KAAKyoB,YAAY,CAAE1kB,cAAaC,WAAYA,EAAa,qCAGlD,IAAAgI,EACmChM,KAAKC,MAAvC7I,EADD4U,EACC5U,SAAUxE,EADXoZ,EACWpZ,OAAQg3B,EADnB5d,EACmB4d,YAClB7lB,EAA4B3M,EAA5B2M,YAAaC,EAAe5M,EAAf4M,WAFd6lB,EAGmBf,GAAQ/kB,GAA1BV,EAHDwmB,EAGCxmB,MAAO4jB,EAHR4C,EAGQ5C,OACT8B,EAAQ9B,EAAOjjB,GACbkkB,EAAiBa,EAAjBb,aACF4B,EACJjpB,EAAAC,EAAAC,cAAA,UAAQC,UAAU,SAAS2B,QAAS3C,KAAKqoB,aAAzC,SAKI0B,GAAkB7B,GACpBD,GAAmB,CAAEC,eAAcjoB,MAAOD,KAAKC,QAG7C+pB,EACJhmB,EAAaijB,EAAOl0B,OAAS,EAC3B8N,EAAAC,EAAAC,cAAA,UACEC,UAAU,SACVqjB,UAAW0F,EACXpnB,QAAS3C,KAAKuoB,iBAHhB,QAOE,KAEA0B,EACJjmB,IAAeijB,EAAOl0B,OAAS,GAAKgR,EAAc+kB,GAAQ/1B,OAAS,EACjE8N,EAAAC,EAAAC,cAAA,UAAQC,UAAU,SAAS2B,QAAS3C,KAAKwoB,kBAAzC,eAGE,KAEA9tB,EACJsJ,EAAa,EACXnD,EAAAC,EAAAC,cAAA,UAAQC,UAAU,SAAS2B,QAAS3C,KAAKsoB,gBAAzC,YAGE,KAEA4B,EACJrpB,EAAAC,EAAAC,cAAA,OAAKC,UAAU,UAAUsL,IAAKtM,KAAK4oB,eAChCluB,EACAuvB,EACAD,EACAF,GAICvrB,EACW,IAAfyF,EACkB,IAAhBD,EACElD,EAAAC,EAAAC,cAAA,SAAIsC,GAEJxC,EAAAC,EAAAC,cAAA,mBACUgD,EADV,KACyBV,GAGzB,KAEA8mB,EAAW5tB,KAAM0qB,EAAOl0B,QAC3B2D,IAAI,SAAAgY,GAAC,OAAKA,IAAM1K,EAAa,IAAM,MACnCvL,KAAK,IAER,OACEoI,EAAAC,EAAAC,cAAA,OACEC,UAAW+B,IAAW,WAAY,CAChCqnB,SAAUx3B,IAAWd,EAAYG,MAEnCqa,IAAKsd,GAEJrrB,EACAwqB,EAAM3yB,KAAKM,IAAI,SAAC7E,EAAG6c,GAAJ,OACd7N,EAAAC,EAAAC,cAAA,KACEzK,IAAKoY,EACL1N,UAAW+B,IAAW,CACpB8f,KAAMhxB,EAAEw4B,WAAW,QAErBC,wBAAyB,CAAEC,OAAQ14B,EAAEoW,QAAQ,MAAO,SAGxDpH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,cACZkpB,EACDrpB,EAAAC,EAAAC,cAAA,SAAIopB,YA3MSlpB,aAkNRC,eAhPS,SAAAlE,GAAA,MAAiC,CACvDpK,OADsBoK,EAAGpK,OAEzBwE,SAFsB4F,EAAW5F,SAGjClB,KAHsB8G,EAAqB9G,OAMlB,SAAA0H,GAAQ,MAAK,CACtC+M,WAAY,SAAAzP,GAAG,OAAI0C,EAASP,EAAQsN,WAAWzP,KAC/CwuB,QAAS,kBAAM9rB,EAASP,EAAQqsB,YAChCzL,UAAW,SAAAC,GAAM,OAAItgB,EAASP,EAAQ4gB,UAAUC,KAChD/d,UAAW,SAAAvN,GAAM,OAAIgL,EAASP,EAAQ8C,UAAUvN,KAChD22B,cAAe,kBAAM3rB,EAASP,EAAQksB,kBACtCV,WAAY,SAAA5rB,GAAA,IAAG/B,EAAH+B,EAAG/B,IAAKY,EAARmB,EAAQnB,QAAR,OACV8B,EAASP,EAAQwrB,WAAW,CAAE3tB,MAAKY,cACrC4e,aAAc,SAAAvd,GAAA,IAAGkX,EAAHlX,EAAGkX,OAAQxhB,EAAXsK,EAAWtK,MAAX,OACZ+K,EACEP,EAAQqd,aAAa,CACnBrG,SACAxhB,YAGNiR,iBAAkB,SAAA1G,GAAA,IAAG2G,EAAH3G,EAAG2G,YAAaC,EAAhB5G,EAAgB4G,WAAhB,OAChBpG,EACEP,EAAQyG,iBAAiB,CACvBC,cACAC,mBAuNO9C,CAGbknB,kEC7NaoC,GAlCE,CACftvB,IAAK,SAAAuvB,GACH,IAAMC,EAASrxB,MAAMoxB,EAAGE,UAAU,cAAgB,GAAGlyB,KAAK,KAC1DgyB,EAAGG,iBAAiBF,IAEtBG,QAAS,SAAAJ,GACPA,EAAGK,iBAELC,OAAQ,SAACN,EAAIO,GACX,IAAMC,EAAUR,EAAGS,WACbr4B,EAAQ43B,EAAGU,aAAaV,EAAGW,aAFNC,EAcSC,KAASC,iBAC3CN,EAXmB,SAAAO,GAAY,MAAK,CACpCC,OAAQ,QACRC,QAAS,CACPC,MAAOC,MAETJ,eACAK,MAAM,EACNC,aAAa,GAKbC,CAAal5B,IAFPm5B,EAdmBX,EAcnBW,UAAWR,EAdQH,EAcRG,aAKnBR,EAAYgB,GAEZ,IAAMC,EAAYxB,EAAGyB,aAAaV,GAClCf,EAAG0B,UAAUF,KChBTG,GAAa/rB,OAAOgsB,UAApBD,SA8cOE,eA3cb,SAAAA,EAAYrsB,GAAO,IAAA0B,EAAA,OAAAhH,OAAAiH,EAAA,EAAAjH,CAAAqF,KAAAssB,IACjB3qB,EAAAhH,OAAAkH,EAAA,EAAAlH,CAAAqF,KAAArF,OAAAmH,EAAA,EAAAnH,CAAA2xB,GAAAvqB,KAAA/B,KAAMC,KAEDssB,WAAa,KAClB5qB,EAAK6qB,UAAY,KACjB7qB,EAAKqpB,YAAcrpB,EAAKqpB,YAAY/oB,KAAjBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACnBA,EAAK8qB,aAAe9qB,EAAK8qB,aAAaxqB,KAAlBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACpBA,EAAK+qB,eAAiB/qB,EAAK+qB,eAAezqB,KAApBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACtBA,EAAKgrB,WAAahrB,EAAKgrB,WAAW1qB,KAAhBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAClBA,EAAKirB,cAAgBjrB,EAAKirB,cAAc3qB,KAAnBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACrBA,EAAKkrB,UAAYlrB,EAAKkrB,UAAU5qB,KAAftH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAVAA,mFAaC,IAAAyJ,EAAApL,KAClBsI,KACA,IAAMwkB,EAAatwB,EAAUwD,KAAKC,MAAM/J,MACxC8J,KAAK+sB,WAAa1sB,OAAOkI,WAAWvI,KAAKgtB,QAAS,CAChDpzB,MAAOkzB,EAAW12B,MAAQ,GAC1BkkB,KAAM,aACN2S,MAAO,OACPC,MAAM,EACNC,aAAa,EACbC,QAAS,EACTC,gBAAiB,EACjBC,eAAgB,KAChBC,UAAW,CACTC,IAAKhD,GAAStvB,IACduyB,QAASjD,GAASK,QAClB6C,SAAUlD,GAASK,QACnB8C,QAAS,SAAAlD,GAAE,OAAID,GAASO,OAAON,EAAIrf,EAAK4f,cACxC4C,IAAK,iBAIT,IAAMC,EAAa50B,KAAI+G,KAAKC,MAAMnJ,aAAZ,IAAAoB,OAA8B40B,EAAWx2B,IAAzC,KAAiD,MAEnEu3B,EACF7tB,KAAK+sB,WAAWe,SAASC,WAAWF,GAEpC7tB,KAAK+sB,WAAWe,SAASE,eAG3BhuB,KAAK+sB,WAAWkB,GAAG,SAAU,SAAAxD,GAC3B,IAAM3uB,EAAU2uB,EAAGS,WACnB7kB,SAASC,cAAc,oBAAoB4nB,UAAU3G,IAAI,QACzDnc,EAAKnL,MAAMkuB,cAAcryB,KAG3BkE,KAAK+sB,WAAWkB,GAAG,UAAW,SAACxD,EAAIlgB,GAC7BqC,IAASwf,GAAU,OACP,SAAV7hB,EAAEjU,KACJ8U,EAAKshB,iBAGO,UAAVniB,EAAEjU,KACJ8U,EAAKshB,mBAMXrsB,OAAO4J,iBAAiB,QAASjK,KAAK2sB,YAhDpB,IAmDVzvB,EAAe4vB,EAAf5vB,WACJA,IACF8C,KAAK+sB,WAAWqB,SAASlxB,EAAW8X,MAAQ,EAAG9X,EAAWgY,KAAO,GACjElV,KAAK+sB,WAAWZ,UAAUjvB,EAAWmxB,iBAIvCruB,KAAK+sB,WAAWriB,6CAIhB1K,KAAKusB,YAAcvsB,KAAKusB,WAAWhY,QACnCvU,KAAKsuB,QAAQJ,UAAU3G,IAAI,8CAGfhrB,GAAO,IAAAuP,EAAA9L,KACbjE,EAAQQ,EAAML,MAAM,KAAKxF,IAAI,SAAAgD,GAAC,OAAKA,IACnC60B,EAAYxyB,EAAM,GAClByyB,EAAWzyB,EAAMA,EAAMhJ,OAAS,GAChC07B,EAAU1yB,EAAMrF,IAAI,SAAAgD,GAAC,OAAIoS,EAAKihB,WAAW2B,QAAQh1B,KAEjDi1B,EAAcF,EAAQ,GAAGruB,OAAO,MAGhCkD,GACHvL,KAAK0W,IAALpS,MAAAtE,KAAI4C,OAAAC,EAAA,EAAAD,CAAQ8zB,EAAQ/3B,IAAI,SAAAgD,GAAC,OAAIA,EAAE3G,WAAW47B,EAAc,GACzD3uB,KAAK+sB,WAAW6B,mBAGZrrB,EACJvD,KAAK+sB,WAAW8B,qBAAuB,EAAIL,EAAWD,GAExDloB,SAASC,cAAc,oBAAoB4nB,UAAUY,OAAO,QAC5D9uB,KAAK+sB,WAAWgC,UACd,CAAElnB,KAAM0mB,EAAWzmB,GAAI6mB,GACvBtoB,SAASC,cAAc,qBACvB,GAGFtG,KAAKgvB,gBAAgBC,MAAM3rB,MAA3B,GAAApL,OAAsCoL,EAAQ,EAA9C,MACAtD,KAAKgvB,gBAAgBC,MAAM1rB,OAA3B,GAAArL,OAAuCqL,EAAS,EAAhD,MAEAvD,KAAK+sB,WAAWzD,eAAe,CAAEzhB,KAAM2mB,EAAU1mB,GAAI,GAAK,6CAQ1D,IAAMonB,EAASlvB,KAAK+sB,WAAW3B,YAGzB70B,EAAQyJ,KAAK+sB,WAAWoC,WAAhBx0B,OAAAwB,EAAA,EAAAxB,CAAA,GACTu0B,EADS,CAEZpnB,GAAIonB,EAAOpnB,GAAK,KAIlB,GAAIvR,GAAwB,WAAfA,EAAM4P,KAAmB,CAEpCnG,KAAKusB,YAAcvsB,KAAKusB,WAAWhY,QAGnCvU,KAAKusB,WAAavsB,KAAK+sB,WAAWqC,SAChC,CACEvnB,KAAMqnB,EAAOrnB,KACbC,GAAIvR,EAAM+E,OAEZ,CACEuM,KAAMqnB,EAAOrnB,KACbC,GAAIvR,EAAMiF,KAEZ,CACEwF,UAAW,iBAKf,IAAMquB,EAAervB,KAAK+sB,WAAWuC,WAAW,CAC9CznB,KAAMqnB,EAAOrnB,KACbC,GAAIvR,EAAM+E,QAINi0B,EAAcvvB,KAAKwvB,SAASC,wBAG5B71B,EAAQrD,EAAMm5B,OAEdC,GAAe/1B,EAEjB+1B,IAAgB,KAAOA,GAAe,KACxC3vB,KAAKsuB,QAAQ9f,KAAO,IACpBxO,KAAKsuB,QAAQ7f,IAAM,IACnBzO,KAAKsuB,QAAQ10B,MAAQ+1B,IAErB3vB,KAAKsuB,QAAQ9f,IAAqB,GAAdmhB,EACpB3vB,KAAKsuB,QAAQ7f,IAAoB,EAAdkhB,EACnB3vB,KAAKsuB,QAAQ10B,MAAQ+1B,GAIvB3vB,KAAKsuB,QAAQW,MAAMja,KAAnB,GAAA9c,OAA6Bm3B,EAAara,KACxCua,EAAYva,KACXpb,EAAM7G,OAASiN,KAAK+sB,WAAW6B,mBAAsB,EAFxD,MAGA5uB,KAAKsuB,QAAQW,MAAM/Z,IAAnB,GAAAhd,OAA4Bm3B,EAAana,IACvCqa,EAAYra,IACZlV,KAAK+sB,WAAW8B,oBAFlB,MAKA7uB,KAAKsuB,QAAQJ,UAAUY,OAAO,8CAIrBvkB,GAAG,IAAAqlB,EAEO5vB,KAAKusB,WAAWsD,OAA7BjoB,EAFMgoB,EAENhoB,KAAMI,EAFA4nB,EAEA5nB,GAGR8nB,EAAWvlB,EAAEqQ,OAAOhhB,MAAMmD,WAGhCiD,KAAK+sB,WAAWzF,aAAawI,EAAUloB,EAAMI,GAG7ChI,KAAKusB,WAAavsB,KAAK+sB,WAAWqC,SAChCxnB,EADgBjN,OAAAwB,EAAA,EAAAxB,CAAA,GAGXiN,EAHW,CAIdE,GAAIF,EAAKE,GAAKgoB,EAAS/8B,SAEzB,CACEiO,UAAW,qDAKLpH,GACVoG,KAAK+sB,WAAWgD,SAASn2B,GACzBoG,KAAK+sB,WAAWiD,4DAGQC,GAAW,IAAAnS,EAAA9d,KAEnC,GAA+B,iBAA3BiwB,EAAU/5B,KAAK,GAAGE,KAEpB4J,KAAKgrB,YAAYt1B,GAEjBsK,KAAK+sB,WAAWe,SAASE,oBACpB,GAELiC,EAAU/5B,KAAK,GAAGE,KAAKi0B,WAAW,mBAClC,CAEArqB,KAAKgrB,YAAYiF,EAAU/5B,KAAK,GAAGE,KAAK6R,QAAQ,kBAAmB,KAFnE,IAKQ7Q,EAAa64B,EAAb74B,SACR,GAAIA,EAAU,CACZ,IAEM2xB,EAFSD,GAAQ1xB,EAAS2M,aACxBkjB,OACa7vB,EAAS4M,YAC1B+kB,GAASA,EAAMmH,mBACjBlwB,KAAKgvB,gBAAgBd,UAAUY,OAAO,QACtC9uB,KAAK4sB,cAAc7D,EAAMmH,yBAGxB,GAGL1zB,EAAUwD,KAAKC,MAAM/J,MAAMI,MAAQkG,EAAUyzB,EAAU/5B,MAAMI,IAC7D,CAEA0J,KAAKC,MAAMkwB,cAAc,CACvBt9B,MAAO2J,EAAUwD,KAAKC,MAAM/J,MAAMI,IAClC85B,QAASpwB,KAAK+sB,WAAWe,SAASuC,eAIpC,IAAMC,EAAgBtwB,KAAK+sB,WAAWwD,gBAChCC,EAAoBxwB,KAAK+sB,WAAW3B,YAC1CprB,KAAKC,MAAMwwB,cAAc,CACvBvzB,WAAY,CACVgY,IAAKob,EAAcpb,IACnBF,KAAMsb,EAActb,KACpBqZ,eAAgBmC,GAElBt1B,IAAKsB,EAAUwD,KAAKC,MAAM/J,MAAMI,MAIlC0J,KAAKgrB,YAAYxuB,EAAUyzB,EAAU/5B,MAAME,MAAQ,IAGnD,IAAMy3B,EAAa50B,KACjB+G,KAAKC,MAAMnJ,aADS,IAAAoB,OAEhBsE,EAAUyzB,EAAU/5B,MAAMI,IAFV,KAGpB,MAIEu3B,EACF7tB,KAAK+sB,WAAWe,SAASC,WAAWF,GAEpC7tB,KAAK+sB,WAAWe,SAASE,eAjC3B,IAqCQ9wB,EAAeV,EAAUyzB,EAAU/5B,MAAnCgH,WACJA,IACF8C,KAAK+sB,WAAWqB,SAASlxB,EAAW8X,MAAQ,EAAG9X,EAAWgY,KAAO,GACjElV,KAAK+sB,WAAWZ,UAAUjvB,EAAWmxB,iBAIvCruB,KAAK+sB,WAAWriB,QAGlB,GACE3R,KAAKG,UAAU+2B,EAAUl6B,aACzBgD,KAAKG,UAAU8G,KAAKC,MAAMlK,aAErB4C,gBAAMs3B,EAAUl6B,WAAY,CAE/B,IAAIkI,EAGAyyB,EAGEC,EAAU,kBACd7S,EAAKiP,WAAW7B,aAAe1uB,EAAUshB,EAAK7d,MAAM/J,MAAME,MAGtDguB,EAAY,WAChBtG,EAAK8O,cAAcqD,EAAUl6B,UAAU8R,KAAK9K,aAiB1C4zB,IAEFvM,KAIAsM,EAAU,EAEVzyB,EAAK2yB,YApBe,WAChBD,KACFE,cAAc5yB,GACdmmB,KACSsM,GAAW,GACpBG,cAAc5yB,GAEhByyB,KAagC,yCAO9BnmB,GAAG,IAEcnP,EAFdgjB,EAAApe,KACP9E,EAAMsB,EAAUwD,KAAKC,MAAM/J,MAI3B46B,EAAsB,WACxB1S,EAAKne,MAAM6wB,oBAAoB,CAAE51B,IAAKA,EAAI5E,OAK5C,GAAIiU,EAAEwmB,QAAS,CAEb,IAAIC,EAAWhxB,KAAK+sB,WAAWkE,WAAW,CAAEjc,KAAMzK,EAAE2mB,MAAOhc,IAAK3K,EAAE4mB,QAClE,GAAKH,EAASI,QAgDZN,QAhDqB,CACrB,IAAIO,EAAe,KACfC,EAAeC,IACnB,IAGE/pB,aAAKxO,aAAMkC,EAAI9E,KAAM,CAACoP,WAAW,IAAQ,CAGvCgsB,eAHuC,SAGxBp2B,GAEb,IAAK41B,EAASI,SACVJ,EAASnpB,KAAO,GAAKzM,EAAKsK,IAAIpK,MAAMuM,MACpCmpB,EAASnpB,KAAO,GAAKzM,EAAKsK,IAAIlK,IAAIqM,MAClCmpB,EAASlpB,IAAM1M,EAAKsK,IAAIpK,MAAMyM,QAC9BipB,EAASlpB,IAAM1M,EAAKsK,IAAIlK,IAAIuM,OAAQ,CACtC,IAAI0pB,EAAWr2B,EAAKI,IAAMJ,EAAKE,QAC1B+1B,GAAgBI,EAAWH,KAC9BD,EAAej2B,EACfk2B,EAAeG,OAKvB,MAAAC,IAGF1xB,KAAKwsB,WAAaxsB,KAAKwsB,UAAUjY,QAC7B8c,IAEFrxB,KAAKwsB,UAAYxsB,KAAK+sB,WAAWqC,SAC/B,CACEvnB,KAAMwpB,EAAa3rB,IAAIpK,MAAMuM,KAAO,EACpCC,GAAIupB,EAAa3rB,IAAIpK,MAAMyM,QAE7B,CACEF,KAAMwpB,EAAa3rB,IAAIlK,IAAIqM,KAAO,EAClCC,GAAIupB,EAAa3rB,IAAIlK,IAAIuM,QAE3B,CACE/G,UAAW,kBApDI5F,EA0DHi2B,EAzDpBjT,EAAKne,MAAM0xB,kBAAkB,CAAEz2B,IAAKA,EAAI5E,IAAK6E,eAAgBC,UA8D7D01B,IACA9wB,KAAKwsB,WAAaxsB,KAAKwsB,UAAUjY,uDAKnClU,OAAO8K,oBAAoB,QAASnL,KAAK2sB,YACzC,IAAMG,EAAatwB,EAAUwD,KAAKC,MAAM/J,MAClC07B,EAAa5xB,KAAK+sB,WAAWwD,gBAC7BlC,EAAiBruB,KAAK+sB,WAAW3B,YACjCluB,EAAa,CACjBgY,IAAK0c,EAAW1c,IAChBF,KAAM4c,EAAW5c,KACjBqZ,kBAEFruB,KAAKC,MAAMwwB,cAAc,CAAEvzB,aAAYhC,IAAK4xB,EAAWx2B,MACvD0J,KAAKC,MAAMkwB,cAAc,CACvBt9B,MAAOi6B,EAAWx2B,IAClB85B,QAASpwB,KAAK+sB,WAAWe,SAASuC,+DAKpC,OAAO,mCAGA,IAAAwB,EAAA7xB,KACP,OACEa,EAAAC,EAAAC,cAAA,OAAKC,UAAU,aAAa8wB,YAAa9xB,KAAK6sB,WAC5ChsB,EAAAC,EAAAC,cAAA,OACEC,UAAU,UACVsL,IAAK,SAAAkjB,GACHqC,EAAKrC,SAAWA,IAGlB3uB,EAAAC,EAAAC,cAAA,OACEC,UAAU,UACVsL,IAAK,SAAA0gB,GACH6E,EAAK7E,QAAUA,KAGnBnsB,EAAAC,EAAAC,cAAA,SACEoF,KAAK,QACLnF,UAAU,cACV+wB,KAAM,EACNzlB,IAAK,SAAAgiB,GACHuD,EAAKvD,QAAUA,GAEjB0D,QAAShyB,KAAKysB,eAEhB5rB,EAAAC,EAAAC,cAAA,OACE9C,GAAG,kBACHqO,IAAK,SAAA0iB,GACH6C,EAAK7C,gBAAkBA,cAncZ/tB,aCQnBgxB,eACJ,SAAAA,EAAYhyB,GAAO,IAAA0B,EAAA,OAAAhH,OAAAiH,EAAA,EAAAjH,CAAAqF,KAAAiyB,IACjBtwB,EAAAhH,OAAAkH,EAAA,EAAAlH,CAAAqF,KAAArF,OAAAmH,EAAA,EAAAnH,CAAAs3B,GAAAlwB,KAAA/B,KAAMC,KACDiyB,iBAAmBvwB,EAAKuwB,iBAAiBjwB,KAAtBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAFPA,gFAKF7F,GACf,IAAMZ,EAAMsB,EAAUwD,KAAKC,MAAM/J,MAAMI,IACvC0J,KAAKC,MAAM4oB,WAAW,CAAE3tB,MAAKY,6CAGtB,IAAAiE,EAUHC,KAAKC,MARP/J,EAFK6J,EAEL7J,KACAkB,EAHK2I,EAGL3I,SACAq5B,EAJK1wB,EAIL0wB,cACAkB,EALK5xB,EAKL4xB,kBACAb,EANK/wB,EAML+wB,oBACAh6B,EAPKiJ,EAOLjJ,aACAq5B,EARKpwB,EAQLowB,cACAp6B,EATKgK,EASLhK,UAGF,OACE8K,EAAAC,EAAAC,cAAA,OACEC,UAAW+B,IAAW,yBAA0B,CAC9C3L,UAAuB,IAAbA,KAGZyJ,EAAAC,EAAAC,cAAA,OAAKC,UAAU,QACbH,EAAAC,EAAAC,cAACoxB,GAAD,CACEp8B,UAAWA,EACXG,KAAMA,EACNi4B,cAAenuB,KAAKkyB,iBACpBzB,cAAeA,EACfkB,kBAAmBA,EACnBb,oBAAqBA,EACrBh6B,aAAcA,EACdq5B,cAAeA,EACf/4B,SAAUA,aAvCH6J,aA+CJC,eAnES,SAAAnH,GAAA,MAAkD,CACxE7D,KADsB6D,EAAG7D,KAEzBkB,SAFsB2C,EAAS3C,SAG/BN,aAHsBiD,EAAmBjD,aAIzCf,UAJsBgE,EAAiChE,YAO9B,SAAA6H,GAAQ,MAAK,CACtCirB,WAAY,SAAA7rB,GAAA,IAAG9B,EAAH8B,EAAG9B,IAAKY,EAARkB,EAAQlB,QAAR,OACV8B,EAASP,EAAQwrB,WAAW,CAAE3tB,MAAKY,cACrC20B,cAAe,SAAAxzB,GAAA,IAAG/B,EAAH+B,EAAG/B,IAAKgC,EAARD,EAAQC,WAAR,OACbU,EAASP,EAAQozB,cAAc,CAAEv1B,MAAKgC,iBACxCizB,cAAe,SAAAhzB,GAAA,IAAGtK,EAAHsK,EAAGtK,MAAOu9B,EAAVjzB,EAAUizB,QAAV,OACbxyB,EAASP,EAAQ8yB,cAAc,CAAEt9B,QAAOu9B,cAC1CuB,kBAAmB,SAAAv0B,GAAA,IAAGlC,EAAHkC,EAAGlC,IAAKC,EAARiC,EAAQjC,eAAR,OACjByC,EAASP,EAAQs0B,kBAAkB,CAAEz2B,MAAKC,qBAC5C21B,oBAAqB,SAAAvO,GAAA,IAAGrnB,EAAHqnB,EAAGrnB,IAAH,OACnB0C,EAASP,EAAQyzB,oBAAoB,CAAE51B,YAkD5BgG,CAGb+wB,kCCzDIG,eACJ,SAAAA,EAAYnyB,GAAO,IAAA0B,EAAA,OAAAhH,OAAAiH,EAAA,EAAAjH,CAAAqF,KAAAoyB,IACjBzwB,EAAAhH,OAAAkH,EAAA,EAAAlH,CAAAqF,KAAArF,OAAAmH,EAAA,EAAAnH,CAAAy3B,GAAArwB,KAAA/B,KAAMC,KACDoyB,aAAe1wB,EAAK0wB,aAAapwB,KAAlBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAFHA,4EAKNoC,GACX/D,KAAKC,MAAMqyB,eAAevuB,oCAGnB,IAAAqH,EAAApL,KACP,OACEa,EAAAC,EAAAC,cAAA,OAAKC,UAAU,QACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,QACbH,EAAAC,EAAAC,cAAA,MAAIC,UAAU,YACZH,EAAAC,EAAAC,cAAA,mEACyD,IACvDF,EAAAC,EAAAC,cAAA,KACEC,UAAU,OACV0B,KAAK,sEAFP,0BAFF,oEAQoE,IAClE7B,EAAAC,EAAAC,cAAA,KAAGC,UAAU,OAAO0B,KAAK,qCAAzB,kBAEK,IAXP,gEAYgE,IAC9D7B,EAAAC,EAAAC,cAAA,KACEC,UAAU,OACV0B,KAAK,kDAFP,QAbF,yEAuBA7B,EAAAC,EAAAC,cAAA,mEACyD,IACvDF,EAAAC,EAAAC,cAAA,KAAGC,UAAU,OAAO0B,KAAK,8BAAzB,mCAFF,2HASA7B,EAAAC,EAAAC,cAAA,oBAEEF,EAAAC,EAAAC,cAAA,MAAIC,UAAU,WACX8nB,GAAQpyB,IAAI,SAAC67B,EAAQ7jB,GAAT,OACX7N,EAAAC,EAAAC,cAAA,MAAIzK,IAAKoY,GACP7N,EAAAC,EAAAC,cAAA,UACEC,UAAU,SACV2B,QAAS,WACPyI,EAAKinB,aAAa3jB,KAGnBA,EANH,MAMS6jB,EAAOC,YAAcD,EAAOlvB,aAQ/CxC,EAAAC,EAAAC,cAAA,MAAIC,UAAU,gBACZH,EAAAC,EAAAC,cAAA,gBAEEF,EAAAC,EAAAC,cAAA,UACG0xB,GAAM/7B,IAAI,SAAAqD,EAAW2U,GAAX,IAAA1R,EAAArC,OAAA6b,GAAA,EAAA7b,CAAAZ,EAAA,GAAE24B,EAAF11B,EAAA,GAAM21B,EAAN31B,EAAA,UACT6D,EAAAC,EAAAC,cAAC6xB,EAAA,SAAD,CAAUt8B,IAAKoY,GACb7N,EAAAC,EAAAC,cAAA,UAAK2xB,GACL7xB,EAAAC,EAAAC,cAAA,MAAIupB,wBAAyB,CAAEC,OAAQoI,WAOjD9xB,EAAAC,EAAAC,cAAA,MAAIC,UAAU,YACZH,EAAAC,EAAAC,cAAA,+BAEEF,EAAAC,EAAAC,cAAA,UACG8xB,GAAUn8B,IAAI,SAAAuG,EAAWyR,GAAX,IAAAvR,EAAAxC,OAAA6b,GAAA,EAAA7b,CAAAsC,EAAA,GAAEy1B,EAAFv1B,EAAA,GAAMw1B,EAANx1B,EAAA,UACb0D,EAAAC,EAAAC,cAAC6xB,EAAA,SAAD,CAAUt8B,IAAKoY,GACb7N,EAAAC,EAAAC,cAAA,UAAK2xB,GACL7xB,EAAAC,EAAAC,cAAA,MAAIupB,wBAAyB,CAAEC,OAAQoI,WAOjD9xB,EAAAC,EAAAC,cAAA,MAAIC,UAAU,YACZH,EAAAC,EAAAC,cAAA,8BAEEF,EAAAC,EAAAC,cAAA,MAAIC,UAAU,eACX8xB,GAAQp8B,IAAI,SAACq8B,EAASrkB,GAAV,OACX7N,EAAAC,EAAAC,cAAA,MAAIzK,IAAKoY,GACNqkB,EAAQ1vB,MACR0vB,EAAQz6B,KAAOuI,EAAAC,EAAAC,cAAA,iBAASgyB,EAAQz6B,KAAjB,KAAiC,KACjDuI,EAAAC,EAAAC,cAAA,UACGgyB,EAAQC,GAAGt8B,IAAI,SAAA0G,EAAWsU,GAAX,IAAA6Q,EAAA5nB,OAAA6b,GAAA,EAAA7b,CAAAyC,EAAA,GAAEs1B,EAAFnQ,EAAA,GAAMoQ,EAANpQ,EAAA,UACd1hB,EAAAC,EAAAC,cAAC6xB,EAAA,SAAD,CAAUt8B,IAAKob,GACb7Q,EAAAC,EAAAC,cAAA,UAAK2xB,GACL7xB,EAAAC,EAAAC,cAAA,MAAIupB,wBAAyB,CAAEC,OAAQoI,eASvD9xB,EAAAC,EAAAC,cAAA,OAAKC,UAAU,WACbH,EAAAC,EAAAC,cAAA,wBACAF,EAAAC,EAAAC,cAAA,8CACAF,EAAAC,EAAAC,cAAA,6bASAF,EAAAC,EAAAC,cAAA,2IAIAF,EAAAC,EAAAC,cAAA,meAnIOE,aAoJJC,eAhKS,iBAAO,IAEJ,SAAAtD,GAAQ,MAAK,CACtC00B,eAAgB,SAAAvuB,GAAW,OACzBnG,EACEP,EAAQyG,iBAAiB,CACvBC,cACAC,WAAY,QAyJL9C,CAA6CkxB,ICxJtDa,GAAY,SAAA7X,GAChB,IAAM8X,EAAM9X,EAAIlf,MAAM,KACtB,OAAO,IAAI4O,KAAKooB,EAAI,GAAIA,EAAI,GAAK,EAAGA,EAAI,KAkB3BC,GAZE,SAACC,EAAQC,GACxB,IAAMtoB,EAAM,IAAID,KAEhB,OAAO1S,IAAEg7B,GACN18B,IAAI,SAACkD,EAAOtD,GACX,IARYg9B,EAAOC,EAUnB,OAAO35B,EA7BI,SAAA45B,GACf,OAAIA,GAAW,EACN,IACEA,GAAW,GACb,GACEA,GAAW,GACb,GACEA,GAAW,GACb,GAEA,GAkBSC,EATFH,EAQaL,GAAU38B,GARhBi9B,EAQsBF,EAAOJ,GAAUI,GAAQtoB,EAPtEhT,KAAK4W,OAAO4kB,EAASD,GAAV,WAWRvqB,OCjCC2qB,GAAQ,CACZ,CAAC,SAAU,GACX,CAAC,SAAU,IACX,CAAC,OAAQ,MACT,CAAC,MAAO,OACR,CAAC,OAAQ,QACT,CAAC,QAAS,QACV,CAAC,OAAQ,UAiBIC,GAdC,SAAA55B,GAEd,IAFmC,IAAlBgR,EAAkBhR,EAAlBgR,IAAK1P,EAAatB,EAAbsB,OAClBu4B,EAAO77B,KAAK4W,OAAO5D,EAAM1P,GAAU,KAC9B8W,EAAI,EAAGA,EAAIuhB,GAAM3gC,OAAQof,IAChC,GAAIyhB,EAAOF,GAAMvhB,GAAG,GAClB,OAAU,IAANA,EACK,YAEPyhB,EAAO77B,KAAK4W,MAAMilB,EAAOF,GAAMvhB,EAAI,GAAG,KACxB,IAAMuhB,GAAMvhB,EAAI,GAAG,IAAe,IAATyhB,EAAa,OAAS,UCd/DC,eACJ,SAAAA,EAAY5zB,GAAO,IAAA0B,EAAA,OAAAhH,OAAAiH,EAAA,EAAAjH,CAAAqF,KAAA6zB,IACjBlyB,EAAAhH,OAAAkH,EAAA,EAAAlH,CAAAqF,KAAArF,OAAAmH,EAAA,EAAAnH,CAAAk5B,GAAA9xB,KAAA/B,KAAMC,KACD6zB,eAAiBnyB,EAAKmyB,eAAe7xB,KAApBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACtBA,EAAKoyB,WAAapyB,EAAKoyB,WAAW9xB,KAAhBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAClBA,EAAK2mB,eAAiB3mB,EAAK2mB,eAAermB,KAApBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACtBA,EAAK/E,MAAQ,CACX/J,MAAO,GANQ8O,4EAWjB3B,KAAKsK,SAAS,CACZzX,MAAOmN,KAAKpD,MAAM/J,MAAQmN,KAAKC,MAAM8xB,gDAKvC/xB,KAAKsK,SAAS,CACZzX,MAAOkF,KAAK0W,IAAIzO,KAAKpD,MAAM/J,MAAQmN,KAAKC,MAAM8xB,KAAM,+CAInB,IAApBiC,EAAoBj6B,EAApBi6B,SAAUtlB,EAAU3U,EAAV2U,EAAG3D,EAAOhR,EAAPgR,IAAOhL,EAM/BC,KAAKC,MAJPg0B,EAFiCl0B,EAEjCk0B,cACAC,EAHiCn0B,EAGjCm0B,WACAC,EAJiCp0B,EAIjCo0B,oBACAC,EALiCr0B,EAKjCq0B,aAEMC,EAA4BL,EAA5BK,UAAWp+B,EAAiB+9B,EAAjB/9B,KAAMm9B,EAAWY,EAAXZ,OAEnB1C,GADc0C,EAASh7B,IAAE2Q,IAAIpO,OAAO+b,OAAO0c,IAAW,GAC9BY,EAAStD,QACjCrtB,EAAQ2wB,EAAS3wB,OAAS,GAE1BixB,EAAUjxB,EAAMtQ,OADJ,GAEZwhC,EAAa,CACjBlxB,EAAMykB,UAAU,EAHA,IAGcpf,OAC9B4rB,EAAU,SAAM,IAChB77B,KAAK,IAED46B,EAAO,IAAIvoB,KAAKkpB,EAASQ,SAE/B,OACE3zB,EAAAC,EAAAC,cAAA,MAAIzK,IAAKoY,EAAG1N,UAAU,YACpBH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,OACbH,EAAAC,EAAAC,cAAA,QAAMC,UAAU,SAASuzB,GAAc,UACvC1zB,EAAAC,EAAAC,cAAA,KACE2B,KAAI,QAAAxK,OAAUjC,GACd0M,QAAS,SAAA4H,GACP0pB,EAAc,CAAE1pB,IAAGtM,GAAIhI,KAEzBw+B,IAAI,sBACJ7Z,OAAO,UAEP/Z,EAAAC,EAAAC,cAAA,OAAKC,UAAU,aAAawB,IAAI,GAAGF,IAAI,sBACvCzB,EAAAC,EAAAC,cAAA,QAAMC,UAAU,QAAhB,iBACCgzB,EAASU,MACR7zB,EAAAC,EAAAC,cAAA,OAAKC,UAAU,QAAQsB,IAAK0xB,EAASU,MAAOlyB,IAAI,KAC9C,MAEN3B,EAAAC,EAAAC,cAAA,QAAMC,UAAU,UAAhB,MACKH,EAAAC,EAAAC,cAAA,KAAG2B,KAAI,WAAAxK,OAAa87B,EAASx0B,OAASw0B,EAASx0B,OAEpDqB,EAAAC,EAAAC,cAAA,OAAKC,UAAU,aACbH,EAAAC,EAAAC,cAAA,QAAMC,UAAU,QAAQ2yB,GAAQ,CAAE5oB,MAAK1P,OAAQg4B,KAC/CxyB,EAAAC,EAAAC,cAAA,QAAMC,UAAU,UACb0vB,GAAW,EADd,QACkC,IAAZA,EAAgB,GAAK,MAEtC,KAERwD,IAAeF,EAASx0B,KACvBqB,EAAAC,EAAAC,cAAA,OAAKC,UAAU,WACbH,EAAAC,EAAAC,cAAA,UACEC,UAAU,SACV2B,QAAS,WACPwxB,EAAoB,CAAEQ,OAAQ1+B,EAAMo+B,WAAYA,MAHpD,QAMQA,EAAY,SAAW,WAE/BxzB,EAAAC,EAAAC,cAAA,UACEC,UAAU,SACV2B,QAAS,WACPyxB,EAAa,CAAEO,OAAQ1+B,MAH3B,WASA,uCAKD,IAAAmV,EAAApL,KAAAU,EAOHV,KAAKC,MALP20B,EAFKl0B,EAELk0B,UACAvxB,EAHK3C,EAGL2C,MACA0uB,EAJKrxB,EAILqxB,KACA8C,EALKn0B,EAKLm0B,cACAC,EANKp0B,EAMLo0B,qBAEMjiC,EAAUmN,KAAKpD,MAAf/J,MACFkY,EAAM,IAAID,KAEhB,OACEjK,EAAAC,EAAAC,cAAA,OAAKC,UAAU,kBACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,0BACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,aACbH,EAAAC,EAAAC,cAAA,QAAMC,UAAU,SAASqC,GACzBxC,EAAAC,EAAAC,cAAA,UACEsjB,SAAUxxB,GAAS,EACnBmO,UAAU,SACV2B,QAAS3C,KAAKsoB,gBAHhB,KAOAznB,EAAAC,EAAAC,cAAA,UACEsjB,SAAUxxB,GAAS+hC,EAAU7hC,OAASg/B,EACtC/wB,UAAU,SACV2B,QAAS3C,KAAK+zB,YAHhB,KAOAlzB,EAAAC,EAAAC,cAAA,QAAMC,UAAU,SACbnO,EAAQ,EADX,MACiBkF,KAAKyW,IAAI3b,EAAQk/B,EAAM6C,EAAU7hC,QADlD,KAEG6hC,EAAU7hC,OAFb,YAKD8hC,EACCh0B,EAAAC,EAAAC,cAAA,OAAKC,UAAU,YACbH,EAAAC,EAAAC,cAAA,UAAQC,UAAU,SAAS2B,QAASmyB,GAApC,uBAIA,MAENj0B,EAAAC,EAAAC,cAAA,MAAIC,UAAU,aACX5I,IAAEw8B,GACAp7B,MAAM3G,EAAOA,EAAQk/B,GACrBr7B,IAAI,SAACgD,EAAGgV,GAAJ,OAAUtD,EAAK0oB,eAAe,CAAEE,SAAUt6B,EAAGgV,IAAG3D,UACpDnR,iBA9IgBqH,aAqJ7B4yB,GAAekB,aAAe,CAC5BhD,KAAM,EACN8C,eAAe,GAGFhB,aCvITmB,eACJ,SAAAA,EAAY/0B,GAAO,IAAA0B,EAAA,OAAAhH,OAAAiH,EAAA,EAAAjH,CAAAqF,KAAAg1B,IACjBrzB,EAAAhH,OAAAkH,EAAA,EAAAlH,CAAAqF,KAAArF,OAAAmH,EAAA,EAAAnH,CAAAq6B,GAAAjzB,KAAA/B,KAAMC,KACDg1B,eAAiBtzB,EAAKszB,eAAehzB,KAApBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACtBA,EAAKuzB,mBAAqBvzB,EAAKuzB,mBAAmBjzB,KAAxBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAC1BA,EAAKsyB,cAAgBtyB,EAAKsyB,cAAchyB,KAAnBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACrBA,EAAKmzB,qBAAuBnzB,EAAKmzB,qBAAqB7yB,KAA1BtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAC5BA,EAAKwyB,oBAAsBxyB,EAAKwyB,oBAAoBlyB,KAAzBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAC3BA,EAAKyyB,aAAezyB,EAAKyyB,aAAanyB,KAAlBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACpBA,EAAK/E,MAAQ,CACXu4B,UAAU,EACVC,iBAAkB,GAClBC,gBAAiB,IAXF1zB,mFAgBjB3B,KAAKs1B,YAAa,EAClBt1B,KAAKi1B,gEAILj1B,KAAKs1B,YAAa,EADG,IAEbl1B,EAAWC,OAAOC,SAAlBF,OACFG,EAAS,IAAIF,OAAOG,gBAAgBJ,GACpCm1B,EAASh1B,EAAOtH,IAAI,MACpBwH,EAAYF,EAAOtH,IAAI,UACxBs8B,GAAU90B,GACbJ,OAAO+vB,QAAQoF,UAAU,KAAM,KAAM,8CAIxB,IAAApqB,EAAApL,KACPzJ,EAAUyJ,KAAKC,MAAf1J,MACF6O,EAAehN,IAAEa,IAAI1C,EAAO,aAAc,MAExC6J,EAAWC,OAAOC,SAAlBF,OAEFK,EADS,IAAIJ,OAAOG,gBAAgBJ,GACjBnH,IAAI,SAKzB1C,EAAMqD,QAAU6G,EAClBJ,OACGe,MADH,GAAAlJ,OACYmJ,wCADZ,sBAC2D,CACvDo0B,OAAQ,OACRC,KAAM38B,KAAKG,UAAU,CACnB3C,MAAOA,EAAMqD,UAGhByF,KACC,SAAAC,GAAQ,OAAIA,EAASgC,QACrB,SAAAtH,GAAK,OACHF,EAAW,CACTE,QACAC,QAAO,mCAGZoF,KAAK,SAAAzF,GACJ,IAAM+7B,EAAuBv9B,IAAEwB,GAC5BksB,OAAO,SAAAkO,GAAQ,OAAKA,EAASQ,UAC7BtV,UACAtlB,QAECwR,EAAKkqB,YACPlqB,EAAKd,SAAS,CACZqrB,uBACAR,UAAU,MAKdn1B,KAAKs1B,YACPt1B,KAAKsK,SAAS,CACZqrB,qBAAsB,KAK5Bt1B,OACGe,MADH,GAAAlJ,OACYmJ,wCADZ,eAEGhC,KACC,SAAAC,GAAQ,OAAIA,EAASgC,QACrB,SAAAtH,GAAK,OACHF,EAAW,CACTE,QACAC,QAAO,mCAGZoF,KAAK,SAAAzF,GACJ,IAAMg7B,EAAYh7B,EAAMlD,IAAI,SAAAs9B,GAAQ,OAAAr5B,OAAAwB,EAAA,EAAAxB,CAAA,GAC/Bq5B,EAD+B,CAElCtD,SAAUsD,EAAStD,SAAW,MAG1B0E,EAAmBh9B,IAAEw8B,GACxBl+B,IAAI,SAAAs9B,GAAQ,OAAAr5B,OAAAwB,EAAA,EAAAxB,CAAA,GACRq5B,EADQ,CAEX4B,MAAOzC,GAASa,EAASZ,YAE1BtN,OAAO,SAAAkO,GAAQ,OAAIA,EAAS4B,QAC5B1W,UACAtlB,QAEGy7B,EAAkBj9B,IAAEw8B,GACvB9O,OAAO,SAAAkO,GAAQ,OAAKA,EAASQ,UAC7BtV,UACAtlB,QAEGi8B,EAAsBzwB,EACxBiwB,EAAgB15B,OAAO,SAAAq4B,GAAQ,OAAIA,EAASx0B,OAAS4F,IACrD,GAEAgG,EAAKkqB,YACPlqB,EAAKd,SAAS,CACZ8qB,iBAAkBA,EAAiBz5B,OAAO,SAAAjC,GAAC,OAAKA,EAAEo8B,SAClDT,gBAAiBA,EAAgB15B,OAAO,SAAAjC,GAAC,OAAKA,EAAEo8B,SAChDD,sBACAV,UAAU,iDAMDlqB,IAEdA,EAAU3T,WAAa0I,KAAKC,MAAM3I,UACnC2T,EAAU1U,QAAUyJ,KAAKC,MAAM1J,SAE/ByJ,KAAKsK,SAAS,CACZ6qB,UAAU,IAEZn1B,KAAKi1B,iEAKP50B,OAAO+vB,QAAQoF,UAAU,KAAM,KAAM,KACrCx1B,KAAKsK,SAAS,CACZ6qB,UAAU,IAEZn1B,KAAKi1B,0DAGkB,IAAT1qB,EAASpN,EAAToN,EAAGtM,EAAMd,EAANc,GAAM8B,EACKC,KAAKC,MAAzBhK,EADe8J,EACf9J,KAAMkK,EADSJ,EACTI,UACVlC,IAAO7F,IAAEa,IAAIhD,EAAM,aACrBsU,EAAEwrB,iBACF51B,EAAUrO,EAAYG,qDAIiB,IAArB0iC,EAAqBv3B,EAArBu3B,OAAQN,EAAaj3B,EAAbi3B,UAAa3zB,EACRV,KAAKC,MAA9B1J,EADiCmK,EACjCnK,OACRy/B,EAFyCt1B,EAC1Bs1B,eACD,CAAEz/B,QAAOo+B,SAAQN,sDAGR,IAAVM,EAAUpS,EAAVoS,OAAU3oB,EACahM,KAAKC,MAAjC1J,EADeyV,EACfzV,MAAO0/B,EADQjqB,EACRiqB,iBAEb51B,OAAOsiB,QACL,+DAGFsT,EAAiB,CAAEtB,SAAQp+B,wDAKsB,IAAhCq+B,EAAgCl3B,EAAhCk3B,UAAWvxB,EAAqB3F,EAArB2F,MAAO6wB,EAAcx2B,EAAdw2B,WACrC,OACErzB,EAAAC,EAAAC,cAACm1B,GAAD,CACE/B,oBAAqBn0B,KAAKm0B,oBAC1BC,aAAcp0B,KAAKo0B,aACnBF,WAAYA,EACZD,cAAej0B,KAAKi0B,cACpBW,UAAWA,EACXvxB,MAAOA,qCAKJ,IAAA0I,EAOH/L,KAAKpD,MALPw4B,EAFKrpB,EAELqpB,iBACAC,EAHKtpB,EAGLspB,gBACAQ,EAJK9pB,EAIL8pB,oBACAF,EALK5pB,EAKL4pB,qBACAR,EANKppB,EAMLopB,SAGIjB,EAAa97B,IAAEa,IAAI+G,KAAKC,MAAO,mBAAoB,MAEjDG,EAAWC,OAAOC,SAAlBF,OAEFK,GADS,IAAIJ,OAAOG,gBAAgBJ,GAChBnH,IAAI,UAAY,IAAIoa,cAExC8iB,EAAsBd,EAAgB15B,OAC1C,SAAAjC,GAAC,OAAIA,EAAE8F,KAAK6T,gBAAkB5S,IAGhC,OACEI,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,QACZm0B,EACCt0B,EAAAC,EAAAC,cAAA,KAAGC,UAAU,WAAb,wBACEP,EACF01B,EAAoBpjC,OAClB8N,EAAAC,EAAAC,cAACm1B,GAAD,CACE/B,oBAAqBn0B,KAAKm0B,oBAC1BC,aAAcp0B,KAAKo0B,aACnBF,WAAYA,EACZD,cAAej0B,KAAKi0B,cACpBW,UAAWuB,EACX9yB,MAAK,GAAAnL,OAAKuI,EAAL,OAAAvI,OACHg8B,GAAczzB,IAAcyzB,EAAW7gB,cACnC,SACA,GAHD,cAKL0e,KAAM,GACN8C,eAAe,EACfC,qBAAsB90B,KAAK80B,uBAG7Bj0B,EAAAC,EAAAC,cAAA,KAAGC,UAAU,WAAb,sBAGFH,EAAAC,EAAAC,cAAC6xB,EAAA,SAAD,KACG+C,GAAwBA,EAAqB5iC,OAC5C8N,EAAAC,EAAAC,cAACm1B,GAAD,CACE/B,oBAAqBn0B,KAAKm0B,oBAC1BC,aAAcp0B,KAAKo0B,aACnBF,WAAYA,EACZD,cAAej0B,KAAKi0B,cACpBW,UAAWe,EACXtyB,MAAM,2BAEN,KACHwyB,GAAuBA,EAAoB9iC,OAC1C8N,EAAAC,EAAAC,cAACm1B,GAAD,CACE/B,oBAAqBn0B,KAAKm0B,oBAC1BC,aAAcp0B,KAAKo0B,aACnBF,WAAYA,EACZD,cAAej0B,KAAKi0B,cACpBW,UAAWiB,EACXxyB,MAAM,0BAEN,KACJxC,EAAAC,EAAAC,cAACm1B,GAAD,CACE/B,oBAAqBn0B,KAAKm0B,oBAC1BC,aAAcp0B,KAAKo0B,aACnBF,WAAYA,EACZD,cAAej0B,KAAKi0B,cACpBW,UAAWQ,EACX/xB,MAAM,sBAERxC,EAAAC,EAAAC,cAACm1B,GAAD,CACE/B,oBAAqBn0B,KAAKm0B,oBAC1BC,aAAcp0B,KAAKo0B,aACnBF,WAAYA,EACZD,cAAej0B,KAAKi0B,cACpBW,UAAWS,EACXhyB,MAAM,+BAvQFpC,aAiRLC,eA/RS,SAAAnH,GAAA,MAAgC,CACtD9D,KADsB8D,EAAG9D,KAEzBM,MAFsBwD,EAASxD,MAG/Be,SAHsByC,EAAgBzC,WAMb,SAAAsG,GAAQ,MAAK,CACtCq4B,iBAAkB,SAAAj5B,GAAA,IAAGzG,EAAHyG,EAAGzG,MAAOo+B,EAAV33B,EAAU23B,OAAV,OAChB/2B,EpDgF4B,SAAAX,GAAA,IAAG1G,EAAH0G,EAAG1G,MAAOo+B,EAAV13B,EAAU03B,OAAV,OAAuB,SAAA/2B,GAGrD,OAFAA,EAASP,EAAQ+4B,yBAEV/1B,OACJe,MADI,GAAAlJ,OACKmJ,wCADL,WACyC,CAC5Co0B,OAAQ,OACRC,KAAM38B,KAAKG,UAAU,CACnB3C,MAAOA,EAAMqD,MACb3D,KAAM0+B,MAGTt1B,KACC,SAAAC,GAAQ,OAAIA,EAASgC,QACrB,SAAAtH,GAAK,OACHF,EAAW,CACTE,QACAC,QAAO,wBAGZoF,KAAK,kBAAMzB,EAASP,EAAQg5B,4BoDnGpBJ,CAAiB,CAAE1/B,QAAOo+B,aACrCx0B,UAAW,SAAAvN,GAAM,OAAIgL,EAASP,EAAQ8C,UAAUvN,KAChDojC,cAAe,SAAA/4B,GAAA,IAAG1G,EAAH0G,EAAG1G,MAAOo+B,EAAV13B,EAAU03B,OAAQN,EAAlBp3B,EAAkBo3B,UAAlB,OACbz2B,EpDsDyB,SAAAZ,GAAA,IAAGzG,EAAHyG,EAAGzG,MAAOo+B,EAAV33B,EAAU23B,OAAQN,EAAlBr3B,EAAkBq3B,UAAlB,OAAkC,SAAAz2B,GAG7D,OAFAA,EAASP,EAAQi5B,wBAEVj2B,OACJe,MADI,GAAAlJ,OACKmJ,wCADL,mBACiD,CACpDo0B,OAAQ,OACRC,KAAM38B,KAAKG,UAAU,CACnB3C,MAAOA,EAAMqD,MACb3D,KAAM0+B,EACNN,gBAGHh1B,KACC,SAAAC,GAAQ,OAAIA,EAASgC,QACrB,SAAAtH,GAAK,OACHF,EAAW,CACTE,QACAC,QAAO,gCAGZoF,KAAK,kBAAMzB,EAASP,EAAQk5B,2BoD1EpBP,CAAc,CAAEz/B,QAAOo+B,SAAQN,kBAoR7BnzB,CAA6C8zB,aC5RtDwB,eACJ,SAAAA,EAAYv2B,GAAO,IAAA0B,EAAA,OAAAhH,OAAAiH,EAAA,EAAAjH,CAAAqF,KAAAw2B,IACjB70B,EAAAhH,OAAAkH,EAAA,EAAAlH,CAAAqF,KAAArF,OAAAmH,EAAA,EAAAnH,CAAA67B,GAAAz0B,KAAA/B,KAAMC,KAEDw2B,qBAAuB90B,EAAK80B,qBAAqBx0B,KAA1BtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAHXA,sFAOjB3B,KAAKC,MAAMy2B,eAAeC,GAAQjgC,IAAI,SAAAgD,GAAC,OAAIA,EAAEuE,uCAI7C,IAAM24B,EAAex+B,IAAEy+B,WACrBF,GAAQjgC,IAAI,SAAAgD,GAAC,OAAIA,EAAEuE,KACnB+B,KAAKC,MAAMlJ,kBAGb,OACE8J,EAAAC,EAAAC,cAAA,OAAKC,UAAU,UACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,OACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,QACbH,EAAAC,EAAAC,cAAA,KAAGC,UAAU,SAAb,oBACC5I,IAAEw+B,GACAlgC,IAAI,SAAAuH,GAAE,OAAI04B,GAAQ9G,KAAK,SAAAn2B,GAAC,OAAIA,EAAEuE,KAAOA,MACrC6nB,OAAO,MACP5G,UACAxoB,IAAI,SAACogC,EAAQpoB,GAAT,OACH7N,EAAAC,EAAAC,cAAA,KAAGzK,IAAKoY,GACN7N,EAAAC,EAAAC,cAAA,YAAO+1B,EAAOzD,KAAd,OACCyD,EAAO1gC,QAGXwD,SAELiH,EAAAC,EAAAC,cAAA,UAAQC,UAAU,SAAS2B,QAAS3C,KAAKy2B,sBAAzC,iBAlCWx1B,aA2CNC,eAjDS,SAAAnH,GAAA,MAA2B,CAAEhD,iBAA7BgD,EAAGhD,mBAEA,SAAA6G,GAAQ,MAAK,CACtC84B,eAAgB,SAAAz4B,GAAE,OAAIL,EAASP,EAAQq5B,eAAez4B,OA8CzCiD,CAGbs1B,ICrDIO,GAAkB,4BAElBC,GAAiB,SAAAp9B,GAAK,OAC1BA,GAASA,EAAM7G,QAAU6G,IAAUm9B,IA4TtBE,eAzTb,SAAAA,EAAYh3B,GAAO,IAAA0B,EAAA,OAAAhH,OAAAiH,EAAA,EAAAjH,CAAAqF,KAAAi3B,IACjBt1B,EAAAhH,OAAAkH,EAAA,EAAAlH,CAAAqF,KAAArF,OAAAmH,EAAA,EAAAnH,CAAAs8B,GAAAl1B,KAAA/B,KAAMC,KAEDi3B,cAAgBv1B,EAAKu1B,cAAcj1B,KAAnBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACrBA,EAAKw1B,sBAAwBx1B,EAAKw1B,sBAAsBl1B,KAA3BtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAC7BA,EAAKy1B,sBAAwBz1B,EAAKy1B,sBAAsBn1B,KAA3BtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAC7BA,EAAK01B,iBAAmB11B,EAAK01B,iBAAiBp1B,KAAtBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACxBA,EAAK21B,cAAgB31B,EAAK21B,cAAcr1B,KAAnBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACrBA,EAAK41B,oBAAsB51B,EAAK41B,oBAAoBt1B,KAAzBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAC3BA,EAAK61B,oBAAsB71B,EAAK61B,oBAAoBv1B,KAAzBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAC3BA,EAAK81B,oBAAsB91B,EAAK81B,oBAAoBx1B,KAAzBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAC3BA,EAAK+1B,iBAAmB/1B,EAAK+1B,iBAAiBz1B,KAAtBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACxBA,EAAK/E,MAAQ,CACX+6B,gBAAiBZ,GACjBa,SAAU,GACVC,MAAO,KACP79B,MAAO,KACP4G,YAAY,EACZk3B,OAAQ,IAlBOn2B,4MAuBTpL,EAAUyJ,KAAKC,MAAf1J,QACF6O,EAAehN,IAAEa,IAAI1C,EAAO,aAAc,8BAGxCwhC,yCAAsC3yB,GAC5CwG,QAAQY,IAAR,2BAAAtU,OAAuC6/B,aAChB32B,MAAM22B,EAAK,CAChCC,QAAS,CACPC,cAAa,SAAA//B,OAAW3B,EAAMqD,OAC9Bs+B,eAAgB,8BAHd54B,UAOO04B,QAAQG,IAAI,mBACvBn4B,KAAKsK,SAAS,CAAEwtB,OAAQx4B,EAAS04B,QAAQ/+B,IAAI,4SAMzCs8B,EAAWv1B,KAAKC,MAAhBs1B,OAGF6C,mDAA2D7C,qCACjE3pB,QAAQY,IAAR,4BAAAtU,OAAwCkgC,EAAxC,eAC4Bh3B,MAAMg3B,iBAA5BC,kBAGkBA,EAAc/2B,iBAAhCg3B,SACAT,EAAQz/B,IAAEa,IAAIq/B,EAAW,WAAY,MACrCC,EAAcngC,IAAEa,IAAIq/B,EAAW,wBAAyB,OAE1DT,IAASU,0BAEXv4B,KAAKsK,SAAS,CAAEutB,UAEhBjsB,QAAQY,IAAR,4BAAAtU,OAAwCqgC,EAAxC,gBAC+Bn3B,MAAMm3B,kBAA/BC,mBACqBA,EAAiBl3B,eAAtCm3B,SACNz4B,KAAKsK,SAAS,CAAEstB,SAAUa,YAG5Bz4B,KAAKq3B,kKAILr3B,KAAKo3B,mMAICp3B,KAAK04B,qCACL14B,KAAKs3B,8RAIet3B,KAAKC,MAAvB1J,UAAOg/B,WAEfv1B,KAAKsK,SAAS,CACZ1J,YAAY,IAIRm3B,kEACAnX,EAAU,CACd6U,OAAQ,OACRuC,QAAS,CACPC,cAAa,SAAA//B,OAAW3B,EAAMqD,OAC9Bs+B,eAAgB,oBAElBxC,KAAM38B,KAAKG,UAAU,CAAEmK,MAAOkyB,KAGhC3pB,QAAQY,IAAR,yBAAAtU,OAAqC6/B,aACd32B,MAAM22B,EAAKnX,aACV,OADlBthB,UACOq5B,yCACQr5B,EAASgC,eAAtBA,SACNtB,KAAKsK,SAAS,CACZutB,MAAOv2B,EACPV,YAAY,kCAGdZ,KAAKsK,SAAS,CACZ1J,YAAY,IAER,IAAI1G,MAAMoF,EAASs5B,6RAKnBriC,EAAUyJ,KAAKC,MAAf1J,QAC2ByJ,KAAKpD,MAAhCi7B,UAAOF,oBAEf33B,KAAKsK,SAAS,CACZ1J,YAAY,IAGRm3B,0EAAuEF,EAAMpgC,oBAC7EmpB,EAAU,CACd6U,OAAQ,OACRuC,QAAS,CACPC,cAAa,SAAA//B,OAAW3B,EAAMqD,OAC9Bs+B,eAAgB,oBAElBxC,KAAM38B,KAAKG,UAAU,CAAEw8B,KAAMiC,KAI/B/rB,QAAQY,IAAR,wBAAAtU,OAAoC6/B,aACb32B,MAAM22B,EAAKnX,aAEV,OAFlBthB,UAEOq5B,yCAEQr5B,EAASgC,eAAtBA,SAINtB,KAAKsK,SAAS,CACZ1J,YAAY,EACZg3B,SAAQ,GAAA1/B,OAAAyC,OAAAC,EAAA,EAAAD,CAAMqF,KAAKpD,MAAMg7B,UAAjB,CAA2Bt2B,IACnCq2B,gBAAiBZ,mCAKb,IAAI78B,MAAMoF,EAASs5B,+LAITC,uFACVtiC,EAAUyJ,KAAKC,MAAf1J,MAERyJ,KAAKsK,SAAS,CACZ1J,YAAY,IAGRm3B,mFAAgFc,GAChFjY,EAAU,CACd6U,OAAQ,SACRuC,QAAS,CACPC,cAAa,SAAA//B,OAAW3B,EAAMqD,SAIlCgS,QAAQY,IAAR,8BAAAtU,OAA0C6/B,aACnB32B,MAAM22B,EAAKnX,UACV,OADlBthB,UACOq5B,OACX34B,KAAKsK,SAAS,CACZ1J,YAAY,EACZg3B,SAAU53B,KAAKpD,MAAMg7B,SAASj8B,OAC5B,SAAAkvB,GAAO,OAAIA,EAAQ5sB,KAAO46B,MAI9B74B,KAAKsK,SAAS,CACZ1J,YAAY,EACZ5G,MAAOsF,EAASs5B,4JAKFC,GAClB74B,KAAKk3B,cAAc2B,iDAGC,IAAArd,EAC2Bxb,KAAKpD,MAA5Ci7B,EADYrc,EACZqc,MAAOF,EADKnc,EACLmc,gBAAiB/2B,EADZ4a,EACY5a,WAKhC,GAHAgL,QAAQY,IAAI,CAAEmrB,kBAAiB/2B,aAAYi3B,WAGtCj3B,GAAco2B,GAAeW,GAEhC,GAAKE,EAQH,IACEjsB,QAAQY,IAAI,oBACZxM,KAAKs3B,gBACL,MAAO/sB,GACPvK,KAAKsK,SAAS,CAAE1J,YAAY,EAAO5G,MAAOuQ,EAAEtQ,eAX9C,IACE2R,QAAQY,IAAI,8BACZxM,KAAKm3B,wBACL,MAAO5sB,GACPvK,KAAKsK,SAAS,CAAE1J,YAAY,EAAO5G,MAAOuQ,EAAEtQ,uDAahCsQ,GAClBvK,KAAKsK,SAAS,CAAEqtB,gBAAiBptB,EAAEqQ,OAAOhhB,MAAOI,MAAO,kDAIxDqG,OAAOy4B,KAAP,sDAAA5gC,OACwDmJ,uBADxD,2BAEE,QACA,mEAIe4J,GAAW,IACb8tB,EAAa9tB,EAApB1U,MACAA,EAAUyJ,KAAKC,MAAf1J,MAEJwiC,EAASn/B,QAAUrD,EAAMqD,OAC3BoG,KAAKq3B,oDAIA,IAAAjsB,EAAApL,KACCzJ,EAAUyJ,KAAKC,MAAf1J,MADDyiC,EAE0Dh5B,KAAKpD,MAA9D+6B,EAFDqB,EAECrB,gBAAiBC,EAFlBoB,EAEkBpB,SAAUh3B,EAF5Bo4B,EAE4Bp4B,WAAY5G,EAFxCg/B,EAEwCh/B,MAAO89B,EAF/CkB,EAE+ClB,OAChD/sB,EAAM,IAAID,KAEV1F,EAAehN,IAAEa,IAAI1C,EAAO,aAAc,MAC1C0iC,EACJr4B,IAAeo2B,GAAeW,GAE1BuB,EAAuBpB,EAAOlrB,SAAS,eAGvCusB,IAAmB/zB,GAAgB8zB,EAEzC,OACEr4B,EAAAC,EAAAC,cAAA,OAAKC,UAAU,YACbH,EAAAC,EAAAC,cAAA,UACG62B,EAASlhC,IAAI,SAACm0B,EAASnc,GAAV,OACZ7N,EAAAC,EAAAC,cAAA,MAAIzK,IAAKoY,GACP7N,EAAAC,EAAAC,cAAA,OAAKC,UAAU,QACbH,EAAAC,EAAAC,cAAA,QAAMC,UAAU,QAAQ6pB,EAAQrrB,KAAKC,OACrCoB,EAAAC,EAAAC,cAAA,QAAMC,UAAU,QACb2yB,GAAQ,CAAE5oB,MAAK1P,OAAQ,IAAIyP,KAAK+f,EAAQuO,eAE1Ch0B,GAAgBA,IAAiBylB,EAAQrrB,KAAKC,OAC7CoB,EAAAC,EAAAC,cAAA,UACEC,UAAU,gBACV2B,QAAS,WACPyI,EAAKosB,oBAAoB3M,EAAQ5sB,MAHrC,aAUJ4C,EAAAC,EAAAC,cAAA,OAAKC,UAAU,WAAW6pB,EAAQ6K,UAIvCyD,GACCt4B,EAAAC,EAAAC,cAAA,OAAKC,UAAU,eACbH,EAAAC,EAAAC,cAAA,YACEnH,MAAO+9B,EACP7W,SAAU9gB,KAAKy3B,sBAEjB52B,EAAAC,EAAAC,cAAA,OAAKC,UAAU,aACbH,EAAAC,EAAAC,cAAA,UACEC,UAAU,SACVqjB,SAAU4U,EACVt2B,QAAS3C,KAAKu3B,qBAHhB,kBAQDv9B,GAAS6G,EAAAC,EAAAC,cAAA,OAAKC,UAAU,SAAf,UAA+BhH,KAG3Cm/B,GACAt4B,EAAAC,EAAAC,cAAA,OAAKC,UAAU,wBACbH,EAAAC,EAAAC,cAAA,UAAQC,UAAU,SAAS2B,QAAS3C,KAAK03B,kBAAzC,IACI,IACDtyB,IAAiB8zB,EACd,gCACA,qBAIVr4B,EAAAC,EAAAC,cAAA,OACEC,UAAW+B,IAAW,UAAW,CAC/Bs2B,cAAez4B,KAFnB,gBA9SeK,aCAjBq4B,+LACiB,IAIXrjC,EAAS+J,KAAKC,MAAdhK,KACFgI,EAAK7F,IAAEa,IAAIhD,EAAM,WACnBgI,GACF+B,KAAKu5B,UAAUt7B,8CAICgN,GAAW,IAIrBhV,EAAS+J,KAAKC,MAAdhK,KACFujC,EAAQphC,IAAEa,IAAIgS,EAAW,gBACzBwuB,EAAQrhC,IAAEa,IAAIhD,EAAM,WACtBwjC,IAAUD,GACZx5B,KAAKu5B,UAAUE,qCAIRA,GAAO,IACRr5B,EAAWC,OAAOC,SAAlBF,OACO,IAAIC,OAAOG,gBAAgBJ,GACrBnH,IAAI,QACXwgC,GACZp5B,OAAO+vB,QAAQoF,UAAU,KAAM,KAAMiE,EAAK,QAAAvhC,OAAWuhC,GAAU,sCAKjE,OAAO,YAlCWx4B,aAsCPC,eA5CS,SAAAnH,GAAA,MAAe,CACrC9D,KADsB8D,EAAG9D,OAIA,iBAAO,IAwCnBiL,CAA6Co4B,ICrC7CI,GARC,SAAA3/B,GAAA,IAAG7D,EAAH6D,EAAG7D,KAAMO,EAATsD,EAAStD,QAASC,EAAlBqD,EAAkBrD,IAAKC,EAAvBoD,EAAuBpD,QAASC,EAAhCmD,EAAgCnD,OAAQC,EAAxCkD,EAAwClD,MAAxC,OACd6N,KAAMxO,EAAMP,EAAaO,OACzBwO,KAAMjO,EAASd,EAAac,UAC5BiO,KAAMhO,EAAKf,EAAae,MACxBgO,KAAM/N,EAAShB,EAAagB,UAC5B+N,KAAM9N,EAAQjB,EAAaiB,SAC3B8N,KAAM7N,EAAOlB,EAAakB,QCYpBu1B,GAAa/rB,OAAOgsB,UAApBD,SAuFFuN,eACJ,SAAAA,EAAY15B,GAAO,IAAA0B,EAAA,OAAAhH,OAAAiH,EAAA,EAAAjH,CAAAqF,KAAA25B,IACjBh4B,EAAAhH,OAAAkH,EAAA,EAAAlH,CAAAqF,KAAArF,OAAAmH,EAAA,EAAAnH,CAAAg/B,GAAA53B,KAAA/B,KAAMC,KACDihB,QAAUvf,EAAKuf,QAAQjf,KAAbtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACfA,EAAKi4B,SAAWj4B,EAAKi4B,SAAS33B,KAAdtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAChBA,EAAKk4B,cAAgBl4B,EAAKk4B,cAAc53B,KAAnBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACrBA,EAAKm4B,aAAen4B,EAAKm4B,aAAa73B,KAAlBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACpBA,EAAKo4B,mBAAqBp4B,EAAKo4B,mBAAmB93B,KAAxBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAC1BA,EAAKq4B,kBAAoBr4B,EAAKq4B,kBAAkB/3B,KAAvBtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACzBA,EAAKs4B,OAASt4B,EAAKs4B,OAAOh4B,KAAZtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACdA,EAAKu4B,QAAUv4B,EAAKu4B,QAAQj4B,KAAbtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KACfA,EAAKw4B,sBAAwBx4B,EAAKw4B,sBAAsBl4B,KAA3BtH,OAAAuH,GAAA,EAAAvH,QAAAuH,GAAA,EAAAvH,CAAAgH,KAC7BtB,OAAO+5B,QAAQC,WAAap6B,EAAMq6B,WAElCj6B,OAAO4J,iBAAiB,eAAgBtI,EAAKu4B,SAb5Bv4B,oFAgBE,IAAA5B,EAC4BC,KAAKC,MAA5C1J,EADWwJ,EACXxJ,MAAOC,EADIuJ,EACJvJ,WAAY+jC,EADRx6B,EACQw6B,gBACvBhkC,EAAMqD,OAASpD,IACjB+jC,IACmB,WAAf/jC,GACFwJ,KAAKi6B,SAEY,iBAAfzjC,GACFwJ,KAAKi6B,QAAO,oCAKVrX,GAAO,IAAAliB,EAC0CV,KAAKC,MAApDrN,EADK8N,EACL9N,OAAQsD,EADHwK,EACGxK,KAAMyU,EADTjK,EACSiK,WAAYxK,EADrBO,EACqBP,UAAW5J,EADhCmK,EACgCnK,MAErCikC,EAAmC5X,EAAnC4X,OAAQ3X,EAA2BD,EAA3BC,KAAM4X,EAAqB7X,EAArB6X,QAAS1J,EAAYnO,EAAZmO,QAiB/B,IAbG0J,GAAoB,SAAT5X,GAAmBzqB,IAAEwU,SAASwf,GAAU,QACnD2E,GAAoB,SAATlO,IAAoBzqB,IAAEwU,SAASwf,GAAU,SAIjD71B,EAAMqD,OAASqL,GAAUjF,KAAKC,SAEhCD,KAAK65B,eAAc,GACnBjX,EAAMmT,kBAKNyE,EAAQ,CAEV,GAAI5nC,IAAWd,EAAYK,KAAM,CAE/B,IAAMuoC,GAAWl+B,EAAUtG,GAAMI,IAIpB,gBAATusB,IACFlY,GAAY+vB,EAAU,EAAI,GAAK,GAC/B9X,EAAMmT,kBAEK,iBAATlT,IACFlY,GAAY+vB,EAAU,GAAK,GAC3B9X,EAAMmT,kBAIG,WAATlT,IACF1iB,EAAUnN,EAAkBJ,IAC5BgwB,EAAMmT,kBAEK,UAATlT,IACF1iB,EAAUxN,EAAcC,IACxBgwB,EAAMmT,+DAMV11B,OAAO4J,iBAAiB,UAAWjK,KAAKkhB,wDAIxC7gB,OAAO8K,oBAAoB,eAAgBnL,KAAKk6B,SAChD75B,OAAO8K,oBAAoB,UAAWnL,KAAKkhB,yDAKzC7gB,OAAOsiB,QACL,6FAGF3iB,KAAKC,MAAM06B,yDAIJ,IAAA3uB,EACchM,KAAKC,MAApBhK,EADC+V,EACD/V,KAAMC,EADL8V,EACK9V,KACRmN,EAAQoF,GAAavS,GAAMyS,cAC3BgsB,EAASv8B,IAAEa,IAAIhD,EAAM,UAAW,MAChC8hC,EAAG,qCAAA7/B,OAAwCpC,IAAxC,SAETuK,OACGe,MAAM22B,GACN14B,KAAK,SAAAC,GAAQ,OAAIA,EAASlJ,SAC1BiJ,KAAK,SAAAjJ,IAhMS,SAAAwkC,GACnB,IAAMC,EAAUx0B,SAAStF,cAAc,KACvC85B,EAAQC,aACN,OACA,iCAAmCC,mBAAmBH,IAExDC,EAAQC,aAAa,WAAY,cACjCD,EAAQ5L,MAAM+L,QAAU,OACxB30B,SAASqvB,KAAKuF,YAAYJ,GAC1BA,EAAQK,QACR70B,SAASqvB,KAAKyF,YAAYN,GAgMpBO,CATahlC,EACV6R,QACC,iCAFS,UAAA/P,OAGCmL,EAHD,oFAKV4E,QACC,SANS,mDAAA/P,OAO0Cy8B,EAP1C,oDAaXpqB,GAAG,IAAA8Y,EAULrjB,KAAKC,MARPhK,EAFOotB,EAEPptB,KACAC,EAHOmtB,EAGPntB,KACAO,EAJO4sB,EAIP5sB,QACAC,EALO2sB,EAKP3sB,IACAC,EANO0sB,EAMP1sB,QACAC,EAPOysB,EAOPzsB,OACAC,EAROwsB,EAQPxsB,MACAhB,EATOwtB,EASPxtB,cAYF,GAVc0O,GAAQ,CACpBtO,OACAC,OACAO,UACAC,MACAC,UACAC,SACAC,QACAhB,kBAES,CACT,IAAMoE,EAAU,iDAEhB,OADAsQ,EAAE8wB,YAAcphC,EACTA,0CAII,IAAAupB,EACiBxjB,KAAKC,MAA3B1J,EADKitB,EACLjtB,MAAO+kC,EADF9X,EACE8X,aACI/kC,EAAMqD,MAGvB0hC,IAEAj7B,OAAOy4B,KAAP,sDAAA5gC,OACwDmJ,uBADxD,2BAEE,QACA,qEAKe,IAAAqiB,EAUf1jB,KAAKC,MARPhK,EAFiBytB,EAEjBztB,KACAC,EAHiBwtB,EAGjBxtB,KACAO,EAJiBitB,EAIjBjtB,QACAC,EALiBgtB,EAKjBhtB,IACAC,EANiB+sB,EAMjB/sB,QACAC,EAPiB8sB,EAOjB9sB,OACAC,EARiB6sB,EAQjB7sB,MACAhB,EATiB6tB,EASjB7tB,cAGY0O,GAAQ,CACpBtO,OACAC,OACAO,UACAC,MACAC,UACAC,SACAC,QACAhB,oBAKAwK,OAAOsiB,QACL,4EAGF3iB,KAAKC,MAAMypB,QAAQ1pB,KAAKC,MAAMrN,kDAIhByhC,GAAW,IAAAxQ,EACe7jB,KAAKC,MAAvCs7B,EADmB1X,EACnB0X,WAAYtlC,EADO4tB,EACP5tB,KAAMC,EADC2tB,EACD3tB,KAAMK,EADLstB,EACKttB,MAE1BilC,EAAWpjC,IAAEa,IAAIhD,EAAM,mBAAoB,MAC3C0+B,EAASv8B,IAAEa,IAAIhD,EAAM,UAAW,MAChC6/B,IAAW19B,IAAEa,IAAIhD,EAAM,eAAgB,MAIvC6G,EAAU,CACd0C,KAAMg8B,EACNvlC,KAAM0+B,EACNtxB,MALYoF,GAAavS,GAMzB4/B,SACAzB,YACA99B,SAGIklC,EAASp1B,SAASC,cAAc,UAEtC,GAAIm1B,EAAQ,CACV,IAAMx1B,EAAU,IAAI5F,OAAO6F,eAC3Bu1B,EAAOl1B,cAAcC,YACnB,CACEL,KAAM,SAER,IACA,CAACF,EAAQQ,QAEXR,EAAQS,MAAMC,UAAY,SAAA4D,GAAK,IACrBzR,EAASyR,EAATzR,KACRyiC,EAAW5gC,OAAAwB,EAAA,EAAAxB,CAAA,GACNmC,EADK,CAER43B,MAAO57B,WAIXyiC,EAAWz+B,yCAIDa,GAAQ,IAAAqmB,EACahkB,KAAKC,MAA9B1J,EADYytB,EACZztB,MAAOmlC,EADK1X,EACL0X,cAGZ/9B,IACD0C,OAAOsiB,QAAQ,uDAGVpsB,EAAMqD,MAYToG,KAAKi6B,OAAOt8B,IAVZ+9B,EAAc/9B,EAAS,eAAiB,UAGxC0C,OAAOy4B,KAAP,sDAAA5gC,OACwDmJ,uBADxD,2BAEE,QACA,yDASD1D,GAAQ,IAAAg+B,EAYT37B,KAAKC,MAVPpK,EAFW8lC,EAEX9lC,cACAU,EAHWolC,EAGXplC,MACAL,EAJWylC,EAIXzlC,KACAuH,EALWk+B,EAKXl+B,SACAxH,EANW0lC,EAMX1lC,KAOFwH,EAAS,CACP5H,gBACAU,QACAL,OACAO,QAjBWklC,EAOXllC,QAWAC,IAlBWilC,EAQXjlC,IAWAC,QAnBWglC,EASXhlC,QAWAC,OApBW+kC,EAUX/kC,OAWAC,MArBW8kC,EAWX9kC,MAWAZ,OACA0H,4CAIK,IAAAyN,EAAApL,KAAA47B,EAiBH57B,KAAKC,MAfPrN,EAFKgpC,EAELhpC,OACAqD,EAHK2lC,EAGL3lC,KACAM,EAJKqlC,EAILrlC,MACAL,EALK0lC,EAKL1lC,KACAO,EANKmlC,EAMLnlC,QACAC,EAPKklC,EAOLllC,IACAC,EARKilC,EAQLjlC,QACAC,EATKglC,EASLhlC,OACAC,EAVK+kC,EAUL/kC,MACAsJ,EAXKy7B,EAWLz7B,UACA9I,EAZKukC,EAYLvkC,MACAwkC,EAbKD,EAaLC,YACAlxB,EAdKixB,EAcLjxB,WACA/J,EAfKg7B,EAeLh7B,WACA/K,EAhBK+lC,EAgBL/lC,cAKIqP,EAAQX,GAAQ,CACpBtO,OACAC,OACAO,UACAC,MACAC,UACAC,SACAC,QACAhB,kBAGIimC,EAAQpC,GAAQ,CAAExjC,OAAMO,UAASC,MAAKC,UAASC,SAAQC,UAEvDklC,EACJ3jC,IAAEyB,QAAQgB,EAAoB3E,KAC9BkC,IAAEyB,QAAQpD,IACV2B,IAAEyB,QAAQnD,IACV0B,IAAEyB,QAAQlD,IACVyB,IAAEyB,QAAQjD,IACVwB,IAAEyB,QAAQhD,GAGNsO,EAAY/M,IAAEa,IAAIhD,EAAM,mBAAoB,MAG5CmP,EAAehN,IAAEa,IAAI1C,EAAO,aAAc,MAK1CylC,GAAqB5jC,IAAEyB,QAAQ5D,KAAU6lC,EAEzCG,EAAeh3B,GAAUjF,KAAKC,OAM9Bi8B,GACH9jC,IAAEyB,QAAQ5D,KACI,OAAdkP,GAAsBA,IAAcC,IAAiB22B,GAElDI,EAAS/2B,GAAgBA,IAAiBD,EAK1Ci3B,EAAYD,IAAWj3B,EAEvBm3B,EAAgB,CACpBvqC,EAAYQ,KACZR,EAAYS,MACZT,EAAYU,QACZoa,SAASha,GAEL0pC,EAAc,CAACxqC,EAAYM,OAAQN,EAAYO,KAAKua,SAASha,GAE7D8nC,EAAUl+B,EAAUtG,GAAMI,IAC1BimC,EAAgB3pC,IAAWd,EAAYK,KAAvB,IAAA+F,OAAkCwiC,GAAY,GAE9D8B,IAAajmC,EAAMqD,MAEnB6iC,EAAyB5mC,GAAiBA,IAAkBC,IAElE,OACE+K,EAAAC,EAAAC,cAAA,OAAKC,UAAU,QACbH,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACE4B,QAAS,WACPxC,EAAUrO,EAAYE,OAExBgP,UAAW+B,IAAW,SAAU,CAC9B1M,OAAQzD,IAAWd,EAAYE,QAGjC6O,EAAAC,EAAAC,cAAA,QAAMC,UAAU,QAAhB,YACAH,EAAAC,EAAAC,cAAA,QAAMC,UAAU,OAAhB,YACAH,EAAAC,EAAAC,cAAA,QAAMC,UAAU,SACbpO,IAAWd,EAAYE,KAAO,WAAa,QAGhD6O,EAAAC,EAAAC,cAAA,MAAIC,UAAU,YACZH,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACE4B,QAAS3C,KAAK85B,aACd94B,UAAU,SACVqjB,SAAUmY,GAHZ,UAQF37B,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACE4B,QAAS3C,KAAK85B,aACd94B,UAAU,SACVqjB,UAAWmY,GAHb,aAUN37B,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UAAQC,UAAU,UAChBH,EAAAC,EAAAC,cAAA,QAAMC,UAAU,QAAhB,YACAH,EAAAC,EAAAC,cAAA,QAAMC,UAAU,OAAhB,OACAH,EAAAC,EAAAC,cAAA,QAAMC,UAAU,SAAhB,MACAH,EAAAC,EAAAC,cAAA,QAAMC,UAAW+B,IAAW,CAAEC,WAAYkC,KAA1C,MAEFrE,EAAAC,EAAAC,cAAA,MAAIC,UAAU,YACZH,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACE4B,QAAS3C,KAAK+5B,mBACd/4B,UAAU,SACVqjB,UAAW2X,GAHb,eASFn7B,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACE4B,QAAS,WACPyI,EAAKyuB,eAAc,IAErB74B,UAAU,SACVqjB,UAAW4X,GALb,WAWFp7B,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACE4B,QAAS,WACPyI,EAAKyuB,eAAc,IAErB74B,UAAU,SACVqjB,UAAW6X,GALb,oBAWFr7B,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACE4B,QAAS,WACPyI,EAAK4uB,mBAAkB,IAEzB3V,UAAW+X,EACXp7B,UAAU,UALZ,yBAUFH,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACE4B,QAAS,WACPyI,EAAK4uB,mBAAkB,IAEzB3V,UAAW+X,EACXp7B,UAAU,UALZ,wBAUFH,EAAAC,EAAAC,cAAA,UASM,MAENF,EAAAC,EAAAC,cAAA,UACG07B,EACC57B,EAAAC,EAAAC,cAAA,UACE4B,QAAS3C,KAAKm6B,sBACdn5B,UAAU,UAFZ,uBAME,QAKVH,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACE4B,QAAS,WACPxC,EAAUrO,EAAYK,OAExB6O,UAAW+B,IAAW,SAAU,CAC9B1M,OAAQzD,IAAWd,EAAYK,QAGjC0O,EAAAC,EAAAC,cAAA,QAAMC,UAAU,QAAhB,OAA4Bu7B,GAC5B17B,EAAAC,EAAAC,cAAA,QAAMC,UAAU,OACbpO,IAAWd,EAAYK,KAAvB,OAAA+F,OACUqkC,GADV,MAAArkC,OAESqkC,IAEZ17B,EAAAC,EAAAC,cAAA,QAAMC,UAAU,SACbpO,IAAWd,EAAYK,KAAvB,OAAA+F,OACUqkC,GADV,KAAArkC,OAEQqkC,KAGb17B,EAAAC,EAAAC,cAAA,MAAIC,UAAU,YACX5I,IAAEmE,MAAM,GAAG7F,IAAI,SAAAgD,GAAC,OACfmH,EAAAC,EAAAC,cAAA,MAAIzK,IAAKoD,GACPmH,EAAAC,EAAAC,cAAA,UACEC,UAAU,SACV2B,QAAS,WACPgI,EAAWjR,GACXyG,EAAUrO,EAAYK,QAJ1B,QAOQuH,QAOhBmH,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACE4B,QAAS,WACPxC,EAAUrO,EAAYM,SAExB4O,UAAW+B,IAAW,SAAU,CAC9B1M,OAAQimC,KAGVz7B,EAAAC,EAAAC,cAAA,QAAMC,UAAU,QAAQs7B,EAAc1pC,EAAS,OAC/CiO,EAAAC,EAAAC,cAAA,QAAMC,UAAU,OAAOs7B,EAAc1pC,EAAS,OAC9CiO,EAAAC,EAAAC,cAAA,QAAMC,UAAU,SACbs7B,EAAc1pC,EAAOk1B,UAAU,EAAG,GAAK,OAG5CjnB,EAAAC,EAAAC,cAAA,MAAIC,UAAU,YACZH,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACE4B,QAAS,WACPxC,EAAUrO,EAAYM,SAExB4O,UAAW+B,IAAW,SAAU,CAC9B1M,OAAQzD,IAAWd,EAAYM,UALnC,WAYFyO,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACE4B,QAAS,WACPxC,EAAUrO,EAAYO,MAExB2O,UAAW+B,IAAW,SAAU,CAC9B1M,OAAQzD,IAAWd,EAAYO,OALnC,UAcNwO,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACE4B,QAAS,WACPxC,EAAUrO,EAAYU,SAExBwO,UAAW+B,IAAW,SAAU,CAC9B1M,OAAQgmC,KAGVx7B,EAAAC,EAAAC,cAAA,QAAMC,UAAU,QAAQq7B,EAAgBzpC,EAAS,SACjDiO,EAAAC,EAAAC,cAAA,QAAMC,UAAU,OAAOq7B,EAAgBzpC,EAAS,OAChDiO,EAAAC,EAAAC,cAAA,QAAMC,UAAU,SACbq7B,EAAgBzpC,EAAOk1B,UAAU,EAAG,GAAK,OAG9CjnB,EAAAC,EAAAC,cAAA,MAAIC,UAAU,YACZH,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACE4B,QAAS,WACPxC,EAAUrO,EAAYU,SAExBwO,UAAW+B,IAAW,SAAU,CAC9B1M,OAAQzD,IAAWd,EAAYU,UALnC,WAYFqO,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACE4B,QAAS,WACPxC,EAAUrO,EAAYS,QAExByO,UAAW+B,IAAW,SAAU,CAC9B1M,OAAQzD,IAAWd,EAAYS,SALnC,UAYFsO,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACE4B,QAAS,WACPxC,EAAUrO,EAAYQ,OAExB0O,UAAW+B,IAAW,SAAU,CAC9B1M,OAAQzD,IAAWd,EAAYQ,QALnC,WAcNuO,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACE4B,QAAS,WACPxC,EAAUrO,EAAYI,OAExB8O,UAAW+B,IAAW,SAAU,CAC9B1M,OAAQzD,IAAWd,EAAYI,QAGjC2O,EAAAC,EAAAC,cAAA,QAAMC,UAAU,QAAhB,QACAH,EAAAC,EAAAC,cAAA,QAAMC,UAAU,OACbpO,IAAWd,EAAYI,KAAO,OAAS,OAE1C2O,EAAAC,EAAAC,cAAA,QAAMC,UAAU,SACbpO,IAAWd,EAAYI,KAAO,OAAS,QAK9C2O,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACE4B,QAAS,WACPxC,EAAUrO,EAAYW,QAExBuO,UAAW+B,IAAW,SAAU,CAC9B1M,OAAQzD,IAAWd,EAAYW,SAGjCoO,EAAAC,EAAAC,cAAA,QAAMC,UAAU,QAAhB,SACAH,EAAAC,EAAAC,cAAA,QAAMC,UAAU,OACbpO,IAAWd,EAAYW,MAAQ,QAAU,OAE5CoO,EAAAC,EAAAC,cAAA,QAAMC,UAAU,SACbpO,IAAWd,EAAYW,MAAQ,QAAU,QAKhDoO,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACE4B,QAAS,WACPxC,EAAUrO,EAAYG,MAExB+O,UAAW+B,IAAW,SAAU,CAC9B1M,OAAQzD,IAAWd,EAAYG,OAGjC4O,EAAAC,EAAAC,cAAA,QAAMC,UAAU,QAAhB,OACAH,EAAAC,EAAAC,cAAA,QAAMC,UAAU,OAAhB,OACAH,EAAAC,EAAAC,cAAA,QAAMC,UAAU,SACbpO,IAAWd,EAAYG,IAAM,MAAQ,QAK5C4O,EAAAC,EAAAC,cAAA,MACEC,UAAW+B,IAAW,CACpBkZ,KAAMrpB,IAAWd,EAAYG,OAG/B4O,EAAAC,EAAAC,cAAA,UAAQ4B,QAASk5B,EAAa76B,UAAU,UACtCH,EAAAC,EAAAC,cAAA,QAAMC,UAAU,QAAQ3J,EAAQ,GAAK,KAArC,QACAwJ,EAAAC,EAAAC,cAAA,QAAMC,UAAU,OAAO3J,EAAQ,GAAK,KAApC,QACAwJ,EAAAC,EAAAC,cAAA,QAAMC,UAAU,SAAS3J,EAAQ,GAAK,KAAtC,WAINwJ,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACEF,EAAAC,EAAAC,cAAA,UACEC,UAAW+B,IAAW,SAAU,QAAS,CACvCs2B,cAAez4B,KAGjBC,EAAAC,EAAAC,cAAA,+BA3sBKE,aAotBJC,eA5xBS,SAAAnH,GAAA,IACtBlE,EADsBkE,EACtBlE,cACAI,EAFsB8D,EAEtB9D,KACAC,EAHsB6D,EAGtB7D,KACAO,EAJsBsD,EAItBtD,QACAC,EALsBqD,EAKtBrD,IACAC,EANsBoD,EAMtBpD,QACAC,EAPsBmD,EAOtBnD,OACAC,EARsBkD,EAQtBlD,MACAN,EATsBwD,EAStBxD,MACAe,EAVsByC,EAUtBzC,SACA1E,EAXsBmH,EAWtBnH,OACA4D,EAZsBuD,EAYtBvD,WACAa,EAbsB0C,EAatB1C,MAbsB,MAcjB,CACLxB,gBACAjD,SACAqD,OACAC,OACAO,UACAC,MACAC,UACAC,SACAC,QACAN,QACAqK,WAAY3K,EAAK2K,YAAcrK,EAAMqK,YAActJ,EACnDd,aACAa,UAGyB,SAAAuG,GAAQ,MAAK,CACtC+8B,oBAAqB,kBAAM/8B,EAASP,EAAQs9B,wBAC5CW,WAAY,kBAAM19B,EAASP,EAAQi+B,eACnC3wB,WAAY,SAAAzP,GAAG,OAAI0C,EAASP,EAAQsN,WAAWzP,KAC/C2gC,YAAa,kBAAMj+B,EAASP,EAAQw+B,gBACpCtB,gBAAiB,kBAAM38B,EAASP,EAAQk9B,oBACxCD,WAAY,SAAA/jC,GAAK,OAAIqH,GzDkHGilB,EyDlHiBtsB,EzDkHT,SAAAqH,GAGhC,OAFAA,EAASP,EAAQq/B,gBAEVr8B,OACJe,MADI,GAAAlJ,OACKmJ,iCADL,kBAAAnJ,OACyD2qB,IAC7DxjB,KACC,SAAAC,GAAQ,OAAIA,EAASgC,QACrB,SAAAtH,GAAK,OAAIF,EAAW,CAAEE,QAAOC,QAAS,mCAEvCoF,KAAK,SAAAkjB,GAAe,IAAZhsB,EAAYgsB,EAAZhsB,MAGP,OAFW,IAAIwH,IAAO,CAAExH,UAGrBomC,UACAC,aACAv9B,KACC,SAAAC,GAAQ,MAAK,CACX/I,QACAiJ,KAAMF,EAASxG,OAEjB,SAAAkB,GAAK,OACHF,EAAW,CACTE,QACAC,QAAS,+DAIlBoF,KAAK,SAAAiC,GAAI,OAAI1D,EAASP,EAAQw/B,aAAav7B,SA3BtB,IAAAuhB,GyDjHxB6G,QAAS,SAAA92B,GAAM,OAAIgL,EAASP,EAAQqsB,QAAQ92B,KAC5C2oC,WAAY,SAAAv+B,GAAA,IAAGwC,EAAHxC,EAAGwC,KAAMvJ,EAAT+G,EAAS/G,KAAMy+B,EAAf13B,EAAe03B,MAAOrxB,EAAtBrG,EAAsBqG,MAAOyyB,EAA7B94B,EAA6B84B,OAAQzB,EAArCr3B,EAAqCq3B,UAAW99B,EAAhDyG,EAAgDzG,MAAhD,OACVqH,EzD4CsB,SAAAT,GAAA,IACxBqC,EADwBrC,EACxBqC,KACAvJ,EAFwBkH,EAExBlH,KACAy+B,EAHwBv3B,EAGxBu3B,MACArxB,EAJwBlG,EAIxBkG,MACAyyB,EALwB34B,EAKxB24B,OACAzB,EANwBl3B,EAMxBk3B,UACA99B,EAPwB4G,EAOxB5G,MAPwB,OAQpB,SAAAqH,GAGJ,OAFAA,EAASP,EAAQ+4B,yBAEV/1B,OACJe,MADI,GAAAlJ,OACKmJ,wCADL,aAC2C,CAC9Co0B,OAAQ,OACRC,KAAM38B,KAAKG,UAAU,CACnBsG,OACAvJ,OACAy+B,QACArxB,QACAyyB,SACAzB,YACA99B,MAAOA,EAAMqD,UAGhByF,KACC,SAAAC,GAAQ,OAAIA,EAASgC,QACrB,SAAAtH,GAAK,OACHF,EAAW,CACTE,QACAC,QAAO,mDAGZoF,KAAK,kBAAMzB,EAASP,EAAQg5B,2BAC5Bh3B,KAAK,kBAAMzB,EAASP,EAAQ8C,UAAUrO,EAAYW,WyD5EjD8oC,CAAW,CAAE/7B,OAAMvJ,OAAMy+B,QAAOrxB,QAAOyyB,SAAQzB,YAAW99B,YAE9DkH,SAAU,SAAAR,GAAA,IACRpH,EADQoH,EACRpH,cACAK,EAFQ+G,EAER/G,KACAK,EAHQ0G,EAGR1G,MACAN,EAJQgH,EAIRhH,KACAQ,EALQwG,EAKRxG,QACAC,EANQuG,EAMRvG,IACAC,EAPQsG,EAORtG,QACAC,EARQqG,EAQRrG,OACAC,EATQoG,EASRpG,MACA8G,EAVQV,EAURU,OAVQ,OAYRC,EACEH,EAAS,CACP5H,gBACAK,OACAK,QACAN,OACAQ,UACAC,MACAC,UACAC,SACAC,QACA8G,aAGN+9B,cAAe,SAAAllC,GAAU,OAAIoH,EAASP,EAAQq+B,cAAcllC,KAC5D2J,UAAW,SAAAvN,GAAM,OAAIgL,EAASP,EAAQ8C,UAAUvN,OAutBnCsO,CAA6Cy4B,IC3yB7CmD,GAfA,SAAA/iC,GAAA,IAAGnE,EAAHmE,EAAGnE,SAAH,OACbiL,EAAAC,EAAAC,cAAA,OACEC,UAAW+B,IAAW,SAAU,CAC9Bg6B,MAAOnnC,KAGTiL,EAAAC,EAAAC,cAACi8B,GAAD,MACAn8B,EAAAC,EAAAC,cAACk8B,GAAD,QCsBWC,eAhCb,SAAAA,EAAaj9B,GAAO,IAAA0B,EAAA,OAAAhH,OAAAiH,EAAA,EAAAjH,CAAAqF,KAAAk9B,IAClBv7B,EAAAhH,OAAAkH,EAAA,EAAAlH,CAAAqF,KAAArF,OAAAmH,EAAA,EAAAnH,CAAAuiC,GAAAn7B,KAAA/B,KAAMC,KACDrD,MAAQ,CAAEugC,UAAU,GAFPx7B,iFAKD3H,EAAOojC,GACxBp9B,KAAKsK,SAAS,CACZtQ,QACAojC,+CAIM,IAAArxB,EACqB/L,KAAKpD,MAA1B5C,EADA+R,EACA/R,MAAOojC,EADPrxB,EACOqxB,UACf,OAAIA,EAGAv8B,EAAAC,EAAAC,cAAA,OAAKC,UAAU,iBACbH,EAAAC,EAAAC,cAAA,mCACAF,EAAAC,EAAAC,cAAA,WAASkuB,MAAO,CAAEoO,WAAY,aAC3BrjC,GAASA,EAAM+C,WAChB8D,EAAAC,EAAAC,cAAA,WACCq8B,EAAUE,iBAMZt9B,KAAKC,MAAMs9B,gBA7BMt8B,oBC8B5B2K,QAAQY,IAAIzT,KAAKG,UAAL,kBAAAhB,OAAiCpC,KAAW,KAAM,IAE9D,2CAsBM0nC,GAAmB,SAAAv9B,GAAS,IACxBhK,EAAgBgK,EAAhBhK,KAAMM,EAAU0J,EAAV1J,MAGR4O,EAAY/M,IAAEa,IAAIhD,EAAM,mBAAoB,MAG5CmP,EAAehN,IAAEa,IAAI1C,EAAO,aAAc,MAG1C4lC,EAAS/2B,GAAgBA,IAAiBD,EAG1CyxB,EAAex+B,IAAEy+B,WACrBF,GAAQjgC,IAAI,SAAAgD,GAAC,OAAIA,EAAEuE,KACnBgC,EAAMlJ,kBAGR,OAAOolC,GAAUvF,EAAa7jC,QAG1B6tB,IAAO6c,GAAA,GAAA9iC,OAAAyB,EAAA,EAAAzB,CAAA8iC,GACV3rC,EAAYC,KAAO,kBAAM8O,EAAAC,EAAAC,cAAC28B,EAAD,QADf/iC,OAAAyB,EAAA,EAAAzB,CAAA8iC,GAEV3rC,EAAYE,KAAO,kBAAM6O,EAAAC,EAAAC,cAAC48B,GAAD,QAFfhjC,OAAAyB,EAAA,EAAAzB,CAAA8iC,GAGV3rC,EAAYM,OAAS,kBAAMyO,EAAAC,EAAAC,cAAC68B,GAAD,QAHjBjjC,OAAAyB,EAAA,EAAAzB,CAAA8iC,GAIV3rC,EAAYO,IAAM,kBAAMwO,EAAAC,EAAAC,cAAC88B,GAAD,QAJdljC,OAAAyB,EAAA,EAAAzB,CAAA8iC,GAKV3rC,EAAYU,OAAS,kBAAMqO,EAAAC,EAAAC,cAAC+8B,GAAD,QALjBnjC,OAAAyB,EAAA,EAAAzB,CAAA8iC,GAMV3rC,EAAYS,MAAQ,kBAAMsO,EAAAC,EAAAC,cAACg9B,GAAD,QANhBpjC,OAAAyB,EAAA,EAAAzB,CAAA8iC,GAOV3rC,EAAYQ,KAAO,kBAAMuO,EAAAC,EAAAC,cAACi9B,GAAD,QAPfrjC,OAAAyB,EAAA,EAAAzB,CAAA8iC,GAQV3rC,EAAYG,IAAM,kBAAM,OARd0I,OAAAyB,EAAA,EAAAzB,CAAA8iC,GASV3rC,EAAYK,KAAO,kBAAM0O,EAAAC,EAAAC,cAACk9B,GAAD,QATftjC,OAAAyB,EAAA,EAAAzB,CAAA8iC,GAUV3rC,EAAYI,KAAO,kBAAM2O,EAAAC,EAAAC,cAACm9B,GAAD,QAVfvjC,OAAAyB,EAAA,EAAAzB,CAAA8iC,GAWV3rC,EAAYW,MAAQ,kBAAMoO,EAAAC,EAAAC,cAACo9B,GAAD,QAXhBV,IAcPW,eACJ,SAAAA,EAAYn+B,GAAO,IAAA0B,EAAA,OAAAhH,OAAAiH,EAAA,EAAAjH,CAAAqF,KAAAo+B,IACjBz8B,EAAAhH,OAAAkH,EAAA,EAAAlH,CAAAqF,KAAArF,OAAAmH,EAAA,EAAAnH,CAAAyjC,GAAAr8B,KAAA/B,KAAMC,KACDo+B,gBAAkBC,IAAMC,YAC7B58B,EAAK68B,WAAa,KAClB78B,EAAK88B,iBAAmB,SAAAl0B,GACtB5I,EAAK68B,WAAaj0B,GALH5I,oFAWjB,GAAI3B,KAAKq+B,iBAAmBr+B,KAAKq+B,gBAAgB3mB,QAAS,KAChDgnB,EAAiB1+B,KAAKq+B,gBAAgB3mB,QAAtCgnB,aACR1+B,KAAKw+B,WAAWvP,MAAM0P,cAAtB,GAAAzmC,OAAyCwmC,EAAzC,WAEA1+B,KAAKw+B,WAAWvP,MAAM0P,cAAgB,IAGrBnB,GAAiBx9B,KAAKC,OAGvCoG,SAASqvB,KAAKxH,UAAU3G,IAAI,mBAE5BlhB,SAASqvB,KAAKxH,UAAUY,OAAO,oDAI1B,IAAA/uB,EAC6CC,KAAKC,MAAjDrN,EADDmN,EACCnN,OAAQwE,EADT2I,EACS3I,SAAUxB,EADnBmK,EACmBnK,SAAUW,EAD7BwJ,EAC6BxJ,MAAON,EADpC8J,EACoC9J,KAErCs/B,EAASn9B,IAAEa,IAAIhD,EAAM,UAAW,MAChC2oC,EAAapB,GAAiBx9B,KAAKC,OAEzC,OACEY,EAAAC,EAAAC,cAAC89B,GAAD,KACEh+B,EAAAC,EAAAC,cAAA,OACEuL,IAAKtM,KAAKy+B,iBACVz9B,UAAW+B,IAAW,MAAD,OAAA7K,OAAetF,GAAU,CAC5CksC,cAAelyB,IACb,CAAC9a,EAAYC,KAAMD,EAAYK,MAC/BS,MAIJiO,EAAAC,EAAAC,cAACg+B,GAAD,CAAQnpC,SAAUA,IACjBgrB,GAAQhuB,KACTiO,EAAAC,EAAAC,cAACi+B,GAAD,MACC5nC,EACCyJ,EAAAC,EAAAC,cAACk+B,GAAD,CACEj+B,UAAW+B,IAAW,CACpBm8B,SAAUtsC,IAAWd,EAAYG,MAEnC23B,YAAa5pB,KAAKq+B,kBAElB,KACHO,EAAa/9B,EAAAC,EAAAC,cAACo+B,GAAD,MAAa,KAC1BvsC,IAAWd,EAAYG,KAAOsjC,GAC7B10B,EAAAC,EAAAC,cAACq+B,GAAD,CAAU7J,OAAQA,EAAQh/B,MAAOA,aA1D3B0K,aAkEHC,eA3HS,SAAAnH,GAAA,MAOjB,CACL9D,KARsB8D,EACtB9D,KAQArD,OATsBmH,EAEtBnH,OAQAwE,SAVsB2C,EAGtB3C,SAQAL,iBAXsBgD,EAItBhD,iBAQAR,MAZsBwD,EAKtBxD,MAQAX,SAbsBmE,EAMtBnE,WAUyB,iBAAO,IA2GnBsL,CAA6Ck9B,uBCzH7CxrC,GA7BA8J,YAAc/B,OAAAyB,EAAA,EAAAzB,CAAA,GAExB1H,EAAYQ,WAAa,SAACmJ,EAAOC,GAqBhC,OAnBE+P,IACE,CACE9a,EAAYU,OACZV,EAAYS,MACZT,EAAYQ,KACZR,EAAYG,KAEd4K,EAAOC,UAIP0iB,IACAA,YACAA,WAAa5iB,OACU,YAAvB4iB,WAAa5iB,OAEb4iB,WAGG3iB,EAAOC,UAGlBnH,EAAa/C,QCPAqD,GAtBFyG,aAAa2iC,GAAA,GAAA1kC,OAAAyB,EAAA,EAAAzB,CAAC0kC,GAEtBpsC,EAAYa,SAAW,cAFF6G,OAAAyB,EAAA,EAAAzB,CAAC0kC,GAGtBpsC,EAAYS,mBAAqB,iBAAO,CACvCkN,YAAY,KAJQjG,OAAAyB,EAAA,EAAAzB,CAAC0kC,GAMtBpsC,EAAYU,mBAAqB,SAACiJ,EAAOC,GAAR,MAAoB,CACpD+D,YAAY,EACZ9H,KAAM+D,EAAOC,WAROnC,OAAAyB,EAAA,EAAAzB,CAAC0kC,GAUtBpsC,EAAYkB,kBAAoB,SAAAyI,GAAK,MAAK,CACzC9D,KAAM8D,EAAM9D,KACZ8H,YAAY,KAZQjG,OAAAyB,EAAA,EAAAzB,CAAC0kC,GActBpsC,EAAYmB,kBAAoB,SAACwI,EAAOC,GAAR,MAAoB,CACnD+D,YAAY,EACZ9H,KAAM+D,EAAOC,WAhBOuiC,IAmBxB1pC,EAAaM,MCZAD,GAPA0G,YAAc/B,OAAAyB,EAAA,EAAAzB,CAAA,GAExB1H,EAAYW,YAAc,SAACgJ,EAAOC,GAAR,OAAmB,IAEhDlH,EAAaK,QCUAO,GAdDmG,aAAa4iC,GAAA,GAAA3kC,OAAAyB,EAAA,EAAAzB,CAAC2kC,GAEvBrsC,EAAYI,YAAc,kBAAMsC,EAAaY,QAFvBoE,OAAAyB,EAAA,EAAAzB,CAAC2kC,GAGvBrsC,EAAYc,cAAgB,iBAAO,CAClC6M,YAAY,KAJSjG,OAAAyB,EAAA,EAAAzB,CAAC2kC,GAMvBrsC,EAAYe,cAAgB,SAAC4I,EAAOC,GAAR,MAAoB,CAC/CjD,MAAOiD,EAAOC,QAAQvG,MACtBiJ,KAAM3C,EAAOC,QAAQ0C,QARA8/B,IAWzB3pC,EAAaY,OCHAC,GARIkG,aAAa6iC,GAAA,GAAA5kC,OAAAyB,EAAA,EAAAzB,CAAC4kC,GAE5BtsC,EAAYgB,gBAAkB,SAAC2I,EAAOC,GAAR,OAAmBA,EAAOC,UAF7BnC,OAAAyB,EAAA,EAAAzB,CAAC4kC,GAG5BtsC,EAAYiB,kBAAoB,kBAAM,OAHXqrC,IAK9B5pC,EAAaa,YCgBAC,GAnBCiG,aAAa8iC,GAAA,GAAA7kC,OAAAyB,EAAA,EAAAzB,CAAC6kC,GAEzBvsC,EAAYa,SAAW,kBAAM6B,EAAac,UAFlBkE,OAAAyB,EAAA,EAAAzB,CAAC6kC,GAGzBvsC,EAAYU,mBAAqB,SAACiJ,EAAOC,GAAR,OAChCsH,GAAmBtH,EAAOC,WAJHnC,OAAAyB,EAAA,EAAAzB,CAAC6kC,GAKzBvsC,EAAYqB,cAAgB,SAACsI,EAAD7C,GAAwB,IAAd+C,EAAc/C,EAAd+C,QAC7BuX,EAAWvX,EAAXuX,OACR,OAAOlb,IAAUwB,OAAAwB,EAAA,EAAAxB,CAAA,GACZiC,EADWjC,OAAAyB,EAAA,EAAAzB,CAAA,GAEbmC,EAAQjK,MACPwhB,GAAUA,EAAO7a,MAAM,EAAG,GAAGmC,OAAO,SAAAjC,GAAC,MAAU,aAANA,IAAkB3G,OACvDshB,EACA,UAZemrB,IAgB3B7pC,EAAac,SCPAC,GAVHgG,aAAa+iC,GAAA,GAAA9kC,OAAAyB,EAAA,EAAAzB,CAAC8kC,GAErBxsC,EAAYa,SAAW,kBAAM6B,EAAae,MAFtBiE,OAAAyB,EAAA,EAAAzB,CAAC8kC,GAGrBxsC,EAAYU,mBAAqB,SAACiJ,EAAOC,GAAR,OAChCqH,GAAerH,EAAOC,WAJHnC,OAAAyB,EAAA,EAAAzB,CAAC8kC,GAKrBxsC,EAAYsB,WAAa,SAACqI,EAAOC,GAAR,OAAmBA,EAAOC,UAL/B2iC,IAOvB9pC,EAAae,KCgBAC,GArBC+F,aAAagjC,GAAA,GAAA/kC,OAAAyB,EAAA,EAAAzB,CAAC+kC,GAEzBzsC,EAAYa,SAAW,kBAAM6B,EAAagB,UAFlBgE,OAAAyB,EAAA,EAAAzB,CAAC+kC,GAGzBzsC,EAAYU,mBAAqB,SAACiJ,EAAOC,GAAR,OAChChE,EAAmBgE,EAAOC,WAJHnC,OAAAyB,EAAA,EAAAzB,CAAC+kC,GAKzBzsC,EAAYuB,cAAgB,SAACoI,EAAD7C,GAAwB,IAAd+C,EAAc/C,EAAd+C,QAC7BjK,EAAkBiK,EAAlBjK,MAAOoE,EAAW6F,EAAX7F,OACf,OAAOkC,IAAUwB,OAAAwB,EAAA,EAAAxB,CAAA,GACZiC,EADWjC,OAAAyB,EAAA,EAAAzB,CAAA,GAEb9H,EACCoE,IACCmB,IAAEyB,QAAQ5C,EAAOM,QAClBoD,OAAO+b,OAAOzf,EAAOM,OAAOoE,OAAO,SAAAjC,GAAC,OAAKtB,IAAEO,MAAMe,KAAI3G,OACjDkE,EACA,UAdeyoC,IAkB3B/pC,EAAagB,SCLAC,GAdA8F,aAAaijC,GAAA,GAAAhlC,OAAAyB,EAAA,EAAAzB,CAACglC,GAExB1sC,EAAYa,SAAW,kBAAM6B,EAAaiB,SAFnB+D,OAAAyB,EAAA,EAAAzB,CAACglC,GAGxB1sC,EAAYU,mBAAqB,SAACiJ,EAAOC,GAAR,OAChCuH,GAAkBvH,EAAOC,WAJHnC,OAAAyB,EAAA,EAAAzB,CAACglC,GAKxB1sC,EAAYwB,aAAe,SAACmI,EAAD7C,GAAA,IAAU+C,EAAV/C,EAAU+C,QAAV,OAC1B3D,IAAUwB,OAAAwB,EAAA,EAAAxB,CAAA,GACLiC,EADIjC,OAAAyB,EAAA,EAAAzB,CAAA,GAENmC,EAAQjK,MAAQiK,EAAQ5F,WARLyoC,IAW1BhqC,EAAaiB,QCGAC,GAdD6F,aAAakjC,GAAA,GAAAjlC,OAAAyB,EAAA,EAAAzB,CAACilC,GAEvB3sC,EAAYa,SAAW,kBAAM6B,EAAakB,QAFpB8D,OAAAyB,EAAA,EAAAzB,CAACilC,GAGvB3sC,EAAYU,mBAAqB,SAACiJ,EAAOC,GAAR,OAChCwH,GAAiBxH,EAAOC,WAJHnC,OAAAyB,EAAA,EAAAzB,CAACilC,GAKvB3sC,EAAYyB,YAAc,SAACkI,EAAD7C,GAAA,IAAU+C,EAAV/C,EAAU+C,QAAV,OACzB3D,IAAUwB,OAAAwB,EAAA,EAAAxB,CAAA,GACLiC,EADIjC,OAAAyB,EAAA,EAAAzB,CAAA,GAENmC,EAAQjK,MAAQiK,EAAQ3F,UARNyoC,IAWzBjqC,EAAakB,OCLAO,GAREsF,aAAamjC,GAAA,GAAAllC,OAAAyB,EAAA,EAAAzB,CAACklC,GAE1B5sC,EAAY2B,eAAiB,kBAAM,OAFV+F,OAAAyB,EAAA,EAAAzB,CAACklC,GAG1B5sC,EAAY0B,mBAAqB,SAACiI,EAAOC,GAAR,OAAmBA,EAAOC,UAHlC+iC,IAK5BlqC,EAAayB,UCEAC,GAPDqF,YAAc/B,OAAAyB,EAAA,EAAAzB,CAAA,GAEvB1H,EAAYM,aAAe,SAACqJ,EAAOC,GAAR,OAAoBD,IAElDjH,EAAa0B,OCQAC,GAZEoF,aAAaojC,GAAA,GAAAnlC,OAAAyB,EAAA,EAAAzB,CAACmlC,GAE1B7sC,EAAY8B,0BAA4B,kBAAM,IAFrB4F,OAAAyB,EAAA,EAAAzB,CAACmlC,GAG1B7sC,EAAY+B,0BAA4B,kBAAM,IAHrB2F,OAAAyB,EAAA,EAAAzB,CAACmlC,GAI1B7sC,EAAY4B,wBAA0B,kBAAM,IAJnB8F,OAAAyB,EAAA,EAAAzB,CAACmlC,GAK1B7sC,EAAY6B,wBAA0B,kBAAM,IALnB6F,OAAAyB,EAAA,EAAAzB,CAACmlC,GAM1B7sC,EAAYgC,uBAAyB,kBAAM,IANlB0F,OAAAyB,EAAA,EAAAzB,CAACmlC,GAO1B7sC,EAAYiC,uBAAyB,kBAAM,IAPlB4qC,IAS5BnqC,EAAa2B,UCEAR,GAXM4F,aAAaqjC,GAAA,GAAAplC,OAAAyB,EAAA,EAAAzB,CAAColC,GAE9B9sC,EAAYa,SAAW,kBAAM6B,EAAamB,eAFb6D,OAAAyB,EAAA,EAAAzB,CAAColC,GAG9B9sC,EAAYsC,eAAiB,SAACqH,EAAD7C,GAAA,IAAU+C,EAAV/C,EAAU+C,QAAV,OAAAnC,OAAAwB,EAAA,EAAAxB,CAAA,GACzBiC,EADyBjC,OAAAyB,EAAA,EAAAzB,CAAA,GAE3BmC,EAAQjK,MAAQiK,EAAQszB,YALG2P,IAQhCpqC,EAAamB,cCDAC,GAPU2F,YAAc/B,OAAAyB,EAAA,EAAAzB,CAAA,GAElC1H,EAAYO,gBAAkB,SAACoJ,EAAD7C,GAAA,IAAU+C,EAAV/C,EAAU+C,QAAV,OAAAnC,OAAAC,EAAA,EAAAD,CAA4BmC,KAE7DnH,EAAaoB,kBCKAC,GATI0F,YAAc/B,OAAAyB,EAAA,EAAAzB,CAAA,GAE5B1H,EAAYK,UAAY,SAACsJ,EAAD7C,GAAA,IAAU+C,EAAV/C,EAAU+C,QAAV,OAAAnC,OAAAwB,EAAA,EAAAxB,CAAA,GACpBmC,KAGPnH,EAAaqB,YCCAjB,GAPG2G,YAAc/B,OAAAyB,EAAA,EAAAzB,CAAA,GAE3B1H,EAAYG,eAAiB,SAACwJ,EAAOC,GAAR,OAAmBA,EAAOC,UAE1DnH,EAAaI,WCOAF,GAVO6G,aAAasjC,GAAA,GAAArlC,OAAAyB,EAAA,EAAAzB,CAACqlC,GAE/B/sC,EAAYE,sBAAwB,kBAAMwC,EAAaE,gBAFzB8E,OAAAyB,EAAA,EAAAzB,CAACqlC,GAG/B/sC,EAAYa,SAAW,kBAAM6B,EAAaE,gBAHZ8E,OAAAyB,EAAA,EAAAzB,CAACqlC,GAI/B/sC,EAAYU,mBAAqB,SAACiJ,EAAOC,GAAR,OAChCyH,GAAuBzH,EAAOC,WALDkjC,IAOjCrqC,EAAaE,eCQAD,GAdE8G,aAAaujC,GAAA,GAAAtlC,OAAAyB,EAAA,EAAAzB,CAACslC,GAE1BhtC,EAAYC,YAAc,SAAC0J,EAAOC,GAAR,OAAoBD,IAFrBjC,OAAAyB,EAAA,EAAAzB,CAACslC,GAG1BhtC,EAAYQ,WAAa,SAACmJ,EAAOC,GAChC,QAAK+P,IAAS,CAAC9a,EAAYC,KAAMD,EAAYG,KAAM4K,EAAOC,UAGjDF,IAPeqjC,IAW5BtqC,EAAaC,UC4BAsqC,GAvBCC,aAAgB,CAC9BvqC,YACAC,iBACAE,aACAnD,UACAqD,QACAD,UACAO,SACAL,OACAM,cACAC,WACAC,OACAC,WACAC,UACAC,SACAO,YACAC,SACAC,YACAR,gBACAC,oBACAC,gBCpCIopC,GCJY,WAChB,IACE,IAAMC,EAAkBC,aAAaC,QAJ7B,cAKR,GAAwB,OAApBF,EACF,OAEF,OAAOtnC,KAAKC,MAAMqnC,GAClB,MAAOrmC,GACP,QDJmBwmC,GAEjBC,GAAmBpgC,OAAOqgC,sCAAwCC,KAElEC,GAAQC,aACZX,GACAE,GACAK,GAAiBK,aAAgBC,QAOnCH,GAAMI,UAAU,YCNE,SAAApkC,GAChB,IACE,IAAMyjC,EAAkBtnC,KAAKG,UAAU0D,GACvC0jC,aAAaW,QAjBL,aAiBkBZ,GAC1B,MAAOrmC,GACP4R,QAAQ5R,MAAMA,IDEhBknC,CAAU,CACR3qC,MAAOqqC,GAAMO,WAAW5qC,MACxBQ,iBAAkB6pC,GAAMO,WAAWpqC,qBAIxB6pC,UErBfvgC,OAAO+5B,QAAU/5B,OAAO+5B,SAAW,GAEnCgH,iBACEvgC,EAAAC,EAAAC,cAACsgC,EAAA,EAAD,CAAUT,MAAOA,IACf//B,EAAAC,EAAAC,cAACugC,GAAD,OAEFj7B,SAASk7B,eAAe","file":"static/js/main.ba086089.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAlAAAAAoCAIAAAC+blOXAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpBQTRCNkU3RDBEOTExMUU5Qjk3MkFERTEyRkI4RjBCQSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpBQTRCNkU3RTBEOTExMUU5Qjk3MkFERTEyRkI4RjBCQSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkFBNEI2RTdCMEQ5MTExRTlCOTcyQURFMTJGQjhGMEJBIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkFBNEI2RTdDMEQ5MTExRTlCOTcyQURFMTJGQjhGMEJBIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+HvluxAAAAUhJREFUeNrs3TFOQkEQgGEwL7RIaAxHsJDiWXsZzsVJ6Kx5hRYcwdAQpDKhorGE4pFZ1sHvKzGZLFL82WKyw5/NahBh8rY4+/n+fWn+Hc8vLfv5a4n6v3VdFzJn87kPmbPdHUPmrL9izvNx+A6ZMx8/hsx5nU1C5jxNRyFznl9iztO2bcichwEA/AOCB4DgAYDgAYDgAYDgAYDgAUAJzaU/lN5bqjW/735S3zlR3yv7+UsrvXcIuOEBgOABgOABgOABgOABgOABgOABwK+Le3hR+161ZN8zy7JPVuu9Ovt2gBseAAgeAIIHAIIHAIIHAIIHAIIHADfS3Ov+U/Z34LK/S/fXfl8ANzwABA8ABA8ABA8ABA8ABA8ABA8ArtTU2lvK8t5e33Nmf4cvC/t2gBseAAgeAIIHAIIHAIIHAIIHAIIHADdyEmAARD5eRI/K+WsAAAAASUVORK5CYII=\"","module.exports = __webpack_public_path__ + \"static/media/loshermanosbros-lite.c3b13663.gif\";","module.exports = __webpack_public_path__ + \"static/media/breakout-lite.a4d778a2.gif\";","module.exports = __webpack_public_path__ + \"static/media/brospipe-lite.82f3b93a.gif\";","module.exports = __webpack_public_path__ + \"static/media/livecoding480.20d1866a.gif\";","module.exports = __webpack_public_path__ + \"static/media/slider480.dc4d8c4b.gif\";","module.exports = __webpack_public_path__ + \"static/media/pauserewind.741e69fa.gif\";","module.exports = __webpack_public_path__ + \"static/media/toggle.4ab6d6b6.gif\";","module.exports = __webpack_public_path__ + \"static/media/spritedemo.76159464.gif\";","module.exports = __webpack_public_path__ + \"static/media/mapdemo.23680514.gif\";","module.exports = __webpack_public_path__ + \"static/media/musicdemo.c1b0f3bd.gif\";","import clamp from 'lodash/clamp'\nimport { shouldHighlight } from './frameBufferCanvasAPI/index'\n\n// Lookup table for triplet arrays containing R, G, and B values.\nconst triplets = [\n  [246, 214, 189],\n  [195, 163, 138],\n  [153, 117, 119],\n  [129, 98, 113],\n  [78, 73, 95],\n  [32, 57, 79],\n  [15, 42, 63],\n  [8, 20, 30]\n]\n\n// Lookup table for the css color strings.\nconst rgbStrings = triplets.map(([r, g, b]) => `rgb(${r},${g},${b})`)\n\n// Lookup tree for the combined integer representation of each color.\nlet intLookup = []\n\n// Loops over each of the color indexes, looks up associated color triplet, and\n// calculates the equivalent integer representation by bit shifting each byte\n// into the correct position.\nfor (let i = 0; i < 8; i++) {\n  let values = triplets[i]\n\n  // Shift each byte into the correct integer position.\n  let possiblyNegativeInteger =\n    (255 << 24) | // Alpha byte\n    (values[2] << 16) | // B byte\n    (values[1] << 8) | // G byte\n    values[0] // R byte\n\n  // Set the positive version of the above calculated integer into the lookup\n  // table. A bitwise right shift of 0 places forces the number to be\n  // interpreted as a positive integer.\n  intLookup[i] = possiblyNegativeInteger >>> 0\n\n  // For example, intLookup[0] = 4290631414.\n}\n\n// The opposite of the intLookup. Each index is the color integer, and the value\n// is the SCRIPT-8 integer color.\nconst reverseIntLookup = {}\nfor (let i = 0; i < 8; i++) {\n  reverseIntLookup[intLookup[i]] = i\n}\n\nconst colors = {\n  rgb(i) {\n    return rgbStrings[i % rgbStrings.length]\n  },\n\n  triplet(i) {\n    return triplets[i % triplets.length]\n  },\n\n  int(i) {\n    let index = i % intLookup.length;\n    // `shouldHighlight` is injected in the use code when the current call is under the mouse. If it is true, all colors\n    // drawn are brightened by 2 steps if they can be, or darkened by two steps if they are already too bright\n    if (shouldHighlight) {\n      if (index > 2) index = clamp(+index - 2, 0, 7)\n      else index += 2\n    }\n    return intLookup[index]\n  },\n\n  // Looks up the integer value in the reverseIntLookup table. If it doesn't\n  // exist, then the background color of 7 is returned instead.\n  lookupInt(int) {\n    if (int in reverseIntLookup) {\n      return reverseIntLookup[int]\n    }\n    return 7\n  }\n}\n\nexport default colors\n","const screenTypes = {\n  BOOT: 'BOOT',\n  HOME: 'HOME',\n  RUN: 'RUN',\n  HELP: 'HELP',\n  CODE: 'CODE',\n  SPRITE: 'SPRITE',\n  MAP: 'MAP',\n  SONG: 'SONG',\n  CHAIN: 'CHAIN',\n  PHRASE: 'PHRASE',\n  SHELF: 'SHELF'\n}\n\nconst cycleOrder = [\n  screenTypes.HOME,\n  screenTypes.CODE,\n  screenTypes.SPRITE,\n  screenTypes.MAP,\n  screenTypes.PHRASE,\n  screenTypes.CHAIN,\n  screenTypes.SONG,\n  screenTypes.HELP,\n  screenTypes.SHELF,\n  screenTypes.RUN\n]\n\nconst getNextScreen = screen => {\n  const index = cycleOrder.indexOf(screen)\n  return cycleOrder[(index + 1) % cycleOrder.length]\n}\n\nconst getPreviousScreen = screen => {\n  const index = cycleOrder.indexOf(screen)\n  return cycleOrder[(index - 1 + cycleOrder.length) % cycleOrder.length]\n}\n\nexport { getNextScreen, getPreviousScreen }\n\nexport default screenTypes\n","const actionTypes = {\n  TOGGLE_MENU: 'TOGGLE_MENU',\n  UPDATE_IFRAME_VERSION: 'UPDATE_IFRAME_VERSION',\n  SET_ERROR_LINE: 'SET_ERROR_LINE',\n  CLEAR_TOKEN: 'CLEAR_TOKEN',\n  SELECT_UI: 'SELECT_UI',\n  TOGGLE_SOUND: 'TOGGLE_SOUND',\n  DISMISS_NOTICES: 'DISMISS_NOTICES',\n  SET_SCREEN: 'SET_SCREEN',\n  FETCH_GIST_REQUEST: 'FETCH_GIST_REQUEST',\n  FETCH_GIST_SUCCESS: 'FETCH_GIST_SUCCESS',\n  FINISH_BOOT: 'FINISH_BOOT',\n  UPDATE_GAME: 'UPDATE_GAME',\n  NEW_GAME: 'NEW_GAME',\n  TOKEN_REQUEST: 'TOKEN_REQUEST',\n  TOKEN_SUCCESS: 'TOKEN_SUCCESS',\n  SET_NEXT_ACTION: 'SET_NEXT_ACTION',\n  CLEAR_NEXT_ACTION: 'CLEAR_NEXT_ACTION',\n  SAVE_GIST_REQUEST: 'SAVE_GIST_REQUEST',\n  SAVE_GIST_SUCCESS: 'SAVE_GIST_SUCCESS',\n  UPDATE_SFX: 'UPDATE_SFX',\n  UPDATE_SPRITE: 'UPDATE_SPRITE',\n  UPDATE_MAP: 'UPDATE_MAP',\n  UPDATE_PHRASE: 'UPDATE_PHRASE',\n  UPDATE_CHAIN: 'UPDATE_CHAIN',\n  UPDATE_SONG: 'UPDATE_SONG',\n  SET_TUTORIAL_SLIDE: 'SET_TUTORIAL_SLIDE',\n  CLOSE_TUTORIAL: 'CLOSE_TUTORIAL',\n  SHELVE_CASSETTE_REQUEST: 'SHELVE_CASSETTE_REQUEST',\n  SHELVE_CASSETTE_SUCCESS: 'SHELVE_CASSETTE_SUCCESS',\n  UNSHELVE_CASSETTE_REQUEST: 'UNSHELVE_CASSETTE_REQUEST',\n  UNSHELVE_CASSETTE_SUCCESS: 'UNSHELVE_CASSETTE_SUCCESS',\n  SET_VISIBILITY_REQUEST: 'SET_VISIBILITY_REQUEST',\n  SET_VISIBILITY_SUCCESS: 'SET_VISIBILITY_SUCCESS',\n  COUNTER_CASSETTE_REQUEST: 'COUNTER_CASSETTE_REQUEST',\n  COUNTER_CASSETTE_SUCCESS: 'COUNTER_CASSETTE_SUCCESS',\n  SET_SCROLL_DATA: 'SET_SCROLL_DATA',\n  SET_CODE_TAB: 'SET_CODE_TAB',\n  UPDATE_HISTORY: 'UPDATE_HISTORY',\n  SET_CALL_UNDER_MOUSE: 'SET_CALL_UNDER_MOUSE',\n  CLEAR_CALL_UNDER_MOUSE: 'CLEAR_CALL_UNDER_MOUSE'\n}\n\nexport default actionTypes\n","export default `init = state => {\n}\n\nupdate = (state, input, elapsed) => {\n}\n\ndraw = state => {\n}`\n","import screenTypes from '../utils/screenTypes.js'\nimport blankTemplate from '../blankTemplate.js'\nimport { version } from '../../package.json'\n\n// TODO: why do we have to make game keys?\nconst initialState = {\n  hideMenu: false,\n  iframeVersion: version,\n  errorLine: null,\n  screen: screenTypes.BOOT,\n  // screen: screenTypes.HOME,\n  booted: false,\n  gist: {},\n  game: {\n    0: {\n      text: blankTemplate,\n      active: true,\n      key: 0\n    }\n  },\n  token: {},\n  nextAction: null,\n  sprites: {},\n  map: [],\n  phrases: {},\n  chains: {},\n  songs: {},\n  docHistories: {},\n  dismissedNotices: [],\n  selectedUi: {\n    phrase: 0,\n    chain: 0,\n    song: 0\n  },\n  // tutorial: {\n  //   lessonIndex: 1,\n  //   slideIndex: 0\n  // },\n  tutorial: null,\n  sound: true,\n  shelving: false\n}\n\nexport default initialState\n","const notes = ['c', 'c#', 'd', 'd#', 'e', 'f', 'f#', 'g', 'g#', 'a', 'a#', 'b']\n\nconst numberToNote = number => notes[number % notes.length]\n\nconst numberToOctave = number => Math.floor(number / notes.length)\n\nconst toLetter = (number, includeOctave, normalize) => {\n  const letter = numberToNote(number)\n  const octave = numberToOctave(number) + (normalize ? 2 : 0)\n  return !includeOctave ? letter : `${letter}${octave}`\n}\n\nconst letterToNumber = letter => notes.indexOf(letter)\n\nexport { numberToOctave, letterToNumber }\n\nexport default toLetter\n","import _ from 'lodash'\nimport omitEmpty from 'omit-empty'\nimport initialState from '../store/initialState.js'\nimport toLetter, { letterToNumber } from '../toLetter.js'\n\nconst compressPhrases = phrases => {\n  const result = _.mapValues(phrases, phrase => {\n    const notes = _.map(phrase.notes, (note, noteIndex) =>\n      [noteIndex, toLetter(note.note), note.octave, note.volume].join('')\n    )\n    return {\n      notes,\n      tempo: _.isNil(phrase.tempo) ? 0 : phrase.tempo,\n      synth: _.isNil(phrase.synth) ? 0 : phrase.synth\n    }\n  })\n  return result\n}\n\nconst expandPhrases = phrases => {\n  // `phrases` is an object, e.g. (old style)\n  // {\n  //   \"0\": [\n  //     \"0f17\",\n  //     \"1g17\",\n  //     \"2a17\",\n\n  const result = omitEmpty(\n    _.mapValues(phrases, phrase => {\n      // If phrase is an array, it's an old kind. We have to convert it.\n      const phraseIsArray = Array.isArray(phrase)\n      const notes = _(phraseIsArray ? phrase : phrase.notes)\n        .map(note => note.match(/^(\\d+)([a-g]#?)(-?\\d)(\\d)/).slice(1, 5))\n        .map(match => ({\n          index: match[0],\n          note: letterToNumber(match[1]),\n          octave: +match[2],\n          volume: +match[3]\n        }))\n        .keyBy('index')\n        .mapValues(d => _.omit(d, 'index'))\n        .value()\n\n      return _.isEmpty(notes)\n        ? null\n        : {\n            notes,\n            tempo: phraseIsArray ? 0 : _.isNil(phrase.tempo) ? 0 : phrase.tempo,\n            synth: phraseIsArray ? 0 : _.isNil(phrase.synth) ? 0 : phrase.synth\n          }\n    })\n  )\n\n  return result\n}\n\nconst extractGistPhrases = data =>\n  expandPhrases(\n    JSON.parse(\n      _.get(\n        data,\n        'files[\"phrases.json\"].content',\n        JSON.stringify(initialState.phrases, null, 2)\n      )\n    )\n  )\n\nexport { extractGistPhrases, compressPhrases, expandPhrases }\n","const throwError = ({ error, message }) => {\n  error.message = [error.message, message].join('. ')\n  throw new Error(error)\n}\n\nexport default throwError\n","const runningSum = array => {\n  if (!array.length) array.push(0)\n  return array.reduce((acc, cur, idx) => {\n    if (idx > 0) {\n      const previous = acc[idx - 1]\n      return [...acc, [previous[1], previous[1] + cur]]\n    } else {\n      return [[0, cur]]\n    }\n  }, [])\n}\n\nexport default runningSum\n","import _ from 'lodash'\nimport runningSum from '../utils/runningSum.js'\n\n// This takes a tab and returns the code from that tab. It also looks at the call expression under the mouse (if one\n// exists) and wraps it in the `_script8.injectHighlight` function to setup higlighting. Decorate is taken as an\n// argument so that places which do not need decorated code can preserve the code as written by the user.\nconst decorateTabCode = (tab, decorate) => {\n  if (tab.callUnderMouse && tab.text && decorate) {\n    // Say the user has written the following code:\n    //\n    //     drawTitle = () => {\n    //       print(64, 64, \"Crazy Awesome Game!\")\n    //       return true\n    //     }\n    //\n    //     if (drawTitle()) { ... do something ... }\n    //         ^^^^^^^^^^^\n    // With the mouse hovering over the drawTitle call. In this case, the `callUnderMouse` for the current tab would be\n    // a callExpression node with a `callee` of the drawTitle Identifier, and an empty arguments list. We can hook into\n    // this call by wrapping it in a lambda and passing it to a function which sets the highlight flag before and after\n    // making the drawTitle call. In our case we have stored a special `injectHighlight` function in the _script8\n    // global variable which is unaccessible by the user. The resulting code for that line looks like this:\n    //\n    //     if (_script8.injectHighlight(() => drawTitle())) { ... do something ... }\n    //\n    // Since `injectHighlight` stores and passes on the return value fom the lambda, the wrapped expression can be used\n    // in any place the original expression was used. But we get the added benefit of knowing when the command started\n    // and when it ended\n    let node = tab.callUnderMouse\n    let before = tab.text.slice(0, node.start)\n    let nodeCode = tab.text.slice(node.start, node.end)\n    let after = tab.text.slice(node.end)\n    return `${before}_script8.injectHighlight(() => ${nodeCode})${after}`\n  }\n  return tab.text\n};\n\nconst assembleOrderedGame = (game, decorate = true) =>\n  _(game)\n    .orderBy((value, key) => key)\n    .map(tab => decorateTabCode(tab, decorate))\n    .filter(d => !_.isEmpty(d))\n    .value()\n    .join('\\n')\n\nconst parseGistGame = data => {\n  const misc = JSON.parse(_.get(data, 'files[\"misc.json\"].content', '{}'))\n  const content = _.get(data, 'files[\"code.js\"].content', '')\n  if (misc.lines) {\n    const ranges = runningSum(misc.lines)\n    const contentLines = content.split('\\n')\n    return ranges.reduce(\n      (acc, cur, idx) => ({\n        ...acc,\n        [idx]: {\n          text: contentLines.slice(...cur).join('\\n'),\n          active: idx === 0,\n          key: idx\n        }\n      }),\n      {}\n    )\n  } else {\n    return {\n      0: {\n        text: content,\n        active: true,\n        key: 0\n      }\n    }\n  }\n}\n\nexport { parseGistGame, assembleOrderedGame }\n","import _ from 'lodash'\nimport { handleActions } from 'redux-actions'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\nimport screenTypes from '../iframe/src/utils/screenTypes.js'\nimport blankTemplate from '../iframe/src/blankTemplate.js'\nimport { parseGistGame } from '../iframe/src/gistParsers/game.js'\n\nconst assembleMiscLines = game =>\n  _.range(8).map(d => {\n    if (game[d] && game[d].text) {\n      return game[d].text.split('\\n').length\n    } else {\n      return 0\n    }\n  })\n\nconst getActive = game => ({\n  ...game[Object.keys(game).filter(key => game[key].active)],\n  key: Object.keys(game).filter(key => game[key].active)[0]\n})\n\nconst game = handleActions(\n  {\n    [actionTypes.NEW_GAME]: (state, action) =>\n      action.payload === screenTypes.CODE\n        ? { 0: { text: 'SCRIPT-8 NEW', active: true, key: 0 } }\n        : { 0: { text: blankTemplate, active: true, key: 0 } },\n\n    [actionTypes.SET_CODE_TAB]: (state, { payload }) =>\n      _.mapValues(\n        {\n          ...state,\n          [payload]: { ...state[payload], key: payload, active: true }\n        },\n        (value, key) => ({\n          ...value,\n          active: key === payload.toString()\n        })\n      ),\n\n    [actionTypes.UPDATE_GAME]: (state, { payload }) => ({\n      ...state,\n      [payload.tab]: {\n        ...state[payload.tab],\n        text: payload.content\n      }\n    }),\n\n    [actionTypes.SET_SCROLL_DATA]: (state, { payload }) => ({\n      ...state,\n      [payload.tab]: { ...state[payload.tab], scrollData: payload.scrollData }\n    }),\n\n    [actionTypes.FETCH_GIST_SUCCESS]: (state, action) =>\n      parseGistGame(action.payload),\n\n    [actionTypes.SET_CALL_UNDER_MOUSE]: (state, { payload }) => ({\n      ...state,\n      [payload.tab]: { ...state[payload.tab], callUnderMouse: payload.callUnderMouse }\n    }),\n\n    [actionTypes.CLEAR_CALL_UNDER_MOUSE]: (state, { payload }) => ({\n      ...state,\n      [payload.tab]: { ...state[payload.tab], callUnderMouse: null }\n    })\n  },\n  initialState.game\n)\n\nexport default game\nexport { getActive, assembleMiscLines }\n","import { createActions } from 'redux-actions'\nimport GitHub from 'github-api'\nimport _ from 'lodash'\nimport actionTypes from './actionTypes.js'\nimport screenTypes from '../iframe/src/utils/screenTypes.js'\nimport { compressPhrases } from '../iframe/src/gistParsers/phrases.js'\nimport throwError from '../utils/throwError.js'\nimport { assembleMiscLines } from '../reducers/game.js'\nimport {\n  parseGistGame,\n  assembleOrderedGame\n} from '../iframe/src/gistParsers/game.js'\n\nconst actions = createActions({\n  [actionTypes.TOGGLE_MENU]: () => {},\n  [actionTypes.UPDATE_IFRAME_VERSION]: () => {},\n  [actionTypes.SET_ERROR_LINE]: d => d,\n  [actionTypes.CLEAR_TOKEN]: () => {},\n  [actionTypes.SELECT_UI]: d => d,\n  [actionTypes.DISMISS_NOTICES]: d => d,\n  [actionTypes.TOGGLE_SOUND]: () => {},\n  [actionTypes.SET_SCREEN]: d => d,\n  [actionTypes.FETCH_GIST_REQUEST]: () => {},\n  [actionTypes.FETCH_GIST_SUCCESS]: d => d,\n  [actionTypes.FINISH_BOOT]: () => {},\n  [actionTypes.UPDATE_GAME]: d => d,\n  [actionTypes.NEW_GAME]: d => d,\n  [actionTypes.TOKEN_REQUEST]: () => {},\n  [actionTypes.TOKEN_SUCCESS]: d => d,\n  [actionTypes.SET_NEXT_ACTION]: d => d,\n  [actionTypes.CLEAR_NEXT_ACTION]: () => {},\n  [actionTypes.SAVE_GIST_REQUEST]: () => {},\n  [actionTypes.SAVE_GIST_SUCCESS]: d => d,\n  [actionTypes.UPDATE_SFX]: d => d,\n  [actionTypes.UPDATE_SPRITE]: d => d,\n  [actionTypes.UPDATE_MAP]: d => d,\n  [actionTypes.UPDATE_PHRASE]: d => d,\n  [actionTypes.UPDATE_CHAIN]: d => d,\n  [actionTypes.UPDATE_SONG]: d => d,\n  [actionTypes.IS_NEW_USER]: () => {},\n  [actionTypes.SET_TUTORIAL_SLIDE]: d => d,\n  [actionTypes.CLOSE_TUTORIAL]: () => {},\n  [actionTypes.SHELVE_CASSETTE_REQUEST]: () => {},\n  [actionTypes.SHELVE_CASSETTE_SUCCESS]: d => d,\n  [actionTypes.UNSHELVE_CASSETTE_REQUEST]: () => {},\n  [actionTypes.UNSHELVE_CASSETTE_SUCCESS]: d => d,\n  [actionTypes.SET_VISIBILITY_REQUEST]: d => d,\n  [actionTypes.SET_VISIBILITY_SUCCESS]: d => d,\n  [actionTypes.COUNTER_CASSETTE_REQUEST]: () => {},\n  [actionTypes.COUNTER_CASSETTE_SUCCESS]: d => d,\n  [actionTypes.SET_SCROLL_DATA]: d => d,\n  [actionTypes.SET_CODE_TAB]: d => d,\n  [actionTypes.UPDATE_HISTORY]: d => d,\n  [actionTypes.SET_CALL_UNDER_MOUSE]: d => d,\n  [actionTypes.CLEAR_CALL_UNDER_MOUSE]: d => d\n})\n\nexport default actions\n\nexport const counterCassette = ({ id }) => dispatch => {\n  dispatch(actions.counterCassetteRequest())\n\n  return window\n    .fetch(`${process.env.REACT_APP_NOW}/counter/${id}`)\n    .then(response => response.json())\n    .then(json => dispatch(actions.counterCassetteSuccess(json)))\n    .catch(error =>\n      throwError({\n        error,\n        message: `Could not increase counter from the hosted oauth service.`\n      })\n    )\n}\n\nexport const setVisibility = ({ token, gistId, isPrivate }) => dispatch => {\n  dispatch(actions.setVisibilityRequest())\n\n  return window\n    .fetch(`${process.env.REACT_APP_NOW}/set-visibility`, {\n      method: 'POST',\n      body: JSON.stringify({\n        token: token.value,\n        gist: gistId,\n        isPrivate\n      })\n    })\n    .then(\n      response => response.json(),\n      error =>\n        throwError({\n          error,\n          message: `Could not set visibility.`\n        })\n    )\n    .then(() => dispatch(actions.setVisibilitySuccess()))\n}\n\nexport const unshelveCassette = ({ token, gistId }) => dispatch => {\n  dispatch(actions.shelveCassetteRequest())\n\n  return window\n    .fetch(`${process.env.REACT_APP_NOW}/delete`, {\n      method: 'POST',\n      body: JSON.stringify({\n        token: token.value,\n        gist: gistId\n      })\n    })\n    .then(\n      response => response.json(),\n      error =>\n        throwError({\n          error,\n          message: `Could not delete.`\n        })\n    )\n    .then(() => dispatch(actions.shelveCassetteSuccess()))\n}\n\nexport const putOnShelf = ({\n  user,\n  gist,\n  cover,\n  title,\n  isFork,\n  isPrivate,\n  token\n}) => dispatch => {\n  dispatch(actions.shelveCassetteRequest())\n\n  return window\n    .fetch(`${process.env.REACT_APP_NOW}/cassette`, {\n      method: 'POST',\n      body: JSON.stringify({\n        user,\n        gist,\n        cover,\n        title,\n        isFork,\n        isPrivate,\n        token: token.value\n      })\n    })\n    .then(\n      response => response.json(),\n      error =>\n        throwError({\n          error,\n          message: `Could not post cassette via appspot service.`\n        })\n    )\n    .then(() => dispatch(actions.shelveCassetteSuccess()))\n    .then(() => dispatch(actions.setScreen(screenTypes.SHELF)))\n}\n\nexport const fetchGist = ({ id, token }) => dispatch => {\n  dispatch(actions.fetchGistRequest())\n\n  if (token && token.value) {\n    const gh = new GitHub({ token: token.value })\n    return gh\n      .getGist(id)\n      .read()\n      .then(\n        response => response.data,\n        error =>\n          throwError({\n            error,\n            message: `Could not fetch gist ${id} from GitHub while using an oauth token.`\n          })\n      )\n      .then(json => dispatch(actions.fetchGistSuccess(json)))\n  } else {\n    return window\n      .fetch(`${process.env.REACT_APP_NOW}/gist/${id}`)\n      .then(response => response.json())\n      .then(json => dispatch(actions.fetchGistSuccess(json)))\n      .catch(error =>\n        throwError({\n          error,\n          message: `Could not fetch gist ${id} from the hosted oauth service.`\n        })\n      )\n  }\n}\n\nexport const fetchToken = code => dispatch => {\n  dispatch(actions.tokenRequest())\n\n  return window\n    .fetch(`${process.env.REACT_APP_AUTHENTICATOR}/authenticate/${code}`)\n    .then(\n      response => response.json(),\n      error => throwError({ error, message: 'Could not fetch oauth token.' })\n    )\n    .then(({ token }) => {\n      const gh = new GitHub({ token })\n\n      return gh\n        .getUser()\n        .getProfile()\n        .then(\n          response => ({\n            token,\n            user: response.data\n          }),\n          error =>\n            throwError({\n              error,\n              message: 'Could not fetch GitHub user despite valid oauth token.'\n            })\n        )\n    })\n    .then(json => dispatch(actions.tokenSuccess(json)))\n}\n\nexport const saveGist = ({\n  iframeVersion,\n  toFork,\n  game,\n  token,\n  gist,\n  sprites,\n  map,\n  phrases,\n  chains,\n  songs\n}) => dispatch => {\n  dispatch(actions.saveGistRequest())\n\n  const gh = new GitHub({\n    token: token.value\n  })\n\n  const createLink = id =>\n    id ? ` Click [here](https://script-8.github.io/?id=${id}) to boot it.` : ''\n\n  const preparePayload = id => {\n    const link = createLink(id)\n    const README = `This is a [SCRIPT-8](https://script-8.github.io) cassette.${link}`\n\n    const miscJson = {\n      iframeVersion\n    }\n\n    let payload = {\n      public: true,\n      description: 'SCRIPT-8',\n      files: {\n        'sprites.json': {\n          content: JSON.stringify(sprites, null, 2)\n        },\n        'map.json': {\n          content: JSON.stringify(map, null, 2)\n        },\n        'phrases.json': {\n          content: JSON.stringify(compressPhrases(phrases), null, 2)\n        },\n        'chains.json': {\n          content: JSON.stringify(chains, null, 2)\n        },\n        'songs.json': {\n          content: JSON.stringify(songs, null, 2)\n        },\n        'README.md': {\n          content: README\n        }\n      }\n    }\n\n    const gistGame = parseGistGame(gist.data)\n    const assembledGistGame = assembleOrderedGame(gistGame)\n    const assembledGame = assembleOrderedGame(game)\n\n    // If game has length, send it.\n    if (assembledGame.length) {\n      payload.files['code.js'] = {\n        content: assembledGame\n      }\n      miscJson.lines = assembleMiscLines(game)\n    } else {\n      // So the game has no length.\n      // But if the previous gist had game,\n      // send 'code.js': null.\n      if (assembledGistGame.length) {\n        payload.files['code.js'] = null\n      }\n    }\n\n    payload.files['misc.json'] = {\n      content: JSON.stringify(miscJson, null, 2)\n    }\n\n    return payload\n  }\n\n  const createGist = () =>\n    gh\n      .getGist()\n      .create(preparePayload())\n      .then(\n        response => response.data,\n        error => throwError({ error, message: 'Could not create gist.' })\n      )\n      .then(data => dispatch(actions.saveGistSuccess(data)))\n\n  const updateGist = () =>\n    gh\n      .getGist(gist.data.id)\n      .update(preparePayload(gist.data.id))\n      .then(\n        response => response.data,\n        error => throwError({ error, message: 'Could not update gist.' })\n      )\n      .then(data => dispatch(actions.saveGistSuccess(data)))\n\n  const forkGist = () =>\n    gh\n      .getGist(gist.data.id)\n      .fork()\n      .then(response => response.data.id)\n      .then(id => gh.getGist(id).read())\n      .then(response => response.data)\n      .then(data => dispatch(actions.saveGistSuccess(data)))\n      .catch(error =>\n        throwError({\n          error,\n          message: `Could not fork gist ${\n            gist.data.id\n          } from the hosted oauth service.`\n        })\n      )\n\n  // If there is no gist, create it.\n  if (!gist.data) {\n    return createGist()\n  } else if (toFork) {\n    // If we want to record to blank,\n    // if it's ours, create a new one.\n    if (_.get(gist, 'data.owner.login', null) === token.user.login) {\n      return createGist()\n    } else {\n      // If it's not ours, fork it.\n      return forkGist()\n    }\n  } else {\n    // If there is a gist, and it is ours,\n    if (_.get(gist, 'data.owner.login', null) === token.user.login) {\n      // update it.\n      return updateGist()\n    } else {\n      // If it is not ours, create it.\n      return createGist()\n    }\n  }\n}\n","import React, { Component } from 'react'\nimport _ from 'lodash'\nimport { connect } from 'react-redux'\nimport screenTypes from '../iframe/src/utils/screenTypes.js'\nimport actions, { fetchGist, counterCassette } from '../actions/actions.js'\n\nconst mapStateToProps = ({ gist, booted, token }) => ({\n  gist,\n  booted,\n  token\n})\n\nconst mapDispatchToProps = dispatch => ({\n  setScreen: screen => dispatch(actions.setScreen(screen)),\n  counterCassette: id => dispatch(counterCassette({ id })),\n  fetchGist: ({ id, token }) => dispatch(fetchGist({ id, token }))\n})\n\nclass Boot extends Component {\n  componentDidMount() {\n    const { fetchGist, token, setScreen } = this.props\n\n    const { search } = window.location\n    const params = new window.URLSearchParams(search)\n    const id = params.get('id')\n    const shelfUser = params.get('shelf')\n    // If there's an id in the query string,\n    if (id) {\n      // try fetching the gist.\n      fetchGist({ id, token })\n    } else if (shelfUser) {\n      // If there's a user in the query string,\n      // show shelf.\n      setScreen(screenTypes.SHELF)\n    } else {\n      // If there is no id,\n      // show home.\n      setScreen(screenTypes.HOME)\n    }\n  }\n\n  componentDidUpdate() {\n    const { gist, setScreen, booted, counterCassette, token } = this.props\n\n    // If we are done fetching, and we have a gist,\n    // AND we are done booting,\n    if (!gist.isFetching && gist.data && booted) {\n      // set screen to RUN,\n      setScreen(screenTypes.RUN)\n\n      const tokenLogin = _.get(token, 'user.login', null)\n      const gistLogin = _.get(gist, 'data.owner.login', null)\n      if (tokenLogin !== gistLogin) {\n        // and if this is not our cassette,\n        // increment cassette hit counter.\n        counterCassette(gist.data.id)\n      }\n    }\n  }\n\n  render() {\n    return <div className=\"Boot\" />\n  }\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Boot)\n","import React, { Component } from 'react'\nimport { connect } from 'react-redux'\nimport classNames from 'classnames'\nimport actions from '../actions/actions.js'\nimport screenTypes from '../iframe/src/utils/screenTypes.js'\nimport logo from '../images/logo.png'\nimport { timestamp } from '../utils/timestamp.json'\nimport loshermanosbrosgif from '../images/loshermanosbros-lite.gif'\nimport breakoutgif from '../images/breakout-lite.gif'\nimport brospipegif from '../images/brospipe-lite.gif'\nimport livecoding480 from '../images/livecoding480.gif'\nimport slider480 from '../images/slider480.gif'\nimport pauserewind from '../images/pauserewind.gif'\nimport toggle from '../images/toggle.gif'\nimport spritedemo from '../images/spritedemo.gif'\nimport mapdemo from '../images/mapdemo.gif'\nimport musicdemo from '../images/musicdemo.gif'\nimport { version } from '../iframe/package.json'\n\nconst mapStateToProps = ({ tutorial }) => ({\n  tutorial\n})\n\nconst mapDispatchToProps = dispatch => ({\n  setScreen: screen => dispatch(actions.setScreen(screen)),\n  startTutorial: () =>\n    dispatch(\n      actions.setTutorialSlide({\n        lessonIndex: 0,\n        slideIndex: 0\n      })\n    )\n})\n\nclass Home extends Component {\n  constructor(props) {\n    super(props)\n    this.handleStartTutorial = this.handleStartTutorial.bind(this)\n    this.handleSeeLessons = this.handleSeeLessons.bind(this)\n    this.handleClickGifs = this.handleClickGifs.bind(this)\n  }\n\n  handleStartTutorial() {\n    this.props.startTutorial()\n  }\n\n  handleSeeLessons() {\n    this.props.setScreen(screenTypes.HELP)\n  }\n\n  handleClickGifs() {\n    this.props.setScreen(screenTypes.SHELF)\n  }\n\n  render() {\n    return (\n      <div className=\"Home\">\n        <div className=\"main\">\n          <img className=\"logo\" src={logo} alt=\"SCRIPT-8 logo\" />\n          <p className=\"last-updated\">\n            <span>updated {timestamp}</span>\n            <span>v{version}</span>\n          </p>\n          <p>\n            SCRIPT-8 is a fantasy computer for making, sharing, and playing tiny\n            retro-looking games (called cassettes). It's free, browser-based,\n            and{' '}\n            <a\n              className=\"text\"\n              href=\"https://github.com/script-8/script-8.github.io\"\n            >\n              open-source\n            </a>\n            . Cassettes are written in JavaScript.\n          </p>\n          <p className=\"gifs\">\n            <button onClick={this.handleClickGifs}>\n              <img\n                className=\"gif\"\n                src={loshermanosbrosgif}\n                alt=\"Los hermanos bros\"\n              />\n            </button>\n            <button onClick={this.handleClickGifs}>\n              <img className=\"gif\" src={breakoutgif} alt=\"break-8 game\" />\n            </button>\n            <button onClick={this.handleClickGifs}>\n              <img className=\"gif\" src={brospipegif} alt=\"the plumber\" />\n            </button>\n          </p>\n          <p className=\"start\">\n            <button\n              className={classNames('button', {\n                invisible: this.props.tutorial\n              })}\n              onClick={this.handleStartTutorial}\n            >\n              > New? Start here\n            </button>\n            <button\n              className={classNames('button', {\n                invisible: this.props.tutorial\n              })}\n              onClick={this.handleSeeLessons}\n            >\n              > See lessons\n            </button>\n          </p>\n          <p>\n            SCRIPT-8 is designed to encourage play  the kind of wonder-filled\n            play children experience as they explore and learn about the world.\n            In order to support this goal, everything in SCRIPT-8 has immediate\n            feedback. It is what some call a \"livecoding\" environment.\n          </p>\n          <p>It features:</p>\n          <ul>\n            <li>\n              a code editor where the game changes as you type.\n              <img className=\"gif wide\" src={livecoding480} alt=\"livecoding\" />\n            </li>\n            <li>\n              a slider to help you tweak numbers without typing.\n              <img className=\"gif wide\" src={slider480} alt=\"slider\" />\n            </li>\n            <li>\n              <span>a time-traveling tool so you can pause and rewind.</span>\n              <img\n                className=\"gif wide single\"\n                src={pauserewind}\n                alt=\"pause and rewind\"\n              />\n            </li>\n            <li>\n              <span>\n                buttons that show a character's past and future paths.\n              </span>\n              <img className=\"gif wide single\" src={toggle} alt=\"toggle\" />\n            </li>\n            <li>\n              the ability to combine all the above so you can manipulate time.\n              <iframe\n                title=\"Demonstration of SCRIPT-8's time-traveling tool\"\n                width=\"560\"\n                height=\"315\"\n                src=\"https://www.youtube.com/embed/0rg5GGFaIY0\"\n                frameBorder=\"0\"\n                allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\"\n                allowFullScreen\n              />{' '}\n            </li>\n            <li>\n              <span>\n                a sprite editor where the game instantly displays your edits.\n              </span>\n              <img\n                className=\"gif wide single\"\n                src={spritedemo}\n                alt=\"sprite demo\"\n              />\n            </li>\n            <li>\n              <span>\n                a map editor where changes alter the game's behavior, in\n                real-time.\n              </span>\n              <img className=\"gif wide single\" src={mapdemo} alt=\"map demo\" />\n            </li>\n            <li>\n              <span>\n                a music editor where you create phrases, group them into chains,\n                and turn those into songs.\n              </span>\n              <img\n                className=\"gif wide single\"\n                src={musicdemo}\n                alt=\"music demo\"\n              />\n            </li>\n          </ul>\n\n          <p>Each cassette is recorded to a URL you can share with anyone.</p>\n          <p>Play cassettes with a keyboard or gamepad.</p>\n          <p>\n            You can inspect any cassette's contents (even if it's not yours),\n            change the code, art, or music, and record it to a different\n            cassette  a new version.\n          </p>\n          <p>\n            SCRIPT-8 is heavily influenced by Bret Victor's ideas (specifically{' '}\n            <a className=\"text\" href=\"http://vimeo.com/36579366\">\n              Inventing on principle\n            </a>{' '}\n            and{' '}\n            <a\n              className=\"text\"\n              href=\"http://worrydream.com/LearnableProgramming/\"\n            >\n              Learnable programming\n            </a>\n            ) and Joseph White's{' '}\n            <a className=\"text\" href=\"https://www.lexaloffle.com/pico-8.php\">\n              PICO-8\n            </a>\n            , the best of all fantasy consoles.\n          </p>\n          <p>\n            SCRIPT-8 is written by Gabriel Florit (that's me!) and{' '}\n            <a\n              className=\"text\"\n              href=\"https://github.com/script-8/script-8.github.io/graphs/contributors\"\n            >\n              dedicated contributors\n            </a>\n            . Click{' '}\n            <a className=\"text\" href=\"https://twitter.com/gabrielflorit\">\n              here\n            </a>{' '}\n            to follow me on twitter. And visit the Github repository{' '}\n            <a\n              className=\"text\"\n              href=\"https://github.com/script-8/script-8.github.io\"\n            >\n              here\n            </a>\n            , where you can keep up with new features and the occasional bug\n            fix.\n          </p>\n          <p>\n            If you have any questions, come join us on the{' '}\n            <a className=\"text\" href=\"https://discord.gg/HA68FNX\">\n              Fantasy Consoles Discord server\n            </a>\n            , a friendly place to chat about these sophisticated, cutting-edge\n            computers. The server has a dedicated SCRIPT-8 room.\n          </p>\n          <p>\n            SCRIPT-8 nyx8 palette by{' '}\n            <a className=\"text\" href=\"https://twitter.com/Xavier_Gd\">\n              Javier Guerrero\n            </a>\n            . Sprites in{' '}\n            <a\n              className=\"text\"\n              href=\"https://script-8.github.io/?id=cd8d6811adb3afb472aaf7505729cf01\"\n            >\n              Los Hermanos Bros.\n            </a>{' '}\n            by{' '}\n            <a className=\"text\" href=\"https://twitter.com/johanvinet\">\n              Johan Vinet\n            </a>\n            .\n          </p>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Home)\n","import { version } from '../../package.json'\nimport skeleton from '../skeleton.js'\nconst boot = `\n\nconst modes = ['glitch', 'numbers', 'pre-ram', 'ram', 'run', 'end']\n\nconst size = range(128)\nconst d = 1\n\nconst rects = flatten(size.map(x => size.map(y => [x, y, d, 128])))\n\nconst biosLines = range(18).map(() => {\n  return (\n    '  ' +\n    range(4)\n      .map(() => random(1000, 9999))\n      .join('      ')\n  )\n})\n\nif (typeof(initialState) !== 'undefined') {\n  initialState = {\n    counter: 0,\n    totalElapsed: 0,\n    modeIndex: 0,\n    hasStarted: false\n  }\n}\n\ninit = state => {\n  state.counter = 0\n  state.totalElapsed = 0\n  state.modeIndex = 0\n  state.hasStarted = false\n}\n\nupdate = (state, input, elapsed) => {\n  if (!state.hasStarted) {\n    state.hasStarted = true\n  }\n\n  const mode = modes[state.modeIndex]\n\n  state.counter++\n  state.totalElapsed += elapsed\n\n  if (mode === 'glitch' && state.totalElapsed > 500) {\n    state.modeIndex++\n    state.totalElapsed = 0\n  } else if (mode === 'numbers' && state.totalElapsed > 100) {\n    state.modeIndex++\n    state.totalElapsed = 0\n  } else if (mode === 'pre-ram' && state.totalElapsed > 100) {\n    state.modeIndex++\n    state.totalElapsed = 0\n    state.counter = 0\n  } else if (mode === 'ram' && state.counter > 64 && _script8.end) {\n    // The _script8.end function is not defined until we're done fetching the gist.\n    state.modeIndex++\n    state.totalElapsed = 0\n    state.counter++\n  } else if (mode === 'run') {\n    if (input.__mousedown) {\n      ${skeleton}\n      _script8.end()\n    }\n  }\n}\n\ndraw = state => {\n  const { modeIndex, counter } = state\n  const mode = modes[modeIndex]\n\n  if (mode === 'glitch') {\n    rects.forEach(rect => {\n      rectFill(...rect, rect[0] + (rect[1] * counter) / 100)\n    })\n  }\n\n  if (mode === 'numbers') {\n    const factor = 4\n    if (counter % factor === 0) {\n      rectFill(0, 0, 128, 128, 7)\n      biosLines.forEach((line, j) => {\n        print(0, 128 + 7 * j - (7 * counter) / factor, line, 5)\n      })\n    }\n  }\n\n  if (mode === 'pre-ram') {\n    rectFill(0, 0, 128, 128, 7)\n  }\n\n  if (mode === 'ram') {\n    rectFill(0, 0, 128, 128, 6)\n    print(7, 7 * 1, 'script-8', 0)\n    print(7, 7 * 3, 'bios (c) 1980 pantron inc.', 3)\n    print(7, 7 * 4, 'version ${version}', 3)\n    print(7, 7 * 6, 'RAM: ' + Math.min(state.counter, 32) + ' kb', 3)\n\n    print(\n      7,\n      7 * 9,\n      'booting cassette ' +\n        (Math.floor(state.counter / 20) % 2 === 0 ? '' : '+'),\n      3\n    )\n\n    rectFill(48 + 3 * 0, 7, 3, 5, 0)\n    rectFill(48 + 3 * 1, 7, 3, 5, 1)\n    rectFill(48 + 3 * 2, 7, 3, 5, 2)\n    rectFill(48 + 3 * 3, 7, 3, 5, 3)\n    rectFill(48 + 3 * 4, 7, 3, 5, 4)\n    rectFill(48 + 3 * 5, 7, 3, 5, 5)\n    rectFill(48 + 3 * 6, 7, 3, 5, 4)\n    rectFill(48 + 3 * 7, 7, 3, 5, 3)\n    rectFill(48 + 3 * 8, 7, 3, 5, 2)\n    rectFill(48 + 3 * 9, 7, 3, 5, 1)\n    rectFill(48 + 3 * 10, 7, 3, 5, 0)\n  }\n\n  if (mode === 'run') {\n    rectFill(0, 0, 128, 128, 6)\n    print(7, 7 * 1, 'script-8', 0)\n    print(7, 7 * 3, 'bios (c) 1980 pantron inc.', 3)\n    print(7, 7 * 4, 'version ${version}', 3)\n    print(7, 7 * 6, 'RAM: ' + Math.min(state.counter, 32) + ' kb', 3)\n\n    print(7, 7 * 9, 'booting cassette done. ', 3)\n\n    rectFill(48 + 3 * 0, 7, 3, 5, 0)\n    rectFill(48 + 3 * 1, 7, 3, 5, 1)\n    rectFill(48 + 3 * 2, 7, 3, 5, 2)\n    rectFill(48 + 3 * 3, 7, 3, 5, 3)\n    rectFill(48 + 3 * 4, 7, 3, 5, 4)\n    rectFill(48 + 3 * 5, 7, 3, 5, 5)\n    rectFill(48 + 3 * 6, 7, 3, 5, 4)\n    rectFill(48 + 3 * 7, 7, 3, 5, 3)\n    rectFill(48 + 3 * 8, 7, 3, 5, 2)\n    rectFill(48 + 3 * 9, 7, 3, 5, 1)\n    rectFill(48 + 3 * 10, 7, 3, 5, 0)\n    print(7, 7 * 11, '> click to run', 3)\n    rectFill(7, 7 * 12, 4, 5, Math.floor(state.counter / 25) % 2 ? 0 : 6)\n  }\n}\n\n`\n\nexport default boot\n","export default `init = state => {\n}\n\nupdate = (state, input, elapsed) => {\n}\n\ndrawActors = (state, fade) =>\n  state.actors && state.actors.forEach(actor =>\n    sprite(\n      actor.x,\n      actor.y,\n      actor.sprite,\n      fade ? actor.trailBrighten || -3 : actor.brighten,\n      actor.flipH,\n      actor.flipV\n    )\n  )\n\ndraw = state => {\n  camera()\n  clear()\n}`\n","import _ from 'lodash'\nimport initialState from '../store/initialState.js'\n\nconst extractGistMap = data =>\n  JSON.parse(\n    _.get(\n      data,\n      'files[\"map.json\"].content',\n      JSON.stringify(initialState.map, null, 2)\n    )\n  )\n\nexport { extractGistMap }\n","import _ from 'lodash'\nimport initialState from '../store/initialState.js'\n\nconst extractGistSprites = data =>\n  JSON.parse(\n    _.get(\n      data,\n      'files[\"sprites.json\"].content',\n      JSON.stringify(initialState.sprites, null, 2)\n    )\n  )\nexport { extractGistSprites }\n","import _ from 'lodash'\nimport initialState from '../store/initialState.js'\n\nconst extractGistChains = data =>\n  JSON.parse(\n    _.get(\n      data,\n      'files[\"chains.json\"].content',\n      JSON.stringify(initialState.chains, null, 2)\n    )\n  )\n\nexport { extractGistChains }\n","import _ from 'lodash'\nimport initialState from '../store/initialState.js'\n\nconst extractGistSongs = data =>\n  JSON.parse(\n    _.get(\n      data,\n      'files[\"songs.json\"].content',\n      JSON.stringify(initialState.songs, null, 2)\n    )\n  )\n\nexport { extractGistSongs }\n","import _ from 'lodash'\nimport initialState from '../store/initialState.js'\n\n// If `data` exists,\n//   if `misc.json` has iframeVersion, return it,\n//   if it doesn't have it, return 0.1.247\n// If `data` doesn't exist,\n//   return initialState.iframeVersion.\nconst parseGistIframeVersion = data => {\n  const iframeVersion = data\n    ? _.get(\n        JSON.parse(_.get(data, 'files[\"misc.json\"].content', '{}')),\n        'iframeVersion',\n        '0.1.247'\n      )\n    : initialState.iframeVersion\n  return iframeVersion\n}\n\nexport { parseGistIframeVersion }\n","import equal from 'deep-equal'\nimport { extractGistMap } from '../iframe/src/gistParsers/map.js'\nimport { extractGistSprites } from '../iframe/src/gistParsers/sprites.js'\nimport { extractGistPhrases } from '../iframe/src/gistParsers/phrases.js'\nimport { extractGistChains } from '../iframe/src/gistParsers/chains.js'\nimport { extractGistSongs } from '../iframe/src/gistParsers/songs.js'\nimport { parseGistIframeVersion } from '../iframe/src/gistParsers/iframeVersion.js'\nimport {\n  parseGistGame,\n  assembleOrderedGame\n} from '../iframe/src/gistParsers/game.js'\nimport blankTemplate from '../iframe/src/blankTemplate.js'\n\nconst isDirty = ({\n  gist,\n  game,\n  sprites,\n  map,\n  phrases,\n  chains,\n  songs,\n  iframeVersion\n}) => {\n  const gistGame = assembleOrderedGame(parseGistGame(gist.data))\n  const thisGame = assembleOrderedGame(game)\n\n  let gameIsDirty = false\n\n  // If there is no game in the gist,\n  if (gistGame === '') {\n    // decide the game is dirty if it's not the blank template.\n    gameIsDirty = !equal(blankTemplate, thisGame)\n  } else {\n    // If there is game in the gist,\n    // then decide if it's dirty as per usual.\n    gameIsDirty = !equal(gistGame, thisGame)\n  }\n\n  const mapIsDirty = !equal(extractGistMap(gist.data), map)\n  const spritesIsDirty = !equal(extractGistSprites(gist.data), sprites)\n  const phrasesIsDirty = !equal(extractGistPhrases(gist.data), phrases)\n  const chainsIsDirty = !equal(extractGistChains(gist.data), chains)\n  const songsIsDirty = !equal(extractGistSongs(gist.data), songs)\n  const iframeVersionIsDirty = !equal(\n    parseGistIframeVersion(gist.data),\n    iframeVersion\n  )\n\n  // console.log({\n  //   old: assembleOrderedGame(parseGistGame(gist.data)),\n  //   newer: assembleOrderedGame(game)\n  // })\n  // console.log({ old: parseGistGame(gist.data), newer: game })\n\n  // console.log({\n  //   gameIsDirty,\n  //   mapIsDirty,\n  //   spritesIsDirty,\n  //   phrasesIsDirty,\n  //   chainsIsDirty,\n  //   songsIsDirty\n  // })\n\n  return (\n    gameIsDirty ||\n    mapIsDirty ||\n    spritesIsDirty ||\n    phrasesIsDirty ||\n    chainsIsDirty ||\n    songsIsDirty ||\n    iframeVersionIsDirty\n  )\n}\n\nexport default isDirty\n","import _ from 'lodash'\nimport isDirty from './isDirty.js'\n\nconst canRecord = ({\n  gist,\n  token,\n  game,\n  sprites,\n  map,\n  phrases,\n  chains,\n  songs,\n  iframeVersion\n}) => {\n  const dirty = isDirty({\n    gist,\n    game,\n    sprites,\n    map,\n    phrases,\n    chains,\n    songs,\n    iframeVersion\n  })\n\n  // If gistLogin is null, gist was created anonymously.\n  const gistLogin = _.get(gist, 'data.owner.login', null)\n\n  // If gistLogin does not match currentLogin, gist wasn't created by us.\n  const currentLogin = _.get(token, 'user.login', null)\n\n  // RECORD can only be enabled when:\n  // - the gist is ours AND content is dirty\n  // - OR the gist is empty (new game)\n  const enableRecord =\n    (currentLogin && currentLogin === gistLogin && dirty) || _.isEmpty(gist)\n\n  return enableRecord\n}\n\nexport default canRecord\n","import * as acorn from 'acorn'\nimport * as walk from 'acorn-walk'\n\nconst parseOptions = {\n  ecmaVersion: 9,\n  sourceType: 'script',\n  locations: true\n}\n\nclass InvalidTokenError extends Error {\n  constructor({ loc, raisedAt, message }) {\n    super(message)\n    this.name = 'InvalidTokenError'\n    this.loc = loc\n    this.raisedAt = raisedAt\n  }\n}\n\nconst findInvalidNode = nodes => {\n  return new Promise(resolve => {\n    const channel = new window.MessageChannel()\n    const payload = {\n      type: 'findInvalidToken',\n      tokens: nodes.map(d => d.name)\n    }\n    const iframe = document.querySelector('iframe')\n    iframe.contentWindow.postMessage(payload, '*', [channel.port2])\n    channel.port1.onmessage = message => {\n      resolve(nodes[message.data])\n    }\n  })\n}\n\nconst getLintErrors = async ({ text }) => {\n  const errors = []\n  try {\n    const parsed = acorn.parse(text, parseOptions)\n    let nodes = []\n    walk.simple(parsed, {\n      Identifier(node) {\n        nodes.push(node)\n      }\n    })\n    const node = await findInvalidNode(nodes)\n    if (node) {\n      const error = {\n        loc: node.loc.start,\n        raisedAt: node.end,\n        message: `${node.name} is not allowed in SCRIPT-8.`\n      }\n      throw new InvalidTokenError(error)\n    }\n  } catch (error) {\n    errors.push({\n      from: {\n        line: error.loc.line - 1,\n        ch: error.loc.column\n      },\n      to: {\n        line: error.loc.line - 1,\n        ch: error.raisedAt\n      },\n      message: error.message.replace(/ \\(\\d+:\\d+\\)$/, ''),\n      severity: 'error'\n    })\n  }\n\n  return errors\n}\n\nconst setupLinter = () => {\n  window.CodeMirror.registerHelper('lint', 'javascript', text =>\n    getLintErrors({ text })\n  )\n}\n\nexport { parseOptions, getLintErrors }\nexport default setupLinter\n","const getGameTitle = game => {\n  const match = game[0].text.split('\\n')[0].match(/\\/\\/\\s*title:\\s*(\\S.*)/)\n  const title = match ? match[1].trim().toUpperCase() : null\n  return title\n}\n\nexport default getGameTitle\n","import { assembleMiscLines } from '../../../reducers/game'\nimport runningSum from './runningSum'\n\nconst gameLineToTabLine = ({ game, gameLine }) => {\n  // First convert the game to misc lines.\n  const miscLines = assembleMiscLines(game)\n\n  // Next, calculate the runningSum.\n  const sum = runningSum(miscLines)\n\n  // Then find our tab.\n  const tab = sum.findIndex(pair => pair[1] > gameLine)\n\n  // If no tab found, return null.\n  return tab > -1\n    ? {\n        tab,\n        tabLine: gameLine - sum[tab][0]\n        // sum\n      }\n    : null\n}\n\nexport default gameLineToTabLine\n","import _ from 'lodash'\nimport classNames from 'classnames'\nimport React, { Component } from 'react'\nimport { connect } from 'react-redux'\nimport { tokenizer } from 'acorn'\nimport actions, { saveGist } from '../actions/actions.js'\nimport bios from '../iframe/src/utils/bios.js'\nimport screenTypes, {\n  getPreviousScreen,\n  getNextScreen\n} from '../iframe/src/utils/screenTypes.js'\nimport canRecord from '../utils/canRecord.js'\nimport { getLintErrors } from '../utils/setupLinter.js'\nimport { numberWithCommas } from '../utils/string.js'\nimport { assembleOrderedGame } from '../iframe/src/gistParsers/game.js'\nimport getGameTitle from '../utils/getGameTitle'\nimport gameLineToTabLine from '../iframe/src/utils/gameLineToTabLine.js'\n\nconst mapStateToProps = ({\n  hideMenu,\n  iframeVersion,\n  screen,\n  game,\n  songs,\n  chains,\n  phrases,\n  sprites,\n  map,\n  sound,\n  gist,\n  token,\n  tutorial\n}) => ({\n  hideMenu,\n  iframeVersion,\n  songs,\n  chains,\n  phrases,\n  sprites,\n  map,\n  game: screen === screenTypes.BOOT ? { 0: { text: bios } } : game,\n  run: [screenTypes.BOOT, screenTypes.RUN].includes(screen),\n  screen,\n  sound,\n  gist,\n  token,\n  tutorial\n})\n\nconst mapDispatchToProps = dispatch => ({\n  toggleMenu: () => dispatch(actions.toggleMenu()),\n  setErrorLine: line => dispatch(actions.setErrorLine(line)),\n  setCodeTab: tab => dispatch(actions.setCodeTab(tab)),\n  setScreen: screen => dispatch(actions.setScreen(screen)),\n  finishBoot: () => dispatch(actions.finishBoot()),\n  saveGist: ({\n    iframeVersion,\n    game,\n    token,\n    gist,\n    sprites,\n    map,\n    phrases,\n    chains,\n    songs\n  }) =>\n    dispatch(\n      saveGist({\n        iframeVersion,\n        game,\n        token,\n        gist,\n        sprites,\n        map,\n        phrases,\n        chains,\n        songs,\n        toFork: false\n      })\n    )\n})\n\nconst getTokenCount = game => {\n  const src = assembleOrderedGame(game)\n  try {\n    return numberWithCommas([...tokenizer(src)].length)\n  } catch (error) {\n    return 'ERROR'\n  }\n}\nconst throttledTokenCount = _.throttle(getTokenCount, 1000)\n\nclass Output extends Component {\n  constructor(props) {\n    super(props)\n\n    this.handleToggleMenuClick = this.handleToggleMenuClick.bind(this)\n    this.evaluate = this.evaluate.bind(this)\n    this.handleClickSize = this.handleClickSize.bind(this)\n    this.handleClickError = this.handleClickError.bind(this)\n    this.resize = _.debounce(this.resize.bind(this), 100)\n    this.handleBlur = this.handleBlur.bind(this)\n\n    window.addEventListener('resize', this.resize)\n\n    this.state = {\n      showSize: false,\n      errors: [],\n      logs: []\n    }\n  }\n\n  noop() {}\n\n  resize() {\n    if (this.isLoaded) {\n      this.evaluate()\n    }\n  }\n\n  handleToggleMenuClick() {\n    this.props.toggleMenu()\n  }\n\n  handleClickSize() {\n    this.setState({\n      showSize: !this.state.showSize\n    })\n  }\n\n  handleBlur(e) {\n    if (this.props.run) {\n      e.currentTarget.focus()\n    }\n  }\n\n  handleClickError({ line, column }) {\n    const { game, setCodeTab, setErrorLine } = this.props\n    const tabAndTabLine = gameLineToTabLine({\n      game,\n      gameLine: line\n    })\n    if (tabAndTabLine) {\n      const { tab, tabLine } = tabAndTabLine\n      setCodeTab(tab)\n      setErrorLine({ line: tabLine - 1, timestamp: Date.now() })\n    }\n  }\n\n  componentDidMount() {\n    this._iframe.focus()\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.run) {\n      this._iframe.focus()\n    }\n    if (this.isLoaded) {\n      if (\n        JSON.stringify([\n          prevProps.iframeVersion,\n          prevProps.game,\n          prevProps.finishBoot,\n          prevProps.run,\n          prevProps.songs,\n          prevProps.chains,\n          prevProps.phrases,\n          prevProps.sprites,\n          prevProps.map,\n          prevProps.screen,\n          prevProps.sound,\n          prevProps.gist,\n          prevProps.setScreen,\n          prevProps.saveGist,\n          prevProps.token\n        ]) !==\n        JSON.stringify([\n          this.props.iframeVersion,\n          this.props.game,\n          this.props.finishBoot,\n          this.props.run,\n          this.props.songs,\n          this.props.chains,\n          this.props.phrases,\n          this.props.sprites,\n          this.props.map,\n          this.props.screen,\n          this.props.sound,\n          this.props.gist,\n          this.props.setScreen,\n          this.props.saveGist,\n          this.props.token\n        ])\n      ) {\n        this.evaluate()\n      }\n    }\n    if (\n      assembleOrderedGame(this.props.game) !==\n      assembleOrderedGame(prevProps.game)\n    ) {\n      this.setState({\n        logs: []\n      })\n    }\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.resize)\n  }\n\n  evaluate() {\n    const {\n      game,\n      finishBoot,\n      run,\n      songs,\n      chains,\n      phrases,\n      sprites,\n      map,\n      screen,\n      sound,\n      gist,\n      setScreen,\n      saveGist,\n      token\n    } = this.props\n\n    // Create a closured function for eval'ing the game.\n    const sendPayload = (callbacks = {}) => {\n      const channel = new window.MessageChannel()\n      if (this._iframe) {\n        this._iframe.contentWindow.postMessage(\n          {\n            type: 'callCode',\n            game: assembleOrderedGame(game),\n            isDoneFetching:\n              screen === screenTypes.BOOT && !gist.isFetching && gist.data,\n            songs,\n            chains,\n            phrases,\n            sprites,\n            map,\n            run,\n            callbacks,\n            sound\n          },\n          '*',\n          [channel.port2]\n        )\n        channel.port1.onmessage = e => {\n          if (e.data.callback === 'finishBoot') {\n            finishBoot()\n          }\n          const { height, errors, logs, shortcut } = e.data\n          if (height && this._iframe) {\n            this._iframe.height = height\n          }\n          if (errors) {\n            this.setState({ errors })\n          }\n          if (!_.isNil(logs)) {\n            this.setState({ logs })\n          }\n          if (shortcut) {\n            if (shortcut === 'save') {\n              // If we're logged in,\n              // and we can save,\n              if (token.value && canRecord(this.props)) {\n                // save.\n                saveGist(this.props)\n              }\n            }\n            if (shortcut === 'previous') {\n              setScreen(getPreviousScreen(screen))\n            }\n            if (shortcut === 'next') {\n              setScreen(getNextScreen(screen))\n            }\n          }\n        }\n      }\n    }\n\n    // If we're on the boot screen,\n    // ignore validation.\n    if (screen === screenTypes.BOOT) {\n      sendPayload({\n        endCallback: 'finishBoot'\n      })\n    } else {\n      // Validate code before drawing.\n      getLintErrors({\n        // Don't decorate the code because it does lint disallowed things\n        text: assembleOrderedGame(game, false)\n      }).then(errors => {\n        if (!errors.length) {\n          sendPayload()\n        } else {\n          // If we had errors, print them to console.\n          console.warn(errors[0].message)\n        }\n      })\n    }\n  }\n\n  render() {\n    const { errors, logs } = this.state\n    const { run, tutorial, game, iframeVersion, hideMenu, screen } = this.props\n    const gameTitle = getGameTitle(game)\n    document.title = [gameTitle, 'SCRIPT-8'].filter(d => d).join(' - ')\n\n    const tokenCount = throttledTokenCount(game)\n\n    const iframeUrl =\n      process.env.NODE_ENV !== 'production'\n        ? process.env.REACT_APP_IFRAME_URL\n        : `${process.env.REACT_APP_IFRAME_URL}/iframe-v${iframeVersion}.html`\n\n    return (\n      <div\n        className={classNames('Output', {\n          'in-tutorial': tutorial && run\n        })}\n      >\n        <iframe\n          src={iframeUrl}\n          title=\"SCRIPT-8\"\n          sandbox=\"allow-scripts allow-same-origin\"\n          // onBlur={this.handleBlur}\n          ref={_iframe => {\n            this._iframe = _iframe\n          }}\n          onLoad={() => {\n            this.isLoaded = true\n            this.evaluate()\n          }}\n        />\n        {!run ? (\n          <div className=\"errors-and-stats\">\n            {logs.map(log => (\n              <div className=\"log\">log: {JSON.stringify(log)}</div>\n            ))}\n            <ul className=\"errors\">\n              {errors.map(({ type, data: { message, position } }) =>\n                position ? (\n                  <li\n                    className=\"clickable\"\n                    key={type}\n                    onClick={() => this.handleClickError(position)}\n                  >\n                    > error: {message}\n                  </li>\n                ) : (\n                  <li key={type}>error: {message}</li>\n                )\n              )}\n            </ul>\n            <div className=\"stats\">TOKENS: {tokenCount}</div>\n          </div>\n        ) : screen === screenTypes.BOOT ? null : (\n          <button\n            className=\"button togglemenu\"\n            onClick={this.handleToggleMenuClick}\n          >\n            {hideMenu ? 'show' : 'hide'} menu\n          </button>\n        )}\n      </div>\n    )\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Output)\n","const replaceAt = (str, index, replacement) =>\n  str.substr(0, index) +\n  replacement +\n  str.substr(index + replacement.toString().length)\n\nconst numberWithCommas = x => {\n  var parts = x.toString().split('.')\n  parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')\n  return parts.join('.')\n}\n\nexport { replaceAt, numberWithCommas }\n","const drawLine = ({ x1, y1, x2, y2, setPixel, color }) => {\n  let steep = false\n\n  if (Math.abs(x1 - x2) < Math.abs(y1 - y2)) {\n    ;[x1, y1] = [y1, x1]\n    ;[x2, y2] = [y2, x2]\n    steep = true\n  }\n  if (x1 > x2) {\n    ;[x1, x2] = [x2, x1]\n    ;[y1, y2] = [y2, y1]\n  }\n\n  const dx = x2 - x1\n  const dy = y2 - y1\n  const derror = Math.abs(dy) * 2\n  let error = 0\n  let y = y1\n\n  for (let x = x1; x <= x2; x++) {\n    if (steep) {\n      setPixel(y, x, color)\n    } else {\n      setPixel(x, y, color)\n    }\n    error += derror\n    if (error > dx) {\n      if (y2 > y1) {\n        y++\n      } else {\n        y--\n      }\n      error -= dx * 2\n    }\n  }\n}\n\nexport default drawLine\n","const drawPolyStroke = ({ points, args, line }) => {\n  if (!points.length) {\n    return\n  }\n  let c, newPoints, xRot, yRot, midX, midY\n  switch (args.length) {\n    case 1:\n      // polyStroke(points, color)\n      newPoints = points.map(p => [...p])\n      c = args[0]\n      break\n    case 2:\n      // polyStroke(points, rotate, color)\n      xRot = Math.cos((args[0] / 180) * Math.PI)\n      yRot = Math.sin((args[0] / 180) * Math.PI)\n      const xs = points.map(p => p[0])\n      const ys = points.map(p => p[1])\n      midX = (Math.min.apply(Math, xs) + Math.max.apply(Math, xs)) / 2\n      midY = (Math.min.apply(Math, ys) + Math.max.apply(Math, ys)) / 2\n      newPoints = points.map(p => [\n        (p[0] - midX) * xRot - (p[1] - midY) * yRot + midX,\n        (p[0] - midX) * yRot + (p[1] - midY) * xRot + midY\n      ])\n      c = args[1]\n      break\n    case 3:\n      throw Error('`polyStroke` found 3 arguments instead of 2, 3, or 5.')\n    default:\n      // polyStroke(points, rotate, x, y, color)\n      xRot = Math.cos((args[0] / 180) * Math.PI)\n      yRot = Math.sin((args[0] / 180) * Math.PI)\n      midX = args[1]\n      midY = args[2]\n      c = args[3]\n      newPoints = points.map(p => [\n        (p[0] - midX) * xRot - (p[1] - midY) * yRot + midX,\n        (p[0] - midX) * yRot + (p[1] - midY) * xRot + midY\n      ])\n      break\n  }\n  for (let i = 1; i < points.length; i++) {\n    line(\n      Math.round(newPoints[i - 1][0]), // x1\n      Math.round(newPoints[i - 1][1]), // y1\n      Math.round(newPoints[i][0]), // x2\n      Math.round(newPoints[i][1]), // y2\n      c\n    )\n  }\n  line(\n    Math.round(newPoints[newPoints.length - 1][0]), // x1\n    Math.round(newPoints[newPoints.length - 1][1]), // y1\n    Math.round(newPoints[0][0]), // x2\n    Math.round(newPoints[0][1]), // y2\n    c\n  )\n}\n\nexport default drawPolyStroke\n","const drawCircle = ({ cx, cy, radius, color, onlyStroke, setPixel, line }) => {\n  let x = radius - 1\n  let y = 0\n  let dx = 1\n  let dy = 1\n  let err = dx - (radius << 1)\n\n  // Draw the correct primitive at x offset from the center, and y above and below the center\n  // If onlyStroke, then draw two points\n  // otherwise, draw a line connecting the two points\n  const drawReflectedPair = (x, y) => {\n    if (onlyStroke) {\n      setPixel(cx + x, cy + y, color)\n      setPixel(cx + x, cy - y, color)\n    } else {\n      line(cx + x, cy + y, cx + x, cy - y, color)\n    }\n  }\n\n  if (radius === 2) {\n    // Draw Left Pixel\n    drawReflectedPair(-1, 0)\n    // Draw Top and Bottom Pixels\n    drawReflectedPair(0, 1)\n    // Draw Right Pixel\n    drawReflectedPair(1, 0)\n  } else if (radius === 3) {\n    // Draw Left Edge\n    drawReflectedPair(-2, 0)\n    drawReflectedPair(-2, 1)\n    // Draw Top and Bottom Edge\n    drawReflectedPair(-1, 2)\n    drawReflectedPair(-0, 2)\n    drawReflectedPair(1, 2)\n    // Draw Right Edge\n    drawReflectedPair(2, 1)\n    drawReflectedPair(2, 0)\n  } else {\n    while (x >= y) {\n      // Draw every octant\n      drawReflectedPair(x, y)\n      drawReflectedPair(-x, y)\n      drawReflectedPair(y, x)\n      drawReflectedPair(-y, x)\n\n      if (err <= 0) {\n        y++\n        err += dy\n        dy += 2\n      }\n\n      if (err > 0) {\n        x--\n        dx += 2\n        err += dx - (radius << 1)\n      }\n    }\n  }\n\n}\n\nexport default drawCircle\n","import clamp from 'lodash/clamp'\n\nconst drawSprite = ({ x, y, spriteIndex, darken, flipH, flipV, setPixel, sprites }) => {\n  if (sprites[spriteIndex]) {\n    sprites[spriteIndex].slice(0, 8).forEach((cells, rowIndex) => {\n      cells.split('').forEach((color, colIndex) => {\n        if (color !== ' ') {\n          const clamped = clamp(+color - darken, 0, 7)\n          setPixel(\n            Math.floor(x) + (flipH ? 7 - colIndex : colIndex),\n            Math.floor(y) + (flipV ? 7 - rowIndex : rowIndex),\n            clamped)\n        }\n      })\n    })\n  }\n}\n\nexport default drawSprite\n","const alphabet = {\n  '<': [\n    0, 0, 1,\n    0, 1, 0,\n    1, 0, 0,\n    0, 1, 0,\n    0, 0, 1,\n    0, 0, 0,\n  ],\n  '>': [\n    1, 0, 0,\n    0, 1, 0,\n    0, 0, 1,\n    0, 1, 0,\n    1, 0, 0,\n    0, 0, 0,\n  ],\n  '/': [\n    0, 0, 0,\n    0, 0, 1,\n    0, 1, 0,\n    0, 1, 0,\n    1, 0, 0,\n    0, 0, 0,\n  ],\n  ':': [\n    0, 0, 0,\n    0, 0, 0,\n    0, 1, 0,\n    0, 0, 0,\n    0, 1, 0,\n    0, 0, 0,\n  ],\n  '|': [\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    0, 0, 0,\n  ],\n  '(': [\n    0, 1,\n    1, 0,\n    1, 0,\n    1, 0,\n    0, 1,\n    0, 0,\n  ],\n  ')': [\n    1, 0,\n    0, 1,\n    0, 1,\n    0, 1,\n    1, 0,\n    0, 0,\n  ],\n  0: [\n    0, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  1: [\n    1, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  2: [\n    1, 1, 1,\n    0, 0, 1,\n    1, 1, 1,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  3: [\n    1, 1, 1,\n    0, 0, 1,\n    0, 1, 1,\n    0, 0, 1,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  4: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 1,\n    0, 0, 1,\n    0, 0, 0,\n  ],\n  5: [\n    1, 1, 1,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 1,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  6: [\n    1, 0, 0,\n    1, 0, 0,\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  7: [\n    1, 1, 1,\n    0, 0, 1,\n    0, 0, 1,\n    0, 0, 1,\n    0, 0, 1,\n    0, 0, 0,\n  ],\n  8: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  9: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 1,\n    0, 0, 1,\n    0, 0, 0,\n  ],\n\n  ' ': [\n    0, 0,\n    0, 0,\n    0, 0,\n    0, 0,\n    0, 0,\n    0, 0\n  ],\n  '.': [\n    0,\n    0,\n    0,\n    0,\n    1,\n    0,\n  ],\n  ',': [\n    0,\n    0,\n    0,\n    0,\n    1,\n    1,\n  ],\n  '+': [\n    0, 0, 0,\n    0, 1, 0,\n    1, 1, 1,\n    0, 1, 0,\n    0, 0, 0,\n    0, 0, 0\n  ],\n  '-': [\n    0, 0, 0,\n    0, 0, 0,\n    1, 1, 1,\n    0, 0, 0,\n    0, 0, 0,\n    0, 0, 0\n  ],\n  '!': [\n    1,\n    1,\n    1,\n    0,\n    1,\n    0,\n  ],\n  '?': [\n    1, 1,\n    0, 1,\n    1, 1,\n    0, 0,\n    1, 0,\n    0, 0,\n  ],\n  a: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  b: [\n    1, 1, 0,\n    1, 0, 1,\n    1, 1, 0,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  c: [\n    1, 1, 1,\n    1, 0, 0,\n    1, 0, 0,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  d: [\n    1, 1, 0,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  e: [\n    1, 1, 1,\n    1, 0, 0,\n    1, 1, 1,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  f: [\n    1, 1, 1,\n    1, 0, 0,\n    1, 1, 1,\n    1, 0, 0,\n    1, 0, 0,\n    0, 0, 0\n  ],\n  g: [\n    1, 1, 1,\n    1, 0, 0,\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  h: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  i: [\n    1, 1, 1,\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  j: [\n    0, 0, 1,\n    0, 0, 1,\n    0, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  k: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 0,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  l: [\n    1, 0, 0,\n    1, 0, 0,\n    1, 0, 0,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  m: [\n    1, 0, 1,\n    1, 1, 1,\n    1, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  n: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  o: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  p: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 1,\n    1, 0, 0,\n    1, 0, 0,\n    0, 0, 0\n  ],\n  q: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    0, 1, 1,\n    0, 0, 0\n  ],\n  r: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 0,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  s: [\n    1, 1, 1,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  t: [\n    1, 1, 1,\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    0, 0, 0\n  ],\n  u: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  v: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 0,\n    0, 0, 0\n  ],\n  w: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    1, 1, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  x: [\n    1, 0, 1,\n    1, 0, 1,\n    0, 1, 0,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  y: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  z: [\n    1, 1, 1,\n    0, 0, 1,\n    0, 1, 0,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 0\n  ],\n}\n\nexport default alphabet\n","import alphabet from './alphabet.js'\n\nconst drawText = ({ x, y, letters, c, setPixel }) => {\n  let currentX = Math.floor(x)\n  let currentY = Math.floor(y)\n\n  // Loop over every letter in the string to print.\n  for (let letter of letters.toString().split('')) {\n    // Lookup the pixels for the given letter.\n    const pixels = alphabet[letter.toLowerCase()]\n    // If we don't have any pixels, then treat this character as a space which\n    // is 3 pixels wide and continue to the next character.\n    if (!pixels) {\n      currentX += 3 // Couldn't find a character\n      continue\n    }\n\n    // Calculate the letter width by dividing the pixel count\n    // by the standard letter height of 6.\n    let letterWidth = pixels.length / 6\n\n    // Loop over every pixel and draw it to the screen.\n    for (let x = 0; x < letterWidth; x++) {\n      for (let y = 0; y < 6; y++) {\n        if (pixels[y * letterWidth + x]) {\n          setPixel(currentX + x, currentY + y, c)\n        }\n      }\n    }\n\n    // Move on to the next character position by moving the previous character\n    // width plus 1 for a slight space between characters.\n    currentX += letterWidth + 1\n  }\n}\n\nexport default drawText\n","import { get } from 'lodash'\nimport colors from '../colors.js'\nimport drawLine from './line.js'\nimport drawPolyStroke from './polyStroke.js'\nimport { drawRectStroke, drawRectFill } from './rect.js'\nimport drawCircle from './circle.js'\nimport drawSprite from './sprite.js'\nimport drawText from './print.js'\n\nconst backgroundColor = 7\n\n// This function is used in the hover highlight functionality. It is stored on the user inaccessible _script8 global\n// variable and takes as argument a lambda wrapping some user expression. The flag `shouldHighlight` is then set to true\n// while the passed in code is running and returned to false when it finishes. `shouldHighlight` is used to modify\n// colors while true to indicate to the user how a given function call effects the drawing on the screen\nexport let shouldHighlight = false\nexport const injectHighlight = (code) => {\n  shouldHighlight  = true\n  let result = code()\n  shouldHighlight = false\n  return result\n}\n\nconst canvasAPI = ({\n  pixels,\n  width: canvasWidth,\n  height: canvasHeight,\n  sprites,\n  // Rename to initialMap, since we have a function named map.\n  map: initialMap = []\n}) => {\n\n  let _runningMap = JSON.parse(JSON.stringify(initialMap))\n  let _cameraX = 0\n  let _cameraY = 0\n  let _colorSwaps = {}\n\n  const camera = (x = 0, y = 0) => {\n    _cameraX = Math.floor(x)\n    _cameraY = Math.floor(y)\n  }\n\n  const clear = (c = 7) => {\n    pixels.fill(colors.int(c))\n  }\n\n  const colorSwap = (from, to) => {\n    if (from === undefined && to === undefined) {\n      _colorSwaps = {}\n    } else {\n      _colorSwaps[colors.int(from)] = colors.int(to)\n    }\n  }\n\n  const setPixel = (x, y, c = 0) => {\n    x = Math.floor(x - _cameraX)\n    y = Math.floor(y - _cameraY)\n    if (x < 0 || x >= canvasWidth || y < 0 || y >= canvasHeight) return\n    const int = colors.int(c)\n    if (int) {\n      const newColor = _colorSwaps[int] || int\n      pixels[y * canvasWidth + x] = newColor\n    }\n  }\n\n  const getPixel = (x, y) => {\n    x = Math.floor(x - _cameraX)\n    y = Math.floor(y - _cameraY)\n    if (x < 0 || x >= canvasWidth || y < 0 || y >= canvasHeight)\n      return backgroundColor\n    return colors.lookupInt(pixels[y * canvasHeight + x])\n  }\n\n  const line = (x1, y1, x2, y2, c = 0) => {\n    drawLine({ x1, y1, x2, y2, setPixel, color: c })\n  }\n\n  const polyStroke = (points, ...args) => {\n    drawPolyStroke({ points, args, line })\n  }\n\n  const rectStroke = (x, y, w, h, c = 0) => {\n    drawRectStroke({\n      x,\n      y,\n      w,\n      h,\n      c,\n      line\n    })\n  }\n\n  const rectFill = (x, y, w, h, c = 0) => {\n    drawRectFill({\n      x,\n      y,\n      w,\n      h,\n      c,\n      line\n    })\n  }\n\n  const circStroke = (x, y, r, c = 0) => {\n    drawCircle({\n      cx: Math.floor(x),\n      cy: Math.floor(y),\n      radius: Math.floor(r),\n      color: c,\n      onlyStroke: true,\n      setPixel,\n      line\n    })\n  }\n\n  const circFill = (x, y, r, c = 0) => {\n    drawCircle({\n      cx: Math.floor(x),\n      cy: Math.floor(y),\n      radius: Math.floor(r),\n      color: c,\n      setPixel,\n      line\n    })\n  }\n\n  const print = (x, y, letters, c = 0) => {\n    drawText({\n      x,\n      y,\n      letters,\n      c,\n      setPixel\n    })\n  }\n\n  const sprite = (\n    x,\n    y,\n    spriteIndex,\n    darken = 0,\n    flipH = false,\n    flipV = false\n  ) => {\n    if (x - _cameraX < -8 || x - _cameraX > canvasWidth) return\n    if (y - _cameraY < -8 || y - _cameraY > canvasHeight) return\n\n    drawSprite({\n      x,\n      y,\n      spriteIndex,\n      darken,\n      flipH,\n      flipV,\n      setPixel,\n      sprites\n    })\n  }\n\n  const getTile = (mx, my) => {\n    const tile = get(_runningMap, [my, mx], null)\n    const result = tile !== null ? sprites[tile] : null\n    if (result) {\n      result.type = result[8] || 0\n      result.number = tile\n    }\n    return result\n  }\n\n  const setTile = (mx, my, spriteNumber) => {\n    _runningMap[my][mx] = spriteNumber\n  }\n\n  const map = (x = 0, y = 0) => {\n    // Loop over every element in the map\n    _runningMap.forEach((row, rowNumber) => {\n      row.forEach((spriteIndex, colNumber) => {\n        // If the element has a sprite index,\n        if (spriteIndex !== null) {\n          // Render at the correct offset position\n          const dx = (colNumber + x) * 8\n          const dy = (rowNumber + y) * 8\n          sprite(dx, dy, spriteIndex)\n        }\n      })\n    })\n  }\n\n  const resetMap = () => {\n    _runningMap = JSON.parse(JSON.stringify(initialMap))\n  }\n\n  return {\n    camera,\n    clear,\n    colorSwap,\n    setPixel,\n    getPixel,\n    line,\n    polyStroke,\n    rectStroke,\n    rectFill,\n    circStroke,\n    circFill,\n    print,\n    sprite,\n    getTile,\n    setTile,\n    map,\n    resetMap\n  }\n}\n\nexport default canvasAPI\n","export const drawRectStroke = ({ x, y, w, h, c, line }) => {\n  let left = Math.floor(x)\n  let right = Math.floor(x + w - 1)\n  let top = Math.floor(y)\n  let bottom = Math.floor(y + h - 1)\n  line(left, top, right, top, c)\n  line(left, bottom, right, bottom, c)\n  line(left, top, left, bottom, c)\n  line(right, top, right, bottom, c)\n}\n\nexport const drawRectFill = ({ x, y, w, h, c, line }) => {\n  let left = Math.floor(x)\n  let right = Math.floor(x + w - 1)\n  let top = Math.floor(y)\n  let bottom = Math.floor(y + h - 1)\n\n  for (let rectX = left; rectX <= right; rectX++) {\n    line(rectX, top, rectX, bottom, c)\n  }\n}\n","const circle = ({ cx, cy, radius, ctx, color, onlyStroke }) => {\n  let x = radius - 1\n  let y = 0\n  let dx = 1\n  let dy = 1\n  let err = dx - (radius << 1)\n\n  ctx.fillStyle = color\n  ctx.strokeStyle = color\n\n  const drawPixel = (x, y) => {\n    ctx.fillRect(x, y, 1, 1)\n  }\n\n  const drawLine = ({ x0, x1, y }) => {\n    ctx.beginPath()\n    ctx.moveTo(x0 + 1, y + 0.5)\n    ctx.lineTo(x1, y + 0.5)\n    ctx.stroke()\n  }\n\n  if (radius === 2) {\n    drawPixel(cx + 1, cy)\n    drawPixel(cx - 1, cy)\n    drawPixel(cx, cy + 1)\n    drawPixel(cx, cy - 1)\n    if (!onlyStroke) {\n      drawPixel(cx, cy)\n    }\n  } else if (radius === 3) {\n    drawLine({ x0: cx - 2, x1: cx + 2, y: cy - 2 })\n    drawLine({ x0: cx - 2, x1: cx + 2, y: cy + 2 })\n    if (onlyStroke) {\n      drawPixel(cx + 2, cy - 1)\n      drawPixel(cx + 2, cy)\n      drawPixel(cx + 2, cy + 1)\n      drawPixel(cx - 2, cy - 1)\n      drawPixel(cx - 2, cy)\n      drawPixel(cx - 2, cy + 1)\n    } else {\n      drawLine({ x0: cx - 3, x1: cx + 3, y: cy - 1 })\n      drawLine({ x0: cx - 3, x1: cx + 3, y: cy })\n      drawLine({ x0: cx - 3, x1: cx + 3, y: cy + 1 })\n    }\n  } else {\n    while (x >= y) {\n      if (onlyStroke) {\n        drawPixel(cx + x, cy + y)\n        drawPixel(cx - x, cy + y)\n        drawPixel(cx + y, cy + x)\n        drawPixel(cx - y, cy + x)\n        drawPixel(cx + x, cy - y)\n        drawPixel(cx - x, cy - y)\n        drawPixel(cx + y, cy - x)\n        drawPixel(cx - y, cy - x)\n      } else {\n        drawLine({ x0: cx + y, x1: cx - y, y: cy - x })\n        drawLine({ x0: cx + x, x1: cx - x, y: cy - y })\n        drawLine({ x0: cx + x, x1: cx - x, y: cy + y })\n        drawLine({ x0: cx + y, x1: cx - y, y: cy + x })\n      }\n      if (err <= 0) {\n        y++\n        err += dy\n        dy += 2\n      }\n      if (err > 0) {\n        x--\n        dx += 2\n        err += dx - (radius << 1)\n      }\n    }\n  }\n}\n\nexport default circle\n","const line = ({ x1, y1, x2, y2, ctx, color }) => {\n  ctx.fillStyle = color\n  let steep = false\n\n  if (Math.abs(x1 - x2) < Math.abs(y1 - y2)) {\n    ;[x1, y1] = [y1, x1]\n    ;[x2, y2] = [y2, x2]\n    steep = true\n  }\n  if (x1 > x2) {\n    ;[x1, x2] = [x2, x1]\n    ;[y1, y2] = [y2, y1]\n  }\n\n  const dx = x2 - x1\n  const dy = y2 - y1\n  const derror = Math.abs(dy) * 2\n  let error = 0\n  let y = y1\n\n  for (let x = x1; x <= x2; x++) {\n    if (steep) {\n      ctx.fillRect(y, x, 1, 1)\n    } else {\n      ctx.fillRect(x, y, 1, 1)\n    }\n    error += derror\n    if (error > dx) {\n      if (y2 > y1) {\n        y++\n      } else {\n        y--\n      }\n      error -= dx * 2\n    }\n  }\n}\n\nexport default line\n","import colors from '../colors.js'\nimport line from './line.js'\n\nconst polyStroke = ({ points, args, ctx }) => {\n  if (!points.length) {\n    return\n  }\n  let c, newPoints, xRot, yRot, midX, midY\n  switch (args.length) {\n    case 1:\n      // polyStroke(points, color)\n      newPoints = points.map(p => [...p])\n      c = args[0]\n      break\n    case 2:\n      // polyStroke(points, rotate, color)\n      xRot = Math.cos((args[0] / 180) * Math.PI)\n      yRot = Math.sin((args[0] / 180) * Math.PI)\n      const xs = points.map(p => p[0])\n      const ys = points.map(p => p[1])\n      midX = (Math.min.apply(Math, xs) + Math.max.apply(Math, xs)) / 2\n      midY = (Math.min.apply(Math, ys) + Math.max.apply(Math, ys)) / 2\n      newPoints = points.map(p => [\n        (p[0] - midX) * xRot - (p[1] - midY) * yRot + midX,\n        (p[0] - midX) * yRot + (p[1] - midY) * xRot + midY\n      ])\n      c = args[1]\n      break\n    case 3:\n      throw Error('`polyStroke` found 3 arguments instead of 2, 3, or 5.')\n    default:\n      // polyStroke(points, rotate, x, y, color)\n      xRot = Math.cos((args[0] / 180) * Math.PI)\n      yRot = Math.sin((args[0] / 180) * Math.PI)\n      midX = args[1]\n      midY = args[2]\n      c = args[3]\n      newPoints = points.map(p => [\n        (p[0] - midX) * xRot - (p[1] - midY) * yRot + midX,\n        (p[0] - midX) * yRot + (p[1] - midY) * xRot + midY\n      ])\n      break\n  }\n  for (let i = 1; i < points.length; i++) {\n    line({\n      x1: Math.round(newPoints[i - 1][0]),\n      y1: Math.round(newPoints[i - 1][1]),\n      x2: Math.round(newPoints[i][0]),\n      y2: Math.round(newPoints[i][1]),\n      ctx,\n      color: colors.rgb(c)\n    })\n  }\n  line({\n    x1: Math.round(newPoints[newPoints.length - 1][0]),\n    y1: Math.round(newPoints[newPoints.length - 1][1]),\n    x2: Math.round(newPoints[0][0]),\n    y2: Math.round(newPoints[0][1]),\n    ctx,\n    color: colors.rgb(c)\n  })\n}\n\nexport default polyStroke\n","const alphabet = {\n  '<': [\n    0, 0, 1,\n    0, 1, 0,\n    1, 0, 0,\n    0, 1, 0,\n    0, 0, 1,\n    0, 0, 0,\n  ],\n  '>': [\n    1, 0, 0,\n    0, 1, 0,\n    0, 0, 1,\n    0, 1, 0,\n    1, 0, 0,\n    0, 0, 0,\n  ],\n  '/': [\n    0, 0, 0,\n    0, 0, 1,\n    0, 1, 0,\n    0, 1, 0,\n    1, 0, 0,\n    0, 0, 0,\n  ],\n  ':': [\n    0, 0, 0,\n    0, 0, 0,\n    0, 1, 0,\n    0, 0, 0,\n    0, 1, 0,\n    0, 0, 0,\n  ],\n  '|': [\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    0, 0, 0,\n  ],\n  '(': [\n    0, 1,\n    1, 0,\n    1, 0,\n    1, 0,\n    0, 1,\n    0, 0,\n  ],\n  ')': [\n    1, 0,\n    0, 1,\n    0, 1,\n    0, 1,\n    1, 0,\n    0, 0,\n  ],\n  0: [\n    0, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  1: [\n    1, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  2: [\n    1, 1, 1,\n    0, 0, 1,\n    1, 1, 1,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  3: [\n    1, 1, 1,\n    0, 0, 1,\n    0, 1, 1,\n    0, 0, 1,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  4: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 1,\n    0, 0, 1,\n    0, 0, 0,\n  ],\n  5: [\n    1, 1, 1,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 1,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  6: [\n    1, 0, 0,\n    1, 0, 0,\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  7: [\n    1, 1, 1,\n    0, 0, 1,\n    0, 0, 1,\n    0, 0, 1,\n    0, 0, 1,\n    0, 0, 0,\n  ],\n  8: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  9: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 1,\n    0, 0, 1,\n    0, 0, 0,\n  ],\n\n  ' ': [\n    0, 0,\n    0, 0,\n    0, 0,\n    0, 0,\n    0, 0,\n    0, 0\n  ],\n  '.': [\n    0,\n    0,\n    0,\n    0,\n    1,\n    0,\n  ],\n  ',': [\n    0,\n    0,\n    0,\n    0,\n    1,\n    1,\n  ],\n  '+': [\n    0, 0, 0,\n    0, 1, 0,\n    1, 1, 1,\n    0, 1, 0,\n    0, 0, 0,\n    0, 0, 0\n  ],\n  '-': [\n    0, 0, 0,\n    0, 0, 0,\n    1, 1, 1,\n    0, 0, 0,\n    0, 0, 0,\n    0, 0, 0\n  ],\n  '!': [\n    1,\n    1,\n    1,\n    0,\n    1,\n    0,\n  ],\n  '?': [\n    1, 1,\n    0, 1,\n    1, 1,\n    0, 0,\n    1, 0,\n    0, 0,\n  ],\n  a: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  b: [\n    1, 1, 0,\n    1, 0, 1,\n    1, 1, 0,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  c: [\n    1, 1, 1,\n    1, 0, 0,\n    1, 0, 0,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  d: [\n    1, 1, 0,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  e: [\n    1, 1, 1,\n    1, 0, 0,\n    1, 1, 1,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  f: [\n    1, 1, 1,\n    1, 0, 0,\n    1, 1, 1,\n    1, 0, 0,\n    1, 0, 0,\n    0, 0, 0\n  ],\n  g: [\n    1, 1, 1,\n    1, 0, 0,\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  h: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  i: [\n    1, 1, 1,\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  j: [\n    0, 0, 1,\n    0, 0, 1,\n    0, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  k: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 0,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  l: [\n    1, 0, 0,\n    1, 0, 0,\n    1, 0, 0,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  m: [\n    1, 0, 1,\n    1, 1, 1,\n    1, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  n: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  o: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  p: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 1,\n    1, 0, 0,\n    1, 0, 0,\n    0, 0, 0\n  ],\n  q: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    0, 1, 1,\n    0, 0, 0\n  ],\n  r: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 0,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  s: [\n    1, 1, 1,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  t: [\n    1, 1, 1,\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    0, 0, 0\n  ],\n  u: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  v: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 0,\n    0, 0, 0\n  ],\n  w: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    1, 1, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  x: [\n    1, 0, 1,\n    1, 0, 1,\n    0, 1, 0,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  y: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  z: [\n    1, 1, 1,\n    0, 0, 1,\n    0, 1, 0,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 0\n  ],\n}\n\nexport default alphabet\n","import colors from '../colors.js'\nimport alphabet from './alphabet.js'\n\nconst print = ({ x, y, letters, c, ctx }) => {\n  const color = colors.triplet(c)\n\n  const grids = letters\n    .toString()\n    // Split into individual letters.\n    .split('')\n    // Get the pixels and the letter's width.\n    .map(letter => {\n      const pixels = alphabet[letter.toLowerCase()]\n      return {\n        // If we found a matching letter in the alphabet,\n        // return its width.\n        // Otherwise if the user tries to print a character\n        // we haven't defined, just return 3.\n        width: pixels ? pixels.length / 6 : 3,\n        letter,\n        pixels\n      }\n    })\n    // Calculate running offsets.\n    .reduce((acc, current, index) => {\n      const previous = acc[index - 1]\n      const xOffset = previous ? previous.width + 1 + previous.xOffset : 0\n      const yOffset = previous ? previous.yOffset : 0\n\n      return [\n        ...acc,\n        {\n          ...current,\n          xOffset,\n          yOffset\n        }\n      ]\n    }, [])\n    // Ignore letters with no matches.\n    .filter(d => d.pixels)\n\n  // For each grid of pixels,\n  grids.forEach(grid => {\n    // get some properties,\n    const { pixels, xOffset, yOffset, width } = grid\n\n    // get the image data this letter will occupy,\n    const imageData = ctx.getImageData(x + xOffset, y + yOffset, width, 6)\n    const { data } = imageData\n\n    // and for each pixel,\n    pixels\n      .map((pixel, pixelIndex) => ({ pixel, pixelIndex }))\n      // ignore pixels set to 0,\n      .filter(d => d.pixel)\n      // and update the underlying canvas data.\n      .forEach(d => {\n        const offset = d.pixelIndex * 4\n        data[offset + 0] = color[0]\n        data[offset + 1] = color[1]\n        data[offset + 2] = color[2]\n        data[offset + 3] = 255\n      })\n\n    // And draw!\n    ctx.putImageData(imageData, x + xOffset, y + yOffset)\n  })\n}\n\nexport default print\n","import clamp from 'lodash/clamp'\nimport colors from '../colors.js'\n\nconst sprite = ({\n  x,\n  y,\n  spriteIndex,\n  darken = 0,\n  flipH = false,\n  flipV = false,\n  sprites,\n  ctx\n}) => {\n  if (sprites[spriteIndex]) {\n    sprites[spriteIndex].slice(0, 8).forEach((cells, rowIndex) => {\n      cells.split('').forEach((color, colIndex) => {\n        if (color !== ' ') {\n          const clamped = clamp(+color - darken, 0, 7)\n          ctx.fillStyle = colors.rgb(clamped)\n          ctx.fillRect(\n            Math.floor(x) + (flipH ? 7 - colIndex : colIndex),\n            Math.floor(y) + (flipV ? 7 - rowIndex : rowIndex),\n            1,\n            1\n          )\n        }\n      })\n    })\n  }\n}\n\nconst pixelSprite = ({ x, y, grid, ctx }) => {\n  grid.slice(0, 8).forEach((cells, rowIndex) => {\n    cells.split('').forEach((color, colIndex) => {\n      if (color !== ' ') {\n        ctx.fillStyle = colors.rgb(+color)\n        ctx.fillRect(Math.floor(x) + colIndex, Math.floor(y) + rowIndex, 1, 1)\n      }\n    })\n  })\n}\n\nexport { pixelSprite }\n\nexport default sprite\n","import { get, isNil } from 'lodash'\nimport colors from '../colors.js'\nimport circle from './circle.js'\nimport line from './line.js'\nimport polyStroke from './polyStroke.js'\nimport print from './print.js'\nimport sprite, { pixelSprite } from './sprite.js'\nimport { getPixel, setPixel } from './pixel.js'\n\n// let mapDraws = []\n// let avgDraws = []\n// let draws = 0\n// let skips = 0\n\nconst canvasAPI = ({\n  ctx,\n  width: canvasWidth,\n  height: canvasHeight,\n  sprites,\n  map = []\n}) => {\n  let _runningMap = JSON.parse(JSON.stringify(map))\n  ctx.setTransform(1, 0, 0, 1, 0, 0)\n\n  let _cameraX = 0\n\n  let _cameraY = 0\n\n  const _memoryCanvas = document.createElement('canvas')\n  _memoryCanvas.width = canvasWidth\n  _memoryCanvas.height = canvasHeight\n  const _mCtx = _memoryCanvas.getContext('2d')\n\n  Object.entries(sprites).forEach(([skey, value]) => {\n    const key = +skey\n    const row = Math.floor(key / 16)\n    const col = key % 16\n    pixelSprite({ x: col * 8, y: row * 8, grid: value, ctx: _mCtx })\n  })\n\n  return {\n    polyStroke(points, ...args) {\n      polyStroke({ points, args, ctx })\n    },\n\n    getTile(mx, my) {\n      const tile = get(_runningMap, [my, mx], null)\n      let result = tile !== null ? sprites[tile] : null\n      if (result) {\n        result.type = result[8] || 0\n        result.number = tile\n      }\n      return result\n    },\n\n    setTile(mx, my, spriteNumber) {\n      _runningMap[my][mx] = spriteNumber\n    },\n\n    line(x1, y1, x2, y2, c = 0) {\n      line({\n        x1: Math.floor(x1),\n        y1: Math.floor(y1),\n        x2: Math.floor(x2),\n        y2: Math.floor(y2),\n        ctx,\n        color: colors.rgb(c)\n      })\n    },\n\n    print(x, y, letters, c = 0) {\n      print({\n        x: x - _cameraX,\n        y: y - _cameraY,\n        letters,\n        c,\n        ctx\n      })\n    },\n\n    rectStroke(x, y, w, h, c = 0) {\n      ctx.strokeStyle = colors.rgb(c)\n      ctx.strokeRect(\n        Math.floor(x) + 0.5,\n        Math.floor(y) + 0.5,\n        Math.floor(w) - 1,\n        Math.floor(h) - 1\n      )\n    },\n\n    camera(x = 0, y = 0) {\n      _cameraX = Math.floor(x)\n      _cameraY = Math.floor(y)\n      ctx.setTransform(1, 0, 0, 1, 0, 0)\n      ctx.translate(-_cameraX, -_cameraY)\n    },\n\n    rectFill(x, y, w, h, c = 0) {\n      ctx.fillStyle = colors.rgb(c)\n      ctx.fillRect(Math.floor(x), Math.floor(y), Math.floor(w), Math.floor(h))\n    },\n\n    resetMap() {\n      _runningMap = JSON.parse(JSON.stringify(map))\n    },\n\n    map(x = 0, y = 0) {\n      // const before = Date.now()\n      _runningMap.forEach((row, rowNumber) => {\n        row.forEach((spriteIndex, colNumber) => {\n          if (spriteIndex !== null) {\n            const sx = (spriteIndex % 16) * 8\n            const sy = Math.floor(spriteIndex / 16) * 8\n            const sWidth = 8\n            const sHeight = 8\n            const dx = (colNumber + x) * 8\n            const dy = (rowNumber + y) * 8\n            const dWidth = 8\n            const dHeight = 8\n\n            if (\n              dx + 7 >= _cameraX &&\n              dx < _cameraX + 128 &&\n              dy + 7 >= _cameraY &&\n              dy < _cameraY + 128\n            ) {\n              // ++draws\n              ctx.drawImage(\n                _memoryCanvas,\n                sx,\n                sy,\n                sWidth,\n                sHeight,\n                dx,\n                dy,\n                dWidth,\n                dHeight\n              )\n            } else {\n              // ++skips\n            }\n          }\n        })\n      })\n\n      // const after = Date.now()\n      // mapDraws.push(after - before)\n      // if (mapDraws.length > 60) {\n      //   const avg = sum(mapDraws) / mapDraws.length\n      //   // console.log(`map() avg: ${sum(mapDraws) / mapDraws.length}ms`)\n      //   // console.log({ _cameraX, _cameraY })\n      //   mapDraws = []\n      //   avgDraws.push(avg)\n      //   if (avgDraws.length % 10 === 0) {\n      //     console.log(`AVG AVG: ${sum(avgDraws) / avgDraws.length}ms`)\n      //     console.log(`DRAWS/SKIPS: ${draws / skips} (${draws}/${skips})`)\n      //   }\n      // }\n    },\n\n    sprite(x, y, spriteIndex, darken = 0, flipH = false, flipV = false) {\n      sprite({\n        x,\n        y,\n        spriteIndex,\n        darken,\n        flipH,\n        flipV,\n        sprites,\n        ctx\n      })\n    },\n\n    circStroke(x, y, r, c = 0) {\n      circle({\n        cx: Math.floor(x),\n        cy: Math.floor(y),\n        radius: Math.floor(r),\n        ctx,\n        color: colors.rgb(c),\n        onlyStroke: true\n      })\n    },\n\n    circFill(x, y, r, c = 0) {\n      circle({\n        cx: Math.floor(x),\n        cy: Math.floor(y),\n        radius: Math.floor(r),\n        ctx,\n        color: colors.rgb(c)\n      })\n    },\n\n    clear(c) {\n      ctx.save()\n      ctx.setTransform(1, 0, 0, 1, 0, 0)\n      if (!isNil(c)) {\n        ctx.fillStyle = colors.rgb(c)\n        ctx.fillRect(0, 0, 128, 128)\n      } else {\n        ctx.clearRect(0, 0, canvasWidth, canvasHeight)\n      }\n      ctx.restore()\n    },\n\n    getPixel(x, y) {\n      return getPixel({\n        x: Math.floor(x - _cameraX),\n        y: Math.floor(y - _cameraY),\n        ctx\n      })\n    },\n\n    setPixel(x, y, c = 0) {\n      setPixel({\n        x: Math.floor(x),\n        y: Math.floor(y),\n        ctx,\n        color: colors.rgb(c)\n      })\n    }\n  }\n}\n\nexport default canvasAPI\n","import colors from '../colors.js'\n\nconst backgroundColor = 7\n\nconst getPixel = ({ x, y, ctx }) => {\n  // pixel: [r, g, b, a]\n  const [r, g, b, alpha] = ctx.getImageData(x, y, 1, 1).data\n\n  // If pixel isn't opaque, return default.\n  if (alpha !== 255) {\n    return backgroundColor\n  }\n\n  // If color wasn't recognized, return default.\n  const color = colors.lookup([r, g, b, alpha])\n  if (color === null) {\n    return backgroundColor\n  }\n\n  return color\n}\n\nconst setPixel = ({ x, y, ctx, color }) => {\n  ctx.fillStyle = color\n  ctx.fillRect(x, y, 1, 1)\n}\n\nexport { getPixel, setPixel }\n","import React, { Component } from 'react'\nimport { connect } from 'react-redux'\nimport _ from 'lodash'\nimport classNames from 'classnames'\nimport actions from '../actions/actions.js'\nimport canvasAPI from '../iframe/src/contextCanvasAPI/index.js'\nimport { replaceAt } from '../utils/string.js'\n\nconst mapStateToProps = ({ sprites }) => ({ sprites })\n\nconst mapDispatchToProps = dispatch => ({\n  updateSprite: ({ sprite, index }) =>\n    dispatch(\n      actions.updateSprite({\n        sprite,\n        index\n      })\n    )\n})\n\nclass Sprite extends Component {\n  constructor(props) {\n    super(props)\n\n    this.draw = this.draw.bind(this)\n    this.handleTypeClick = this.handleTypeClick.bind(this)\n    this.handleColorClick = this.handleColorClick.bind(this)\n    this.handleCanvasClick = this.handleCanvasClick.bind(this)\n    this.handleOnMouseDown = this.handleOnMouseDown.bind(this)\n    this.handleOnMouseEnter = this.handleOnMouseEnter.bind(this)\n    this.handleOnMouseUp = this.handleOnMouseUp.bind(this)\n    this.handleOnTouchMove = this.handleOnTouchMove.bind(this)\n    this.getCurrentSprite = this.getCurrentSprite.bind(this)\n    this.drawPixel = this.drawPixel.bind(this)\n    this.setMode = this.setMode.bind(this)\n\n    this.state = {\n      spriteIndex: 0,\n      colorIndex: 0,\n      mouseDown: false,\n      mode: '+'\n    }\n  }\n\n  draw() {\n    // Assign various properties to global scope, for the user.\n    const { sprites } = this.props\n    this.canvasAPI = canvasAPI({\n      ctx: this._canvas.getContext('2d'),\n      width: 128,\n      height: 64,\n      sprites\n    })\n\n    this.canvasAPI.clear()\n    Object.keys(sprites).forEach(skey => {\n      const key = +skey\n      const row = Math.floor(key / 16)\n      const col = key % 16\n      this.canvasAPI.sprite(col * 8, row * 8, key)\n    })\n  }\n\n  componentDidMount() {\n    this.draw()\n  }\n\n  getCurrentSprite() {\n    const { sprites } = this.props\n    const { spriteIndex } = this.state\n    return _.get(sprites, spriteIndex, _.range(8).map(d => '        '))\n  }\n\n  handleCanvasClick(spriteIndex) {\n    this.setState({ spriteIndex })\n  }\n\n  handleColorClick(colorIndex) {\n    this.setState({ colorIndex, mode: '+' })\n  }\n\n  handleTypeClick(typeIndex) {\n    const { spriteIndex } = this.state\n    const { updateSprite } = this.props\n    const sprite = this.getCurrentSprite()\n\n    const newSprite = [...sprite.slice(0, 8), typeIndex]\n\n    updateSprite({ sprite: newSprite, index: spriteIndex })\n  }\n\n  handleOnMouseDown(e) {\n    this.setState({\n      mouseDown: true\n    })\n    const { row, col } = e.target.dataset\n    this.drawPixel({ row: +row, col: +col })\n  }\n\n  handleOnMouseEnter(e) {\n    if (this.state.mouseDown) {\n      const { row, col } = e.target.dataset\n      this.drawPixel({ row: +row, col: +col })\n    }\n  }\n\n  handleOnMouseUp() {\n    this.setState({\n      mouseDown: false\n    })\n  }\n\n  handleOnTouchMove(e) {\n    if (this.state.mouseDown) {\n      const touchLocation = e.changedTouches[0]\n      const dataset = document.elementFromPoint(\n        touchLocation.clientX,\n        touchLocation.clientY\n      ).dataset\n      const { row, col } = dataset\n      if (row && col) {\n        this.drawPixel({ row: +row, col: +col })\n      }\n    }\n  }\n\n  setMode(mode) {\n    this.setState({\n      mode\n    })\n  }\n\n  drawPixel({ row, col }) {\n    const { spriteIndex, colorIndex, mode } = this.state\n    const { updateSprite } = this.props\n\n    const sprite = this.getCurrentSprite()\n\n    const newSprite = JSON.parse(JSON.stringify(sprite))\n\n    // Set it to the selected color.\n    newSprite[row] = replaceAt(\n      newSprite[row],\n      col,\n      mode === '+' ? colorIndex : ' '\n    )\n\n    updateSprite({ sprite: newSprite, index: spriteIndex })\n  }\n\n  componentDidUpdate() {\n    this.draw()\n  }\n\n  render() {\n    const { spriteIndex, colorIndex, mode } = this.state\n    const sprite = this.getCurrentSprite()\n    const isEmpty = !sprite.slice(0, 8).filter(d => d !== '        ').length\n    const typeIndex = sprite.length === 8 ? 0 : +sprite[8]\n    return (\n      <div\n        onMouseUp={this.handleOnMouseUp}\n        onTouchEnd={this.handleOnMouseUp}\n        className=\"Sprite two-rows-and-grid\"\n      >\n        <div className=\"main\">\n          <div className=\"SpriteEditor\">\n            <div className=\"sprite-and-colors\">\n              <table className=\"sprite\">\n                <tbody>\n                  {_.range(8).map(row => (\n                    <tr key={row}>\n                      {_.range(8).map(col => {\n                        const value = _.get(sprite, [row, col], ' ')\n                        return (\n                          <td key={col}>\n                            <button\n                              data-row={row}\n                              data-col={col}\n                              onMouseDown={this.handleOnMouseDown}\n                              onMouseEnter={this.handleOnMouseEnter}\n                              onTouchStart={this.handleOnMouseDown}\n                              onTouchMove={this.handleOnTouchMove}\n                              className={`background-${value}`}\n                            >\n                              {value === ' ' ? 'x' : ''}\n                            </button>\n                          </td>\n                        )\n                      })}\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n              <div className=\"colors-and-tools\">\n                <table className=\"colors\">\n                  <tbody>\n                    {_.range(2).map(row => (\n                      <tr key={row}>\n                        {_.range(0 + 4 * row, 4 + 4 * row).map(col => {\n                          return (\n                            <td\n                              key={col}\n                              className={classNames({\n                                active: col === colorIndex && mode === '+'\n                              })}\n                            >\n                              <button\n                                onClick={() => this.handleColorClick(col)}\n                                className={classNames(\n                                  `background-${col}`,\n                                  `border-${col}`,\n                                  {\n                                    active: col === colorIndex && mode === '+'\n                                  }\n                                )}\n                              />\n                            </td>\n                          )\n                        })}\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n                <div className=\"tools\">\n                  <div className=\"add-delete\">\n                    <button\n                      className={classNames('button', {\n                        active: mode === '+'\n                      })}\n                      onClick={() => {\n                        this.setMode('+')\n                      }}\n                    >\n                      +\n                    </button>\n\n                    <button\n                      className={classNames('button', {\n                        active: mode === '-'\n                      })}\n                      onClick={() => {\n                        this.setMode('-')\n                      }}\n                    >\n                      -\n                    </button>\n                  </div>\n                  <table className={classNames('types', { hide: isEmpty })}>\n                    <tbody>\n                      <tr>\n                        {_.range(4).map(i => {\n                          return (\n                            <td\n                              key={i}\n                              className={classNames({\n                                active: i === typeIndex\n                              })}\n                            >\n                              <button\n                                onClick={() => this.handleTypeClick(i)}\n                                className={classNames({\n                                  active: i === typeIndex\n                                })}\n                              >\n                                {i}\n                              </button>\n                            </td>\n                          )\n                        })}\n                      </tr>\n                    </tbody>\n                  </table>\n                </div>\n              </div>\n            </div>\n            <div className=\"sprites\">\n              <table>\n                <tbody>\n                  {_.range(8).map(row => (\n                    <tr key={row}>\n                      {_.range(16).map(col => {\n                        const thisSpriteIndex = row * 16 + col\n                        return (\n                          <td\n                            className={classNames({\n                              active: spriteIndex === thisSpriteIndex\n                            })}\n                            key={col}\n                          >\n                            <button\n                              onClick={() =>\n                                this.handleCanvasClick(thisSpriteIndex)\n                              }\n                            />\n                          </td>\n                        )\n                      })}\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n              <canvas\n                width={128}\n                height={64}\n                ref={_canvas => {\n                  this._canvas = _canvas\n                }}\n              />\n            </div>\n            <div className=\"sprite-number\">{spriteIndex}</div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Sprite)\n","const pixelData = ({ width, height }) => {\n  // Pixel data has the actual image data object which can be passed to putImageData.\n  const _pixelData = new ImageData(width, height)\n\n  // This contains the actual binary data for setting on _pixelData. It cannot\n  // be accessed directly, but is instead modified through TypedArrays such as\n  // Uint8ClampedArray and Uint32Array. Both the TypedArrays below refer to\n  // the same backing buffer, so modifying values via one will be reflected in\n  // the other.\n  const _pixelBuffer = new ArrayBuffer(4 * width * height)\n\n  // The pixelBytes array is only used to set the data in the _pixelData\n  // object. ImageData only has an Uint8ClampedArray to access the underlying\n  // bytes, so a Uint8ClampedArray must be kept around to copy the data.\n  const _pixelBytes = new Uint8ClampedArray(_pixelBuffer)\n\n  // It turns out that setting pixels all at once via a single integer is much\n  // faster than setting each byte individually. So the pixel data is only\n  // ever modified via the Uint32Array for performance reasons.\n  const _pixelIntegers = new Uint32Array(_pixelBuffer)\n\n  const writePixelDataToCanvas = ctx => {\n    _pixelData.data.set(_pixelBytes)\n    ctx.putImageData(_pixelData, 0, 0)\n  }\n\n  return {\n    pixels: _pixelIntegers,\n    writePixelDataToCanvas\n  }\n}\n\nexport default pixelData\n","import React, { Component } from 'react'\nimport { connect } from 'react-redux'\nimport _ from 'lodash'\nimport classNames from 'classnames'\nimport canvasAPI from '../iframe/src/frameBufferCanvasAPI/index.js'\nimport pixelData from '../iframe/src/frameBufferCanvasAPI/pixelData.js'\nimport actions from '../actions/actions.js'\n\nconst mapStateToProps = ({ sprites, map }) => ({ sprites, map })\n\nconst mapDispatchToProps = dispatch => ({\n  updateMap: newMap => dispatch(actions.updateMap(newMap))\n})\n\nclass Map extends Component {\n  constructor(props) {\n    super(props)\n    this.handleOnMouseDown = this.handleOnMouseDown.bind(this)\n    this.handleOnMouseEnter = this.handleOnMouseEnter.bind(this)\n    this.handleOnMouseUp = this.handleOnMouseUp.bind(this)\n    this.handleOnTouchMove = this.handleOnTouchMove.bind(this)\n    this.handleSpriteClick = this.handleSpriteClick.bind(this)\n    this.handleRoomClick = this.handleRoomClick.bind(this)\n\n    this.spritePixelData = pixelData({ width: 128, height: 64 })\n    this.drawSprite = this.drawSprite.bind(this)\n    this.roomPixelData = pixelData({ width: 128, height: 128 })\n    this.drawRoom = this.drawRoom.bind(this)\n    this.mapPixelData = pixelData({ width: 128 * 8, height: 128 * 4 })\n    this.drawMap = this.drawMap.bind(this)\n    this.getCurrentRoom = this.getCurrentRoom.bind(this)\n    this.setMode = this.setMode.bind(this)\n\n    this.state = {\n      spriteIndex: 0,\n      roomIndex: 0,\n      mouseDown: false,\n      mode: '+'\n    }\n  }\n\n  componentDidMount() {\n    this.drawSprites()\n    this.drawRoom()\n    this.drawMap()\n  }\n\n  drawSprites() {\n    const { sprites } = this.props\n\n    this.spriteCanvasAPI = canvasAPI({\n      pixels: this.spritePixelData.pixels,\n      width: 128,\n      height: 64,\n      sprites\n    })\n    this.spriteCanvasAPI.clear()\n    Object.keys(sprites).forEach(skey => {\n      const key = +skey\n      const row = Math.floor(key / 16)\n      const col = key % 16\n      this.spriteCanvasAPI.sprite(col * 8, row * 8, key)\n    })\n    this.spritePixelData.writePixelDataToCanvas(\n      this._spriteCanvas.getContext('2d')\n    )\n  }\n\n  drawRoom() {\n    const before = Date.now()\n\n    const { sprites, map } = this.props\n    const { roomIndex } = this.state\n\n    this.roomCanvasAPI = canvasAPI({\n      pixels: this.roomPixelData.pixels,\n      width: 128,\n      height: 128,\n      sprites\n    })\n\n    this.roomCanvasAPI.clear()\n    _.range(16).forEach(rowN => {\n      _.range(16).forEach(colN => {\n        const sprite = _.get(map, [\n          Math.floor(roomIndex / 8) * 16 + rowN,\n          (roomIndex % 8) * 16 + colN\n        ])\n        this.roomCanvasAPI.sprite(colN * 8, rowN * 8, sprite)\n      })\n    })\n    this.roomPixelData.writePixelDataToCanvas(this._roomCanvas.getContext('2d'))\n\n    const after = Date.now()\n    console.log(`this.drawRoom() took: ${after - before}ms`)\n  }\n\n  drawMap() {\n    const before = Date.now()\n\n    const { map, sprites } = this.props\n    this.mapCanvasAPI = canvasAPI({\n      pixels: this.mapPixelData.pixels,\n      width: 128 * 8,\n      height: 128 * 4,\n      sprites,\n      map\n    })\n\n    this.mapCanvasAPI.clear()\n    map.forEach((row, rowNumber) => {\n      row.forEach((col, colNumber) => {\n        this.mapCanvasAPI.sprite(colNumber * 8, rowNumber * 8, col)\n      })\n    })\n    this.mapPixelData.writePixelDataToCanvas(this._mapCanvas.getContext('2d'))\n\n    const after = Date.now()\n    console.log(`this.drawMap() took: ${after - before}ms`)\n  }\n\n  componentDidUpdate() {\n    this.drawRoom()\n    this.drawMap()\n  }\n\n  handleOnMouseDown(e) {\n    this.setState({\n      mouseDown: true\n    })\n    const { row, col } = e.target.dataset\n    this.drawSprite({ row: +row, col: +col })\n  }\n\n  handleOnMouseEnter(e) {\n    if (this.state.mouseDown) {\n      const { row, col } = e.target.dataset\n      this.drawSprite({ row: +row, col: +col })\n    }\n  }\n\n  handleOnMouseUp() {\n    this.setState({\n      mouseDown: false\n    })\n  }\n\n  handleOnTouchMove(e) {\n    if (this.state.mouseDown) {\n      const touchLocation = e.changedTouches[0]\n      const dataset = document.elementFromPoint(\n        touchLocation.clientX,\n        touchLocation.clientY\n      ).dataset\n      const { row, col } = dataset\n      if (row && col) {\n        this.drawSprite({ row: +row, col: +col })\n      }\n    }\n  }\n\n  handleSpriteClick(spriteIndex) {\n    this.setState({ spriteIndex, mode: '+' })\n  }\n\n  handleRoomClick(roomIndex) {\n    this.setState({ roomIndex })\n  }\n\n  drawSprite({ row, col }) {\n    const { roomIndex, spriteIndex, mode } = this.state\n    const { updateMap } = this.props\n    const map = this.getCurrentRoom()\n    const newMap = JSON.parse(JSON.stringify(map))\n    newMap[Math.floor(roomIndex / 8) * 16 + row][(roomIndex % 8) * 16 + col] =\n      mode === '+' ? spriteIndex : null\n    updateMap(newMap)\n  }\n\n  getCurrentRoom() {\n    const { map } = this.props\n    return map.length ? map : Map.createBlankMap()\n  }\n\n  setMode(mode) {\n    this.setState({\n      mode\n    })\n  }\n\n  render() {\n    const { roomIndex, spriteIndex, mode } = this.state\n    const { map } = this.props\n    return (\n      <div\n        onMouseUp={this.handleOnMouseUp}\n        onTouchEnd={this.handleOnMouseUp}\n        className=\"Map two-rows-and-grid\"\n      >\n        <div className=\"main\">\n          <div className=\"MapEditor\">\n            <div className=\"room-and-tools\">\n              <div className=\"room\">\n                <table>\n                  <tbody>\n                    {_.range(16).map(row => (\n                      <tr key={row}>\n                        {_.range(16).map(col => {\n                          const sprite = _.get(map, [\n                            Math.floor(roomIndex / 8) * 16 + row,\n                            (roomIndex % 8) * 16 + col\n                          ])\n                          return (\n                            <td key={col}>\n                              <button\n                                data-row={row}\n                                data-col={col}\n                                onMouseDown={this.handleOnMouseDown}\n                                onMouseEnter={this.handleOnMouseEnter}\n                                onTouchStart={this.handleOnMouseDown}\n                                onTouchMove={this.handleOnTouchMove}\n                                className=\"background-\"\n                              >\n                                {_.isNil(sprite) ? 'x' : ''}\n                              </button>\n                            </td>\n                          )\n                        })}\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n                <canvas\n                  width={128}\n                  height={128}\n                  ref={_roomCanvas => {\n                    this._roomCanvas = _roomCanvas\n                  }}\n                />\n              </div>\n              <div className=\"tools\">\n                <button\n                  className={classNames('button', {\n                    active: mode === '+'\n                  })}\n                  onClick={() => {\n                    this.setMode('+')\n                  }}\n                >\n                  +\n                </button>\n\n                <button\n                  className={classNames('button', {\n                    active: mode === '-'\n                  })}\n                  onClick={() => {\n                    this.setMode('-')\n                  }}\n                >\n                  -\n                </button>\n              </div>\n            </div>\n            <div className=\"sprites-and-map\">\n              <div className=\"sprites\">\n                <table>\n                  <tbody>\n                    {_.range(8).map(row => (\n                      <tr key={row}>\n                        {_.range(16).map(col => {\n                          const thisSpriteIndex = row * 16 + col\n                          return (\n                            <td\n                              className={classNames({\n                                active:\n                                  spriteIndex === thisSpriteIndex &&\n                                  mode === '+'\n                              })}\n                              key={col}\n                            >\n                              <button\n                                onClick={() =>\n                                  this.handleSpriteClick(thisSpriteIndex)\n                                }\n                              />\n                            </td>\n                          )\n                        })}\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n                <canvas\n                  width={128}\n                  height={64}\n                  ref={_spriteCanvas => {\n                    this._spriteCanvas = _spriteCanvas\n                  }}\n                />\n              </div>\n              <div className=\"map\">\n                <table>\n                  <tbody>\n                    {_.range(4).map(row => (\n                      <tr key={row}>\n                        {_.range(8).map(col => {\n                          const thisRoomIndex = row * 8 + col\n                          return (\n                            <td\n                              className={classNames({\n                                active: roomIndex === thisRoomIndex\n                              })}\n                              key={col}\n                            >\n                              <button\n                                onClick={() =>\n                                  this.handleRoomClick(thisRoomIndex)\n                                }\n                              />\n                            </td>\n                          )\n                        })}\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n                <canvas\n                  width={128 * 8}\n                  height={128 * 4}\n                  ref={_mapCanvas => {\n                    this._mapCanvas = _mapCanvas\n                  }}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nMap.createBlankMap = () => _.range(64).map(() => _.range(128).map(() => null))\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Map)\n","const settings = {\n  octaves: 4,\n  volumes: 8,\n  phrases: 8 * 8,\n  chains: 8 * 8,\n  songs: 8,\n  matrixLength: 16,\n  chainChannels: 4,\n  startOffset: '+0.1',\n  startOffsetDouble: '+0.5',\n  bpm: 144 * 8,\n  subdivision: '2m'\n}\n\nexport default settings\n","import settings from './settings.js'\nconst normalize = {\n  volume: vol => (vol + 1) / settings.volumes,\n  note: note => note\n}\n\nexport default normalize\n","// TODO: if sustain exists, volume should also just show `-`\n\nimport * as Tone from 'tone'\nimport _ from 'lodash'\nimport toLetter from '../toLetter.js'\nimport normalize from '../normalize.js'\nimport settings from '../settings.js'\n\nconst slowToFastTempo = [1, 2, 3, 5, 8, 12, 20, 32]\nconst fastToSlowTempo = [...slowToFastTempo].reverse()\n\nconst tempoToPlaybackRate = tempo => slowToFastTempo[tempo]\nconst tempoToSubdivision = tempo =>\n  fastToSlowTempo.map(i => ({ '16n': i }))[tempo]\n\nconst createSynth = ({ volumeNode, index }) => {\n  let synth\n\n  if (index === 0) {\n    synth = new Tone.Synth({\n      oscillator: {\n        type: 'pulse',\n        width: 0.5\n      },\n      envelope: {\n        release: 0.07\n      }\n    })\n    synth.script8Name = 'synth'\n  }\n\n  if (index === 1) {\n    synth = new Tone.Synth({\n      oscillator: {\n        type: 'pulse',\n        width: 0.75\n      },\n      envelope: {\n        release: 0.07\n      }\n    })\n    synth.script8Name = 'synth'\n  }\n\n  if (index === 2) {\n    synth = new Tone.Synth({\n      oscillator: {\n        type: 'triangle'\n      },\n      envelope: {\n        release: 0.07\n      }\n    })\n    synth.script8Name = 'synth'\n  }\n\n  if (index === 3) {\n    synth = new Tone.NoiseSynth({\n      envelope: {\n        release: 0.07\n      }\n    })\n    synth.script8Name = 'noise'\n  }\n\n  if (volumeNode) {\n    synth.chain(volumeNode, Tone.Master)\n  } else {\n    synth.chain(Tone.Master)\n  }\n\n  return synth\n}\n\nconst triggerAttack = ({\n  note: letter,\n  octave,\n  volume,\n  time = Tone.context.currentTime,\n  synth\n}) => {\n  if (time >= Tone.context.currentTime) {\n    const note = toLetter(letter + octave * 12, true, true)\n    const velocity = normalize.volume(volume)\n    if (synth.script8Name === 'synth') {\n      synth.triggerAttack(note, time, velocity)\n    }\n    if (synth.script8Name === 'noise') {\n      synth.triggerAttack(time, velocity)\n    }\n  }\n}\n\nconst triggerAttackRelease = ({\n  note: letter,\n  octave,\n  volume,\n  time = Tone.context.currentTime,\n  synth,\n  tempo\n}) => {\n  if (time >= Tone.context.currentTime) {\n    const note = toLetter(letter + octave * 12, true, true)\n    const duration = tempoToSubdivision(tempo)\n    const velocity = normalize.volume(volume)\n    if (synth.script8Name === 'synth') {\n      synth.triggerAttackRelease(note, duration, time, velocity)\n    }\n    if (synth.script8Name === 'noise') {\n      synth.triggerAttackRelease(duration, time, velocity)\n    }\n  }\n}\n\nconst triggerRelease = ({\n  time = Tone.context.currentTime,\n  delay = 0,\n  synth\n}) => {\n  if (time >= Tone.context.currentTime) {\n    synth.triggerRelease(time + delay)\n  }\n}\n\nconst soundAPI = volumeNode => {\n  const chainSynths = _.range(settings.chainChannels).map(index =>\n    createSynth({ volumeNode, index })\n  )\n  const songSynths = _.range(settings.chainChannels).map(index =>\n    createSynth({ volumeNode, index })\n  )\n  const phraseSynth = createSynth({ volumeNode, index: 0 })\n\n  Tone.Transport.bpm.value = settings.bpm\n  Tone.Transport.start(settings.startOffset)\n\n  let songContainers = {}\n  let chainContainers = {}\n  let localPhrases = {}\n  let phrasePool = []\n\n  const stopChain = () => {\n    _.forEach(chainContainers, ({ sequence }, key) => {\n      if (sequence) {\n        sequence.stop()\n        chainSynths.forEach(synth => triggerRelease({ synth }))\n      }\n    })\n  }\n\n  const stopSong = () => {\n    // Stop all sequences.\n    // console.log('soundAPI.stopSong() BEGIN----------')\n    // const before = Date.now()\n    _.forEach(songContainers, ({ sequence }, key) => {\n      if (sequence) {\n        sequence.stop()\n        songSynths.forEach(synth => triggerRelease({ synth }))\n        // console.log(`stopping song with key: ${key}`)\n      }\n    })\n    // const after = Date.now()\n    // console.log(`soundAPI.stopSong() END ${after - before}ms`)\n  }\n\n  const makeSongsAndChains = ({ songs, chains, phrases }) => {\n    // console.log(`soundAPI.makeSongs() BEGIN----------`)\n    // const before = Date.now()\n    stopSong()\n    stopChain()\n    localPhrases = phrases\n    songContainers = _.mapValues(songs, song =>\n      makeSongContainer({ song, chains, phrases })\n    )\n    chainContainers = _.mapValues(chains, chain =>\n      makeChainContainer({ chain, phrases })\n    )\n    // const after = Date.now()\n    // console.log(`soundAPI.makeSongs() END ${after - before}ms`)\n  }\n\n  const makeChainContainer = ({ chain, phrases }) => {\n    const notePositions = _(_.range(Math.pow(settings.matrixLength, 2)))\n      .map(index => {\n        // Get the phrase and note positions by using base math.\n        const [phrasePosition, notePosition] = _.padStart(\n          index.toString(settings.matrixLength),\n          2,\n          0\n        )\n          .split('')\n          .map(d => parseInt(d, settings.matrixLength))\n\n        // Get the phrase indices for this position, e.g. { 0: 0, 1: 11, 2: 2 }\n        const phrasesIndices = _.get(chain, phrasePosition)\n\n        // For each channel,\n        return _.range(settings.chainChannels).map(channel => {\n          // Get the phrase index for this channel.\n          const phraseIndex = _.get(phrasesIndices, channel)\n          let result\n\n          // If the phrase index exists,\n          if (!_.isNil(phraseIndex)) {\n            // get the phrase assigned to this channel.\n            const phrase = _.get(phrases, phraseIndex, {})\n\n            // Get the note element for this position.\n            const noteElement = _.get(phrase.notes, notePosition)\n\n            // If we have a note,\n            if (!_.isNil(noteElement)) {\n              // add it to the result.\n              result = {\n                noteElement,\n                tempo: chain.tempo\n              }\n            }\n          }\n          return result\n        })\n      })\n      // NOW we can drop from right.\n      .dropRightWhile(d =>\n        _(d)\n          .compact()\n          .isEmpty()\n      )\n      .value()\n\n    const callback = (time, position) => {\n      // For every column cell on the grid,\n      notePositions[position].forEach((d, channel) => {\n        // if the channel has a note:\n        if (d && !_.isNil(d.noteElement)) {\n          // If we're on the last position of the entire array,\n          if (position === notePositions.length - 1) {\n            // if we have a note, triggerAttackRelease.\n            if (d.noteElement.octave > -1) {\n              triggerAttackRelease({\n                ...d.noteElement,\n                time,\n                synth: chainSynths[channel],\n                tempo: d.tempo\n              })\n            }\n            // If we have a sustain, triggerRelease(time + duration).\n            if (d.noteElement.octave === -1) {\n              triggerRelease({\n                time,\n                synth: chainSynths[channel],\n                delay: Tone.Time(tempoToSubdivision(d.tempo)).valueOf()\n              })\n            }\n          } else {\n            // If we're not on the last position of the array,\n            // if we have a note, triggerAttack.\n            if (d.noteElement.octave > -1) {\n              triggerAttack({\n                ...d.noteElement,\n                time,\n                synth: chainSynths[channel]\n              })\n            }\n            // If we have a sustain, do nothing.\n            if (d.noteElement.octave === -1) {\n            }\n          }\n        } else {\n          // If the channel does not have a note, stop it.\n          triggerRelease({ time, synth: chainSynths[channel] })\n        }\n      })\n    }\n\n    const events = _.range(notePositions.length)\n\n    return {\n      callback,\n      events,\n      sequence: null,\n      tempo: chain.tempo\n    }\n  }\n\n  const makeSongContainer = ({ song, chains, phrases }) => {\n    // const before = Date.now()\n    // Create an array of note positions.\n    // There's a lot going on here, but the gist:\n    // create an array of all the notes, but remove nulls from the end,\n    // so that we can make a Tone Sequence that is the right length and no more.\n    // This is good for performance.\n\n    // For matrixLength cubed (chains * phrases * notes),\n    const notePositions = _(_.range(Math.pow(settings.matrixLength, 3)))\n      .map(index => {\n        // Get the chain, phrase and note positions by using base math.\n        const [chainPosition, phrasePosition, notePosition] = _.padStart(\n          index.toString(settings.matrixLength),\n          3,\n          0\n        )\n          .split('')\n          .map(d => parseInt(d, settings.matrixLength))\n\n        // Get the chain index for this position.\n        const chainIndex = _.get(song, chainPosition)\n\n        // Get the chain.\n        const chain = _.get(chains, chainIndex)\n\n        // Get the phrase indices for this position, e.g. { 0: 0, 1: 11, 2: 2 }\n        const phrasesIndices = _.get(chain, phrasePosition)\n\n        // For each channel,\n        return _.range(settings.chainChannels).map(channel => {\n          // Get the phrase index for this channel.\n          const phraseIndex = _.get(phrasesIndices, channel)\n          let result\n\n          // If the phrase index exists,\n          if (!_.isNil(phraseIndex)) {\n            // get the phrase assigned to this channel.\n            const phrase = _.get(phrases, phraseIndex, {})\n\n            // Get the note element for this position.\n            const noteElement = _.get(phrase.notes, notePosition)\n\n            // If we have a note,\n            if (!_.isNil(noteElement)) {\n              // add it to the result.\n              result = {\n                noteElement,\n                tempo: song.tempo\n              }\n            }\n          }\n          return result\n        })\n      })\n      // NOW we can drop from right.\n      .dropRightWhile(d =>\n        _(d)\n          .compact()\n          .isEmpty()\n      )\n      .value()\n\n    const callback = (time, position) => {\n      // For every column cell on the grid,\n      notePositions[position].forEach((d, channel) => {\n        // if the channel has a note:\n        if (d && !_.isNil(d.noteElement)) {\n          // If we're on the last position of the entire array,\n          if (position === notePositions.length - 1) {\n            // if we have a note, triggerAttackRelease.\n            if (d.noteElement.octave > -1) {\n              triggerAttackRelease({\n                ...d.noteElement,\n                time,\n                synth: songSynths[channel],\n                tempo: d.tempo\n              })\n            }\n            // If we have a sustain, triggerRelease(time + duration).\n            if (d.noteElement.octave === -1) {\n              triggerRelease({\n                time,\n                synth: songSynths[channel],\n                delay: Tone.Time(tempoToSubdivision(d.tempo)).valueOf()\n              })\n            }\n          } else {\n            // If we're not on the last position of the array,\n            // if we have a note, triggerAttack.\n            if (d.noteElement.octave > -1) {\n              triggerAttack({\n                ...d.noteElement,\n                time,\n                synth: songSynths[channel]\n              })\n            }\n            // If we have a sustain, do nothing.\n            if (d.noteElement.octave === -1) {\n            }\n          }\n        } else {\n          // If the channel does not have a note, stop it.\n          triggerRelease({ time, synth: songSynths[channel] })\n        }\n      })\n    }\n\n    const events = _.range(notePositions.length)\n\n    // const after = Date.now()\n    // console.log(`soundAPI.makeSongContainer() took ${after - before}ms`)\n\n    return {\n      callback,\n      events,\n      sequence: null,\n      tempo: song.tempo\n    }\n  }\n\n  const playSong = (number, loop = false) => {\n    // console.log(`soundAPI.playSong() BEGIN----------`)\n    // const before = Date.now()\n    stopSong()\n\n    // console.log(`going to play song with key ${number}`)\n    _.forEach(songContainers, (value, key) => {\n      if (+key === number) {\n        // console.log(`found one: key ${key}`)\n        value.sequence = new Tone.Sequence(\n          value.callback,\n          value.events,\n          settings.subdivision\n        )\n        value.sequence.loop = loop\n        value.sequence.playbackRate = tempoToPlaybackRate(value.tempo)\n        value.sequence.start(settings.startOffset)\n      }\n    })\n    // const after = Date.now()\n    // console.log(`soundAPI.playSong() END took ${after - before}ms`)\n  }\n\n  const playChain = (number, loop = false) => {\n    // console.log(`soundAPI.playSong() BEGIN----------`)\n    // const before = Date.now()\n    stopChain()\n\n    // console.log(`going to play song with key ${number}`)\n    _.forEach(chainContainers, (value, key) => {\n      if (+key === number) {\n        // console.log(`found one: key ${key}`)\n        value.sequence = new Tone.Sequence(\n          value.callback,\n          value.events,\n          settings.subdivision\n        )\n        value.sequence.loop = loop\n        value.sequence.playbackRate = tempoToPlaybackRate(value.tempo)\n        value.sequence.start(settings.startOffset)\n      }\n    })\n    // const after = Date.now()\n    // console.log(`soundAPI.playSong() END took ${after - before}ms`)\n  }\n\n  const playPhrase = number => {\n    // const before = Date.now()\n    const phrase = _.get(localPhrases, number)\n    if (phrase) {\n      while (phrasePool.length) {\n        const popped = phrasePool.pop()\n        popped.dispose()\n      }\n\n      const { tempo } = phrase\n\n      const sequence = new Tone.Sequence(\n        (time, index) => {\n          const value = phrase.notes[index]\n          // if (value) {\n          //   playNote({ ...value, time, synth: phraseSynth, tempo })\n          // }\n\n          // If there is a note,\n          if (value) {\n            // If we're on the last position of the phrase,\n            if (index === settings.matrixLength - 1) {\n              // if we have a note, triggerAttackRelease.\n              // If we have a sustain, triggerRelease(time + duration).\n              if (value.octave > -1) {\n                triggerAttackRelease({\n                  ...value,\n                  time,\n                  synth: phraseSynth,\n                  tempo\n                })\n              }\n              if (value.octave === -1) {\n                triggerRelease({\n                  time,\n                  synth: phraseSynth,\n                  delay: Tone.Time(tempoToSubdivision(tempo)).valueOf()\n                })\n              }\n            } else {\n              // If we're not on the last position of the array,\n              // if we have a note, triggerAttack.\n              if (value.octave > -1) {\n                triggerAttack({\n                  ...value,\n                  time,\n                  synth: phraseSynth\n                })\n              }\n              // If it's sustain, do nothing.\n              if (value.octave === -1) {\n              }\n            }\n          } else {\n            // If there is no note, triggerRelease.\n            triggerRelease({ time, synth: phraseSynth })\n          }\n        },\n        _.range(settings.matrixLength),\n        settings.subdivision\n      )\n      sequence.loop = false\n      sequence.playbackRate = tempoToPlaybackRate(tempo)\n      sequence.start()\n      phrasePool.push(sequence)\n      // const after = Date.now()\n      // console.log(`soundAPI.playPhrase() took ${after - before}ms`)\n    }\n  }\n  return {\n    playPhrase,\n    playChain,\n    stopChain,\n    playSong,\n    stopSong,\n    makeSongsAndChains\n  }\n}\n\nexport {\n  createSynth,\n  tempoToPlaybackRate,\n  triggerAttack,\n  triggerAttackRelease,\n  triggerRelease\n}\n\nexport default soundAPI\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nconst TextInput = ({ label, value, type, handleChange, options }) => (\n  <div className='TextInput'>\n    <label>\n      {label}\n      <input type={type} value={value} {...options} onChange={handleChange} />\n    </label>\n  </div>\n)\n\nTextInput.propTypes = {\n  label: PropTypes.string.isRequired,\n  type: PropTypes.string.isRequired,\n  value: PropTypes.string.isRequired,\n  handleChange: PropTypes.func.isRequired,\n  options: PropTypes.object\n}\n\nexport default TextInput\n","import React, { Component } from 'react'\nimport { connect } from 'react-redux'\nimport _ from 'lodash'\nimport * as Tone from 'tone'\nimport classNames from 'classnames'\nimport {\n  createSynth,\n  triggerAttack,\n  triggerAttackRelease,\n  triggerRelease,\n  tempoToPlaybackRate\n} from '../iframe/src/soundAPI/index.js'\nimport actions from '../actions/actions.js'\nimport TextInput from '../components/TextInput.js'\nimport toLetter from '../iframe/src/toLetter.js'\nimport settings from '../iframe/src/settings.js'\n\nconst synths = _.range(settings.chainChannels).map(index =>\n  createSynth({ index })\n)\nTone.Transport.bpm.value = settings.bpm\nTone.Transport.start(settings.startOffset)\n\nconst getCurrentPhrase = ({ phrases, selectedUi }) => ({\n  tempo: 0,\n  synth: 0,\n  notes: [],\n  ..._.get(phrases, [selectedUi.phrase], {})\n})\n\nconst mapStateToProps = ({ phrases, selectedUi }) => ({ phrases, selectedUi })\n\nconst mapDispatchToProps = dispatch => ({\n  selectUi: payload => dispatch(actions.selectUi(payload)),\n  updatePhrase: ({ phrase, index }) =>\n    dispatch(\n      actions.updatePhrase({\n        phrase,\n        index\n      })\n    )\n})\n\nclass Phrase extends Component {\n  constructor(props) {\n    super(props)\n\n    this.keydown = this.keydown.bind(this)\n    this.handleOctaveChange = this.handleOctaveChange.bind(this)\n    this.handleVolumeChange = this.handleVolumeChange.bind(this)\n    this.handleCloneChange = this.handleCloneChange.bind(this)\n    this.handleClear = this.handleClear.bind(this)\n    this.handleClone = this.handleClone.bind(this)\n    this.createSequence = this.createSequence.bind(this)\n    this.handleTempoChange = this.handleTempoChange.bind(this)\n    this.handleSynthChange = this.handleSynthChange.bind(this)\n    this.handlePhraseIndexChange = this.handlePhraseIndexChange.bind(this)\n    this.handleNoteClick = this.handleNoteClick.bind(this)\n    this.handleVolumeClick = this.handleVolumeClick.bind(this)\n    this.handlePlay = this.handlePlay.bind(this)\n    this.drawCallback = this.drawCallback.bind(this)\n\n    this.state = {\n      isPlaying: false,\n      playingIndex: 0,\n      selectedCloneIndex: '',\n      selectedOctave: 3,\n      selectedVolume: 7,\n      mode: '+'\n    }\n  }\n\n  handleOctaveChange(e) {\n    this.setState({\n      selectedOctave: +e.target.value\n    })\n    e.currentTarget.blur()\n  }\n\n  handleVolumeChange(e) {\n    this.setState({\n      selectedVolume: +e.target.value\n    })\n    e.currentTarget.blur()\n  }\n\n  handleCloneChange(e) {\n    this.setState({\n      selectedCloneIndex: e.target.value\n    })\n    e.currentTarget.blur()\n  }\n\n  getValidClonePhraseKeys() {\n    const { selectedUi, phrases } = this.props\n    const phraseIndex = selectedUi.phrase\n    return Object.entries(phrases)\n      .filter(([key, phrase]) => +key !== +phraseIndex)\n      .map(([key, phrase]) => key)\n  }\n\n  handleClone(e) {\n    const { selectedUi, phrases, updatePhrase } = this.props\n    const validClonePhraseKeys = this.getValidClonePhraseKeys()\n    const phraseIndex = selectedUi.phrase\n    let { selectedCloneIndex } = this.state\n    const phrase = getCurrentPhrase(this.props)\n    if (_.isEmpty(selectedCloneIndex)) {\n      selectedCloneIndex = validClonePhraseKeys[0]\n    }\n\n    if (\n      _.isEmpty(phrase.notes) ||\n      window.confirm(\n        `Do you really want to clone phrase ${selectedCloneIndex}?`\n      )\n    ) {\n      updatePhrase({\n        phrase: phrases[selectedCloneIndex],\n        index: phraseIndex\n      })\n    }\n    e.currentTarget.blur()\n  }\n\n  handleClear(e) {\n    const { updatePhrase, selectedUi } = this.props\n    const phraseIndex = selectedUi.phrase\n\n    if (window.confirm('Do you really want to clear this phrase?')) {\n      updatePhrase({\n        phrase: {\n          tempo: 0,\n          synth: 0,\n          notes: []\n        },\n        index: phraseIndex\n      })\n    }\n    e.currentTarget.blur()\n  }\n\n  keydown(event) {\n    // If we pressed space,\n    if (event.code === 'Space') {\n      // toggle the playbar.\n      this.handlePlay()\n    }\n  }\n\n  drawCallback(playingIndex) {\n    this.setState({\n      playingIndex\n    })\n  }\n\n  componentDidMount() {\n    Tone.context.resume()\n\n    const phrase = getCurrentPhrase(this.props)\n    this.sequence = this.createSequence()\n    this.sequence.playbackRate = tempoToPlaybackRate(phrase.tempo)\n\n    window.addEventListener('keydown', this.keydown)\n  }\n\n  createSequence() {\n    return new Tone.Sequence(\n      (time, index) => {\n        const phrase = getCurrentPhrase(this.props)\n        const value = phrase.notes[index]\n        // If there is a note,\n        if (value) {\n          // if it's not sustain, triggerAttack.\n          if (value.octave > -1) {\n            triggerAttack({\n              ...value,\n              time,\n              synth: synths[phrase.synth]\n            })\n          }\n          if (value.octave === -1) {\n            // If it's sustain, do nothing.\n          }\n        } else {\n          // If there is no note, triggerRelease.\n          triggerRelease({ time, synth: synths[phrase.synth] })\n        }\n        Tone.Draw.schedule(() => {\n          this.drawCallback(index)\n        }, time)\n      },\n      _.range(settings.matrixLength),\n      settings.subdivision\n    )\n  }\n\n  handleSynthChange(e) {\n    const { validity, value } = e.target\n    if (validity.valid) {\n      // Update the store.\n      const { updatePhrase, selectedUi } = this.props\n      const phraseIndex = selectedUi.phrase\n      const phrase = getCurrentPhrase(this.props)\n      const newPhrase = {\n        ...phrase,\n        synth: value\n      }\n\n      // Stop the old synth.\n      triggerRelease({ synth: synths[phrase.synth] })\n\n      updatePhrase({ phrase: newPhrase, index: phraseIndex })\n    }\n  }\n\n  handleTempoChange(e) {\n    const { validity, value } = e.target\n    if (validity.valid) {\n      // Update the sequence.\n      this.sequence.playbackRate = tempoToPlaybackRate(value)\n\n      // Update the store.\n      const { updatePhrase, selectedUi } = this.props\n      const phraseIndex = selectedUi.phrase\n      const phrase = getCurrentPhrase(this.props)\n      const newPhrase = {\n        ...phrase,\n        tempo: value\n      }\n      updatePhrase({ phrase: newPhrase, index: phraseIndex })\n    }\n  }\n\n  handlePlay() {\n    const { isPlaying } = this.state\n    const phrase = getCurrentPhrase(this.props)\n    if (isPlaying) {\n      this.sequence.stop()\n      triggerRelease({ synth: synths[phrase.synth] })\n    } else {\n      this.sequence.start(settings.startOffset)\n    }\n    this.setState({\n      isPlaying: !isPlaying,\n      playingIndex: 0\n    })\n  }\n\n  handlePhraseIndexChange(e) {\n    const { validity, value } = e.target\n    const phrase = getCurrentPhrase(this.props)\n    if (validity.valid) {\n      const { selectUi, selectedUi } = this.props\n      selectUi({\n        ...selectedUi,\n        phrase: value\n      })\n      triggerRelease({ synth: synths[phrase.synth] })\n    }\n  }\n\n  handleVolumeClick(col) {\n    const { updatePhrase, selectedUi } = this.props\n    const phraseIndex = selectedUi.phrase\n    const { isPlaying } = this.state\n    const phrase = getCurrentPhrase(this.props)\n    const { tempo } = phrase\n    const position = phrase.notes[col]\n    let newPosition\n\n    // If we do not have a note on this column,\n    if (!position) {\n      // add one at note 0.\n      newPosition = {\n        note: 11,\n        octave: settings.octaves - 1,\n        volume: settings.volumes - 1\n      }\n    } else {\n      const { volume } = position\n\n      // If we do have a note on this column, and we're not at 0,\n      if (volume > 0) {\n        // decrease it.\n        newPosition = {\n          ...position,\n          volume: volume - 1\n        }\n      } else {\n        // If we are at the max volume,\n        // remove the note.\n        newPosition = null\n      }\n    }\n\n    if (newPosition && !isPlaying) {\n      // If the note is not sustain, triggerAttackRelease.\n      if (newPosition.octave > -1) {\n        triggerAttackRelease({\n          ...newPosition,\n          synth: synths[phrase.synth],\n          tempo\n        })\n      }\n    }\n\n    const newPhrase = {\n      ...phrase,\n      notes: {\n        ...phrase.notes,\n        [col]: newPosition\n      }\n    }\n\n    updatePhrase({ phrase: newPhrase, index: phraseIndex })\n  }\n\n  handleNoteClick({ row, col }) {\n    const { updatePhrase, selectedUi } = this.props\n    const phraseIndex = selectedUi.phrase\n    const { isPlaying, mode, selectedOctave, selectedVolume } = this.state\n    const phrase = getCurrentPhrase(this.props)\n    const { tempo } = phrase\n    const position = phrase.notes[col]\n    let newNote\n\n    if (mode === '-') {\n      newNote = null\n    } else {\n      // If we do not have a note on this column,\n      if (!position) {\n        // add one according to the selected dropdowns.\n        newNote = {\n          note: row,\n          octave: selectedOctave,\n          volume: selectedVolume\n        }\n      } else {\n        const { note, octave } = position\n\n        // If we do have a note on this column, but not on this row,\n        if (note !== row) {\n          // update the note to this row, and use the same octave.\n          newNote = {\n            ...position,\n            note: row\n          }\n        } else {\n          // If we have a note on this very column and row,\n          // and we're not at -1,\n          if (octave > -1) {\n            // decrease it.\n            newNote = {\n              ...position,\n              octave: octave - 1\n            }\n          } else {\n            newNote = null\n          }\n        }\n      }\n\n      if (newNote && !isPlaying) {\n        // If the note is not sustain, triggerAttackRelease.\n        if (newNote.octave > -1) {\n          triggerAttackRelease({\n            ...newNote,\n            synth: synths[phrase.synth],\n            tempo\n          })\n        }\n      }\n    }\n\n    const newPhrase = {\n      ...phrase,\n      notes: {\n        ...phrase.notes,\n        [col]: newNote\n      }\n    }\n\n    updatePhrase({ phrase: newPhrase, index: phraseIndex })\n  }\n\n  componentWillUnmount() {\n    this.drawCallback = () => {}\n    this.sequence.stop()\n    const phrase = getCurrentPhrase(this.props)\n    triggerRelease({ synth: synths[phrase.synth] })\n    window.removeEventListener('keydown', this.keydown)\n  }\n\n  componentDidUpdate(prevProps) {\n    const oldPhrase = getCurrentPhrase(prevProps)\n    const newPhrase = getCurrentPhrase(this.props)\n    if (\n      prevProps.selectedUi.phrase !== this.props.selectedUi.phrase ||\n      oldPhrase.tempo !== newPhrase.tempo\n    ) {\n      this.sequence.playbackRate = tempoToPlaybackRate(newPhrase.tempo)\n    }\n\n    if (!_.isEmpty(oldPhrase.notes) && _.isEmpty(newPhrase.notes)) {\n      this.setState({ mode: '+' })\n    }\n  }\n\n  render() {\n    const { selectedUi } = this.props\n    const phraseIndex = selectedUi.phrase\n\n    const {\n      isPlaying,\n      playingIndex,\n      selectedCloneIndex,\n      mode,\n      selectedOctave,\n      selectedVolume\n    } = this.state\n\n    const phrase = getCurrentPhrase(this.props)\n    const validClonePhraseKeys = this.getValidClonePhraseKeys()\n\n    return (\n      <div className=\"Phrase two-rows-and-grid\">\n        <div className=\"main\">\n          <div className=\"settings\">\n            <div className=\"title\">Phrase</div>\n            <TextInput\n              label=\"#\"\n              value={phraseIndex.toString()}\n              handleChange={this.handlePhraseIndexChange}\n              type=\"number\"\n              options={{ min: 0, max: settings.phrases - 1 }}\n            />\n            <div className=\"title\">Tempo</div>\n            <TextInput\n              label=\"#\"\n              value={phrase.tempo.toString()}\n              handleChange={this.handleTempoChange}\n              type=\"number\"\n              options={{ min: 0, max: 7 }}\n            />\n            <div className=\"title\">Synth</div>\n            <TextInput\n              label=\"#\"\n              value={phrase.synth.toString()}\n              handleChange={this.handleSynthChange}\n              type=\"number\"\n              options={{ min: 0, max: 3 }}\n            />\n          </div>\n          <div className=\"matrix\">\n            <button\n              className={classNames('play button', { active: isPlaying })}\n              onClick={this.handlePlay}\n            >\n              {isPlaying ? 'stop' : 'play'}\n            </button>\n            <table className=\"notes\">\n              <tbody>\n                {_.range(11, -1).map(row => (\n                  <tr key={row}>\n                    <td>{toLetter(row)}</td>\n                    {_.range(settings.matrixLength).map(col => {\n                      const value = phrase.notes[col]\n                      const match = value && value.note === row\n                      const highlighter =\n                        row === 11 && col === playingIndex && isPlaying ? (\n                          <span className=\"highlight\" />\n                        ) : null\n                      return (\n                        <td\n                          key={col}\n                          onClick={() => this.handleNoteClick({ row, col })}\n                          className={classNames({\n                            match,\n                            highlight: col === playingIndex && isPlaying,\n                            [`octave-${value && value.octave}`]: match\n                          })}\n                        >\n                          {highlighter}\n                          <button>\n                            {match\n                              ? value.octave > -1\n                                ? value.octave\n                                : '-'\n                              : ' '}\n                          </button>\n                        </td>\n                      )\n                    })}\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n            <table className=\"volumes\">\n              <tbody>\n                <tr>\n                  <td>v</td>\n                  {_.range(settings.matrixLength).map(col => {\n                    const value = phrase.notes[col]\n                    const highlighter =\n                      col === playingIndex && isPlaying ? (\n                        <span className=\"highlight\" />\n                      ) : null\n                    return (\n                      <td\n                        key={col}\n                        className={classNames({\n                          highlight: col === playingIndex && isPlaying,\n                          [`volume-${value && value.volume}`]: value\n                        })}\n                        onClick={() => this.handleVolumeClick(col)}\n                      >\n                        {highlighter}\n                        <button>{value && value.volume}</button>\n                      </td>\n                    )\n                  })}\n                </tr>\n              </tbody>\n            </table>\n          </div>\n          <div className=\"tools\">\n            <div>\n              <button\n                className=\"button\"\n                disabled={_.isEmpty(phrase.notes)}\n                onClick={this.handleClear}\n              >\n                clear\n              </button>\n            </div>\n            <div className=\"clone\">\n              <button\n                disabled={_.isEmpty(validClonePhraseKeys)}\n                className=\"button\"\n                onClick={this.handleClone}\n              >\n                clone\n              </button>\n              <select\n                value={selectedCloneIndex}\n                onChange={this.handleCloneChange}\n              >\n                {validClonePhraseKeys.map(key => (\n                  <option key={key} value={key}>\n                    {key}\n                  </option>\n                ))}\n              </select>\n            </div>\n            <div className=\"selected\">\n              <span className=\"title\">octave</span>\n              <select value={selectedOctave} onChange={this.handleOctaveChange}>\n                {_.range(3, -2, -1).map(key => (\n                  <option key={key} value={key}>\n                    {key === -1 ? '-' : key}\n                  </option>\n                ))}\n              </select>\n            </div>\n            <div className=\"selected\">\n              <span className=\"title\">volume</span>\n              <select value={selectedVolume} onChange={this.handleVolumeChange}>\n                {_.range(7, -1).map(key => (\n                  <option key={key} value={key}>\n                    {key}\n                  </option>\n                ))}\n              </select>\n            </div>\n            <div className=\"add-delete\">\n              <button\n                className={classNames('button', {\n                  active: mode === '+'\n                })}\n                onClick={() => {\n                  this.setState({\n                    mode: '+'\n                  })\n                }}\n              >\n                +\n              </button>\n              <button\n                disabled={_.isEmpty(phrase.notes)}\n                className={classNames('button', {\n                  active: mode === '-'\n                })}\n                onClick={() => {\n                  this.setState({\n                    mode: '-'\n                  })\n                }}\n              >\n                -\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Phrase)\n","import React, { Component } from 'react'\nimport { connect } from 'react-redux'\nimport _ from 'lodash'\nimport * as Tone from 'tone'\nimport classNames from 'classnames'\nimport {\n  createSynth,\n  tempoToPlaybackRate,\n  triggerRelease,\n  triggerAttack\n} from '../iframe/src/soundAPI/index.js'\nimport actions from '../actions/actions.js'\nimport TextInput from '../components/TextInput.js'\nimport settings from '../iframe/src/settings.js'\n\nconst synths = _.range(settings.chainChannels).map(index =>\n  createSynth({ index })\n)\nTone.Transport.bpm.value = settings.bpm\nTone.Transport.start(settings.startOffset)\n\nconst mapStateToProps = ({ chains, phrases, selectedUi }) => ({\n  chains,\n  phrases,\n  selectedUi\n})\n\nconst chainIsEmpty = chain =>\n  !_.intersection(\n    Object.keys(chain),\n    _.range(settings.matrixLength).map(i => i.toString())\n  ).length\n\nconst getCurrentChain = ({ chains, selectedUi }) => ({\n  tempo: 0,\n  ..._.get(chains, [selectedUi.chain], {})\n})\n\nconst mapDispatchToProps = dispatch => ({\n  selectUi: payload => dispatch(actions.selectUi(payload)),\n  updateChain: ({ chain, index }) =>\n    dispatch(\n      actions.updateChain({\n        chain,\n        index\n      })\n    )\n})\n\nclass Chain extends Component {\n  constructor(props) {\n    super(props)\n\n    this.keydown = this.keydown.bind(this)\n    this.handleClear = this.handleClear.bind(this)\n    this.handleSelectedPhraseChange = this.handleSelectedPhraseChange.bind(this)\n    this.handleCloneChange = this.handleCloneChange.bind(this)\n    this.handleClone = this.handleClone.bind(this)\n    this.handleTempoChange = this.handleTempoChange.bind(this)\n    this.handleChainIndexChange = this.handleChainIndexChange.bind(this)\n    this.handlePhraseClick = this.handlePhraseClick.bind(this)\n    this.handlePlay = this.handlePlay.bind(this)\n    this.drawCallback = this.drawCallback.bind(this)\n\n    this.state = {\n      isPlaying: false,\n      playingIndex: 0,\n      selectedCloneIndex: '',\n      selectedPhraseIndex: '',\n      mode: '+'\n    }\n  }\n\n  handleSelectedPhraseChange(e) {\n    this.setState({\n      selectedPhraseIndex: e.target.value\n    })\n    e.currentTarget.blur()\n  }\n\n  handleCloneChange(e) {\n    this.setState({\n      selectedCloneIndex: e.target.value\n    })\n    e.currentTarget.blur()\n  }\n\n  getValidCloneChainKeys() {\n    const { selectedUi, chains } = this.props\n    const chainIndex = selectedUi.chain\n    return Object.keys(chains).filter(key => +key !== +chainIndex)\n  }\n\n  handleClone(e) {\n    const { selectedUi, chains, updateChain } = this.props\n    const validCloneChainKeys = this.getValidCloneChainKeys()\n    const chainIndex = selectedUi.chain\n    let { selectedCloneIndex } = this.state\n    const chain = getCurrentChain(this.props)\n    if (_.isEmpty(selectedCloneIndex)) {\n      selectedCloneIndex = validCloneChainKeys[0]\n    }\n\n    if (\n      chainIsEmpty(chain) ||\n      window.confirm(\n        `Do you really want to clone phrase ${selectedCloneIndex}?`\n      )\n    ) {\n      updateChain({\n        chain: chains[selectedCloneIndex],\n        index: chainIndex\n      })\n    }\n    e.currentTarget.blur()\n  }\n\n  handleClear(e) {\n    const { updateChain, selectedUi } = this.props\n    const chainIndex = selectedUi.chain\n\n    if (window.confirm('Do you really want to clear this chain?')) {\n      updateChain({\n        chain: null,\n        index: chainIndex\n      })\n    }\n    e.currentTarget.blur()\n  }\n\n  drawCallback(playingIndex) {\n    this.setState({\n      playingIndex\n    })\n  }\n\n  componentDidMount() {\n    Tone.context.resume()\n\n    const { phrases } = this.props\n    const chain = getCurrentChain(this.props)\n\n    this.sequence = new Tone.Sequence(\n      (time, index) => {\n        const chain = getCurrentChain(this.props)\n\n        // Get the phrase and note positions by using base math.\n        const [phrasePosition, notePosition] = _.padStart(\n          index.toString(settings.matrixLength),\n          2,\n          0\n        )\n          .split('')\n          .map(d => parseInt(d, settings.matrixLength))\n\n        // Get the phrase indices for this position, e.g. { 0: 0, 1: 11, 2: 2 }\n        const phrasesIndices = _.get(chain, phrasePosition)\n\n        // For each channel,\n        _.range(settings.chainChannels).forEach(channel => {\n          // get the phrase index.\n          const phraseIndex = _.get(phrasesIndices, channel)\n\n          // If the phrase index exists,\n          if (!_.isNil(phraseIndex)) {\n            // get the phrase assigned to this channel.\n            const phrase = _.get(phrases, phraseIndex, {})\n\n            // Get the note element for this position.\n            const noteElement = _.get(phrase.notes, notePosition)\n\n            // If we have a note:\n            if (!_.isNil(noteElement)) {\n              // if we have a non-sustain note, triggerAttack.\n              if (noteElement.octave > -1) {\n                triggerAttack({\n                  ...noteElement,\n                  time,\n                  synth: synths[channel]\n                })\n              }\n              // If we have a sustain, do nothing.\n              if (noteElement.octave === -1) {\n              }\n            } else {\n              // If we don't have a note, triggerRelease.\n              triggerRelease({ time, synth: synths[channel] })\n            }\n          } else {\n            // If the phrase doesn't exist, stop the synth.\n            triggerRelease({ time, synth: synths[channel] })\n          }\n        })\n        Tone.Draw.schedule(() => {\n          this.drawCallback(phrasePosition)\n        }, time)\n      },\n      _.range(Math.pow(settings.matrixLength, 2)),\n      settings.subdivision\n    )\n\n    this.sequence.playbackRate = tempoToPlaybackRate(chain.tempo)\n    window.addEventListener('keydown', this.keydown)\n  }\n\n  keydown(event) {\n    // If we pressed space,\n    if (event.code === 'Space') {\n      // toggle the playbar.\n      this.handlePlay(event)\n    }\n  }\n\n  handleTempoChange(e) {\n    const { validity, value } = e.target\n    if (validity.valid) {\n      // Update the sequence.\n      this.sequence.playbackRate = tempoToPlaybackRate(value)\n\n      // Update the store.\n      const { updateChain, selectedUi } = this.props\n      const chain = getCurrentChain(this.props)\n      const newChain = _.cloneDeep(chain)\n      newChain.tempo = value\n      const chainIndex = selectedUi.chain\n      updateChain({ chain: newChain, index: chainIndex })\n    }\n  }\n\n  handlePlay(e) {\n    const { isPlaying } = this.state\n    if (isPlaying) {\n      this.sequence.stop()\n      synths.forEach(synth => triggerRelease({ synth }))\n    } else {\n      this.sequence.start(settings.startOffset)\n    }\n    this.setState({\n      isPlaying: !isPlaying,\n      playingIndex: 0\n    })\n    e.currentTarget.blur()\n  }\n\n  handleChainIndexChange(e) {\n    const { validity, value } = e.target\n    if (validity.valid) {\n      const { selectUi, selectedUi } = this.props\n      selectUi({\n        ...selectedUi,\n        chain: value\n      })\n    }\n  }\n\n  handlePhraseClick({ channel, col, e }) {\n    const { phrases, updateChain, selectedUi } = this.props\n    const { selectedPhraseIndex, mode } = this.state\n    const chainIndex = selectedUi.chain\n    const chain = getCurrentChain(this.props)\n    const newChain = _.cloneDeep(chain)\n    let newPhrase = _.get(newChain, [col, channel])\n\n    // Get all phrases, in order.\n    const allPhrases = _(Object.keys(phrases))\n      .sortBy(d => +d)\n      .uniq()\n      .map(d => +d)\n      .value()\n\n    if (mode === '-') {\n      newPhrase = null\n    } else {\n      // If the cell is empty,\n      if (_.isNil(newPhrase)) {\n        // add the selected one.\n        newPhrase = _.isEmpty(selectedPhraseIndex)\n          ? allPhrases[0]\n          : selectedPhraseIndex\n      } else {\n        // If the cell is not empty,\n        // get the phrase index.\n        const newPhraseIndex = _.indexOf(allPhrases, +newPhrase)\n\n        // If it shows the first overall phrase,\n        if (newPhraseIndex === 0) {\n          // clear the cell.\n          newPhrase = null\n        } else {\n          // Else decrease phrase.\n          newPhrase = allPhrases[newPhraseIndex - 1]\n        }\n      }\n    }\n\n    _.setWith(newChain, [col, channel], newPhrase, Object)\n    updateChain({ chain: newChain, index: chainIndex })\n    e.currentTarget.blur()\n  }\n\n  componentWillUnmount() {\n    this.drawCallback = () => {}\n    this.sequence.stop()\n    synths.forEach(synth => triggerRelease({ synth }))\n    window.removeEventListener('keydown', this.keydown)\n  }\n\n  componentDidUpdate(prevProps) {\n    const oldChain = getCurrentChain(prevProps)\n    const newChain = getCurrentChain(this.props)\n    if (\n      prevProps.selectedUi.chain !== this.props.selectedUi.chain ||\n      oldChain.tempo !== newChain.tempo\n    ) {\n      this.sequence.playbackRate = tempoToPlaybackRate(newChain.tempo)\n    }\n\n    if (!chainIsEmpty(oldChain) && chainIsEmpty(newChain)) {\n      this.setState({ mode: '+' })\n    }\n  }\n\n  render() {\n    const { selectedUi, phrases } = this.props\n    const chainIndex = selectedUi.chain\n\n    const {\n      isPlaying,\n      playingIndex,\n      selectedCloneIndex,\n      selectedPhraseIndex,\n      mode\n    } = this.state\n    const chain = getCurrentChain(this.props)\n    const validCloneChainKeys = this.getValidCloneChainKeys()\n\n    return (\n      <div className=\"Chain two-rows-and-grid\">\n        <div className=\"main\">\n          <div className={classNames('warning', { hide: !_.isEmpty(phrases) })}>\n            error: no phrases found\n          </div>\n          <div className={classNames('settings', { hide: _.isEmpty(phrases) })}>\n            <div className=\"title\">Chain</div>\n            <TextInput\n              label=\"#\"\n              value={chainIndex.toString()}\n              handleChange={this.handleChainIndexChange}\n              type=\"number\"\n              options={{ min: 0, max: settings.chains - 1 }}\n            />\n            <div className=\"title\">Tempo</div>\n            <TextInput\n              label=\"#\"\n              value={chain.tempo.toString()}\n              handleChange={this.handleTempoChange}\n              type=\"number\"\n              options={{ min: 0, max: 7 }}\n            />\n          </div>\n          <div className={classNames('matrix', { hide: _.isEmpty(phrases) })}>\n            <button\n              className={classNames('play button', { active: isPlaying })}\n              onClick={this.handlePlay}\n            >\n              {isPlaying ? 'stop' : 'play'}\n            </button>\n            <table className=\"phrases\">\n              <tbody>\n                {_.range(settings.chainChannels).map(channel => (\n                  <tr key={channel}>\n                    <td>{channel}</td>\n                    {_.range(settings.matrixLength).map(col => {\n                      const phrase = _.get(chain, [col, channel])\n                      const highlighter =\n                        channel === 0 && col === playingIndex && isPlaying ? (\n                          <span className=\"highlight\" />\n                        ) : null\n                      return (\n                        <td\n                          key={col}\n                          className={classNames({\n                            highlight:\n                              col === playingIndex &&\n                              isPlaying &&\n                              !_.isNil(phrase)\n                          })}\n                          onClick={e =>\n                            this.handlePhraseClick({ channel, col, e })\n                          }\n                        >\n                          {highlighter}\n                          <button>\n                            <span>\n                              {_.isNil(phrase) ? '' : _.padStart(phrase, 2, 0)}\n                            </span>\n                          </button>\n                        </td>\n                      )\n                    })}\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n          <div className=\"tools\">\n            <div>\n              <button\n                className=\"button\"\n                disabled={chainIsEmpty(chain)}\n                onClick={this.handleClear}\n              >\n                clear\n              </button>\n            </div>\n            <div className=\"clone\">\n              <button\n                disabled={_.isEmpty(validCloneChainKeys)}\n                className=\"button\"\n                onClick={this.handleClone}\n              >\n                clone\n              </button>\n              <select\n                value={selectedCloneIndex}\n                onChange={this.handleCloneChange}\n              >\n                {validCloneChainKeys.map(key => (\n                  <option key={key} value={key}>\n                    {key}\n                  </option>\n                ))}\n              </select>\n            </div>\n            <div className=\"selected\">\n              <span className=\"title\">phrase</span>\n              <select\n                value={selectedPhraseIndex}\n                onChange={this.handleSelectedPhraseChange}\n              >\n                {Object.keys(phrases).map(key => (\n                  <option key={key} value={key}>\n                    {key}\n                  </option>\n                ))}\n              </select>\n            </div>\n            <div className=\"add-delete\">\n              <button\n                className={classNames('button', {\n                  active: mode === '+'\n                })}\n                onClick={() => {\n                  this.setState({\n                    mode: '+'\n                  })\n                }}\n              >\n                +\n              </button>\n              <button\n                // disabled={_.isEmpty(phrase.notes)}\n                className={classNames('button', {\n                  active: mode === '-'\n                })}\n                onClick={() => {\n                  this.setState({\n                    mode: '-'\n                  })\n                }}\n              >\n                -\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Chain)\n","import React, { Component } from 'react'\nimport { connect } from 'react-redux'\nimport _ from 'lodash'\nimport * as Tone from 'tone'\nimport classNames from 'classnames'\nimport {\n  createSynth,\n  tempoToPlaybackRate,\n  triggerAttack,\n  triggerRelease\n} from '../iframe/src/soundAPI/index.js'\nimport actions from '../actions/actions.js'\nimport TextInput from '../components/TextInput.js'\nimport settings from '../iframe/src/settings.js'\n\nconst synths = _.range(settings.chainChannels).map(index =>\n  createSynth({ index })\n)\nTone.Transport.bpm.value = settings.bpm\nTone.Transport.start(settings.startOffset)\n\nconst mapStateToProps = ({ songs, chains, phrases, selectedUi }) => ({\n  songs,\n  chains,\n  phrases,\n  selectedUi\n})\n\nconst getCurrentSong = ({ songs, selectedUi }) => ({\n  tempo: 0,\n  ..._.get(songs, [selectedUi.song], {})\n})\n\nconst songIsEmpty = song =>\n  !_.intersection(\n    Object.keys(song),\n    _.range(settings.matrixLength).map(i => i.toString())\n  ).length\n\nconst mapDispatchToProps = dispatch => ({\n  selectUi: payload => dispatch(actions.selectUi(payload)),\n  updateSong: ({ song, index }) =>\n    dispatch(\n      actions.updateSong({\n        song,\n        index\n      })\n    )\n})\n\nclass Song extends Component {\n  constructor(props) {\n    super(props)\n\n    this.handleClear = this.handleClear.bind(this)\n    this.keydown = this.keydown.bind(this)\n    this.handleTempoChange = this.handleTempoChange.bind(this)\n    this.handleSongIndexChange = this.handleSongIndexChange.bind(this)\n    this.handleChainClick = this.handleChainClick.bind(this)\n    this.handlePlay = this.handlePlay.bind(this)\n    this.drawCallback = this.drawCallback.bind(this)\n\n    this.state = {\n      isPlaying: false,\n      playingIndex: 0\n    }\n  }\n\n  handleClear(e) {\n    e.currentTarget.blur()\n    const { updateSong, selectedUi } = this.props\n    const songIndex = selectedUi.song\n\n    if (window.confirm('Do you really want to clear this song?')) {\n      updateSong({\n        song: {\n          tempo: 0\n        },\n        index: songIndex\n      })\n    }\n  }\n\n  drawCallback(playingIndex) {\n    this.setState({\n      playingIndex\n    })\n  }\n\n  componentDidMount() {\n    Tone.context.resume()\n\n    const { chains, phrases } = this.props\n    const song = getCurrentSong(this.props)\n\n    this.sequence = new Tone.Sequence(\n      (time, index) => {\n        const song = getCurrentSong(this.props)\n\n        // Get the chain, phrase and note positions by using base math.\n        const [chainPosition, phrasePosition, notePosition] = _.padStart(\n          index.toString(settings.matrixLength),\n          3,\n          0\n        )\n          .split('')\n          .map(d => parseInt(d, settings.matrixLength))\n\n        // Get the chain index for this position.\n        const chainIndex = _.get(song, chainPosition)\n\n        // Get the chain.\n        const chain = _.get(chains, chainIndex)\n\n        // Get the phrase indices for this position, e.g. { 0: 0, 1: 11, 2: 2 }\n        const phrasesIndices = _.get(chain, phrasePosition)\n\n        // For each channel,\n        _.range(settings.chainChannels).forEach(channel => {\n          // get the phrase index.\n          const phraseIndex = _.get(phrasesIndices, channel)\n\n          // If the phrase index exists,\n          if (!_.isNil(phraseIndex)) {\n            // get the phrase assigned to this channel.\n            const phrase = _.get(phrases, phraseIndex, {})\n\n            // Get the note element for this position.\n            const noteElement = _.get(phrase.notes, notePosition)\n\n            // If we have a note:\n            if (!_.isNil(noteElement)) {\n              // if we have a non-sustain note, triggerAttack.\n              if (noteElement.octave > -1) {\n                triggerAttack({\n                  ...noteElement,\n                  time,\n                  synth: synths[channel]\n                })\n              }\n              // If we have a sustain, do nothing.\n              if (noteElement.octave === -1) {\n              }\n            } else {\n              // If we don't have a note, triggerRelease.\n              triggerRelease({ time, synth: synths[channel] })\n            }\n          } else {\n            // If the phrase doesn't exist, stop the synth.\n            triggerRelease({ time, synth: synths[channel] })\n          }\n        })\n\n        Tone.Draw.schedule(() => {\n          this.drawCallback(chainPosition)\n        }, time)\n      },\n      _.range(Math.pow(settings.matrixLength, 3)),\n      settings.subdivision\n    )\n\n    this.sequence.playbackRate = tempoToPlaybackRate(song.tempo)\n    window.addEventListener('keydown', this.keydown)\n  }\n\n  handleTempoChange(e) {\n    const { validity, value } = e.target\n    if (validity.valid) {\n      // Update the sequence.\n      this.sequence.playbackRate = tempoToPlaybackRate(value)\n\n      // Update the store.\n      const { updateSong, selectedUi } = this.props\n      const song = getCurrentSong(this.props)\n      const newSong = { ...song, tempo: value }\n      const songIndex = selectedUi.song\n      updateSong({ song: newSong, index: songIndex })\n    }\n  }\n\n  handlePlay() {\n    const { isPlaying } = this.state\n    if (isPlaying) {\n      this.sequence.stop()\n      synths.forEach(synth => triggerRelease({ synth }))\n    } else {\n      this.sequence.start(settings.startOffset)\n    }\n    this.setState({\n      isPlaying: !isPlaying,\n      playingIndex: 0\n    })\n  }\n\n  handleSongIndexChange(e) {\n    const { validity, value } = e.target\n    if (validity.valid) {\n      const { selectUi, selectedUi } = this.props\n      selectUi({\n        ...selectedUi,\n        song: value\n      })\n    }\n  }\n\n  handleChainClick({ col }) {\n    const { chains, updateSong, selectedUi } = this.props\n    const songIndex = selectedUi.song\n    const song = getCurrentSong(this.props)\n    let newChain = _.get(song, col)\n\n    // Get chains, in order.\n    const sortedChains = _(Object.keys(chains))\n      .sortBy(d => +d)\n      .uniq()\n      .map(d => +d)\n      .value()\n\n    // If the cell is empty,\n    if (_.isNil(newChain)) {\n      // set the last chain.\n      newChain = _.last(sortedChains)\n    } else {\n      // If the cell is not empty,\n      // and if it shows the first chain,\n      const newChainIndex = _.indexOf(sortedChains, newChain)\n\n      if (newChainIndex === 0) {\n        // clear.\n        newChain = null\n      } else {\n        // Otherwise decrease chain.\n        newChain = sortedChains[newChainIndex - 1]\n      }\n    }\n\n    const newSong = {\n      ...song,\n      [col]: newChain\n    }\n\n    updateSong({ song: newSong, index: songIndex })\n  }\n\n  keydown(event) {\n    // If we pressed space,\n    if (event.code === 'Space') {\n      // toggle the playbar.\n      this.handlePlay()\n    }\n  }\n\n  componentWillUnmount() {\n    this.drawCallback = () => {}\n    this.sequence.stop()\n    synths.forEach(synth => triggerRelease({ synth }))\n    window.removeEventListener('keydown', this.keydown)\n  }\n\n  componentDidUpdate(prevProps) {\n    const oldSong = getCurrentSong(prevProps)\n    const newSong = getCurrentSong(this.props)\n    if (\n      prevProps.selectedUi.song !== this.props.selectedUi.song ||\n      oldSong.tempo !== newSong.tempo\n    ) {\n      this.sequence.playbackRate = tempoToPlaybackRate(newSong.tempo)\n    }\n  }\n\n  render() {\n    const { selectedUi } = this.props\n    const songIndex = selectedUi.song\n    const { isPlaying, playingIndex } = this.state\n    const song = getCurrentSong(this.props)\n    const { chains } = this.props\n\n    return (\n      <div className=\"Song two-rows-and-grid\">\n        <div className=\"main\">\n          <div className={classNames('warning', { hide: !_.isEmpty(chains) })}>\n            error: no chains found\n          </div>\n          <div className={classNames('settings', { hide: _.isEmpty(chains) })}>\n            <div className=\"title\">Song</div>\n            <TextInput\n              label=\"#\"\n              value={songIndex.toString()}\n              handleChange={this.handleSongIndexChange}\n              type=\"number\"\n              options={{ min: 0, max: settings.songs - 1 }}\n            />\n            <div className=\"title\">Tempo</div>\n            <TextInput\n              label=\"#\"\n              value={song.tempo.toString()}\n              handleChange={this.handleTempoChange}\n              type=\"number\"\n              options={{ min: 0, max: 7 }}\n            />\n          </div>\n          <div className={classNames('matrix', { hide: _.isEmpty(chains) })}>\n            <button\n              className={classNames('play button', { active: isPlaying })}\n              onClick={this.handlePlay}\n            >\n              {isPlaying ? 'stop' : 'play'}\n            </button>\n            <table className=\"songs\">\n              <tbody>\n                <tr>\n                  <td>c</td>\n                  {_.range(settings.matrixLength).map(col => {\n                    const chain = _.get(song, col)\n                    const highlighter =\n                      col === playingIndex && isPlaying ? (\n                        <span className=\"highlight\" />\n                      ) : null\n                    return (\n                      <td\n                        key={col}\n                        className={classNames({\n                          highlight:\n                            col === playingIndex && isPlaying && !_.isNil(chain)\n                        })}\n                        onClick={() => this.handleChainClick({ col })}\n                      >\n                        {highlighter}\n                        <button>\n                          <span>\n                            {_.isNil(chain) ? '' : _.padStart(chain, 2, 0)}\n                          </span>\n                        </button>\n                      </td>\n                    )\n                  })}\n                </tr>\n              </tbody>\n            </table>\n          </div>\n          <div className=\"tools\">\n            <div>\n              <button\n                className=\"button\"\n                disabled={songIsEmpty(song)}\n                onClick={this.handleClear}\n              >\n                clear\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Song)\n","const patcher = ({ slides, index }) => {\n  return slides\n    .slice(0, index + 1)\n    .map(d => d.game)\n    .reduce((accumulator, current) => {\n      if (current && current.length) {\n        const lines = accumulator.split('\\n')\n\n        // If it starts with one of the patching keywords,\n        // run the patch.\n        // Otherwise return text.\n\n        const deleteOne = current.match(/^DEL(\\d+)$/)\n        const deleteRange = current.match(/^DEL(\\d+)-(\\d+)$/)\n        const replaceOne = current.match(/^REP(\\d+)/)\n        const replaceRange = current.match(/^REP(\\d+)-(\\d+)/)\n        const add = current.match(/^ADD(\\d+)/)\n        const same = current.match(/^SAME$/)\n        if (deleteOne) {\n          // Get line number to delete.\n          const lineNumberToDelete = +deleteOne[1]\n          // Delete the line.\n          const newLines = [\n            ...lines.slice(0, lineNumberToDelete),\n            ...lines.slice(lineNumberToDelete + 1)\n          ]\n\n          return newLines.join('\\n')\n        } else if (deleteRange) {\n          // Get line numbers to delete.\n          const lineNumberToDeleteStart = +deleteRange[1]\n          const lineNumberToDeleteEnd = +deleteRange[2]\n          const newLines = [\n            ...lines.slice(0, lineNumberToDeleteStart),\n            ...lines.slice(lineNumberToDeleteEnd + 1)\n          ]\n\n          return newLines.join('\\n')\n        } else if (replaceRange) {\n          // Get line numbers to delete.\n          const lineNumberToReplaceStart = +replaceRange[1]\n          const lineNumberToReplaceEnd = +replaceRange[2]\n          const newLines = [\n            ...lines.slice(0, lineNumberToReplaceStart),\n            ...current.substring(replaceRange[0].length + 1).split('\\n'),\n            ...lines.slice(lineNumberToReplaceEnd + 1)\n          ]\n\n          return newLines.join('\\n')\n        } else if (replaceOne) {\n          const lineNumberToReplace = +replaceOne[1]\n          const newLines = [\n            ...lines.slice(0, lineNumberToReplace),\n            ...current.substring(replaceOne[0].length + 1).split('\\n'),\n            ...lines.slice(lineNumberToReplace + 1)\n          ]\n\n          return newLines.join('\\n')\n        } else if (add) {\n          // Get line numbers to add.\n          const lineNumberToAdd = +add[1]\n          const newLines = [\n            ...lines.slice(0, lineNumberToAdd),\n            ...current.substring(add[0].length + 1).split('\\n'),\n            ...lines.slice(lineNumberToAdd)\n          ]\n\n          return newLines.join('\\n')\n        } else if (same) {\n          return accumulator\n        } else {\n          return current\n        }\n      } else {\n        return accumulator\n      }\n    }, '')\n}\n\nexport default patcher\n","import React, { Component } from 'react'\nimport classNames from 'classnames'\nimport { isNil } from 'lodash'\nimport range from 'lodash/range'\nimport every from 'lodash/every'\nimport { connect } from 'react-redux'\nimport patcher from '../utils/patcher.js'\nimport screenTypes from '../iframe/src/utils/screenTypes.js'\nimport actions from '../actions/actions.js'\nimport lessons from '../utils/lessons.json'\nimport Map from './Map.js'\n\nconst areRequirementsMet = ({ requirements, props }) =>\n  every(requirements, (value, key) => props[key] === value)\n\nconst mapStateToProps = ({ screen, tutorial, game }) => ({\n  screen,\n  tutorial,\n  game\n})\n\nconst mapDispatchToProps = dispatch => ({\n  setCodeTab: tab => dispatch(actions.setCodeTab(tab)),\n  newGame: () => dispatch(actions.newGame()),\n  updateMap: newMap => dispatch(actions.updateMap(newMap)),\n  setScreen: screen => dispatch(actions.setScreen(screen)),\n  closeTutorial: () => dispatch(actions.closeTutorial()),\n  updateGame: ({ tab, content }) =>\n    dispatch(actions.updateGame({ tab, content })),\n  updateSprite: ({ sprite, index }) =>\n    dispatch(\n      actions.updateSprite({\n        sprite,\n        index\n      })\n    ),\n  setTutorialSlide: ({ lessonIndex, slideIndex }) =>\n    dispatch(\n      actions.setTutorialSlide({\n        lessonIndex,\n        slideIndex\n      })\n    )\n})\n\nclass Tutorial extends Component {\n  constructor(props) {\n    super(props)\n    this.handleClose = this.handleClose.bind(this)\n    this.handlePrevious = this.handlePrevious.bind(this)\n    this.handleNextSlide = this.handleNextSlide.bind(this)\n    this.handleNextLesson = this.handleNextLesson.bind(this)\n    this.handleSlide = this.handleSlide.bind(this)\n    this.fireActions = this.fireActions.bind(this)\n    this.buttonsElement = null\n    this.setButtonsRef = e => {\n      this.buttonsElement = e\n    }\n  }\n\n  fireActions({ lessonIndex, slideIndex }) {\n    const {\n      setScreen,\n      updateGame,\n      updateSprite,\n      updateMap,\n      screen,\n      setCodeTab\n    } = this.props\n\n    const lesson = lessons[lessonIndex]\n    const { slides } = lesson\n    const slide = slides[slideIndex]\n    const { screen: slideScreen, game, sprites, map: slideMap } = slide\n\n    if (!isNil(game)) {\n      const patchedGame = patcher({ slides, index: slideIndex })\n      // If we're not on CODE, set the game with no prefix.\n      if (screen !== screenTypes.CODE) {\n        updateGame({ tab: 0, content: patchedGame })\n      } else {\n        // If we are on CODE, use prefix.\n        updateGame({ tab: 0, content: `SCRIPT-8 LESSON${patchedGame}` })\n      }\n    }\n\n    // If there are sprites, set them.\n    if (sprites) {\n      // console.log(sprites)\n      sprites.forEach(({ array, index }) =>\n        updateSprite({ sprite: array, index })\n      )\n    }\n\n    if (slideMap) {\n      let newMap = Map.createBlankMap()\n      slideMap.forEach(d => {\n        const [row, col, value] = d.split('-')\n        newMap[+row][+col] = value ? +value : null\n      })\n      updateMap(newMap)\n    }\n\n    // Set the screen, if we have one.\n    if (slideScreen) {\n      setScreen(slideScreen)\n      // If the slide screen is CODE, go to the first tab.\n      if (slideScreen === screenTypes.CODE) {\n        setCodeTab(0)\n      }\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    const { tutorial, screen } = this.props\n    const { lessonIndex, slideIndex } = tutorial\n    const { slides } = lessons[lessonIndex]\n    const slide = slides[slideIndex]\n    const { requirements } = slide\n\n    // Check if we're on a slide with requirements,\n    // and if those requirements were not previously met,\n    // but they are now. And if so, advance.\n    if (requirements) {\n      if (!areRequirementsMet({ requirements, props: prevProps })) {\n        if (areRequirementsMet({ requirements, props: this.props })) {\n          this.handleNextSlide()\n        }\n      }\n    }\n\n    if (screen === screenTypes.RUN) {\n      this.buttonsElement.scrollIntoView()\n    }\n  }\n\n  handleClose() {\n    this.props.closeTutorial()\n  }\n\n  handleSlide({ lessonIndex, slideIndex }) {\n    this.props.setTutorialSlide({ lessonIndex, slideIndex })\n    this.fireActions({ lessonIndex, slideIndex })\n  }\n\n  handleNextLesson() {\n    const { lessonIndex } = this.props.tutorial\n    this.handleSlide({ lessonIndex: lessonIndex + 1, slideIndex: 0 })\n  }\n\n  handleNextSlide() {\n    const { lessonIndex, slideIndex } = this.props.tutorial\n    const { newGameOnNext } = lessons[lessonIndex].slides[slideIndex]\n    if (newGameOnNext) {\n      this.props.newGame(this.props.screen)\n    }\n    this.handleSlide({ lessonIndex, slideIndex: slideIndex + 1 })\n  }\n\n  handlePrevious() {\n    const { lessonIndex, slideIndex } = this.props.tutorial\n    this.handleSlide({ lessonIndex, slideIndex: slideIndex - 1 })\n  }\n\n  render() {\n    const { tutorial, screen, tutorialRef } = this.props\n    const { lessonIndex, slideIndex } = tutorial\n    const { title, slides } = lessons[lessonIndex]\n    const slide = slides[slideIndex]\n    const { requirements } = slide\n    const close = (\n      <button className=\"button\" onClick={this.handleClose}>\n        close\n      </button>\n    )\n\n    const enableNextSlide = requirements\n      ? areRequirementsMet({ requirements, props: this.props })\n      : true\n\n    const nextSlide =\n      slideIndex < slides.length - 1 ? (\n        <button\n          className=\"button\"\n          disabled={!enableNextSlide}\n          onClick={this.handleNextSlide}\n        >\n          next\n        </button>\n      ) : null\n\n    const nextLesson =\n      slideIndex === slides.length - 1 && lessonIndex < lessons.length - 1 ? (\n        <button className=\"button\" onClick={this.handleNextLesson}>\n          next lesson\n        </button>\n      ) : null\n\n    const previous =\n      slideIndex > 0 ? (\n        <button className=\"button\" onClick={this.handlePrevious}>\n          previous\n        </button>\n      ) : null\n\n    const buttons = (\n      <div className=\"buttons\" ref={this.setButtonsRef}>\n        {previous}\n        {nextLesson}\n        {nextSlide}\n        {close}\n      </div>\n    )\n\n    const description =\n      slideIndex === 0 ? (\n        lessonIndex === 0 ? (\n          <p>{title}</p>\n        ) : (\n          <p>\n            Lesson {lessonIndex}: {title}\n          </p>\n        )\n      ) : null\n\n    const progress = range(slides.length)\n      .map(i => (i === slideIndex ? '|' : '.'))\n      .join('')\n\n    return (\n      <div\n        className={classNames('Tutorial', {\n          'in-run': screen === screenTypes.RUN\n        })}\n        ref={tutorialRef}\n      >\n        {description}\n        {slide.text.map((p, i) => (\n          <p\n            key={i}\n            className={classNames({\n              code: p.startsWith('XX')\n            })}\n            dangerouslySetInnerHTML={{ __html: p.replace(/^XX/, '') }}\n          />\n        ))}\n        <div className=\"bottom-bar\">\n          {buttons}\n          <p>{progress}</p>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Tutorial)\n","import prettier from 'prettier/standalone'\nimport prettierParser from 'prettier/parser-babylon'\n\nconst commands = {\n  tab: cm => {\n    const spaces = Array(cm.getOption('indentUnit') + 1).join(' ')\n    cm.replaceSelection(spaces)\n  },\n  comment: cm => {\n    cm.toggleComment()\n  },\n  format: (cm, setContents) => {\n    const oldCode = cm.getValue()\n    const index = cm.indexFromPos(cm.getCursor())\n\n    const prettierOpts = cursorOffset => ({\n      parser: 'babel',\n      plugins: {\n        babel: prettierParser\n      },\n      cursorOffset,\n      semi: false,\n      singleQuote: true\n    })\n\n    const { formatted, cursorOffset } = prettier.formatWithCursor(\n      oldCode,\n      prettierOpts(index)\n    )\n\n    setContents(formatted)\n\n    const newCursor = cm.posFromIndex(cursorOffset)\n    cm.setCursor(newCursor)\n  }\n}\n\nexport default commands\n","// actions.updateContent is used in three places:\n// - in CodeEditor, on code mirror change\n// - in Tutorial, if slide has game,\n//    if we're not on code, updateContent is called as is\n//    if we are on code, updateContent is called with the prefix\nimport { parse } from 'acorn'\nimport { simple as walk } from 'acorn-walk'\nimport React, { Component } from 'react'\nimport { isNil } from 'lodash'\nimport get from 'lodash/get'\nimport includes from 'lodash/includes'\nimport setupLinter from '../utils/setupLinter.js'\nimport commands from '../utils/commands.js'\nimport blankTemplate from '../iframe/src/blankTemplate.js'\nimport { getActive } from '../reducers/game.js'\nimport lessons from '../utils/lessons.json'\n\nconst { platform } = window.navigator\n\nclass CodeEditor extends Component {\n  constructor(props) {\n    super(props)\n\n    this.sliderMark = null\n    this.hoverMark = null\n    this.setContents = this.setContents.bind(this)\n    this.handleSlider = this.handleSlider.bind(this)\n    this.activateSlider = this.activateSlider.bind(this)\n    this.hideSlider = this.hideSlider.bind(this)\n    this.highlightText = this.highlightText.bind(this)\n    this.mouseMove = this.mouseMove.bind(this)\n  }\n\n  componentDidMount() {\n    setupLinter()\n    const activeGame = getActive(this.props.game)\n    this.codeMirror = window.CodeMirror(this._editor, {\n      value: activeGame.text || '',\n      mode: 'javascript',\n      theme: 'nyx8',\n      lint: true,\n      lineNumbers: true,\n      tabSize: 2,\n      cursorBlinkRate: 0,\n      scrollbarStyle: null,\n      extraKeys: {\n        Tab: commands.tab,\n        'Cmd-/': commands.comment,\n        'Ctrl-/': commands.comment,\n        'Alt-F': cm => commands.format(cm, this.setContents),\n        Esc: 'clearSearch'\n      }\n    })\n\n    const docHistory = get(this.props.docHistories, `[${activeGame.key}]`, null)\n\n    if (docHistory) {\n      this.codeMirror.getDoc().setHistory(docHistory)\n    } else {\n      this.codeMirror.getDoc().clearHistory()\n    }\n\n    this.codeMirror.on('change', cm => {\n      const content = cm.getValue()\n      document.querySelector('#highlighter-box').classList.add('hide')\n      this.props.updateContent(content)\n    })\n\n    this.codeMirror.on('keydown', (cm, e) => {\n      if (includes(platform, 'Mac')) {\n        if (e.key === 'Meta') {\n          this.activateSlider()\n        }\n      } else {\n        if (e.key === 'Shift') {\n          this.activateSlider()\n        }\n      }\n    })\n\n    // Add this eventlistener to window.\n    window.addEventListener('keyup', this.hideSlider)\n\n    // If found, restore scroll data.\n    const { scrollData } = activeGame\n    if (scrollData) {\n      this.codeMirror.scrollTo(scrollData.left || 0, scrollData.top || 0)\n      this.codeMirror.setCursor(scrollData.cursorPosition)\n    }\n\n    // Give editor focus.\n    this.codeMirror.focus()\n  }\n\n  hideSlider() {\n    this.sliderMark && this.sliderMark.clear()\n    this._slider.classList.add('hide')\n  }\n\n  highlightText(range) {\n    const lines = range.split('-').map(d => +d)\n    const firstLine = lines[0]\n    const lastLine = lines[lines.length - 1]\n    const cmLines = lines.map(d => this.codeMirror.getLine(d))\n\n    const whiteSpaces = cmLines[0].search(/\\S/)\n\n    // Calculate the width.\n    const width =\n      (Math.max(...cmLines.map(d => d.length)) - whiteSpaces + 1) *\n      this.codeMirror.defaultCharWidth()\n\n    // Calculate the height.\n    const height =\n      this.codeMirror.defaultTextHeight() * (1 + lastLine - firstLine)\n\n    document.querySelector('#highlighter-box').classList.remove('hide')\n    this.codeMirror.addWidget(\n      { line: firstLine, ch: whiteSpaces },\n      document.querySelector('#highlighter-box'),\n      false\n    )\n\n    this._highlighterBox.style.width = `${width + 8}px`\n    this._highlighterBox.style.height = `${height + 6}px`\n\n    this.codeMirror.scrollIntoView({ line: lastLine, ch: 0 }, 40)\n  }\n\n  activateSlider() {\n    // If the cursor is on a number,\n    // reset and show the slider.\n\n    // Get cursor.\n    const cursor = this.codeMirror.getCursor()\n\n    // Get token for this position.\n    const token = this.codeMirror.getTokenAt({\n      ...cursor,\n      ch: cursor.ch + 1\n    })\n\n    // If it's a number,\n    if (token && token.type === 'number') {\n      // clear out the previous mark,\n      this.sliderMark && this.sliderMark.clear()\n\n      // and mark this token.\n      this.sliderMark = this.codeMirror.markText(\n        {\n          line: cursor.line,\n          ch: token.start\n        },\n        {\n          line: cursor.line,\n          ch: token.end\n        },\n        {\n          className: 'slider-token'\n        }\n      )\n\n      // get the token's middle point coords.\n      const middleCoords = this.codeMirror.charCoords({\n        line: cursor.line,\n        ch: token.start\n      })\n\n      // Get the wrapper rect.\n      const wrapperRect = this._wrapper.getBoundingClientRect()\n\n      // Save token.\n      const value = token.string\n\n      const valueNumber = +value\n\n      if (valueNumber >= -127 && valueNumber <= 127) {\n        this._slider.min = -127\n        this._slider.max = 127\n        this._slider.value = valueNumber\n      } else {\n        this._slider.min = -valueNumber * 2\n        this._slider.max = valueNumber * 2\n        this._slider.value = valueNumber\n      }\n\n      // Position slider centered above token.\n      this._slider.style.left = `${middleCoords.left -\n        wrapperRect.left +\n        (value.length * this.codeMirror.defaultCharWidth()) / 2}px`\n      this._slider.style.top = `${middleCoords.top -\n        wrapperRect.top -\n        this.codeMirror.defaultTextHeight()}px`\n\n      // Show slider.\n      this._slider.classList.remove('hide')\n    }\n  }\n\n  handleSlider(e) {\n    // Get mark positions.\n    const { from, to } = this.sliderMark.find()\n\n    // Calculate new token.\n    const newToken = e.target.value.toString()\n\n    // Change token content.\n    this.codeMirror.replaceRange(newToken, from, to)\n\n    // Re-select token.\n    this.sliderMark = this.codeMirror.markText(\n      from,\n      {\n        ...from,\n        ch: from.ch + newToken.length\n      },\n      {\n        className: 'slider-token'\n      }\n    )\n  }\n\n  setContents(value) {\n    this.codeMirror.setValue(value)\n    this.codeMirror.refresh()\n  }\n\n  componentWillReceiveProps(nextProps) {\n    // If the incoming game is the empty game code,\n    if (nextProps.game[0].text === 'SCRIPT-8 NEW') {\n      // set CodeMirror's value to the blank template,\n      this.setContents(blankTemplate)\n      // and clear the doc history.\n      this.codeMirror.getDoc().clearHistory()\n    } else if (\n      // If the incoming game is a lesson,\n      nextProps.game[0].text.startsWith('SCRIPT-8 LESSON')\n    ) {\n      // set the lesson,\n      this.setContents(nextProps.game[0].text.replace('SCRIPT-8 LESSON', ''))\n\n      // and highlight lines if required.\n      const { tutorial } = nextProps\n      if (tutorial) {\n        const lesson = lessons[tutorial.lessonIndex]\n        const { slides } = lesson\n        const slide = slides[tutorial.slideIndex]\n        if (slide && slide.linesToHighlight) {\n          this._highlighterBox.classList.remove('hide')\n          this.highlightText(slide.linesToHighlight)\n        }\n      }\n    } else if (\n      // If the incoming tab is different than this one,\n      // we are about to switch tabs.\n      getActive(this.props.game).key !== getActive(nextProps.game).key\n    ) {\n      // Save current doc's history.\n      this.props.updateHistory({\n        index: getActive(this.props.game).key,\n        history: this.codeMirror.getDoc().getHistory()\n      })\n\n      // Save current scrollData.\n      const oldScrollInfo = this.codeMirror.getScrollInfo()\n      const oldCursorPosition = this.codeMirror.getCursor()\n      this.props.setScrollData({\n        scrollData: {\n          top: oldScrollInfo.top,\n          left: oldScrollInfo.left,\n          cursorPosition: oldCursorPosition\n        },\n        tab: getActive(this.props.game).key\n      })\n\n      // Set codemirror contents to new tab.\n      this.setContents(getActive(nextProps.game).text || '')\n\n      // Try getting new tab's history.\n      const docHistory = get(\n        this.props.docHistories,\n        `[${getActive(nextProps.game).key}]`,\n        null\n      )\n\n      // Try setting new tab's history.\n      if (docHistory) {\n        this.codeMirror.getDoc().setHistory(docHistory)\n      } else {\n        this.codeMirror.getDoc().clearHistory()\n      }\n\n      // Try setting new tab's scrollData.\n      const { scrollData } = getActive(nextProps.game)\n      if (scrollData) {\n        this.codeMirror.scrollTo(scrollData.left || 0, scrollData.top || 0)\n        this.codeMirror.setCursor(scrollData.cursorPosition)\n      }\n\n      // Give editor focus.\n      this.codeMirror.focus()\n    }\n\n    if (\n      JSON.stringify(nextProps.errorLine) !==\n      JSON.stringify(this.props.errorLine)\n    ) {\n      if (!isNil(nextProps.errorLine)) {\n        // We'll use this to store the setTimeout id.\n        let id\n\n        // This counter will prevent the setTimeout running indefinitely.\n        let counter\n\n        // Function to check if codemirror has active game loaded.\n        const isReady = () =>\n          this.codeMirror.getValue() === getActive(this.props.game).text\n\n        // Function to highlight the line.\n        const highlight = () => {\n          this.highlightText(nextProps.errorLine.line.toString())\n        }\n\n        // Function that checks if we're ready, and if so, stops the interval,\n        // and highlights the text.\n        const checkFunction = () => {\n          if (isReady()) {\n            clearInterval(id)\n            highlight()\n          } else if (counter >= 7) {\n            clearInterval(id)\n          }\n          counter++\n        }\n\n        // Now we can begin.\n        // If we're already ready,\n        if (isReady()) {\n          // just highlight.\n          highlight()\n        } else {\n          // Otherwise,\n          // reset the counter variable,\n          counter = 0\n          // and start checking.\n          id = setInterval(checkFunction, 250)\n        }\n      }\n    }\n  }\n\n  // Track current mouse position in the code\n  mouseMove(e) {\n    let tab = getActive(this.props.game)\n    let setCallUnderMouse = (node) => {\n      this.props.setCallUnderMouse({ tab: tab.key, callUnderMouse: node })\n    }\n    let clearCallUnderMouse = () => {\n      this.props.clearCallUnderMouse({ tab: tab.key })\n    }\n\n    // We only want this to show up if the user is holding control. Otherwise selection and cursor position can get\n    // confusing.\n    if (e.ctrlKey) {\n      // Lookup the text position of the mouse\n      let mousePos = this.codeMirror.coordsChar({ left: e.pageX, top: e.pageY });\n      if (!mousePos.outside) {\n        let smallestNode = null\n        let smallestSize = Infinity\n        try {\n          // Use Acorn to walk over the parsed code looking for each call expression. If the mouse is currently inside\n          // the call expression text bounds, and is smaller than the previously smallest node, then store it away\n          walk(parse(tab.text, {locations: true}), {\n            // Call expression is used because it is pretty consistent.\n            // https://github.com/estree/estree/blob/master/es5.md#callexpression\n            CallExpression(node) {\n              // If the mouse is in bounds, then continue to checking node size\n              if (!mousePos.outside &&\n                  mousePos.line + 1 >= node.loc.start.line &&\n                  mousePos.line + 1 <= node.loc.end.line &&\n                  mousePos.ch >= node.loc.start.column &&\n                  mousePos.ch <= node.loc.end.column) {\n                let nodeSize = node.end - node.start\n                if (!smallestNode || nodeSize < smallestSize) {\n                  smallestNode = node\n                  smallestSize = nodeSize\n                }\n              }\n            }\n          })\n        } catch { }\n\n        // If a CallExpression node was found, highlight it to indicate to the user what is going on\n        this.hoverMark && this.hoverMark.clear()\n        if (smallestNode) {\n          // and mark this expression.\n          this.hoverMark = this.codeMirror.markText(\n            {\n              line: smallestNode.loc.start.line - 1,\n              ch: smallestNode.loc.start.column\n            },\n            {\n              line: smallestNode.loc.end.line - 1,\n              ch: smallestNode.loc.end.column\n            },\n            {\n              className: 'slider-token'\n            }\n          )\n        }\n\n        // Store the smallest node in the redux store\n        setCallUnderMouse(smallestNode)\n      } else {\n        clearCallUnderMouse()\n      }\n    } else {\n      clearCallUnderMouse()\n      this.hoverMark && this.hoverMark.clear()\n    }\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('keyup', this.hideSlider)\n    const activeGame = getActive(this.props.game)\n    const scrollInfo = this.codeMirror.getScrollInfo()\n    const cursorPosition = this.codeMirror.getCursor()\n    const scrollData = {\n      top: scrollInfo.top,\n      left: scrollInfo.left,\n      cursorPosition\n    }\n    this.props.setScrollData({ scrollData, tab: activeGame.key })\n    this.props.updateHistory({\n      index: activeGame.key,\n      history: this.codeMirror.getDoc().getHistory()\n    })\n  }\n\n  shouldComponentUpdate() {\n    return false\n  }\n\n  render() {\n    return (\n      <div className=\"CodeEditor\" onMouseMove={this.mouseMove}>\n        <div\n          className=\"wrapper\"\n          ref={_wrapper => {\n            this._wrapper = _wrapper\n          }}\n        >\n          <div\n            className=\"_editor\"\n            ref={_editor => {\n              this._editor = _editor\n            }}\n          />\n          <input\n            type=\"range\"\n            className=\"slider hide\"\n            step={1}\n            ref={_slider => {\n              this._slider = _slider\n            }}\n            onInput={this.handleSlider}\n          />\n          <div\n            id=\"highlighter-box\"\n            ref={_highlighterBox => {\n              this._highlighterBox = _highlighterBox\n            }}\n          />\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default CodeEditor\n","import React, { Component } from 'react'\nimport classNames from 'classnames'\nimport { connect } from 'react-redux'\nimport CodeEditor from '../components/CodeEditor.js'\nimport actions from '../actions/actions.js'\nimport { getActive } from '../reducers/game.js'\n\nconst mapStateToProps = ({ game, tutorial, docHistories, errorLine }) => ({\n  game,\n  tutorial,\n  docHistories,\n  errorLine\n})\n\nconst mapDispatchToProps = dispatch => ({\n  updateGame: ({ tab, content }) =>\n    dispatch(actions.updateGame({ tab, content })),\n  setScrollData: ({ tab, scrollData }) =>\n    dispatch(actions.setScrollData({ tab, scrollData })),\n  updateHistory: ({ index, history }) =>\n    dispatch(actions.updateHistory({ index, history })),\n  setCallUnderMouse: ({ tab, callUnderMouse }) =>\n    dispatch(actions.setCallUnderMouse({ tab, callUnderMouse })),\n  clearCallUnderMouse: ({ tab }) =>\n    dispatch(actions.clearCallUnderMouse({ tab }))\n})\n\nclass Code extends Component {\n  constructor(props) {\n    super(props)\n    this.handleTabUpdates = this.handleTabUpdates.bind(this)\n  }\n\n  handleTabUpdates(content) {\n    const tab = getActive(this.props.game).key\n    this.props.updateGame({ tab, content })\n  }\n\n  render() {\n    const {\n      game,\n      tutorial,\n      setScrollData,\n      setCallUnderMouse,\n      clearCallUnderMouse,\n      docHistories,\n      updateHistory,\n      errorLine\n    } = this.props\n\n    return (\n      <div\n        className={classNames('Code two-rows-and-grid', {\n          tutorial: tutorial !== false\n        })}\n      >\n        <div className=\"main\">\n          <CodeEditor\n            errorLine={errorLine}\n            game={game}\n            updateContent={this.handleTabUpdates}\n            setScrollData={setScrollData}\n            setCallUnderMouse={setCallUnderMouse}\n            clearCallUnderMouse={clearCallUnderMouse}\n            docHistories={docHistories}\n            updateHistory={updateHistory}\n            tutorial={tutorial}\n          />\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Code)\n","import React, { Component, Fragment } from 'react'\nimport { connect } from 'react-redux'\nimport actions from '../actions/actions.js'\nimport lessons from '../utils/lessons.json'\nimport apiDocs from '../utils/apiDocs.json'\nimport howTo from '../utils/howTo.json'\nimport shortcuts from '../utils/shortcuts.json'\n\nconst mapStateToProps = () => ({})\n\nconst mapDispatchToProps = dispatch => ({\n  setLessonIndex: lessonIndex =>\n    dispatch(\n      actions.setTutorialSlide({\n        lessonIndex,\n        slideIndex: 0\n      })\n    )\n})\n\nclass Help extends Component {\n  constructor(props) {\n    super(props)\n    this.handleLesson = this.handleLesson.bind(this)\n  }\n\n  handleLesson(lessonIndex) {\n    this.props.setLessonIndex(lessonIndex)\n  }\n\n  render() {\n    return (\n      <div className=\"Help\">\n        <div className=\"main\">\n          <ul className=\"top-list\">\n            <li>\n              SCRIPT-8 is written by Gabriel Florit (that's me!) and{' '}\n              <a\n                className=\"text\"\n                href=\"https://github.com/script-8/script-8.github.io/graphs/contributors\"\n              >\n                dedicated contributors\n              </a>\n              . Do you have a question? Or perhaps you found a bug? Tweet me at{' '}\n              <a className=\"text\" href=\"https://twitter.com/gabrielflorit\">\n                @gabrielflorit\n              </a>{' '}\n              and I'll be glad to help out. And visit the Github repository{' '}\n              <a\n                className=\"text\"\n                href=\"https://github.com/script-8/script-8.github.io\"\n              >\n                here\n              </a>\n              , where you can keep up with new features and the occasional bug\n              fix.\n            </li>\n\n            <li>\n              If you have any further questions, come join us on the{' '}\n              <a className=\"text\" href=\"https://discord.gg/HA68FNX\">\n                Fantasy Consoles Discord server\n              </a>\n              , a friendly place to chat about these sophisticated, cutting-edge\n              computers. The server has a dedicated SCRIPT-8 room.\n            </li>\n\n            <li>\n              Lessons\n              <ul className=\"lessons\">\n                {lessons.map((lesson, i) => (\n                  <li key={i}>\n                    <button\n                      className=\"button\"\n                      onClick={() => {\n                        this.handleLesson(i)\n                      }}\n                    >\n                      {i} - {lesson.shortTitle || lesson.title}\n                    </button>\n                  </li>\n                ))}\n              </ul>\n            </li>\n          </ul>\n\n          <ul className=\"top-list how\">\n            <li>\n              FAQ\n              <dl>\n                {howTo.map(([dt, dd], i) => (\n                  <Fragment key={i}>\n                    <dt>{dt}</dt>\n                    <dd dangerouslySetInnerHTML={{ __html: dd }} />\n                  </Fragment>\n                ))}\n              </dl>\n            </li>\n          </ul>\n\n          <ul className=\"top-list\">\n            <li>\n              Keyboard shortcuts\n              <dl>\n                {shortcuts.map(([dt, dd], i) => (\n                  <Fragment key={i}>\n                    <dt>{dt}</dt>\n                    <dd dangerouslySetInnerHTML={{ __html: dd }} />\n                  </Fragment>\n                ))}\n              </dl>\n            </li>\n          </ul>\n\n          <ul className=\"top-list\">\n            <li>\n              API documentation\n              <ul className=\"second-list\">\n                {apiDocs.map((section, i) => (\n                  <li key={i}>\n                    {section.title}\n                    {section.note ? <span> ({section.note})</span> : null}\n                    <dl>\n                      {section.dl.map(([dt, dd], j) => (\n                        <Fragment key={j}>\n                          <dt>{dt}</dt>\n                          <dd dangerouslySetInnerHTML={{ __html: dd }} />\n                        </Fragment>\n                      ))}\n                    </dl>\n                  </li>\n                ))}\n              </ul>\n            </li>\n          </ul>\n          <div className=\"license\">\n            <p>MIT License</p>\n            <p>Copyright (c) 2018 Gabriel Florit</p>\n            <p>\n              Permission is hereby granted, free of charge, to any person\n              obtaining a copy of this software and associated documentation\n              files (the \"Software\"), to deal in the Software without\n              restriction, including without limitation the rights to use, copy,\n              modify, merge, publish, distribute, sublicense, and/or sell copies\n              of the Software, and to permit persons to whom the Software is\n              furnished to do so, subject to the following conditions:\n            </p>\n            <p>\n              The above copyright notice and this permission notice shall be\n              included in all copies or substantial portions of the Software.\n            </p>\n            <p>\n              THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n              EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n              MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n              NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n              HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n              WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n              OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n              DEALINGS IN THE SOFTWARE.\n            </p>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Help)\n","import _ from 'lodash'\n\nconst getScore = daysAgo => {\n  if (daysAgo <= 4) {\n    return 100\n  } else if (daysAgo <= 14) {\n    return 70\n  } else if (daysAgo <= 31) {\n    return 50\n  } else if (daysAgo <= 90) {\n    return 30\n  } else {\n    return 10\n  }\n}\n\nconst parseDate = str => {\n  const mdy = str.split('-')\n  return new Date(mdy[0], mdy[1] - 1, mdy[2])\n}\n\nconst datediff = (first, second) =>\n  Math.round((second - first) / (1000 * 60 * 60 * 24))\n\nconst frecency = (visits, date) => {\n  const now = new Date()\n\n  return _(visits)\n    .map((value, key) => {\n      const daysAgo = datediff(parseDate(key), date ? parseDate(date) : now)\n      const score = getScore(daysAgo)\n      return value * score\n    })\n    .sum()\n}\n\nexport default frecency\n","const times = [\n  ['second', 1],\n  ['minute', 60],\n  ['hour', 3600],\n  ['day', 86400],\n  ['week', 604800],\n  ['month', 2592000],\n  ['year', 31536000]\n]\n\nconst timeAgo = ({ now, before }) => {\n  let diff = Math.round((now - before) / 1000)\n  for (let t = 0; t < times.length; t++) {\n    if (diff < times[t][1]) {\n      if (t === 0) {\n        return 'Just now'\n      } else {\n        diff = Math.round(diff / times[t - 1][1])\n        return diff + ' ' + times[t - 1][0] + (diff === 1 ? ' ago' : 's ago')\n      }\n    }\n  }\n}\n\nexport default timeAgo\n","import React, { Component } from 'react'\nimport _ from 'lodash'\nimport timeAgo from '../utils/timeAgo.js'\n\nclass ShelfCassettes extends Component {\n  constructor(props) {\n    super(props)\n    this.renderCassette = this.renderCassette.bind(this)\n    this.handleNext = this.handleNext.bind(this)\n    this.handlePrevious = this.handlePrevious.bind(this)\n    this.state = {\n      index: 0\n    }\n  }\n\n  handleNext() {\n    this.setState({\n      index: this.state.index + this.props.step\n    })\n  }\n\n  handlePrevious() {\n    this.setState({\n      index: Math.max(this.state.index - this.props.step, 0)\n    })\n  }\n\n  renderCassette({ cassette, i, now }) {\n    const {\n      handleOnClick,\n      tokenLogin,\n      handleSetVisibility,\n      handleRemove\n    } = this.props\n    const { isPrivate, gist, visits } = cassette\n    const visitsCount = visits ? _.sum(Object.values(visits)) : 0\n    const counter = visitsCount + cassette.counter\n    const title = cassette.title || ''\n    const maxLength = 16\n    const tooLong = title.length > maxLength\n    const finalTitle = [\n      title.substring(0, maxLength).trim(),\n      tooLong ? '' : ''\n    ].join('')\n\n    const date = new Date(cassette.updated)\n\n    return (\n      <li key={i} className=\"cassette\">\n        <div className=\"img\">\n          <span className=\"title\">{finalTitle || ''}</span>\n          <a\n            href={`/?id=${gist}`}\n            onClick={e => {\n              handleOnClick({ e, id: gist })\n            }}\n            rel=\"noopener noreferrer\"\n            target=\"_blank\"\n          >\n            <img className=\"background\" alt=\"\" src=\"./cassette-bg.png\" />\n            <span className=\"load\">load cassette</span>\n            {cassette.cover ? (\n              <img className=\"cover\" src={cassette.cover} alt=\"\" />\n            ) : null}\n          </a>\n          <span className=\"author\">\n            by <a href={`/?shelf=${cassette.user}`}>{cassette.user}</a>\n          </span>\n          <div className=\"date-info\">\n            <span className=\"date\">{timeAgo({ now, before: date })}</span>\n            <span className=\"booted\">\n              {counter || 0} play{counter === 1 ? '' : 's'}\n            </span>\n          </div>{' '}\n        </div>\n        {tokenLogin === cassette.user ? (\n          <div className=\"buttons\">\n            <button\n              className=\"button\"\n              onClick={() => {\n                handleSetVisibility({ gistId: gist, isPrivate: !isPrivate })\n              }}\n            >\n              make {isPrivate ? 'public' : 'private'}\n            </button>\n            <button\n              className=\"button\"\n              onClick={() => {\n                handleRemove({ gistId: gist })\n              }}\n            >\n              remove\n            </button>\n          </div>\n        ) : null}\n      </li>\n    )\n  }\n\n  render() {\n    const {\n      cassettes,\n      title,\n      step,\n      showAllButton,\n      handleOnShowAllClick\n    } = this.props\n    const { index } = this.state\n    const now = new Date()\n\n    return (\n      <div className=\"ShelfCassettes\">\n        <div className=\"title-nav-and-show-all\">\n          <div className=\"title-nav\">\n            <span className=\"title\">{title}</span>\n            <button\n              disabled={index <= 0}\n              className=\"button\"\n              onClick={this.handlePrevious}\n            >\n              &lt;\n            </button>\n            <button\n              disabled={index >= cassettes.length - step}\n              className=\"button\"\n              onClick={this.handleNext}\n            >\n              &gt;\n            </button>\n            <span className=\"count\">\n              {index + 1} - {Math.min(index + step, cassettes.length)} (\n              {cassettes.length} total)\n            </span>\n          </div>\n          {showAllButton ? (\n            <div className=\"show-all\">\n              <button className=\"button\" onClick={handleOnShowAllClick}>\n                show all cassettes\n              </button>\n            </div>\n          ) : null}\n        </div>\n        <ul className=\"cassettes\">\n          {_(cassettes)\n            .slice(index, index + step)\n            .map((d, i) => this.renderCassette({ cassette: d, i, now }))\n            .value()}\n        </ul>\n      </div>\n    )\n  }\n}\n\nShelfCassettes.defaultProps = {\n  step: 5,\n  showAllButton: false\n}\n\nexport default ShelfCassettes\n","import React, { Component, Fragment } from 'react'\nimport { connect } from 'react-redux'\nimport _ from 'lodash'\nimport screenTypes from '../iframe/src/utils/screenTypes.js'\nimport throwError from '../utils/throwError.js'\nimport frecency from '../utils/frecency.js'\nimport actions, { setVisibility, unshelveCassette } from '../actions/actions.js'\nimport ShelfCassettes from '../components/ShelfCassettes.js'\n\nconst mapStateToProps = ({ gist, token, shelving }) => ({\n  gist,\n  token,\n  shelving\n})\n\nconst mapDispatchToProps = dispatch => ({\n  unshelveCassette: ({ token, gistId }) =>\n    dispatch(unshelveCassette({ token, gistId })),\n  setScreen: screen => dispatch(actions.setScreen(screen)),\n  setVisibility: ({ token, gistId, isPrivate }) =>\n    dispatch(setVisibility({ token, gistId, isPrivate }))\n})\n\nclass Shelf extends Component {\n  constructor(props) {\n    super(props)\n    this.fetchCassettes = this.fetchCassettes.bind(this)\n    this.makeShelfCassettes = this.makeShelfCassettes.bind(this)\n    this.handleOnClick = this.handleOnClick.bind(this)\n    this.handleOnShowAllClick = this.handleOnShowAllClick.bind(this)\n    this.handleSetVisibility = this.handleSetVisibility.bind(this)\n    this.handleRemove = this.handleRemove.bind(this)\n    this.state = {\n      fetching: true,\n      popularCassettes: [],\n      recentCassettes: []\n    }\n  }\n\n  componentDidMount() {\n    this._isMounted = true\n    this.fetchCassettes()\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false\n    const { search } = window.location\n    const params = new window.URLSearchParams(search)\n    const gameId = params.get('id')\n    const shelfUser = params.get('shelf')\n    if (!gameId && shelfUser) {\n      window.history.pushState(null, null, '/')\n    }\n  }\n\n  fetchCassettes() {\n    const { token } = this.props\n    const currentLogin = _.get(token, 'user.login', null)\n\n    const { search } = window.location\n    const params = new window.URLSearchParams(search)\n    const shelfUser = params.get('shelf')\n\n    // If querystring doesn't have `shelf` and we are logged in,\n    // load our cassettes.\n\n    if (token.value && !shelfUser) {\n      window\n        .fetch(`${process.env.REACT_APP_NOW}/private-cassettes`, {\n          method: 'POST',\n          body: JSON.stringify({\n            token: token.value\n          })\n        })\n        .then(\n          response => response.json(),\n          error =>\n            throwError({\n              error,\n              message: `Could not request cassettes.`\n            })\n        )\n        .then(value => {\n          const yourPrivateCassettes = _(value)\n            .sortBy(cassette => +cassette.updated)\n            .reverse()\n            .value()\n\n          if (this._isMounted) {\n            this.setState({\n              yourPrivateCassettes,\n              fetching: false\n            })\n          }\n        })\n    } else {\n      if (this._isMounted) {\n        this.setState({\n          yourPrivateCassettes: []\n        })\n      }\n    }\n\n    window\n      .fetch(`${process.env.REACT_APP_NOW}/cassettes`)\n      .then(\n        response => response.json(),\n        error =>\n          throwError({\n            error,\n            message: `Could not request cassettes.`\n          })\n      )\n      .then(value => {\n        const cassettes = value.map(cassette => ({\n          ...cassette,\n          counter: +cassette.counter || 0\n        }))\n\n        const popularCassettes = _(cassettes)\n          .map(cassette => ({\n            ...cassette,\n            score: frecency(cassette.visits)\n          }))\n          .sortBy(cassette => cassette.score)\n          .reverse()\n          .value()\n\n        const recentCassettes = _(cassettes)\n          .sortBy(cassette => +cassette.updated)\n          .reverse()\n          .value()\n\n        const yourPublicCassettes = currentLogin\n          ? recentCassettes.filter(cassette => cassette.user === currentLogin)\n          : []\n\n        if (this._isMounted) {\n          this.setState({\n            popularCassettes: popularCassettes.filter(d => !d.isFork),\n            recentCassettes: recentCassettes.filter(d => !d.isFork),\n            yourPublicCassettes,\n            fetching: false\n          })\n        }\n      })\n  }\n\n  componentDidUpdate(prevProps) {\n    if (\n      (prevProps.shelving && !this.props.shelving) ||\n      prevProps.token !== this.props.token\n    ) {\n      this.setState({\n        fetching: true\n      })\n      this.fetchCassettes()\n    }\n  }\n\n  handleOnShowAllClick() {\n    window.history.pushState(null, null, '/')\n    this.setState({\n      fetching: true\n    })\n    this.fetchCassettes()\n  }\n\n  handleOnClick({ e, id }) {\n    const { gist, setScreen } = this.props\n    if (id === _.get(gist, 'data.id')) {\n      e.preventDefault()\n      setScreen(screenTypes.RUN)\n    }\n  }\n\n  handleSetVisibility({ gistId, isPrivate }) {\n    const { token, setVisibility } = this.props\n    setVisibility({ token, gistId, isPrivate })\n  }\n\n  handleRemove({ gistId }) {\n    const { token, unshelveCassette } = this.props\n    if (\n      window.confirm(\n        'Do you really want to remove this cassette from the shelf?'\n      )\n    ) {\n      unshelveCassette({ gistId, token })\n    }\n  }\n\n  // NOTE: this is currently not in use\n  makeShelfCassettes({ cassettes, title, tokenLogin }) {\n    return (\n      <ShelfCassettes\n        handleSetVisibility={this.handleSetVisibility}\n        handleRemove={this.handleRemove}\n        tokenLogin={tokenLogin}\n        handleOnClick={this.handleOnClick}\n        cassettes={cassettes}\n        title={title}\n      />\n    )\n  }\n\n  render() {\n    const {\n      popularCassettes,\n      recentCassettes,\n      yourPublicCassettes,\n      yourPrivateCassettes,\n      fetching\n    } = this.state\n\n    const tokenLogin = _.get(this.props, 'token.user.login', null)\n\n    const { search } = window.location\n    const params = new window.URLSearchParams(search)\n    const shelfUser = (params.get('shelf') || '').toLowerCase()\n\n    const userPublicCassettes = recentCassettes.filter(\n      d => d.user.toLowerCase() === shelfUser\n    )\n\n    return (\n      <div className=\"Shelf\">\n        <div className=\"main\">\n          {fetching ? (\n            <p className=\"loading\">loading cassettes...</p>\n          ) : shelfUser ? (\n            userPublicCassettes.length ? (\n              <ShelfCassettes\n                handleSetVisibility={this.handleSetVisibility}\n                handleRemove={this.handleRemove}\n                tokenLogin={tokenLogin}\n                handleOnClick={this.handleOnClick}\n                cassettes={userPublicCassettes}\n                title={`${shelfUser}'s ${\n                  tokenLogin && shelfUser === tokenLogin.toLowerCase()\n                    ? 'public'\n                    : ''\n                } cassettes`}\n                step={20}\n                showAllButton={true}\n                handleOnShowAllClick={this.handleOnShowAllClick}\n              />\n            ) : (\n              <p className=\"loading\">no cassettes found</p>\n            )\n          ) : (\n            <Fragment>\n              {yourPrivateCassettes && yourPrivateCassettes.length ? (\n                <ShelfCassettes\n                  handleSetVisibility={this.handleSetVisibility}\n                  handleRemove={this.handleRemove}\n                  tokenLogin={tokenLogin}\n                  handleOnClick={this.handleOnClick}\n                  cassettes={yourPrivateCassettes}\n                  title=\"Your private cassettes\"\n                />\n              ) : null}\n              {yourPublicCassettes && yourPublicCassettes.length ? (\n                <ShelfCassettes\n                  handleSetVisibility={this.handleSetVisibility}\n                  handleRemove={this.handleRemove}\n                  tokenLogin={tokenLogin}\n                  handleOnClick={this.handleOnClick}\n                  cassettes={yourPublicCassettes}\n                  title=\"Your public cassettes\"\n                />\n              ) : null}\n              <ShelfCassettes\n                handleSetVisibility={this.handleSetVisibility}\n                handleRemove={this.handleRemove}\n                tokenLogin={tokenLogin}\n                handleOnClick={this.handleOnClick}\n                cassettes={popularCassettes}\n                title=\"Popular cassettes\"\n              />\n              <ShelfCassettes\n                handleSetVisibility={this.handleSetVisibility}\n                handleRemove={this.handleRemove}\n                tokenLogin={tokenLogin}\n                handleOnClick={this.handleOnClick}\n                cassettes={recentCassettes}\n                title=\"Recent cassettes\"\n              />\n            </Fragment>\n          )}\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Shelf)\n","import React, { Component } from 'react'\nimport _ from 'lodash'\nimport { connect } from 'react-redux'\nimport actions from '../actions/actions.js'\nimport notices from '../utils/notices.json'\n\nconst mapStateToProps = ({ dismissedNotices }) => ({ dismissedNotices })\n\nconst mapDispatchToProps = dispatch => ({\n  dismissNotices: id => dispatch(actions.dismissNotices(id))\n})\n\nclass Notice extends Component {\n  constructor(props) {\n    super(props)\n\n    this.handleDismissNotices = this.handleDismissNotices.bind(this)\n  }\n\n  handleDismissNotices() {\n    this.props.dismissNotices(notices.map(d => d.id))\n  }\n\n  render() {\n    const newNoticeIds = _.difference(\n      notices.map(d => d.id),\n      this.props.dismissedNotices\n    )\n\n    return (\n      <div className=\"Notice\">\n        <div className=\"box\">\n          <div className=\"text\">\n            <p className=\"title\">SCRIPT-8 updates</p>\n            {_(newNoticeIds)\n              .map(id => notices.find(d => d.id === id))\n              .sortBy('id')\n              .reverse()\n              .map((notice, i) => (\n                <p key={i}>\n                  <span>{notice.date} - </span>\n                  {notice.text}\n                </p>\n              ))\n              .value()}\n          </div>\n          <button className=\"button\" onClick={this.handleDismissNotices}>\n            > OK\n          </button>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Notice)\n","import React, { Component } from 'react'\nimport classNames from 'classnames'\nimport _ from 'lodash'\nimport timeAgo from '../utils/timeAgo.js'\n\nconst DEFAULT_COMMENT = 'Insert your comment here.'\n\nconst isCommentValid = value =>\n  value && value.length && value !== DEFAULT_COMMENT\n\nclass Comments extends Component {\n  constructor(props) {\n    super(props)\n\n    this.deleteComment = this.deleteComment.bind(this)\n    this.createIssueAndComment = this.createIssueAndComment.bind(this)\n    this.fetchIssueAndComments = this.fetchIssueAndComments.bind(this)\n    this.updateUserScopes = this.updateUserScopes.bind(this)\n    this.createComment = this.createComment.bind(this)\n    this.handleCommentCreate = this.handleCommentCreate.bind(this)\n    this.handleCommentDelete = this.handleCommentDelete.bind(this)\n    this.handleCommentChange = this.handleCommentChange.bind(this)\n    this.handleLoginClick = this.handleLoginClick.bind(this)\n    this.state = {\n      commentTextarea: DEFAULT_COMMENT,\n      comments: [],\n      issue: null,\n      error: null,\n      isFetching: false,\n      scopes: ''\n    }\n  }\n\n  async updateUserScopes() {\n    const { token } = this.props\n    const currentLogin = _.get(token, 'user.login', null)\n\n    if (currentLogin) {\n      const url = `https://api.github.com/users/${currentLogin}`\n      console.log(`updateUserScopes: fetch ${url}`)\n      const response = await fetch(url, {\n        headers: {\n          Authorization: `token ${token.value}`,\n          'Content-Type': 'application/json'\n        }\n      })\n\n      if (response.headers.has('x-oauth-scopes')) {\n        this.setState({ scopes: response.headers.get('x-oauth-scopes') })\n      }\n    }\n  }\n\n  async fetchIssueAndComments() {\n    const { gameId } = this.props\n\n    // Fetch this game's issue.\n    const issueSearchUrl = `https://api.github.com/search/issues?q=${gameId}+repo:script8/script8.github.io`\n    console.log(`componentDidMount: fetch ${issueSearchUrl}.`)\n    const issueResponse = await fetch(issueSearchUrl)\n\n    // Extract the comments url from the issue.\n    const issueJson = await issueResponse.json()\n    const issue = _.get(issueJson, 'items[0]', null)\n    const commentsUrl = _.get(issueJson, 'items[0].comments_url', null)\n\n    if (issue && commentsUrl) {\n      // If we found an issue, set it on state, fetch its comments and set them on state.\n      this.setState({ issue })\n\n      console.log(`componentDidMount: fetch ${commentsUrl}.`)\n      const commentsResponse = await fetch(commentsUrl)\n      const commentsJson = await commentsResponse.json()\n      this.setState({ comments: commentsJson })\n    }\n\n    this.updateUserScopes()\n  }\n\n  componentDidMount() {\n    this.fetchIssueAndComments()\n  }\n\n  async createIssueAndComment() {\n    await this.createIssue()\n    await this.createComment()\n  }\n\n  async createIssue() {\n    const { token, gameId } = this.props\n\n    this.setState({\n      isFetching: true\n    })\n\n    // Create an issue.\n    const url = `https://api.github.com/repos/script8/script8.github.io/issues`\n    const options = {\n      method: 'POST',\n      headers: {\n        Authorization: `token ${token.value}`,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({ title: gameId })\n    }\n\n    console.log(`createIssue: fetching ${url}`)\n    const response = await fetch(url, options)\n    if (response.status === 201) {\n      const json = await response.json()\n      this.setState({\n        issue: json,\n        isFetching: false\n      })\n    } else {\n      this.setState({\n        isFetching: false\n      })\n      throw new Error(response.statusText)\n    }\n  }\n\n  async createComment() {\n    const { token } = this.props\n    const { issue, commentTextarea } = this.state\n\n    this.setState({\n      isFetching: true\n    })\n\n    const url = `https://api.github.com/repos/script8/script8.github.io/issues/${issue.number}/comments`\n    const options = {\n      method: 'POST',\n      headers: {\n        Authorization: `token ${token.value}`,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({ body: commentTextarea })\n    }\n\n    // POST the commentTextarea to this issue.\n    console.log(`createComment: fetch ${url}`)\n    const response = await fetch(url, options)\n    // If we got a 201 status, which means CREATED,\n    if (response.status === 201) {\n      // parse the response,\n      const json = await response.json()\n      // then add the new comment to the bottom of our existing comments,\n      // reset the comment textarea,\n      // and also reset isFetching.\n      this.setState({\n        isFetching: false,\n        comments: [...this.state.comments, json],\n        commentTextarea: DEFAULT_COMMENT\n      })\n    } else {\n      // If we didn't get a 201, something else happened.\n      // Throw an error so we can handle it elsewhere.\n      throw new Error(response.statusText)\n    }\n  }\n\n  async deleteComment(commentId) {\n    const { token } = this.props\n\n    this.setState({\n      isFetching: true\n    })\n\n    const url = `https://api.github.com/repos/script8/script8.github.io/issues/comments/${commentId}`\n    const options = {\n      method: 'DELETE',\n      headers: {\n        Authorization: `token ${token.value}`\n      }\n    }\n\n    console.log(`handleCommentDelete: fetch ${url}`)\n    const response = await fetch(url, options)\n    if (response.status === 204) {\n      this.setState({\n        isFetching: false,\n        comments: this.state.comments.filter(\n          comment => comment.id !== commentId\n        )\n      })\n    } else {\n      this.setState({\n        isFetching: false,\n        error: response.statusText\n      })\n    }\n  }\n\n  handleCommentDelete(commentId) {\n    this.deleteComment(commentId)\n  }\n\n  handleCommentCreate() {\n    const { issue, commentTextarea, isFetching } = this.state\n\n    console.log({ commentTextarea, isFetching, issue })\n\n    // If we have an valid comment and we're not fetching:\n    if (!isFetching && isCommentValid(commentTextarea)) {\n      // If we don't have an issue, first create it.\n      if (!issue) {\n        try {\n          console.log('creating issue and comment')\n          this.createIssueAndComment()\n        } catch (e) {\n          this.setState({ isFetching: false, error: e.message })\n        }\n      } else {\n        try {\n          console.log('creating comment')\n          this.createComment()\n        } catch (e) {\n          this.setState({ isFetching: false, error: e.message })\n        }\n      }\n    }\n  }\n\n  handleCommentChange(e) {\n    this.setState({ commentTextarea: e.target.value, error: null })\n  }\n\n  handleLoginClick() {\n    window.open(\n      `https://github.com/login/oauth/authorize?client_id=${process.env.REACT_APP_CLIENT_ID}&scope=gist public_repo`,\n      'popup',\n      'width=600,height=700'\n    )\n  }\n\n  componentDidUpdate(prevProps) {\n    const { token: oldToken } = prevProps\n    const { token } = this.props\n\n    if (oldToken.value !== token.value) {\n      this.updateUserScopes()\n    }\n  }\n\n  render() {\n    const { token } = this.props\n    const { commentTextarea, comments, isFetching, error, scopes } = this.state\n    const now = new Date()\n\n    const currentLogin = _.get(token, 'user.login', null)\n    const disableAddCommentButton =\n      isFetching || !isCommentValid(commentTextarea)\n\n    const userHasCorrectScopes = scopes.includes('public_repo')\n\n    // User can comment only if there is a login, and it has the right scopes.\n    const userCanComment = !!currentLogin && userHasCorrectScopes\n\n    return (\n      <div className=\"Comments\">\n        <ul>\n          {comments.map((comment, i) => (\n            <li key={i}>\n              <div className=\"info\">\n                <span className=\"user\">{comment.user.login}</span>\n                <span className=\"time\">\n                  {timeAgo({ now, before: new Date(comment.updated_at) })}\n                </span>\n                {currentLogin && currentLogin === comment.user.login && (\n                  <button\n                    className=\"button delete\"\n                    onClick={() => {\n                      this.handleCommentDelete(comment.id)\n                    }}\n                  >\n                    > delete\n                  </button>\n                )}\n              </div>\n              <div className=\"comment\">{comment.body}</div>\n            </li>\n          ))}\n        </ul>\n        {userCanComment && (\n          <div className=\"comment-box\">\n            <textarea\n              value={commentTextarea}\n              onChange={this.handleCommentChange}\n            ></textarea>\n            <div className=\"ok-button\">\n              <button\n                className=\"button\"\n                disabled={disableAddCommentButton}\n                onClick={this.handleCommentCreate}\n              >\n                > Add comment\n              </button>\n            </div>\n            {error && <div className=\"error\">Error: {error}</div>}\n          </div>\n        )}\n        {!userCanComment && (\n          <div className=\"comment-login-prompt\">\n            <button className=\"button\" onClick={this.handleLoginClick}>\n              >{' '}\n              {currentLogin && !userHasCorrectScopes\n                ? 'please login again to comment'\n                : 'login to comment'}\n            </button>\n          </div>\n        )}\n        <div\n          className={classNames('loading', {\n            'is-fetching': isFetching\n          })}\n        >\n          LOAD\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default Comments\n","import { Component } from 'react'\nimport _ from 'lodash'\nimport { connect } from 'react-redux'\n\nconst mapStateToProps = ({ gist }) => ({\n  gist\n})\n\nconst mapDispatchToProps = () => ({})\n\nclass Updater extends Component {\n  componentDidMount () {\n    // on component mount,\n    // if we have an id in the gist,\n    // make sure the url reflects this\n    const { gist } = this.props\n    const id = _.get(gist, 'data.id')\n    if (id) {\n      this.updateUrl(id)\n    }\n  }\n\n  componentDidUpdate (prevProps) {\n    // when we get new props,\n    // if the previous gist id is different than this one,\n    // update url!\n    const { gist } = this.props\n    const oldId = _.get(prevProps, 'gist.data.id')\n    const newId = _.get(gist, 'data.id')\n    if (newId !== oldId) {\n      this.updateUrl(newId)\n    }\n  }\n\n  updateUrl (newId) {\n    const { search } = window.location\n    const params = new window.URLSearchParams(search)\n    const urlId = params.get('id')\n    if (urlId !== newId) {\n      window.history.pushState(null, null, newId ? `/?id=${newId}` : '/')\n    }\n  }\n\n  render () {\n    return null\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Updater)\n","import equal from 'deep-equal'\nimport initialState from '../iframe/src/store/initialState.js'\n\nconst isBlank = ({ game, sprites, map, phrases, chains, songs }) =>\n  equal(game, initialState.game) &&\n  equal(sprites, initialState.sprites) &&\n  equal(map, initialState.map) &&\n  equal(phrases, initialState.phrases) &&\n  equal(chains, initialState.chains) &&\n  equal(songs, initialState.songs)\n\nexport default isBlank\n","import React, { Component } from 'react'\nimport { connect } from 'react-redux'\nimport classNames from 'classnames'\nimport _ from 'lodash'\nimport screenTypes, {\n  getPreviousScreen,\n  getNextScreen\n} from '../iframe/src/utils/screenTypes.js'\nimport isDirty from '../utils/isDirty.js'\nimport getGameTitle from '../utils/getGameTitle.js'\nimport canRecord from '../utils/canRecord.js'\nimport isBlank from '../utils/isBlank.js'\nimport actions, {\n  saveGist,\n  fetchToken,\n  putOnShelf\n} from '../actions/actions.js'\nimport { getActive } from '../reducers/game.js'\nimport { assembleOrderedGame } from '../iframe/src/gistParsers/game.js'\nimport { version } from '../iframe/package.json'\n\nconst { platform } = window.navigator\n\nconst downloadHtml = html => {\n  const element = document.createElement('a')\n  element.setAttribute(\n    'href',\n    'data:text/plain;charset=utf-8,' + encodeURIComponent(html)\n  )\n  element.setAttribute('download', 'index.html')\n  element.style.display = 'none'\n  document.body.appendChild(element)\n  element.click()\n  document.body.removeChild(element)\n}\n\nconst mapStateToProps = ({\n  iframeVersion,\n  gist,\n  game,\n  sprites,\n  map,\n  phrases,\n  chains,\n  songs,\n  token,\n  shelving,\n  screen,\n  nextAction,\n  sound\n}) => ({\n  iframeVersion,\n  screen,\n  gist,\n  game,\n  sprites,\n  map,\n  phrases,\n  chains,\n  songs,\n  token,\n  isFetching: gist.isFetching || token.isFetching || shelving,\n  nextAction,\n  sound\n})\n\nconst mapDispatchToProps = dispatch => ({\n  updateIframeVersion: () => dispatch(actions.updateIframeVersion()),\n  clearToken: () => dispatch(actions.clearToken()),\n  setCodeTab: tab => dispatch(actions.setCodeTab(tab)),\n  toggleSound: () => dispatch(actions.toggleSound()),\n  clearNextAction: () => dispatch(actions.clearNextAction()),\n  fetchToken: token => dispatch(fetchToken(token)),\n  newGame: screen => dispatch(actions.newGame(screen)),\n  putOnShelf: ({ user, gist, cover, title, isFork, isPrivate, token }) =>\n    dispatch(\n      putOnShelf({ user, gist, cover, title, isFork, isPrivate, token })\n    ),\n  saveGist: ({\n    iframeVersion,\n    game,\n    token,\n    gist,\n    sprites,\n    map,\n    phrases,\n    chains,\n    songs,\n    toFork\n  }) =>\n    dispatch(\n      saveGist({\n        iframeVersion,\n        game,\n        token,\n        gist,\n        sprites,\n        map,\n        phrases,\n        chains,\n        songs,\n        toFork\n      })\n    ),\n  setNextAction: nextAction => dispatch(actions.setNextAction(nextAction)),\n  setScreen: screen => dispatch(actions.setScreen(screen))\n})\n\nclass Menu extends Component {\n  constructor(props) {\n    super(props)\n    this.keydown = this.keydown.bind(this)\n    this.onExport = this.onExport.bind(this)\n    this.onRecordClick = this.onRecordClick.bind(this)\n    this.onLoginClick = this.onLoginClick.bind(this)\n    this.onInsertBlankClick = this.onInsertBlankClick.bind(this)\n    this.onPutOnShelfClick = this.onPutOnShelfClick.bind(this)\n    this.record = this.record.bind(this)\n    this.onClose = this.onClose.bind(this)\n    this.onUpdateIframeVersion = this.onUpdateIframeVersion.bind(this)\n    window.script8.handleCode = props.fetchToken\n\n    window.addEventListener('beforeunload', this.onClose)\n  }\n\n  componentDidUpdate() {\n    const { token, nextAction, clearNextAction } = this.props\n    if (token.value && nextAction) {\n      clearNextAction()\n      if (nextAction === 'record') {\n        this.record()\n      }\n      if (nextAction === 'recordToFork') {\n        this.record(true)\n      }\n    }\n  }\n\n  keydown(event) {\n    const { screen, game, setCodeTab, setScreen, token } = this.props\n\n    const { altKey, code, metaKey, ctrlKey } = event\n\n    // If we pressed Cmd-S or Ctrl-S,\n    if (\n      (metaKey && code === 'KeyS' && _.includes(platform, 'Mac')) ||\n      (ctrlKey && code === 'KeyS' && !_.includes(platform, 'Mac'))\n    ) {\n      // and we're logged in,\n      // and we can save,\n      if (token.value && canRecord(this.props)) {\n        // save.\n        this.onRecordClick(false)\n        event.preventDefault()\n      }\n    }\n\n    // If we pressed Alt,\n    if (altKey) {\n      // and we're on the CODE screen,\n      if (screen === screenTypes.CODE) {\n        // Get the current code tab.\n        const codeTab = +getActive(game).key\n\n        // Then see if we pressed [ or ],\n        // and if so, cycle through tabs appropriately.\n        if (code === 'BracketLeft') {\n          setCodeTab((codeTab - 1 + 8) % 8)\n          event.preventDefault()\n        }\n        if (code === 'BracketRight') {\n          setCodeTab((codeTab + 1) % 8)\n          event.preventDefault()\n        }\n      }\n\n      if (code === 'Period') {\n        setScreen(getPreviousScreen(screen))\n        event.preventDefault()\n      }\n      if (code === 'Slash') {\n        setScreen(getNextScreen(screen))\n        event.preventDefault()\n      }\n    }\n  }\n\n  componentDidMount() {\n    window.addEventListener('keydown', this.keydown)\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('beforeunload', this.onClose)\n    window.removeEventListener('keydown', this.keydown)\n  }\n\n  onUpdateIframeVersion() {\n    if (\n      window.confirm(\n        'Do you really want to update to the latest SCRIPT-8 API? This change cannot be reverted.'\n      )\n    ) {\n      this.props.updateIframeVersion()\n    }\n  }\n\n  onExport() {\n    const { gist, game } = this.props\n    const title = getGameTitle(game).toUpperCase()\n    const gistId = _.get(gist, 'data.id', null)\n    const url = `https://script8.github.io/iframe-v${version}.html`\n\n    window\n      .fetch(url)\n      .then(response => response.text())\n      .then(text => {\n        const html = text\n          .replace(\n            '<title>script-8-iframe</title>',\n            `<title>${title}</title><style>#root canvas.master { width: 100vmin; height: 100vmin; }</style>`\n          )\n          .replace(\n            '<body>',\n            `<body><script>window.SCRIPT_8_EMBEDDED_GIST_ID=\"${gistId}\";</script>`\n          )\n        downloadHtml(html)\n      })\n  }\n\n  onClose(e) {\n    const {\n      gist,\n      game,\n      sprites,\n      map,\n      phrases,\n      chains,\n      songs,\n      iframeVersion\n    } = this.props\n    const dirty = isDirty({\n      gist,\n      game,\n      sprites,\n      map,\n      phrases,\n      chains,\n      songs,\n      iframeVersion\n    })\n    if (dirty) {\n      const message = 'Leave site? Changes you made may not be saved.'\n      e.returnValue = message\n      return message\n    }\n  }\n\n  onLoginClick() {\n    const { token, clearToken } = this.props\n    const loggedIn = !!token.value\n\n    if (loggedIn) {\n      clearToken()\n    } else {\n      window.open(\n        `https://github.com/login/oauth/authorize?client_id=${process.env.REACT_APP_CLIENT_ID}&scope=gist public_repo`,\n        'popup',\n        'width=600,height=700'\n      )\n    }\n  }\n\n  onInsertBlankClick() {\n    const {\n      gist,\n      game,\n      sprites,\n      map,\n      phrases,\n      chains,\n      songs,\n      iframeVersion\n    } = this.props\n\n    const dirty = isDirty({\n      gist,\n      game,\n      sprites,\n      map,\n      phrases,\n      chains,\n      songs,\n      iframeVersion\n    })\n\n    if (\n      !dirty ||\n      window.confirm(\n        'You have not recorded the cassette. Changes will be lost. Are you sure?'\n      )\n    ) {\n      this.props.newGame(this.props.screen)\n    }\n  }\n\n  onPutOnShelfClick(isPrivate) {\n    const { putOnShelf, gist, game, token } = this.props\n\n    const gistUser = _.get(gist, 'data.owner.login', null)\n    const gistId = _.get(gist, 'data.id', null)\n    const isFork = !!_.get(gist, 'data.fork_of', null)\n\n    const title = getGameTitle(game)\n\n    const payload = {\n      user: gistUser,\n      gist: gistId,\n      title,\n      isFork,\n      isPrivate,\n      token\n    }\n\n    const iframe = document.querySelector('iframe')\n\n    if (iframe) {\n      const channel = new window.MessageChannel()\n      iframe.contentWindow.postMessage(\n        {\n          type: 'image'\n        },\n        '*',\n        [channel.port2]\n      )\n      channel.port1.onmessage = e => {\n        const { data } = e\n        putOnShelf({\n          ...payload,\n          cover: data\n        })\n      }\n    } else {\n      putOnShelf(payload)\n    }\n  }\n\n  onRecordClick(toFork) {\n    const { token, setNextAction } = this.props\n\n    if (\n      !toFork ||\n      window.confirm('Do you really want to record to a blank cassette?')\n    ) {\n      // If we're not logged in,\n      if (!token.value) {\n        // remind ourselves to record next,\n        setNextAction(toFork ? 'recordToFork' : 'record')\n\n        // and log in.\n        window.open(\n          `https://github.com/login/oauth/authorize?client_id=${process.env.REACT_APP_CLIENT_ID}&scope=gist public_repo`,\n          'popup',\n          'width=600,height=700'\n        )\n      } else {\n        // If we are logged in, record.\n        this.record(toFork)\n      }\n    }\n  }\n\n  record(toFork) {\n    const {\n      iframeVersion,\n      token,\n      game,\n      saveGist,\n      gist,\n      sprites,\n      map,\n      phrases,\n      chains,\n      songs\n    } = this.props\n    saveGist({\n      iframeVersion,\n      token,\n      game,\n      sprites,\n      map,\n      phrases,\n      chains,\n      songs,\n      gist,\n      toFork\n    })\n  }\n\n  render() {\n    const {\n      screen,\n      gist,\n      token,\n      game,\n      sprites,\n      map,\n      phrases,\n      chains,\n      songs,\n      setScreen,\n      sound,\n      toggleSound,\n      setCodeTab,\n      isFetching,\n      iframeVersion\n    } = this.props\n\n    // If the game isn't equal to the gist,\n    // set flag to dirty.\n    const dirty = isDirty({\n      gist,\n      game,\n      sprites,\n      map,\n      phrases,\n      chains,\n      songs,\n      iframeVersion\n    })\n\n    const blank = isBlank({ game, sprites, map, phrases, chains, songs })\n\n    const contentIsEmpty =\n      _.isEmpty(assembleOrderedGame(game)) &&\n      _.isEmpty(sprites) &&\n      _.isEmpty(map) &&\n      _.isEmpty(phrases) &&\n      _.isEmpty(chains) &&\n      _.isEmpty(songs)\n\n    // If gistLogin is null, gist was created anonymously.\n    const gistLogin = _.get(gist, 'data.owner.login', null)\n\n    // If gistLogin does not match currentLogin, gist wasn't created by us.\n    const currentLogin = _.get(token, 'user.login', null)\n\n    // INSERT BLANK can only be enabled when:\n    // - the gist is not empty\n    // - OR content is not NEW_GAME template\n    const enableInsertBlank = !_.isEmpty(gist) || !blank\n\n    const enableRecord = canRecord(this.props)\n\n    // RECORD TO FORK can only be enabled when:\n    // - gist is NOT empty AND\n    //    - gist is not ours (anonymous or user that is not us)\n    //    - OR there is something to save (content is non-null)\n    const enableRecordToFork =\n      !_.isEmpty(gist) &&\n      (gistLogin === null || gistLogin !== currentLogin || !contentIsEmpty)\n\n    const isMine = currentLogin && currentLogin === gistLogin\n\n    // SHELVE can only happen when:\n    // - gist is ours AND\n    // - content is NOT dirty\n    const canShelve = isMine && !dirty\n\n    const isMusicScreen = [\n      screenTypes.SONG,\n      screenTypes.CHAIN,\n      screenTypes.PHRASE\n    ].includes(screen)\n\n    const isArtScreen = [screenTypes.SPRITE, screenTypes.MAP].includes(screen)\n\n    const codeTab = getActive(game).key\n    const codeTabSuffix = screen === screenTypes.CODE ? ` ${codeTab}` : ''\n\n    const loggedIn = !!token.value\n\n    const canUpdateIframeVersion = iframeVersion && iframeVersion !== version\n\n    return (\n      <nav className=\"Menu\">\n        <ul>\n          <li>\n            <button\n              onClick={() => {\n                setScreen(screenTypes.HOME)\n              }}\n              className={classNames('button', {\n                active: screen === screenTypes.HOME\n              })}\n            >\n              <span className=\"full\">SCRIPT-8</span>\n              <span className=\"mid\">SCRIPT-8</span>\n              <span className=\"small\">\n                {screen === screenTypes.HOME ? 'script-8' : 's-8'}\n              </span>\n            </button>\n            <ul className=\"dropdown\">\n              <li>\n                <button\n                  onClick={this.onLoginClick}\n                  className=\"button\"\n                  disabled={loggedIn}\n                >\n                  Login\n                </button>\n              </li>\n              <li>\n                <button\n                  onClick={this.onLoginClick}\n                  className=\"button\"\n                  disabled={!loggedIn}\n                >\n                  Logout\n                </button>\n              </li>\n            </ul>\n          </li>\n          <li>\n            <button className=\"button\">\n              <span className=\"full\">cassette</span>\n              <span className=\"mid\">cas</span>\n              <span className=\"small\">ca</span>\n              <span className={classNames({ invisible: !dirty })}>*</span>\n            </button>\n            <ul className=\"dropdown\">\n              <li>\n                <button\n                  onClick={this.onInsertBlankClick}\n                  className=\"button\"\n                  disabled={!enableInsertBlank}\n                >\n                  Insert new\n                </button>\n              </li>\n\n              <li>\n                <button\n                  onClick={() => {\n                    this.onRecordClick(false)\n                  }}\n                  className=\"button\"\n                  disabled={!enableRecord}\n                >\n                  Record\n                </button>\n              </li>\n\n              <li>\n                <button\n                  onClick={() => {\n                    this.onRecordClick(true)\n                  }}\n                  className=\"button\"\n                  disabled={!enableRecordToFork}\n                >\n                  Record to blank\n                </button>\n              </li>\n\n              <li>\n                <button\n                  onClick={() => {\n                    this.onPutOnShelfClick(true)\n                  }}\n                  disabled={!canShelve}\n                  className=\"button\"\n                >\n                  Put on private shelf\n                </button>\n              </li>\n              <li>\n                <button\n                  onClick={() => {\n                    this.onPutOnShelfClick(false)\n                  }}\n                  disabled={!canShelve}\n                  className=\"button\"\n                >\n                  Put on public shelf\n                </button>\n              </li>\n              <li>\n                {isMine && false ? (\n                  <button\n                    onClick={this.onExport}\n                    disabled={!canShelve}\n                    className=\"button\"\n                  >\n                    Export to HTML\n                  </button>\n                ) : null}\n              </li>\n              <li>\n                {canUpdateIframeVersion ? (\n                  <button\n                    onClick={this.onUpdateIframeVersion}\n                    className=\"button\"\n                  >\n                    UPDATE SCRIPT-8 API\n                  </button>\n                ) : null}\n              </li>\n            </ul>\n          </li>\n\n          <li>\n            <button\n              onClick={() => {\n                setScreen(screenTypes.CODE)\n              }}\n              className={classNames('button', {\n                active: screen === screenTypes.CODE\n              })}\n            >\n              <span className=\"full\">CODE{codeTabSuffix}</span>\n              <span className=\"mid\">\n                {screen === screenTypes.CODE\n                  ? `code${codeTabSuffix}`\n                  : `cod${codeTabSuffix}`}\n              </span>\n              <span className=\"small\">\n                {screen === screenTypes.CODE\n                  ? `code${codeTabSuffix}`\n                  : `co${codeTabSuffix}`}\n              </span>\n            </button>\n            <ul className=\"dropdown\">\n              {_.range(8).map(d => (\n                <li key={d}>\n                  <button\n                    className=\"button\"\n                    onClick={() => {\n                      setCodeTab(d)\n                      setScreen(screenTypes.CODE)\n                    }}\n                  >\n                    CODE {d}\n                  </button>\n                </li>\n              ))}\n            </ul>\n          </li>\n\n          <li>\n            <button\n              onClick={() => {\n                setScreen(screenTypes.SPRITE)\n              }}\n              className={classNames('button', {\n                active: isArtScreen\n              })}\n            >\n              <span className=\"full\">{isArtScreen ? screen : 'ART'}</span>\n              <span className=\"mid\">{isArtScreen ? screen : 'ART'}</span>\n              <span className=\"small\">\n                {isArtScreen ? screen.substring(0, 2) : 'AR'}\n              </span>\n            </button>\n            <ul className=\"dropdown\">\n              <li>\n                <button\n                  onClick={() => {\n                    setScreen(screenTypes.SPRITE)\n                  }}\n                  className={classNames('button', {\n                    active: screen === screenTypes.SPRITE\n                  })}\n                >\n                  SPRITE\n                </button>\n              </li>\n\n              <li>\n                <button\n                  onClick={() => {\n                    setScreen(screenTypes.MAP)\n                  }}\n                  className={classNames('button', {\n                    active: screen === screenTypes.MAP\n                  })}\n                >\n                  MAP\n                </button>\n              </li>\n            </ul>\n          </li>\n\n          <li>\n            <button\n              onClick={() => {\n                setScreen(screenTypes.PHRASE)\n              }}\n              className={classNames('button', {\n                active: isMusicScreen\n              })}\n            >\n              <span className=\"full\">{isMusicScreen ? screen : 'music'}</span>\n              <span className=\"mid\">{isMusicScreen ? screen : 'mus'}</span>\n              <span className=\"small\">\n                {isMusicScreen ? screen.substring(0, 2) : 'mu'}\n              </span>\n            </button>\n            <ul className=\"dropdown\">\n              <li>\n                <button\n                  onClick={() => {\n                    setScreen(screenTypes.PHRASE)\n                  }}\n                  className={classNames('button', {\n                    active: screen === screenTypes.PHRASE\n                  })}\n                >\n                  PHRASE\n                </button>\n              </li>\n\n              <li>\n                <button\n                  onClick={() => {\n                    setScreen(screenTypes.CHAIN)\n                  }}\n                  className={classNames('button', {\n                    active: screen === screenTypes.CHAIN\n                  })}\n                >\n                  CHAIN\n                </button>\n              </li>\n\n              <li>\n                <button\n                  onClick={() => {\n                    setScreen(screenTypes.SONG)\n                  }}\n                  className={classNames('button', {\n                    active: screen === screenTypes.SONG\n                  })}\n                >\n                  SONG\n                </button>\n              </li>\n            </ul>\n          </li>\n\n          <li>\n            <button\n              onClick={() => {\n                setScreen(screenTypes.HELP)\n              }}\n              className={classNames('button', {\n                active: screen === screenTypes.HELP\n              })}\n            >\n              <span className=\"full\">HELP</span>\n              <span className=\"mid\">\n                {screen === screenTypes.HELP ? 'help' : 'hel'}\n              </span>\n              <span className=\"small\">\n                {screen === screenTypes.HELP ? 'help' : 'he'}\n              </span>\n            </button>\n          </li>\n\n          <li>\n            <button\n              onClick={() => {\n                setScreen(screenTypes.SHELF)\n              }}\n              className={classNames('button', {\n                active: screen === screenTypes.SHELF\n              })}\n            >\n              <span className=\"full\">SHELF</span>\n              <span className=\"mid\">\n                {screen === screenTypes.SHELF ? 'shelf' : 'she'}\n              </span>\n              <span className=\"small\">\n                {screen === screenTypes.SHELF ? 'shelf' : 'sh'}\n              </span>\n            </button>\n          </li>\n\n          <li>\n            <button\n              onClick={() => {\n                setScreen(screenTypes.RUN)\n              }}\n              className={classNames('button', {\n                active: screen === screenTypes.RUN\n              })}\n            >\n              <span className=\"full\">RUN</span>\n              <span className=\"mid\">run</span>\n              <span className=\"small\">\n                {screen === screenTypes.RUN ? 'run' : 'ru'}\n              </span>\n            </button>\n          </li>\n\n          <li\n            className={classNames({\n              hide: screen !== screenTypes.RUN\n            })}\n          >\n            <button onClick={toggleSound} className=\"button\">\n              <span className=\"full\">{sound ? '' : 'un'}mute</span>\n              <span className=\"mid\">{sound ? '' : 'un'}mute</span>\n              <span className=\"small\">{sound ? '' : 'un'}mute</span>\n            </button>\n          </li>\n        </ul>\n        <ul>\n          <li>\n            <button\n              className={classNames('button', 'title', {\n                'is-fetching': isFetching\n              })}\n            >\n              <span>load</span>\n            </button>\n          </li>\n        </ul>\n      </nav>\n    )\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Menu)\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport Updater from '../containers/Updater.js'\nimport Menu from '../containers/Menu.js'\n\nconst TopBar = ({ hideMenu }) => (\n  <div\n    className={classNames('TopBar', {\n      show: !hideMenu\n    })}\n  >\n    <Updater />\n    <Menu />\n  </div>\n)\n\nTopBar.propTypes = {\n  hideMenu: PropTypes.bool\n}\n\nexport default TopBar\n","import React, { Component } from 'react'\n\nclass ErrorBoundary extends Component {\n  constructor (props) {\n    super(props)\n    this.state = { hasError: false }\n  }\n\n  componentDidCatch (error, errorInfo) {\n    this.setState({\n      error,\n      errorInfo\n    })\n  }\n\n  render () {\n    const { error, errorInfo } = this.state\n    if (errorInfo) {\n      // Error path\n      return (\n        <div className='ErrorBoundary'>\n          <h2>Something went wrong.</h2>\n          <details style={{ whiteSpace: 'pre-wrap' }}>\n            {error && error.toString()}\n            <br />\n            {errorInfo.componentStack}\n          </details>\n        </div>\n      )\n    }\n    // Normally, just render children\n    return this.props.children\n  }\n}\n\nexport default ErrorBoundary\n","/*\nTODO\n- on insert new, probably best to run clear() and also stop any music.\n- the cassettes on SHELF don't correctly reflect last updated. fix this.\n*/\n\nimport React, { Component } from 'react'\nimport { connect } from 'react-redux'\nimport includes from 'lodash/includes'\nimport classNames from 'classnames'\nimport _ from 'lodash'\nimport Boot from './Boot.js'\nimport Home from './Home.js'\nimport Output from './Output.js'\nimport Sprite from './Sprite.js'\nimport Map from './Map.js'\nimport Phrase from './Phrase.js'\nimport Chain from './Chain.js'\nimport Song from './Song.js'\nimport Tutorial from './Tutorial.js'\nimport Code from './Code.js'\nimport Help from './Help.js'\nimport Shelf from './Shelf.js'\nimport Notice from './Notice.js'\nimport Comments from '../components/Comments.js'\nimport TopBar from '../components/TopBar.js'\nimport ErrorBoundary from '../components/ErrorBoundary.js'\nimport screenTypes from '../iframe/src/utils/screenTypes.js'\nimport notices from '../utils/notices.json'\nimport { version } from '../iframe/package.json'\nimport '../css/App.css'\n\nconsole.log(JSON.stringify(`SCRIPT-8 app v ${version}`, null, 2))\n\nconst mapStateToProps = ({\n  gist,\n  screen,\n  tutorial,\n  dismissedNotices,\n  token,\n  hideMenu\n}) => ({\n  gist,\n  screen,\n  tutorial,\n  dismissedNotices,\n  token,\n  hideMenu\n})\n\nconst mapDispatchToProps = () => ({})\n\n// Show notice only if:\n// - we're logged in\n// - we're the owner of this cassette\n// - there is at least one notice we haven't dismissed\nconst shouldShowNotice = props => {\n  const { gist, token } = props\n\n  // If gistLogin is null, gist was created anonymously.\n  const gistLogin = _.get(gist, 'data.owner.login', null)\n\n  // If gistLogin does not match currentLogin, gist wasn't created by us.\n  const currentLogin = _.get(token, 'user.login', null)\n\n  // Are we owner of this cassette?\n  const isMine = currentLogin && currentLogin === gistLogin\n\n  // Is there at least one notice we haven't dismissed?\n  const newNoticeIds = _.difference(\n    notices.map(d => d.id),\n    props.dismissedNotices\n  )\n\n  return isMine && newNoticeIds.length\n}\n\nconst options = {\n  [screenTypes.BOOT]: () => <Boot />,\n  [screenTypes.HOME]: () => <Home />,\n  [screenTypes.SPRITE]: () => <Sprite />,\n  [screenTypes.MAP]: () => <Map />,\n  [screenTypes.PHRASE]: () => <Phrase />,\n  [screenTypes.CHAIN]: () => <Chain />,\n  [screenTypes.SONG]: () => <Song />,\n  [screenTypes.RUN]: () => null,\n  [screenTypes.CODE]: () => <Code />,\n  [screenTypes.HELP]: () => <Help />,\n  [screenTypes.SHELF]: () => <Shelf />\n}\n\nclass App extends Component {\n  constructor(props) {\n    super(props)\n    this.tutorialElement = React.createRef()\n    this.appElement = null\n    this.setAppElementRef = e => {\n      this.appElement = e\n    }\n  }\n\n  componentDidUpdate() {\n    // Get the tutorial's height and set App's padding-bottom to this.\n    if (this.tutorialElement && this.tutorialElement.current) {\n      const { clientHeight } = this.tutorialElement.current\n      this.appElement.style.paddingBottom = `${clientHeight}px`\n    } else {\n      this.appElement.style.paddingBottom = '0'\n    }\n\n    const showNotice = shouldShowNotice(this.props)\n\n    if (showNotice) {\n      document.body.classList.add('overflow-hidden')\n    } else {\n      document.body.classList.remove('overflow-hidden')\n    }\n  }\n\n  render() {\n    const { screen, tutorial, hideMenu, token, gist } = this.props\n\n    const gameId = _.get(gist, 'data.id', null)\n    const showNotice = shouldShowNotice(this.props)\n\n    return (\n      <ErrorBoundary>\n        <div\n          ref={this.setAppElementRef}\n          className={classNames('App', `App-${screen}`, {\n            'full-height': includes(\n              [screenTypes.BOOT, screenTypes.CODE],\n              screen\n            )\n          })}\n        >\n          <TopBar hideMenu={hideMenu} />\n          {options[screen]()}\n          <Output />\n          {tutorial ? (\n            <Tutorial\n              className={classNames({\n                'in-RUN': screen === screenTypes.RUN\n              })}\n              tutorialRef={this.tutorialElement}\n            />\n          ) : null}\n          {showNotice ? <Notice /> : null}\n          {screen === screenTypes.RUN && gameId && (\n            <Comments gameId={gameId} token={token} />\n          )}\n        </div>\n      </ErrorBoundary>\n    )\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App)\n","import * as Tone from 'tone'\nimport { handleActions } from 'redux-actions'\nimport includes from 'lodash/includes'\nimport screenTypes from '../iframe/src/utils/screenTypes.js'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\n\nconst screen = handleActions(\n  {\n    [actionTypes.SET_SCREEN]: (state, action) => {\n      if (\n        includes(\n          [\n            screenTypes.PHRASE,\n            screenTypes.CHAIN,\n            screenTypes.SONG,\n            screenTypes.RUN\n          ],\n          action.payload\n        )\n      ) {\n        if (\n          Tone &&\n          Tone.context &&\n          Tone.context.state &&\n          Tone.context.state !== 'running'\n        ) {\n          Tone.start()\n        }\n      }\n      return action.payload\n    }\n  },\n  initialState.screen\n)\n\nexport default screen\n","import { handleActions } from 'redux-actions'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\n\nconst gist = handleActions(\n  {\n    [actionTypes.NEW_GAME]: () => {},\n    [actionTypes.FETCH_GIST_REQUEST]: () => ({\n      isFetching: true\n    }),\n    [actionTypes.FETCH_GIST_SUCCESS]: (state, action) => ({\n      isFetching: false,\n      data: action.payload\n    }),\n    [actionTypes.SAVE_GIST_REQUEST]: state => ({\n      data: state.data,\n      isFetching: true\n    }),\n    [actionTypes.SAVE_GIST_SUCCESS]: (state, action) => ({\n      isFetching: false,\n      data: action.payload\n    })\n  },\n  initialState.gist\n)\n\nexport default gist\n","import { handleActions } from 'redux-actions'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\n\nconst booted = handleActions(\n  {\n    [actionTypes.FINISH_BOOT]: (state, action) => true\n  },\n  initialState.booted\n)\n\nexport default booted\n","import { handleActions } from 'redux-actions'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\n\nconst token = handleActions(\n  {\n    [actionTypes.CLEAR_TOKEN]: () => initialState.token,\n    [actionTypes.TOKEN_REQUEST]: () => ({\n      isFetching: true\n    }),\n    [actionTypes.TOKEN_SUCCESS]: (state, action) => ({\n      value: action.payload.token,\n      user: action.payload.user\n    })\n  },\n  initialState.token\n)\n\nexport default token\n","import { handleActions } from 'redux-actions'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\n\nconst nextAction = handleActions(\n  {\n    [actionTypes.SET_NEXT_ACTION]: (state, action) => action.payload,\n    [actionTypes.CLEAR_NEXT_ACTION]: () => null\n  },\n  initialState.nextAction\n)\n\nexport default nextAction\n","import omitEmpty from 'omit-empty'\nimport { handleActions } from 'redux-actions'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\nimport { extractGistSprites } from '../iframe/src/gistParsers/sprites.js'\n\nconst sprites = handleActions(\n  {\n    [actionTypes.NEW_GAME]: () => initialState.sprites,\n    [actionTypes.FETCH_GIST_SUCCESS]: (state, action) =>\n      extractGistSprites(action.payload),\n    [actionTypes.UPDATE_SPRITE]: (state, { payload }) => {\n      const { sprite } = payload\n      return omitEmpty({\n        ...state,\n        [payload.index]:\n          sprite && sprite.slice(0, 8).filter(d => d !== '        ').length\n            ? sprite\n            : null\n      })\n    }\n  },\n  initialState.sprites\n)\n\nexport default sprites\n","import { handleActions } from 'redux-actions'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\nimport { extractGistMap } from '../iframe/src/gistParsers/map.js'\n\nconst map = handleActions(\n  {\n    [actionTypes.NEW_GAME]: () => initialState.map,\n    [actionTypes.FETCH_GIST_SUCCESS]: (state, action) =>\n      extractGistMap(action.payload),\n    [actionTypes.UPDATE_MAP]: (state, action) => action.payload\n  },\n  initialState.map\n)\n\nexport default map\n","import _ from 'lodash'\nimport omitEmpty from 'omit-empty'\nimport { handleActions } from 'redux-actions'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\nimport { extractGistPhrases } from '../iframe/src/gistParsers/phrases.js'\n\nconst phrases = handleActions(\n  {\n    [actionTypes.NEW_GAME]: () => initialState.phrases,\n    [actionTypes.FETCH_GIST_SUCCESS]: (state, action) =>\n      extractGistPhrases(action.payload),\n    [actionTypes.UPDATE_PHRASE]: (state, { payload }) => {\n      const { index, phrase } = payload\n      return omitEmpty({\n        ...state,\n        [index]:\n          phrase &&\n          !_.isEmpty(phrase.notes) &&\n          Object.values(phrase.notes).filter(d => !_.isNil(d)).length\n            ? phrase\n            : null\n      })\n    }\n  },\n  initialState.phrases\n)\n\nexport default phrases\n","import omitEmpty from 'omit-empty'\nimport { handleActions } from 'redux-actions'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\nimport { extractGistChains } from '../iframe/src/gistParsers/chains.js'\n\nconst chains = handleActions(\n  {\n    [actionTypes.NEW_GAME]: () => initialState.chains,\n    [actionTypes.FETCH_GIST_SUCCESS]: (state, action) =>\n      extractGistChains(action.payload),\n    [actionTypes.UPDATE_CHAIN]: (state, { payload }) =>\n      omitEmpty({\n        ...state,\n        [payload.index]: payload.chain\n      })\n  },\n  initialState.chains\n)\n\nexport default chains\n","import omitEmpty from 'omit-empty'\nimport { handleActions } from 'redux-actions'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\nimport { extractGistSongs } from '../iframe/src/gistParsers/songs.js'\n\nconst songs = handleActions(\n  {\n    [actionTypes.NEW_GAME]: () => initialState.songs,\n    [actionTypes.FETCH_GIST_SUCCESS]: (state, action) =>\n      extractGistSongs(action.payload),\n    [actionTypes.UPDATE_SONG]: (state, { payload }) =>\n      omitEmpty({\n        ...state,\n        [payload.index]: payload.song\n      })\n  },\n  initialState.songs\n)\n\nexport default songs\n","import { handleActions } from 'redux-actions'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\n\nconst tutorial = handleActions(\n  {\n    [actionTypes.CLOSE_TUTORIAL]: () => null,\n    [actionTypes.SET_TUTORIAL_SLIDE]: (state, action) => action.payload\n  },\n  initialState.tutorial\n)\n\nexport default tutorial\n","import { handleActions } from 'redux-actions'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\n\nconst sound = handleActions(\n  {\n    [actionTypes.TOGGLE_SOUND]: (state, action) => !state\n  },\n  initialState.sound\n)\n\nexport default sound\n","import { handleActions } from 'redux-actions'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\n\nconst shelving = handleActions(\n  {\n    [actionTypes.UNSHELVE_CASSETTE_REQUEST]: () => true,\n    [actionTypes.UNSHELVE_CASSETTE_SUCCESS]: () => false,\n    [actionTypes.SHELVE_CASSETTE_REQUEST]: () => true,\n    [actionTypes.SHELVE_CASSETTE_SUCCESS]: () => false,\n    [actionTypes.SET_VISIBILITY_REQUEST]: () => true,\n    [actionTypes.SET_VISIBILITY_SUCCESS]: () => false\n  },\n  initialState.shelving\n)\n\nexport default shelving\n","import { handleActions } from 'redux-actions'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\n\nconst docHistories = handleActions(\n  {\n    [actionTypes.NEW_GAME]: () => initialState.docHistories,\n    [actionTypes.UPDATE_HISTORY]: (state, { payload }) => ({\n      ...state,\n      [payload.index]: payload.history\n    })\n  },\n  initialState.docHistories\n)\n\nexport default docHistories\n","import { handleActions } from 'redux-actions'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\n\nconst dismissedNotices = handleActions(\n  {\n    [actionTypes.DISMISS_NOTICES]: (state, { payload }) => [...payload]\n  },\n  initialState.dismissedNotices\n)\n\nexport default dismissedNotices\n","import { handleActions } from 'redux-actions'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\n\nconst selectedUi = handleActions(\n  {\n    [actionTypes.SELECT_UI]: (state, { payload }) => ({\n      ...payload\n    })\n  },\n  initialState.selectedUi\n)\n\nexport default selectedUi\n","import { handleActions } from 'redux-actions'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\n\nconst errorLine = handleActions(\n  {\n    [actionTypes.SET_ERROR_LINE]: (state, action) => action.payload\n  },\n  initialState.errorLine\n)\n\nexport default errorLine\n","import { handleActions } from 'redux-actions'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\nimport { parseGistIframeVersion } from '../iframe/src/gistParsers/iframeVersion.js'\n\nconst iframeVersion = handleActions(\n  {\n    [actionTypes.UPDATE_IFRAME_VERSION]: () => initialState.iframeVersion,\n    [actionTypes.NEW_GAME]: () => initialState.iframeVersion,\n    [actionTypes.FETCH_GIST_SUCCESS]: (state, action) =>\n      parseGistIframeVersion(action.payload)\n  },\n  initialState.iframeVersion\n)\n\nexport default iframeVersion\n","import { handleActions } from 'redux-actions'\nimport includes from 'lodash/includes'\nimport actionTypes from '../actions/actionTypes.js'\nimport initialState from '../iframe/src/store/initialState.js'\nimport screenTypes from '../iframe/src/utils/screenTypes.js'\n\nconst hideMenu = handleActions(\n  {\n    [actionTypes.TOGGLE_MENU]: (state, action) => !state,\n    [actionTypes.SET_SCREEN]: (state, action) => {\n      if (!includes([screenTypes.BOOT, screenTypes.RUN], action.payload)) {\n        return false\n      } else {\n        return state\n      }\n    }\n  },\n  initialState.hideMenu\n)\n\nexport default hideMenu\n","import { combineReducers } from 'redux'\nimport screen from './screen.js'\nimport gist from './gist.js'\nimport booted from './booted.js'\nimport game from './game.js'\nimport token from './token.js'\nimport nextAction from './nextAction.js'\nimport sprites from './sprites.js'\nimport map from './map.js'\nimport phrases from './phrases.js'\nimport chains from './chains.js'\nimport songs from './songs.js'\nimport tutorial from './tutorial.js'\nimport sound from './sound.js'\nimport shelving from './shelving.js'\nimport docHistories from './docHistories.js'\nimport dismissedNotices from './dismissedNotices.js'\nimport selectedUi from './selectedUi.js'\nimport errorLine from './errorLine.js'\nimport iframeVersion from './iframeVersion.js'\nimport hideMenu from './hideMenu.js'\n\nconst reducer = combineReducers({\n  hideMenu,\n  iframeVersion,\n  errorLine,\n  screen,\n  gist,\n  booted,\n  token,\n  game,\n  nextAction,\n  sprites,\n  map,\n  phrases,\n  chains,\n  songs,\n  tutorial,\n  sound,\n  shelving,\n  docHistories,\n  dismissedNotices,\n  selectedUi\n})\n\nexport default reducer\n","import thunkMiddleware from 'redux-thunk'\nimport { createStore, applyMiddleware, compose } from 'redux'\nimport reducer from '../reducers/reducer.js'\nimport { loadState, saveState } from './localStorage.js'\n// import setupSocket from './setupSocket.js'\n\nconst persistedState = loadState()\n\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose\n\nconst store = createStore(\n  reducer,\n  persistedState,\n  composeEnhancers(applyMiddleware(thunkMiddleware))\n)\n\n// if (process.env.NODE_ENV !== 'production') {\n//   setupSocket(store.dispatch)\n// }\n\nstore.subscribe(() => {\n  saveState({\n    token: store.getState().token,\n    dismissedNotices: store.getState().dismissedNotices\n  })\n})\n\nexport default store\n","const key = 'script-8-1'\n\nconst loadState = () => {\n  try {\n    const serializedState = localStorage.getItem(key)\n    if (serializedState === null) {\n      return undefined\n    }\n    return JSON.parse(serializedState)\n  } catch (error) {\n    return undefined\n  }\n}\n\nconst saveState = state => {\n  try {\n    const serializedState = JSON.stringify(state)\n    localStorage.setItem(key, serializedState)\n  } catch (error) {\n    console.error(error)\n  }\n}\n\nexport { loadState, saveState }\n","import React from 'react'\nimport { render } from 'react-dom'\nimport { Provider } from 'react-redux'\nimport App from './containers/App.js'\nimport store from './store/store.js'\n\nwindow.script8 = window.script8 || {}\n\nrender(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.getElementById('root')\n)\n"],"sourceRoot":""}